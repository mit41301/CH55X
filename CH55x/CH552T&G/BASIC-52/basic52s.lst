
C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 1





        8051 Macro Assembler   C 5 1 A S M   V 1.2
        ==========================================



        Source File:     basic52s.asm
        Object File(s):  basic52s.hex
        List File:       basic52s.lst



 Line    I  Addr Code           Source

    1:                          $mod51
    2:                          ;                                       
    3:                          ; WCH CH552T/G ëŒâûÉoÅ[ÉWÉáÉì(SFRÉAÉNÉZÉ
    4:                          ;   Internal Clock 24MHz, CPU Clock(Fsys
    5:                          ;   Timer2 Ç UART0 ÇÃÉVÉäÉAÉãÉ|Å[ÉgópÉN
    6:                          ;   ÉVÉäÉAÉãÉ|Å[ÉgÇÃé©ìÆë¨ìxîFéØã@î\Ç™ê≥
    7:                          ;
    8:                          ;   SFRóÃàÊÇÃÉAÉNÉZÉXã@î\Çí«â¡
    9:                          ;   I2CSFR  (C) H.-J. Boehling & D. Wulf
   10:                          ;
   11:                          ;***************************************
   12:                          ;*                                      
   13:                          ;*                    MCS-BASIC-52 V1.31
   14:                          ;*                           12/1986 til
   15:                          ;*       The original source code of V1.
   16:                          ;*            Intel Corporation, Embedde
   17:                          ;*                             is public
   18:                          ;*                                      
   19:                          ;***************************************
   20:                          ;
   21:                          ;***************************************
   22:                          ;* General alterations made by D. Wulf, 
   23:                          ;* e-mail: Detlef.Wulf@onlinehome.de    
   24:                          ;***************************************
   25:                          ;
   26:                          ;  The following general alterations are
   27:                          ;
   28:                          ;  - The original source code had 2 file
   29:                          ;    been incorporated into this file fo
   30:                          ;
   31:                          ;  - All absolute and relativ jumps and 
   32:                          ;    with labels.
   33:                          ;
   34:                          ;  - All machine code in the original so
   35:                          ;    by the menomics.
   36:                          ;
   37:                          ;  - One routine in the source was diffe
   38:                          ;    by the ROM code.
   39:                          ;
   40:                          ;  - Some "ORG" statements between BASIC
   41:                          ;    out.
   42:                          ;
   43:                          ;  - To get room for new code the "ego m

C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 2



 Line    I  Addr Code           Source

   44:                          ;    (Remarked with "Sorry")
   45:                          ;
   46:                          ;  - To get more room for new code the "
   47:                          ;    (Remarked with "get room")
   48:                          ;
   49:                          ;***************************************
   50:                          ;* Bugfixes for MCS-52-BASIC from D. Kar
   51:                          ;* e-mail: dankarmann@lucent.com        
   52:                          ;***************************************
   53:                          ;
   54:                          ;  - Corrected Intel bug to allow BASIC 
   55:                          ;    command extensions to work.
   56:                          ;    (Remarked as Karmann 1)
   57:                          ;
   58:                          ;  - Corrected Intel bug to that discard
   59:                          ;    F, FP, FPR and FPRO and followed by
   60:                          ;    (Remarked as Karmann 2)
   61:                          ;
   62:                          ;***************************************
   63:                          ;* Bugfix and performance for MCS-52-BAS
   64:                          ;* D. Mudric and Z. Stojsavljevic descip
   65:                          ;* Elektor Electronics magazine german i
   66:                          ;***************************************
   67:                          ;
   68:                          ;  - Modifications to the unprocess a BA
   69:                          ;    (Remarked as Elektor 1)
   70:                          ;
   71:                          ;  - Modifications to the floating point
   72:                          ;    (Remarked as Elektor 2)
   73:                          ;
   74:                          ;  - HEX to BIN performance improvements
   75:                          ;    (Remarked as Elektor 3)
   76:                          ;
   77:                          ; The same article describes a fix for t
   78:                          ; the fixes did not work.
   79:                          ;
   80:                          ; The multiplicaton underflow bug is now
   81:                          ;    (Remarked as Wulf 1)
   82:                          ;
   83:                          ;***************************************
   84:                          ;* Change UV-EPROM to EEPROM programming
   85:                          ;* e-mail: r.skowronek@kfa-juelich.de   
   86:                          ;***************************************
   87:                          ;
   88:                          ; This altered section of code writes th
   89:                          ; EEPROM just like the ROM resident Basi
   90:                          ; The EEPROM is connected just like a RA
   91:                          ; and gets it's adresses from the real a
   92:                          ; difference from the normal setup is th
   93:                          ; P1.4, which supplies the program pulse
   94:                          ; can be located in externally ROM and i
   95:                          ; EEPROMs!
   96:                          ; (Remarked as Skowronek)
   97:                          ;
   98:                          ; The original code from R. Skowronek di
   99:                          ; this feature is added by D. Wulf.

C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 3



 Line    I  Addr Code           Source

  100:                          ; Memory is now limited to 32K bytes RAM
  101:                          ; would change the EEPROM.
  102:                          ;
  103:                          ;***************************************
  104:                          ;* Change timer 0 from 13 bit to 16 bit 
  105:                          ;* from D. Wulf 1/2000                  
  106:                          ;***************************************
  107:                          ;
  108:                          ; The max. value for XTAL is now 7862747
  109:                          ; Dallas 80C320 high speed / low power m
  110:                          ; The defaut crystal value is still 1105
  111:                          ; XTAL or patch the souce code at
  112:                          ;
  113:                          ;	17F1H = 11
  114:                          ;	17F0H = 05
  115:                          ;	17EFH = 92
  116:                          ;	17EEH = 00
  117:                          ;
  118:                          ; with a new crystal value.
  119:                          ; (Remarket as Wulf 2)
  120:                          ;
  121:                          ;***************************************
  122:                          ;* New baudrate detection from D. Wulf 1
  123:                          ;***************************************
  124:                          ;
  125:                          ; The new baudrate detection uses timer 
  126:                          ; the code loop timing. So the Dallas 80
  127:                          ; used. Also at higher clock speeds the 
  128:                          ; (Remarked as Wulf 3)
  129:                          ;
  130:                          ;***************************************
  131:                          ;* New processor type detection from D. 
  132:                          ;***************************************
  133:                          ;
  134:                          ; A new reset routine detects the proces
  135:                          ; used with the following controllers:
  136:                          ;
  137:                          ; 8032, 87C52#, Dallas 80C320, 80515*#, 
  138:                          ; 80537*, 80575 or similars.
  139:                          ;
  140:                          ; - On processor types marked with the "
  141:                          ;   baudrates, depending on the crystal 
  142:                          ; - The processor types marked with the 
  143:                          ;   V1.3 can be located there, because i
  144:                          ;
  145:                          ; (Remarked as Wulf 4)
  146:                          ;
  147:                          ;***************************************
  148:                          ;* OPBYTE 43H for POP from H.-J. Boehlin
  149:                          ;* e-mail: H-Boehling@gmx.de            
  150:                          ;***************************************
  151:                          ;
  152:                          ; A feature of BASIC-52 is the ability t
  153:                          ; representing commands or instructions 
  154:                          ; routines. For using system routines in
  155:                          ; operation bytes (for more information 

C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 4



 Line    I  Addr Code           Source

  156:                          ; In the original souce code is no OPCOD
  157:                          ; stack and store in a variable.
  158:                          ; With BASIC-52 V1.3 you can use OPBYTE 
  159:                          ; "POP" statement.
  160:                          ; (Remarked as Boehling 1)
  161:                          ;
  162:                          ;***************************************
  163:                          ;* Reset millisecond counter on "TIME=" 
  164:                          ;***************************************
  165:                          ;
  166:                          ; The command "TIME=0" now zeros the mil
  167:                          ; returns with zero.
  168:                          ; (Remarked as Boehling 2)
  169:                          ;
  170:                          ;***************************************
  171:                          ;* New command "ERASE" by H.-J. Boehling
  172:                          ;***************************************
  173:                          ;
  174:                          ; To erase an EEPROM (fill 16K byte up t
  175:                          ; "ERASE" is implemented. It takes 2 min
  176:                          ; (Remarked as Boehling 3)
  177:                          ;
  178:                          ;***************************************
  179:                          ;* Correct "ASC(x)" bug by D. Wulf 2/200
  180:                          ;***************************************
  181:                          ;
  182:                          ; BASIC-51 V1.1 gives erroneous results 
  183:                          ; one of the following signs : *, +, -, 
  184:                          ; BASIC-51 V1.3 returns the correct valu
  185:                          ; (Remarked as Wulf 5)
  186:                          ;
  187:                          ;***************************************
  188:                          ;***************************************
  189:                          ; To indicate the new version the start 
  190:                          ; *MCS-51(tm) BASIC V1.1* to
  191:                          ; *MCS-BASIC-52 V1.31*
  192:                          ;
  193:                          ; H.-J. Boehling, D. Wulf 11/26/2001
  194:                          ;***************************************
  195:                          ;
  196:           N      00C8    T2CON	EQU	0C8H ; This three lines are ne
  197:           N      00CC    TL2	EQU	0CCH ; MCS-51 Family Cross Assem
  198:           N      00CD    TH2	EQU	0CDH ; from W.W. Heinz (e-mail: 
  199:                          ;
  200:                          ;=== CH552 Added =====
  201:           N      00C9    T2MOD		EQU	0C9H	; T2MOD define
  202:           N      00B9    CLOCK_CFG	EQU	0B9H	; System clock config
  203:           N      00A1    SAFE_MOD	EQU	0A1H	; Safe mode control re
  204:                          ;=====================
  205:                          ;
  206:                          	;**************************************
  207:                          	;
  208:                          	; TRAP VECTORS TO MONITOR
  209:                          	;
  210:                          	; RESET TAG (0AAH) ---------2001H
  211:                          	;

C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 5



 Line    I  Addr Code           Source

  212:                          	; TAG LOCATION (5AH) ------ 2002H
  213:                          	;
  214:                          	; EXTERNAL INTERRUPT 0 ---- 2040H
  215:                          	;
  216:                          	; COMMAND MODE ENTRY ------ 2048H
  217:                          	;
  218:                          	; SERIAL PORT ------------- 2050H
  219:                          	;
  220:                          	; MONITOR (BUBBLE) OUTPUT - 2058H
  221:                          	;
  222:                          	; MONITOR (BUBBLE) INPUT -- 2060H
  223:                          	;
  224:                          	; MONITOR (BUBBLE) CSTS --- 2068H
  225:                          	;
  226:                          	; GET USER JUMP VECTOR ---- 2070H
  227:                          	;
  228:                          	; GET USER LOOKUP VECTOR -- 2078H
  229:                          	;
  230:                          	; PRINT AT VECTOR --------- 2080H
  231:                          	;
  232:                          	; INTERRUPT PWM ----------- 2088H
  233:                          	;
  234:                          	; EXTERNAL RESET ---------- 2090H
  235:                          	;
  236:                          	; USER OUTPUT-------------- 4030H
  237:                          	;
  238:                          	; USER INPUT -------------- 4033H
  239:                          	;
  240:                          	; USER CSTS --------------- 4036H
  241:                          	;
  242:                          	; USER RESET -------------- 4039H
  243:                          	;
  244:                          	; USER DEFINED PRINT @ ---  403CH
  245:                          	;
  246:                          	;**************************************
  247:                          	;
  248:                          	;**************************************
  249:                          	;
  250:                          	; MCS - 52  -  8K BASIC VERSION 1.3
  251:                          	;
  252:                          	;**************************************
  253:                          	;
  254:      0000 61 8B          	AJMP	CRST		;START THE PROGRAM
  255:      0002 37             	ADDC	A,@R1
  256:                          	;
  257:           N      0003    	ORG	3H
  258:                          	;
  259:                          	;**************************************
  260:                          	;
  261:                          	;EXTERNAL INTERRUPT 0
  262:                          	;
  263:                          	;**************************************
  264:                          	;
  265:      0003 20 31 2D       	JB	DRQ,STQ 	;SEE IF DMA IS SET
  266:      0006 C0 D0          	PUSH	PSW		;SAVE THE STATUS
  267:      0008 02 40 03       	LJMP	4003H		;JUMP TO USER IF NOT SET

C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 6



 Line    I  Addr Code           Source

  268:                          	;
  269:           N      000B    	ORG	0BH
  270:                          	;
  271:                          	;**************************************
  272:                          	;
  273:                          	;TIMER 0 OVERFLOW INTERRUPT
  274:                          	;
  275:                          	;**************************************
  276:                          	;
  277:      000B C0 D0          	PUSH	PSW		;SAVE THE STATUS
  278:      000D 20 2E 10       	JB	C_BIT,STJ	;SEE IF USER WANTS INTERRU
  279:      0010 02 40 0B       	LJMP	400BH		;EXIT IF USER WANTS INTERRU
  280:                          	;
  281:           N      0013    	ORG	13H
  282:                          	;
  283:                          	;**************************************
  284:                          	;
  285:                          	;EXTERNAL INTERRUPT 1
  286:                          	;
  287:                          	;**************************************
  288:                          	;
  289:      0013 20 12 2B       	JB	INTBIT,STK
  290:      0016 C0 D0          	PUSH	PSW
  291:      0018 02 40 13       	LJMP	4013H
  292:                          	;
  293:                          	;
  294:           N      001B    	ORG	1BH
  295:                          	;
  296:                          	;**************************************
  297:                          	;
  298:                          	;TIMER 1 OVERFLOW INTERRUPT
  299:                          	;
  300:                          	;**************************************
  301:                          	;
  302:      001B C0 D0          	PUSH	PSW
  303:      001D 02 1F 78       	LJMP	CKS_I
  304:                          	;
  305:      0020 02 19 02       STJ:	LJMP	I_DR		;DO THE INTERRUPT
  306:                          	;
  307:                          	;**************************************
  308:                          	;
  309:                          	;SERIAL PORT INTERRUPT
  310:                          	;
  311:                          	;**************************************
  312:                          	;
  313:           N      0023    	ORG	23H
  314:                          	;
  315:      0023 C0 D0          	PUSH	PSW
  316:      0025 20 1F 1C       	JB	SPINT,STU	;SEE IF MONITOR EANTS INTE
  317:      0028 02 40 23       	LJMP	4023H
  318:                          	;
  319:           N      002B    	ORG	2BH
  320:                          	;
  321:                          	;**************************************
  322:                          	;
  323:                          	;TIMER 2 OVERFLOW INTERRUPT

C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 7



 Line    I  Addr Code           Source

  324:                          	;
  325:                          	;**************************************
  326:                          	;
  327:      002B C0 D0          	PUSH	PSW
  328:      002D 02 40 2B       	LJMP	402BH
  329:                          	;
  330:                          	;**************************************
  331:                          	;
  332:                          	;USER ENTRY
  333:                          	;
  334:                          	;**************************************
  335:                          	;
  336:           N      0030    	ORG	30H
  337:                          	;
  338:      0030 02 19 3F       	LJMP	IBLK		;LINK TO USER BLOCK
  339:                          	;
  340:      0033 20 26 08       STQ:	JB	I_T0,STS	;SEE IF MONITOR WANTS I
  341:      0036 C2 96          	CLR	DACK
  342:      0038 30 B2 FD       	JNB	P3.2,$		;WAIT FOR DMA TO END
  343:      003B D2 96          	SETB	DACK
  344:      003D 32             	RETI
  345:                          	;
  346:      003E 02 20 40       STS:	LJMP	2040H		;GO TO THE MONITOR
  347:                          	;
  348:      0041 D2 16          STK:	SETB	INTPEN		;TELL BASIC AN INTERRU
  349:      0043 32             	RETI
  350:                          	;
  351:      0044 02 20 50       STU:	LJMP	2050H		;SERIAL PORT INTERRUPT
  352:                          	;
  353:                          	;
  354:                          	;**************************************
  355:                          	;
  356:                          	; This is the equate table for 8052 bas
  357:                          	;
  358:                          	;**************************************
  359:                          	;
  360:                          	; The register to direct equates for CJ
  361:                          	;
  362:           N      0000    R0B0	EQU	0
  363:           N      0001    R1B0	EQU	1
  364:           N      0002    R2B0	EQU	2
  365:           N      0003    R3B0	EQU	3
  366:           N      0004    R4B0	EQU	4
  367:           N      0005    R5B0	EQU	5
  368:           N      0006    R6B0	EQU	6
  369:           N      0007    R7B0	EQU	7
  370:                          	;
  371:                          	; Register bank 1 contains the text poi
  372:                          	; and the arg stack pointer.
  373:                          	;
  374:           N      0008    TXAL	EQU	8		;R0 BANK 1 = TEXT POINTER LO
  375:           N      0009    ASTKA	EQU	9		;R1 BANK 1 = ARG STACK
  376:           N      000A    TXAH	EQU	10		;R2 BANK 1 = TEXT POINTER H
  377:                          	;
  378:                          	; Now five temporary locations that are
  379:                          	;

C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 8



 Line    I  Addr Code           Source

  380:           N      000B    TEMP1	EQU	11
  381:           N      000C    TEMP2	EQU	12
  382:           N      000D    TEMP3	EQU	13
  383:           N      000E    TEMP4	EQU	14
  384:           N      000F    TEMP5	EQU	15
  385:                          	;
  386:                          	; Register bank 2 contains the read tex
  387:                          	; and the control stack pointer.
  388:                          	;
  389:           N      0010    RTXAL	EQU	16		;R0 BANK 2 = READ TEXT POI
  390:           N      0011    CSTKA	EQU	17		;R1 BANK 2 = CONTROL STACK
  391:           N      0012    RTXAH	EQU	18		;R2 BANK 2 = READ TEXT POI
  392:                          	;
  393:                          	; Now some internal system equates.
  394:                          	;
  395:           N      0013    BOFAH	EQU	19		;START OF THE BASIC PROGRA
  396:           N      0014    BOFAL	EQU	20		;START OF THE BASIC PROGRA
  397:           N      0015    NULLCT	EQU	21		;NULL COUNT
  398:           N      0016    PHEAD	EQU	22		;PRINT HEAD POSITION
  399:           N      0017    FORMAT	EQU	23
  400:                          	;
  401:                          	; Register bank 3 is for the user and c
  402:                          	; by basic
  403:                          	;
  404:                          	;
  405:                          	;
  406:                          	; Now everything else is used by basic.
  407:                          	; First the bit locations, these use by
  408:                          	;
  409:           B        10    OTS		BIT	16	;34.0-ON TIME INSTRUCTION EX
  410:           B        11    INPROG		BIT	17	;34.1-INTERRUPT IN PROCES
  411:           B        12    INTBIT		BIT	18	;34.2-INTERRUPT SET BIT
  412:           B        13    ON_ERR		BIT	19	;34.3-ON ERROR EXECUTED
  413:           B        14    OTI		BIT	20	;34.4-ON TIME INTERRUPT IN P
  414:           B        15    LINEB		BIT	21	;34.5-LINE CHANGE OCCURED
  415:           B        16    INTPEN		BIT	22	;34.6-INTERRUPT PENDING B
  416:           B        17    CONB		BIT	23	;34.7-CAN CONTINUE IF SET
  417:           B        18    GTRD		BIT	24	;35.0-READ GET LOCATION
  418:           B        19    LPB		BIT	25	;35.1-PRINT TO LINE PRINTER 
  419:           B        1A    CKS_B		BIT	26	;35.2-FOR PWM INTERRUPT
  420:           B        1B    COB		BIT	27	;35.3-CONSOLE OUT BIT
  421:                          				;     0 = SERIAL PORT
  422:                          				;     1 = LINE PRINTER
  423:           B        1C    COUB		BIT	28	;35.4-USER CONSOLE OUT BIT
  424:                          				;     0 = SERIAL PORT
  425:                          				;     1 = USER DRIVER
  426:           B        1D    INBIT		BIT	29	;35.5-INITIALIZATION BIT
  427:           B        1E    CIUB		BIT	30	;35.6-USER CONSOLE IN BIT
  428:                          				;     0 = SERIAL PORT
  429:                          				;     1 = USER ROUTINE
  430:           B        1F    SPINT		BIT	31	;35.7-SERIAL PORT INTERRUP
  431:           B        20    STOPBIT 	BIT	32	;36.0-PROGRAM STOP ENCOU
  432:           B        21    U_IDL		BIT	33	;36.1-USER IDLE BREAK
  433:           B        22    INP_B		BIT	34	;36.2-SET DURING INPUT INS
  434:                          ;DCMPXZ 	BIT	35	;36.3-DCMPX ZERO FLAG
  435:           B        24    ARGF		BIT	36	;36.4-ARG STACK HAS A VALUE

C51ASM V1.2             Copyright (c) 2009 Atmel Corp.            PAGE 9



 Line    I  Addr Code           Source

  436:           B        25    RETBIT		BIT	37	;36.5-RET FROM INTERRUPT 
  437:           B        26    I_T0		BIT	38	;36.6-TRAP INTERRUPT ZERO T
  438:           B        27    UPB		BIT	39	;36.7-SET WHEN @ IS VALID
  439:                          
  440:                          ;
  441:                          ;***************************************
  442:                          ;****** Sorry - but the ego message had 
  443:                          ;
  444:                          ;JKBIT		BIT	40	;37.0-WB TRIGGER We use t
  445:                          ;
  446:           B        28    mul_underflow	BIT	40	;37.0-mul_limit_cas
  447:                          ;
  448:                          ;***************************************
  449:                          ;
  450:           B        29    ENDBIT		BIT	41	;37.1-GET END OF PROGRAM
  451:           B        2A    UBIT		BIT	42	;37.2-FOR DIM STATEMENT
  452:           B        2B    ISAV		BIT	43	;37.3-SAVE INTERRUPT STATUS
  453:           B        2C    BO		BIT	44	;37.4-BUBBLE OUTPUT
  454:           B        2D    XBIT		BIT	45	;37.5-EXTERNAL PROGRAM PRES
  455:           B        2E    C_BIT		BIT	46	;37.6-SET WHEN CLOCK RUNNI
  456:           B        2F    DIRF		BIT	47	;37.7-DIRECT INPUT MODE
  457:           B        30    NO_C		BIT	48	;38.0-NO CONTROL C
  458:           B        31    DRQ		BIT	49	;38.1-DMA ENABLED
  459:           B        32    BI		BIT	50	;38.2-BUBBLE INPUT
  460:                          ;
  461:                          ;***************************************
  462:                          ;****** Disable Intel programming for to
  463:                          ;
  464:                          ;INTELB 	BIT	51	;38.3-INTELLIGENT PROM P
  465:                          ;
  466:                          ;***************************************
  467:                          ;
  468:           B        34    C0ORX1		BIT	52	;38.4-PRINT FROM ROM OR R
  469:           B        35    CNT_S		BIT	53	;38.5-CONTROL S ENCOUNTERE
  470:           B        36    ZSURP		BIT	54	;38.6-ZERO SUPRESS
  471:           B        37    HMODE		BIT	55	;38.7-HEX MODE PRINT
  472:           B        97    LP		BIT	P1.7	;SOFTWARE LINE PRINTER
  473:           B        96    DACK		BIT	P1.6	;DMA ACK
  474:                          ;***************************************
  475:                          ;
  476:                          ;PROMV		BIT	P1.5	;TURN ON PROM VOLTAGE
  477:                          ;PROMP		BIT	P1.4	;PROM PULSE
  478:                          ;ALED		BIT	P1.3	;ALE DISABLE
  479:                          ;
  480:                          ;***************************************
  481:           B        92    T_BIT		BIT	P1.2	;I/O TOGGLE BIT
  482:           B        DF    BD		BIT	0DFH	;Baudrategenerator 805x7,x5
  483:                          	;
  484:                          	;
  485:                          	; The next location is a bit addressabl
  486:                          	;
  487:           N      0027    BABC	EQU	39
  488:                          	;
  489:                          	; Now floating point and the other temp
  490:                          	;
  491:                          	; FP Uses to locations 03CH

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 10



 Line    I  Addr Code           Source

  492:                          	;
  493:                          	; Now the stack designators.
  494:                          	;
  495:           N      003E    SPSAV	EQU	3EH
  496:           N      003F    S_LEN	EQU	3FH
  497:           N      0040    T_HH	EQU	40H
  498:           N      0041    T_LL	EQU	41H
  499:           N      0042    INTXAH	EQU	42H
  500:           N      0043    INTXAL	EQU	43H
  501:           N      0045    MT1	EQU	45H
  502:           N      0046    MT2	EQU	46H
  503:           N      0047    MILLIV	EQU	47H		;Real Time Clock 5 milli
  504:           N      0048    TVH	EQU	48H		;Real Time Clock high byte
  505:           N      0049    TVL	EQU	49H		;Real Time Clock low byte
  506:           N      004A    SAVE_T	EQU	4AH
  507:           N      004B    SP_H	EQU	4BH		;SERIAL PORT TIME OUT
  508:           N      004C    SP_L	EQU	4CH
  509:           N      004D    CMNDSP	EQU	4DH		;SYSTEM STACK POINTER
  510:           N      0087    PCON0	EQU	87H		;PCON SFR
  511:           N      00AA    S0RELL	EQU	0AAH		;S0RELL 805x7A SFR
  512:           N      00BA    S0RELH	EQU	0BAH		;S0RELH 805x7A SFR
  513:           N      00CB    RCAPH2	EQU	0CBH		;RCAPH2 8052 SFR
  514:           N      00CA    RCAPL2	EQU	0CAH		;RCAPL2 8052 SFR
  515:           N      00D8    ADCON	EQU	0D8H		;ADCON 805xx SFR
  516:           N      00DA    DAPR	EQU	0DAH		;DAPR 805xx SFR
  517:           N      00FF    IRAMTOP EQU	0FFH		;TOP OF RAM
  518:           N      00FE    STACKTP EQU	0FEH		;ARG AND CONTROL STACK
  519:                          	;
  520:                          	; The character equates
  521:                          	;
  522:           N      000D    CR	EQU	0DH		;CARRIAGE RETURN
  523:           N      000A    LF	EQU	0AH		;LINE FEED
  524:           N      0007    BELL	EQU	07H		;BELL CHARACTER
  525:           N      0008    BS	EQU	08H		;BACK SPACE
  526:           N      0003    CNTRLC	EQU	03H		;CONTROL C
  527:           N      0004    CNTRLD	EQU	04H		;CONTROL D
  528:           N      0000    NULL	EQU	00H		;NULL
  529:                          	;
  530:                          	; The new baud rate constants
  531:                          	;
  532:           N      00B2    B4800	EQU	0B2H		;Timervalue for 4800 bau
  533:           N      00D9    B9600	EQU	0D9H		;Timervalue for 9600 bau
  534:                          	;
  535:                          	;
  536:                          	; The internal system equates
  537:                          	;
  538:           N      0049    LINLEN	EQU	73		;THE LENGTH OF AN INPUT L
  539:           N      0001    EOF	EQU	01		;END OF FILE CHARACTER
  540:           N      0001    ASTKAH	EQU	01		;ASTKA IS IN PAGE 1 OF RA
  541:           N      0000    CSTKAH	EQU	00		;CSTKA IS IN PAGE 0 OF RA
  542:           N      0001    FTYPE	EQU	01		;CONTROL STACK "FOR"
  543:           N      0002    GTYPE	EQU	02		;CONTROL STACK "GOSUB"
  544:           N      0003    DTYPE	EQU	03		;DO-WHILE/UNTIL TYPE
  545:           N      8000    ROMADR	EQU	8000H	;LOCATION OF ROM
  546:                          ;
  547:                          	; The floating point equates

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 11



 Line    I  Addr Code           Source

  548:                          	;
  549:           N      0006    FPSIZ	EQU	6		;NO. OF BYTES IN A FLOATING
  550:           N      0004    DIGIT	EQU	FPSIZ-2 	;THE MANTISSA OF A FL
  551:           N      0009    STESIZ	EQU	FPSIZ+3 	;SIZE OF SYMBOL ADJU
  552:                          ;FP_BASE EQU	 1993H		 ;BASE OF FLOATING 
  553:           N      0200    PSTART	EQU	512		;START OF A PROGRAM IN R
  554:           N      0011    FSIZE	EQU	FPSIZ+FPSIZ+2+2+1
  555:                          ;
  556:                          ;=== CH552 Added =====
  557:           N      03FF    ERAMEND	EQU	03FFH ; EX-RAM last addr (1K
  558:                          ;=====================
  559:                          ;
  560:                          	;**************************************
  561:                          	;
  562:                          USENT:	; User entry jump table
  563:                          	;
  564:                          	;**************************************
  565:                          	;
  566:      0047 17 87          	DW	CMND1		;(00, 00H)COMMAND MODE JUMP
  567:      0049 12 23          	DW	IFIX		;(01, 01H)CONVERT FP TO INT
  568:      004B 0F DD          	DW	PUSHAS		;(02, 02H)PUSH VALUE ONTO AR
  569:      004D 0F D3          	DW	POPAS		;(03, 03H)POP VALUE OFF ARG S
  570:      004F 04 BD          	DW	PG1		;(04, 04H)PROGRAM A PROM
  571:      0051 06 D8          	DW	INLINE		;(05, 05H)INPUT A LINE
  572:      0053 06 BF          	DW	UPRNT		;(06, 06H)PRINT A LINR
  573:      0055 06 A5          	DW	CRLF		;(07, 07H)OUTPUT A CRLF
  574:                          	;
  575:                          	;**************************************
  576:                          	;
  577:                          	; This is the operation jump table for 
  578:                          	;
  579:                          	;**************************************
  580:                          	;
  581:      0057 13 AC          OPTAB:	DW	ALPAR		;(08, 08H)LEFT PAREN
  582:      0059 13 2B          	DW	AEXP		;(09, 09H)EXPONENTAION
  583:      005B 11 B0          	DW	AMUL		;(10, 0AH)FP MUL
  584:      005D 17 41          	DW	AADD		;(11, 0BH)FLOATING POINT ADD
  585:      005F 14 0A          	DW	ADIV		;(12, 0CH)FLOATING POINT DIVID
  586:      0061 17 1C          	DW	ASUB		;(13, 0DH)FLOATING POINT SUBTR
  587:      0063 14 98          	DW	AXRL		;(14, 0EH)XOR
  588:      0065 14 84          	DW	AANL		;(15, 0FH)AND
  589:      0067 14 8D          	DW	AORL		;(16, 10H)OR
  590:      0069 13 A1          	DW	ANEG		;(17, 11H)NEGATE
  591:      006B 13 DB          	DW	AEQ		;(18, 12H)EQUAL
  592:      006D 13 E7          	DW	AGE		;(19, 13H)GREATER THAN OR EQUAL
  593:      006F 13 EB          	DW	ALE		;(20, 14H)LESS THAN OR EQUAL
  594:      0071 13 E1          	DW	ANE		;(21, 15H)NOT EQUAL
  595:      0073 13 D6          	DW	ALT		;(22, 16H)LESS THAN
  596:      0075 13 C5          	DW	AGT		;(23, 17H)GREATER THAN
  597:                          	;
  598:                          	;**************************************
  599:                          	;
  600:                          	; This is the jump table for unary oper
  601:                          	;
  602:                          	;**************************************
  603:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 12



 Line    I  Addr Code           Source

  604:      0077 13 8F          	DW	AABS		;(24, 18H)ABSOLUTE VALUE
  605:      0079 13 6D          	DW	AINT		;(25, 19H)INTEGER OPERATOR
  606:      007B 13 95          	DW	ASGN		;(26, 1AH)SIGN OPERATOR
  607:      007D 14 96          	DW	ANOT		;(27, 1BH)ONE'S COMPLEMENT
  608:      007F 11 6D          	DW	ACOS		;(28, 1CH)COSINE
  609:      0081 11 D0          	DW	ATAN		;(29, 1DH)TANGENT
  610:      0083 11 71          	DW	ASIN		;(30, 1EH)SINE
  611:      0085 12 8D          	DW	ASQR		;(31, 1FH)SQUARE ROOT
  612:      0087 13 AD          	DW	ACBYTE		;(32, 20H)READ CODE
  613:      0089 13 27          	DW	AETOX		;(33, 21H)E TO THE X
  614:      008B 11 E0          	DW	AATAN		;(34, 22H)ARC TANGENT
  615:      008D 12 C0          	DW	ALN		;(35, 23H)NATURAL LOG
  616:      008F 13 B6          	DW	ADBYTE		;(36, 24H)READ DATA MEMORY
  617:      0091 13 BE          	DW	AXBYTE		;(37, 25H)READ EXTERNAL MEMO
  618:      0093 14 7F          	DW	PIPI		;(38, 26H)PI
  619:      0095 13 F1          	DW	ARND		;(39, 27H)RANDOM NUMBER
  620:      0097 14 A9          	DW	AGET		;(40, 28H)GET INPUT CHARACTER
  621:      0099 17 11          	DW	AFREE		;(41, 29H)COMPUTE #BYTES FREE
  622:      009B 17 21          	DW	ALEN		;(42, 2AH) COMPUTE LEN OF PORG
  623:      009D 0F D9          	DW	AXTAL		;(43, 2BH) CRYSTAL
  624:      009F 16 4F          	DW	PMTOP		;(44, 2CH)TOP OF MEMORY
  625:      00A1 17 29          	DW	ATIME		;(45, 2DH) TIME
  626:      00A3 14 B9          	DW	A_IE		;(46, 2EH) IE
  627:      00A5 14 BD          	DW	A_IP		;(47, 2FH) IP
  628:      00A7 14 C1          	DW	ATIM0		;(48, 30H) TIMER 0
  629:      00A9 14 C7          	DW	ATIM1		;(49, 31H) TIMER 1
  630:      00AB 14 CD          	DW	ATIM2		;(50, 32H) TIMER 2
  631:      00AD 14 D3          	DW	AT2CON		;(51, 33H) T2CON
  632:      00AF 14 D7          	DW	ATCON		;(52, 34H) TCON
  633:      00B1 14 DB          	DW	ATMOD		;(53, 35H) ATMOD
  634:      00B3 14 DF          	DW	ARCAP2		;(54, 36H) RCAP2
  635:      00B5 14 E5          	DW	AP1		;(55, 37H) P1
  636:      00B7 14 E9          	DW	APCON		;(56, 38H) PCON
  637:      00B9 0F 43          	DW	EXPRB		;(57, 39H) EVALUATE AN EXPRES
  638:      00BB 16 5C          	DW	AXTAL1		;(58, 3AH) CALCULATE CRYSTAL
  639:      00BD 14 F0          	DW	LINE		;(59, 3BH) EDIT A LINE
  640:      00BF 15 BA          	DW	PP		;(60, 3CH) PROCESS A LINE
  641:      00C1 10 A0          	DW	UPPL0		;(61, 3DH) UNPROCESS A LINE
  642:      00C3 0D 65          	DW	VAR		;(62, 3EH) FIND A VARIABLE
  643:      00C5 0E CD          	DW	GC		;(63, 3FH) GET A CHARACTER
  644:      00C7 0E D5          	DW	GCI		;(64, 40H) GET CHARACTER AND IN
  645:      00C9 07 91          	DW	INCHAR		;(65, 41H) INPUT A CHARACTER
  646:      00CB 08 02          	DW	CRUN		;(66, 42H) RUN A PROGRAM
  647:                          ;
  648:                          ;***************************************
  649:                          ;****** OPBYTE 43H for POP *************
  650:                          ;****** Boehling 1 *********************
  651:                          ;
  652:      00CD 0A 7D          	dw	SPOP		;(67, 43H) POP a value to a va
  653:                          ;
  654:                          ;***************************************
  655:                          ;
  656:                          
  657:      00CF 01             OPBOL:	DB	1		;
  658:                          	;
  659:      00D0 0F             	DB	15		;LEFT PAREN

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 13



 Line    I  Addr Code           Source

  660:      00D1 0E             	DB	14		;EXPONENTIAN **
  661:      00D2 0A             	DB	10		;MUL
  662:      00D3 08             	DB	8		;ADD
  663:      00D4 0A             	DB	10		;DIVIDE
  664:      00D5 08             	DB	8		;SUB
  665:      00D6 03             	DB	3		;XOR
  666:      00D7 05             	DB	5		;AND
  667:      00D8 04             	DB	4		;OR
  668:      00D9 0C             	DB	12		;NEGATE
  669:      00DA 06             	DB	6		;EQ
  670:      00DB 06             	DB	6		;GT
  671:      00DC 06             	DB	6		;LT
  672:      00DD 06             	DB	6		;NE
  673:      00DE 06             	DB	6		;LE
  674:      00DF 06             	DB	6		;GE
  675:                          	;
  676:      00E0 0F             UOPBOL: DB	15		;AABS
  677:      00E1 0F             	DB	15		;AAINT
  678:      00E2 0F             	DB	15		;ASGN
  679:      00E3 0F             	DB	15		;ANOT
  680:      00E4 0F             	DB	15		;ACOS
  681:      00E5 0F             	DB	15		;ATAN
  682:      00E6 0F             	DB	15		;ASIN
  683:      00E7 0F             	DB	15		;ASQR
  684:      00E8 0F             	DB	15		;ACBYTE
  685:      00E9 0F             	DB	15		;E TO THE X
  686:      00EA 0F             	DB	15		;AATAN
  687:      00EB 0F             	DB	15		;NATURAL LOG
  688:      00EC 0F             	DB	15		;DBYTE
  689:      00ED 0F             	DB	15		;XBYTE
  690:                          	;
  691:                          	;**************************************
  692:                          	;
  693:                          	; The ASCII printed messages.
  694:                          	;
  695:                          	;**************************************
  696:                          	;
  697:      00EE 53 54 4F 50    STP:	DB	'STOP"'
            00F2 22
  698:                          	;
  699:      00F3 54 52 59 20    IAN:	DB	'TRY AGAIN"'
            00F7 41 47 41 49
            00FB 4E 22
  700:                          	;
  701:      00FD 52 45 41 44    RDYS:	DB	'READY"'
            0101 59 22
  702:                          	;
  703:      0103 20 2D 20 49    INS:	DB	' - IN LINE "'
            0107 4E 20 4C 49
            010B 4E 45 20 22
  704:                          	;
  705:                          	;**************************************
  706:                          	;
  707:                          	; This is the command jump table
  708:                          	;
  709:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 14



 Line    I  Addr Code           Source

  710:                          	;
  711:      010F 08 02          CMNDD:	DW	CRUN		;RUN
  712:      0111 10 4E          	DW	CLIST		;LIST
  713:      0113 0B 08          	DW	CNULL		;NULL
  714:      0115 06 5C          	DW	CNEW		;NEW
  715:      0117 18 3E          	DW	CCONT		;CONTINUE
  716:      0119 04 8A          	DW	CPROG		;PROGRAM A PROM
  717:      011B 17 73          	DW	CXFER		;TRANSFER FROM ROM TO RAM
  718:      011D 17 7F          	DW	CRAM		;RAM MODE
  719:      011F 05 3C          	DW	CROM		;ROM MODE
  720:                          ;
  721:                          ;***************************************
  722:                          ;****** Disable Intel programming for to
  723:                          ;
  724:                          ;	DW	CIPROG		;INTELLIGENT PROM PROGRAMMI
  725:                          ;
  726:                          ;***************************************
  727:                          ;
  728:      0121 05 00          	dw	CERASE		;Erase an EEPROM
  729:                          ;
  730:                          	;**************************************
  731:                          	;
  732:                          	; This is the statement jump table.
  733:                          	;
  734:                          	;**************************************
  735:                          	;
  736:                          STATD:	;
  737:      0123 09 6E          	DW	SLET		;LET		80H
  738:      0125 06 8F          	DW	SCLR		;CLEAR		81H
  739:      0127 0A 76          	DW	SPUSH		;PUSH VAR	82H
  740:      0129 0A AA          	DW	SGOTO		;GO TO		83H
  741:      012B 16 86          	DW	STONE		;TONE		84H
  742:      012D 0C 29          	DW	SPH0		;PRINT MODE 0	85H
  743:      012F 19 2E          	DW	SUI		;USER INPUT	86H
  744:      0131 19 33          	DW	SUO		;USER OUTPUT	87H
  745:      0133 0A 7D          	DW	SPOP		;POP VAR	88H
  746:      0135 0C 2D          	DW	SPRINT		;PRINT		89H
  747:      0137 0E 63          	DW	SCALL		;CALL		8AH
  748:      0139 0D 61          	DW	SDIMX		;DIMENSION	8BH
  749:      013B 06 0C          	DW	STRING		;STRING ALLO	8CH
  750:      013D 16 F9          	DW	SBAUD		;SET BAUD	8DH
  751:      013F 19 18          	DW	SCLOCK		;CLOCK		8EH
  752:      0141 0C 2B          	DW	SPH1		;PRINT MODE 1	8FH
  753:                          	;
  754:                          	; No direct mode from here on
  755:                          	;
  756:      0143 08 58          	DW	SSTOP		;STOP		90H
  757:      0145 0E 56          	DW	SOT		;ON TIME	91H
  758:      0147 14 19          	DW	SONEXT		;ON EXT INT	92H
  759:      0149 0B 0E          	DW	SRETI		;RET FROM INT	93H
  760:      014B 0F 05          	DW	S_DO		;DO		94H
  761:      014D 0B CE          	DW	SRESTR		;RESTOR 	95H
  762:      014F 0E FC          	DW	WCR		;REM		96H
  763:      0151 0B 5F          	DW	SNEXT		;NEXT		97H
  764:      0153 14 0F          	DW	SONERR		;ON ERROR	98H
  765:      0155 0C EB          	DW	S_ON		;ON		99H

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 15



 Line    I  Addr Code           Source

  766:      0157 0D F5          	DW	SINPUT		;INPUT		9AH
  767:      0159 0B E3          	DW	SREAD		;READ		9BH
  768:      015B 0E EC          	DW	FINDCR		;DATA		9CH
  769:      015D 0B 10          	DW	SRETRN		;RETURN 	9DH
  770:      015F 0A 86          	DW	SIF		;IF		9EH
  771:      0161 0B 2D          	DW	SGOSUB		;GOSUB		9FH
  772:      0163 0A 3C          	DW	SFOR		;FOR		A0H
  773:      0165 0A FC          	DW	SWHILE		;WHILE		A1H
  774:      0167 0B 01          	DW	SUNTIL		;UNTIL		A2H
  775:      0169 17 87          	DW	CMND1		;END		A3H
  776:      016B 18 5B          	DW	I_DL		;IDLE		A4H
  777:      016D 0F E5          	DW	ST_A		;STORE AT	A5H
  778:      016F 0F E9          	DW	LD_A		;LOAD AT	A6H
  779:      0171 04 F8          	DW	PGU		;PGM		A7H
  780:      0173 07 C0          	DW	RROM		;RUN A ROM	A9H
  781:                          	;
  782:                          	;**************************************
  783:                          	;
  784:                          TOKTAB: ; This is the basic token table
  785:                          	;
  786:                          	;**************************************
  787:                          	;
  788:                          	; First the tokens for statements
  789:                          	;
  790:      0175 80             	DB	80H		;LET TOKEN
  791:      0176 4C 45 54       	DB	'LET'
  792:                          	;
  793:      0179 81             	DB	81H		;CLEAR TOKEN
  794:      017A 43 4C 45 41    	DB	'CLEAR'
            017E 52
  795:                          	;
  796:      017F 82             	DB	82H		;PUSH TOKEN
  797:      0180 50 55 53 48    	DB	'PUSH'
  798:                          	;
  799:           N      0083    T_GOTO	EQU	83H
  800:                          	;
  801:      0184 83             	DB	83H		;GO TO TOKEN
  802:      0185 47 4F 54 4F    	DB	'GOTO'
  803:                          	;
  804:      0189 84             	DB	84H		;TOGGLE TOKEN
  805:      018A 50 57 4D       	DB	'PWM'
  806:                          	;
  807:      018D 85             	DB	85H		;PRINT HEX MODE 0
  808:      018E 50 48 30 2E    	DB	'PH0.'
  809:                          	;
  810:      0192 86             	DB	86H		;USER IN TOKEN
  811:      0193 55 49          	DB	'UI'
  812:                          	;
  813:      0195 87             	DB	87H		;USER OUT TOKEN
  814:      0196 55 4F          	DB	'UO'
  815:                          	;
  816:      0198 88             	DB	88H		;POP TOKEN
  817:      0199 50 4F 50       	DB	'POP'
  818:                          	;
  819:      019C 89             	DB	89H		;PRINT TOKEN
  820:      019D 50 52 49 4E    	DB	'PRINT'

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 16



 Line    I  Addr Code           Source

            01A1 54
  821:      01A2 89             	DB	89H
  822:      01A3 50 2E          	DB	'P.'            ;P. ALSO MEANS PRINT
  823:      01A5 89             	DB	89H		;? ALSO
  824:      01A6 3F             	DB	'?'
  825:                          	;
  826:      01A7 8A             	DB	8AH		;CALL TOKEN
  827:      01A8 43 41 4C 4C    	DB	'CALL'
  828:                          	;
  829:      01AC 8B             	DB	8BH		;DIMENSION TOKEN
  830:      01AD 44 49 4D       	DB	'DIM'
  831:                          	;
  832:      01B0 8C             	DB	8CH		;STRING TOKEN
  833:      01B1 53 54 52 49    	DB	'STRING'
            01B5 4E 47
  834:                          	;
  835:      01B7 8D             	DB	8DH		;SET BAUD RATE
  836:      01B8 42 41 55 44    	DB	'BAUD'
  837:                          	;
  838:      01BC 8E             	DB	8EH		;CLOCK
  839:      01BD 43 4C 4F 43    	DB	'CLOCK'
            01C1 4B
  840:                          	;
  841:      01C2 8F             	DB	8FH		;PRINT HEX MODE 1
  842:      01C3 50 48 31 2E    	DB	'PH1.'
  843:                          	;
  844:           N      0090    T_STOP	EQU	90H		;STOP TOKEN
  845:      01C7 90             	DB	T_STOP
  846:      01C8 53 54 4F 50    	DB	'STOP'
  847:                          	;
  848:           N      0090    T_DIR	EQU	T_STOP		;NO DIRECT FROM HERE O
  849:                          	;
  850:      01CC 91             	DB	T_STOP+1	;ON TIMER INTERRUPT
  851:      01CD 4F 4E 54 49    	DB	'ONTIME'
            01D1 4D 45
  852:                          	;
  853:      01D3 92             	DB	T_STOP+2	;ON EXTERNAL INTERRUPT
  854:      01D4 4F 4E 45 58    	DB	'ONEX1'
            01D8 31
  855:                          	;
  856:      01D9 93             	DB	T_STOP+3	;RETURN FROM INTERRUPT
  857:      01DA 52 45 54 49    	DB	'RETI'
  858:                          	;
  859:      01DE 94             	DB	T_STOP+4	;DO TOKEN
  860:      01DF 44 4F          	DB	'DO'
  861:                          	;
  862:      01E1 95             	DB	T_STOP+5	;RESTORE TOKEN
  863:      01E2 52 45 53 54    	DB	'RESTORE'
            01E6 4F 52 45
  864:                          	;
  865:           N      0096    T_REM	EQU	T_STOP+6	;REMARK TOKEN
  866:      01E9 96             	DB	T_REM
  867:      01EA 52 45 4D       	DB	'REM'
  868:                          	;
  869:      01ED 97             	DB	T_REM+1 	;NEXT TOKEN
  870:      01EE 4E 45 58 54    	DB	'NEXT'

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 17



 Line    I  Addr Code           Source

  871:                          	;
  872:      01F2 98             	DB	T_REM+2 	;ON ERROR TOKEN
  873:      01F3 4F 4E 45 52    	DB	'ONERR'
            01F7 52
  874:                          	;
  875:      01F8 99             	DB	T_REM+3 	;ON TOKEN
  876:      01F9 4F 4E          	DB	'ON'
  877:                          	;
  878:      01FB 9A             	DB	T_REM+4 	;INPUT
  879:      01FC 49 4E 50 55    	DB	'INPUT'
            0200 54
  880:                          	;
  881:      0201 9B             	DB	T_REM+5 	;READ
  882:      0202 52 45 41 44    	DB	'READ'
  883:                          	;
  884:           N      009C    T_DATA	EQU	T_REM+6 	;DATA
  885:      0206 9C             	DB	T_DATA
  886:      0207 44 41 54 41    	DB	'DATA'
  887:                          	;
  888:      020B 9D             	DB	T_DATA+1	;RETURN
  889:      020C 52 45 54 55    	DB	'RETURN'
            0210 52 4E
  890:                          	;
  891:      0212 9E             	DB	T_DATA+2	;IF
  892:      0213 49 46          	DB	'IF'
  893:                          	;
  894:           N      009F    T_GOSB	EQU	T_DATA+3	;GOSUB
  895:      0215 9F             	DB	T_GOSB
  896:      0216 47 4F 53 55    	DB	'GOSUB'
            021A 42
  897:                          	;
  898:      021B A0             	DB	T_GOSB+1	;FOR
  899:      021C 46 4F 52       	DB	'FOR'
  900:                          	;
  901:      021F A1             	DB	T_GOSB+2	;WHILE
  902:      0220 57 48 49 4C    	DB	'WHILE'
            0224 45
  903:                          	;
  904:      0225 A2             	DB	T_GOSB+3	;UNTIL
  905:      0226 55 4E 54 49    	DB	'UNTIL'
            022A 4C
  906:                          	;
  907:      022B A3             	DB	T_GOSB+4	;END
  908:      022C 45 4E 44       	DB	'END'
  909:                          	;
  910:           N      00A4    T_LAST	EQU	T_GOSB+5	;LAST INITIAL TOKEN
  911:                          	;
  912:           N      00A4    T_TAB	EQU	T_LAST		;TAB TOKEN
  913:      022F A4             	DB	T_TAB
  914:      0230 54 41 42       	DB	'TAB'
  915:                          	;
  916:           N      00A5    T_THEN	EQU	T_LAST+1	;THEN TOKEN
  917:      0233 A5             	DB	T_THEN
  918:      0234 54 48 45 4E    	DB	'THEN'
  919:                          	;
  920:           N      00A6    T_TO	EQU	T_LAST+2	;TO TOKEN

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 18



 Line    I  Addr Code           Source

  921:      0238 A6             	DB	T_TO
  922:      0239 54 4F          	DB	'TO'
  923:                          	;
  924:           N      00A7    T_STEP	EQU	T_LAST+3	;STEP TOKEN
  925:      023B A7             	DB	T_STEP
  926:      023C 53 54 45 50    	DB	'STEP'
  927:                          	;
  928:           N      00A8    T_ELSE	EQU	T_LAST+4	;ELSE TOKEN
  929:      0240 A8             	DB	T_ELSE
  930:      0241 45 4C 53 45    	DB	'ELSE'
  931:                          	;
  932:           N      00A9    T_SPC	EQU	T_LAST+5	;SPACE TOKEN
  933:      0245 A9             	DB	T_SPC
  934:      0246 53 50 43       	DB	'SPC'
  935:                          	;
  936:           N      00AA    T_CR	EQU	T_LAST+6
  937:      0249 AA             	DB	T_CR
  938:      024A 43 52          	DB	'CR'
  939:                          	;
  940:      024C AB             	DB	T_CR+1
  941:      024D 49 44 4C 45    	DB	'IDLE'
  942:                          	;
  943:      0251 AC             	DB	T_CR+2
  944:      0252 53 54 40       	DB	'ST@'
  945:                          	;
  946:      0255 AD             	DB	T_CR+3
  947:      0256 4C 44 40       	DB	'LD@'
  948:                          	;
  949:      0259 AE             	DB	T_CR+4
  950:      025A 50 47 4D       	DB	'PGM'
  951:                          	;
  952:      025D AF             	DB	T_CR+5
  953:      025E 52 52 4F 4D    	DB	'RROM'
  954:                          	;
  955:                          	; Operator tokens
  956:                          	;
  957:           N      00E0    T_LPAR	EQU	0E0H		;LEFT PAREN
  958:      0262 E0             	DB	T_LPAR
  959:      0263 28             	DB	'('
  960:                          	;
  961:      0264 E1             	DB	T_LPAR+1	;EXPONENTIAN
  962:      0265 2A 2A          	DB	'**'
  963:                          	;
  964:      0267 E2             	DB	T_LPAR+2	;FP MULTIPLY
  965:      0268 2A             	DB	'*'
  966:                          	;
  967:           N      00E3    T_ADD	EQU	T_LPAR+3
  968:      0269 E3             	DB	T_LPAR+3	;ADD TOKEN
  969:      026A 2B             	DB	'+'
  970:                          	;
  971:      026B E4             	DB	T_LPAR+4	;DIVIDE TOKEN
  972:      026C 2F             	DB	'/'
  973:                          	;
  974:           N      00E5    T_SUB	EQU	T_LPAR+5	;SUBTRACT TOKEN
  975:      026D E5             	DB	T_SUB
  976:      026E 2D             	DB	'-'

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 19



 Line    I  Addr Code           Source

  977:                          	;
  978:      026F E6             	DB	T_LPAR+6	;LOGICAL EXCLUSIVE OR
  979:      0270 2E 58 4F 52    	DB	'.XOR.'
            0274 2E
  980:                          	;
  981:      0275 E7             	DB	T_LPAR+7	;LOGICAL AND
  982:      0276 2E 41 4E 44    	DB	'.AND.'
            027A 2E
  983:                          	;
  984:      027B E8             	DB	T_LPAR+8	;LOGICAL OR
  985:      027C 2E 4F 52 2E    	DB	'.OR.'
  986:                          	;
  987:           N      00E9    T_NEG	EQU	T_LPAR+9
  988:                          	;
  989:           N      00EA    T_EQU	EQU	T_LPAR+10	;EQUAL
  990:      0280 EA             	DB	T_EQU
  991:      0281 3D             	DB	'='
  992:                          	;
  993:      0282 EB             	DB	T_LPAR+11	;GREATER THAN OR EQUAL
  994:      0283 3E 3D          	DB	'>='
  995:                          	;
  996:      0285 EC             	DB	T_LPAR+12	;LESS THAN OR EQUAL
  997:      0286 3C 3D          	DB	'<='
  998:                          	;
  999:      0288 ED             	DB	T_LPAR+13	;NOT EQUAL
 1000:      0289 3C 3E          	DB	'<>'
 1001:                          	;
 1002:      028B EE             	DB	T_LPAR+14	;LESS THAN
 1003:      028C 3C             	DB	'<'
 1004:                          	;
 1005:      028D EF             	DB	T_LPAR+15	;GREATER THAN
 1006:      028E 3E             	DB	'>'
 1007:                          	;
 1008:                          	;
 1009:           N      00B0    T_UOP	EQU	0B0H		;UNARY OP BASE TOKEN
 1010:                          	;
 1011:      028F B0             	DB	T_UOP		;ABS TOKEN
 1012:      0290 41 42 53       	DB	'ABS'
 1013:                          	;
 1014:      0293 B1             	DB	T_UOP+1 	;INTEGER TOKEN
 1015:      0294 49 4E 54       	DB	'INT'
 1016:                          	;
 1017:      0297 B2             	DB	T_UOP+2 	;SIGN TOKEN
 1018:      0298 53 47 4E       	DB	'SGN'
 1019:                          	;
 1020:      029B B3             	DB	T_UOP+3 	;GET TOKEN
 1021:      029C 4E 4F 54       	DB	'NOT'
 1022:                          	;
 1023:      029F B4             	DB	T_UOP+4 	;COSINE TOKEN
 1024:      02A0 43 4F 53       	DB	'COS'
 1025:                          	;
 1026:      02A3 B5             	DB	T_UOP+5 	;TANGENT TOKEN
 1027:      02A4 54 41 4E       	DB	'TAN'
 1028:                          	;
 1029:      02A7 B6             	DB	T_UOP+6 	;SINE TOKEN
 1030:      02A8 53 49 4E       	DB	'SIN'

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 20



 Line    I  Addr Code           Source

 1031:                          	;
 1032:      02AB B7             	DB	T_UOP+7 	;SQUARE ROOT TOKEN
 1033:      02AC 53 51 52       	DB	'SQR'
 1034:                          	;
 1035:      02AF B8             	DB	T_UOP+8 	;CBYTE TOKEN
 1036:      02B0 43 42 59       	DB	'CBY'
 1037:                          	;
 1038:      02B3 B9             	DB	T_UOP+9 	;EXP (E TO THE X) TOKEN
 1039:      02B4 45 58 50       	DB	'EXP'
 1040:                          	;
 1041:      02B7 BA             	DB	T_UOP+10
 1042:      02B8 41 54 4E       	DB	'ATN'
 1043:                          	;
 1044:      02BB BB             	DB	T_UOP+11
 1045:      02BC 4C 4F 47       	DB	'LOG'
 1046:                          	;
 1047:      02BF BC             	DB	T_UOP+12	;DBYTE TOKEN
 1048:      02C0 44 42 59       	DB	'DBY'
 1049:                          	;
 1050:      02C3 BD             	DB	T_UOP+13	;XBYTE TOKEN
 1051:      02C4 58 42 59       	DB	'XBY'
 1052:                          	;
 1053:           N      00BE    T_ULAST EQU	T_UOP+14	;LAST OPERATOR NEED
 1054:                          	;
 1055:      02C7 BE             	DB	T_ULAST
 1056:      02C8 50 49          	DB	'PI'
 1057:                          	;
 1058:      02CA BF             	DB	T_ULAST+1	;RND TOKEN
 1059:      02CB 52 4E 44       	DB	'RND'
 1060:                          	;
 1061:      02CE C0             	DB	T_ULAST+2	;GET TOKEN
 1062:      02CF 47 45 54       	DB	'GET'
 1063:                          	;
 1064:      02D2 C1             	DB	T_ULAST+3	;FREE TOKEN
 1065:      02D3 46 52 45 45    	DB	'FREE'
 1066:                          	;
 1067:      02D7 C2             	DB	T_ULAST+4	;LEN TOKEN
 1068:      02D8 4C 45 4E       	DB	'LEN'
 1069:                          	;
 1070:           N      00C3    T_XTAL	EQU	T_ULAST+5	;CRYSTAL TOKEN
 1071:      02DB C3             	DB	T_XTAL
 1072:      02DC 58 54 41 4C    	DB	'XTAL'
 1073:                          	;
 1074:           N      00C4    T_MTOP	EQU	T_ULAST+6	;MTOP
 1075:      02E0 C4             	DB	T_MTOP
 1076:      02E1 4D 54 4F 50    	DB	'MTOP'
 1077:                          	;
 1078:           N      00C6    T_IE	EQU	T_ULAST+8	;IE REGISTER
 1079:      02E5 C6             	DB	T_IE
 1080:      02E6 49 45          	DB	'IE'
 1081:                          	;
 1082:           N      00C7    T_IP	EQU	T_ULAST+9	;IP REGISTER
 1083:      02E8 C7             	DB	T_IP
 1084:      02E9 49 50          	DB	'IP'
 1085:                          	;
 1086:           N      00C8    TMR0	EQU	T_ULAST+10	;TIMER 0

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 21



 Line    I  Addr Code           Source

 1087:      02EB C8             	DB	TMR0
 1088:      02EC 54 49 4D 45    	DB	'TIMER0'
            02F0 52 30
 1089:                          	;
 1090:           N      00C9    TMR1	EQU	T_ULAST+11	;TIMER 1
 1091:      02F2 C9             	DB	TMR1
 1092:      02F3 54 49 4D 45    	DB	'TIMER1'
            02F7 52 31
 1093:                          	;
 1094:           N      00CA    TMR2	EQU	T_ULAST+12	;TIMER 2
 1095:      02F9 CA             	DB	TMR2
 1096:      02FA 54 49 4D 45    	DB	'TIMER2'
            02FE 52 32
 1097:                          	;
 1098:           N      00C5    T_TIME	EQU	T_ULAST+7	;TIME
 1099:      0300 C5             	DB	T_TIME
 1100:      0301 54 49 4D 45    	DB	'TIME'
 1101:                          	;
 1102:           N      00CB    TT2C	EQU	T_ULAST+13	;T2CON
 1103:      0305 CB             	DB	TT2C
 1104:      0306 54 32 43 4F    	DB	'T2CON'
            030A 4E
 1105:                          	;
 1106:           N      00CC    TTC	EQU	T_ULAST+14	;TCON
 1107:      030B CC             	DB	TTC
 1108:      030C 54 43 4F 4E    	DB	'TCON'
 1109:                          	;
 1110:           N      00CD    TTM	EQU	T_ULAST+15	;TMOD
 1111:      0310 CD             	DB	TTM
 1112:      0311 54 4D 4F 44    	DB	'TMOD'
 1113:                          	;
 1114:           N      00CE    TRC2	EQU	T_ULAST+16	;RCAP2
 1115:      0315 CE             	DB	TRC2
 1116:      0316 52 43 41 50    	DB	'RCAP2'
            031A 32
 1117:                          	;
 1118:           N      00CF    T_P1	EQU	T_ULAST+17	;P1
 1119:      031B CF             	DB	T_P1
 1120:      031C 50 4F 52 54    	DB	'PORT1'
            0320 31
 1121:                          	;
 1122:           N      00D0    T_PC	EQU	T_ULAST+18	;PCON
 1123:      0321 D0             	DB	T_PC
 1124:      0322 50 43 4F 4E    	DB	'PCON'
 1125:                          	;
 1126:           N      00D1    T_ASC	EQU	T_ULAST+19	;ASC TOKEN
 1127:      0326 D1             	DB	T_ASC
 1128:      0327 41 53 43 28    	DB	'ASC('
 1129:                          	;
 1130:           N      00D2    T_USE	EQU	T_ULAST+20	;USING TOKEN
 1131:      032B D2             	DB	T_USE
 1132:      032C 55 53 49 4E    	DB	'USING('
            0330 47 28
 1133:      0332 D2             	DB	T_USE
 1134:      0333 55 2E 28       	DB	'U.('
 1135:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 22



 Line    I  Addr Code           Source

 1136:           N      00D3    T_CHR	EQU	T_ULAST+21	;CHR TOKEN
 1137:      0336 D3             	DB	T_CHR
 1138:      0337 43 48 52 28    	DB	'CHR('
 1139:                          	;
 1140:           N      00F0    T_CMND	EQU	0F0H		;COMMAND BASE
 1141:                          	;
 1142:      033B F0             	DB	0F0H		;RUN TOKEN
 1143:      033C 52 55 4E       	DB	'RUN'
 1144:                          	;
 1145:      033F F1             	DB	0F1H		;LIST TOKEN
 1146:      0340 4C 49 53 54    	DB	'LIST'
 1147:                          	;
 1148:      0344 F2             	DB	0F2H		;NULL TOKEN
 1149:      0345 4E 55 4C 4C    	DB	'NULL'
 1150:                          	;
 1151:      0349 F3             	DB	0F3H		;NEW TOKEN
 1152:      034A 4E 45 57       	DB	'NEW'
 1153:                          	;
 1154:      034D F4             	DB	0F4H		;CONTINUE TOKEN
 1155:      034E 43 4F 4E 54    	DB	'CONT'
 1156:                          	;
 1157:      0352 F5             	DB	0F5H		;PROGRAM TOKEN
 1158:      0353 50 52 4F 47    	DB	'PROG'
 1159:                          	;
 1160:      0357 F6             	DB	0F6H		;TRANSFER TOKEN
 1161:      0358 58 46 45 52    	DB	'XFER'
 1162:                          	;
 1163:      035C F7             	DB	0F7H		;RAM MODE
 1164:      035D 52 41 4D       	DB	'RAM'
 1165:                          	;
 1166:      0360 F8             	DB	0F8H		;ROM MODE
 1167:      0361 52 4F 4D       	DB	'ROM'
 1168:                          ;
 1169:                          ;
 1170:                          ;***************************************
 1171:                          ;****** Disable Intel programming for to
 1172:                          ;
 1173:                          ;	DB	0F9H		;INTELLIGENT PROM PROGRAMMING
 1174:                          ;	DB	'FPROG'
 1175:                          ;
 1176:                          ;***************************************
 1177:                          ;****** New command "ERASE" to fill an E
 1178:                          ;****** Boehling 3 *********************
 1179:                          ;
 1180:      0364 F9             	db	0F9H		;Erase an EEPROM
 1181:      0365 45 52 41 53    	db	'ERASE'
            0369 45
 1182:                          ;
 1183:                          ;***************************************
 1184:                          ;****** Karmann 2 Bugfix ***************
 1185:                          ;
 1186:      036A FE             	db	0feh		;dummy token and
 1187:      036B 7F             	db	07fh		;unused dummy char
 1188:                          ;
 1189:                          ;****** continue with original code: ***
 1190:                          ;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 23



 Line    I  Addr Code           Source

 1191:      036C FF             	DB	0FFH		;END OF TABLE
 1192:                          	;
 1193:      036D 45 58 54 52    EIG:	DB	'EXTRA IGNORED"'
            0371 41 20 49 47
            0375 4E 4F 52 45
            0379 44 22
 1194:                          	;
 1195:      037B 41 2D 53 54    EXA:	DB	'A-STACK"'
            037F 41 43 4B 22
 1196:                          	;
 1197:      0383 43 2D 53 54    EXC:	DB	'C-STACK"'
            0387 41 43 4B 22
 1198:                          	;
 1199:                          	;**************************************
 1200:                          	;
 1201:                          CRST:	; This performs system initialzati
 1202:                          	; new power on reset functions could be
 1203:                          	;
 1204:                          	;**************************************
 1205:                          	;
 1206:                          	; First, initialize SFR's
 1207:                          	;
 1208:      038B 75 98 5A       	MOV	SCON,#5AH	;INITIALIZE SFR'S
 1209:                          ;
 1210:                          ;***************************************
 1211:                          ;****** Use XTAL up to 47 MHz **********
 1212:                          ;****** Wulf 2 *************************
 1213:                          ;
 1214:                          ;	MOV	TMOD,#10H
 1215:                          ;
 1216:      038E 75 89 11       	mov	TMOD,#11H	;Use 16 bit mode of timer
 1217:                          ;
 1218:                          ;***************************************
 1219:                          ;
 1220:      0391 75 88 54       	MOV	TCON,#54H
 1221:      0394 75 C8 34       	MOV	T2CON,#34H
 1222:                          ;	DB	75H		;MOV DIRECT, # OP CODE
 1223:                          ;	DB	0C8H		;T2CON LOCATION
 1224:                          ;	DB	34H		;CONFIGURATION BYTE
 1225:                          ;
 1226:                          ;=== CH552 Added =====
 1227:      0397 91 37          	acall	setfsys	; Set CPU Clock 24MHz(Max
 1228:                          ;=====================
 1229:                          	;
 1230:      0399 90 20 01       	MOV	DPTR,#2001H	;READ CODE AT 2001H
 1231:      039C E4             	CLR	A
 1232:      039D 93             	MOVC	A,@A+DPTR
 1233:      039E B4 AA 03       	CJNE	A,#0AAH,CRST1	;IF IT IS AN AAH, DO
 1234:      03A1 12 20 90       	LCALL	2090H
 1235:                          	;
 1236:      03A4 78 FF          CRST1:	MOV	R0,#IRAMTOP	;PUT THE TOP OF R
 1237:      03A6 E4             	CLR	A		;ZERO THE ACC
 1238:                          	;
 1239:      03A7 F6             CRST2:	MOV	@R0,A		;CLEAR INTERNAL MEMORY
 1240:      03A8 D8 FD          	DJNZ	R0,CRST2	;LOOP TIL DONE
 1241:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 24



 Line    I  Addr Code           Source

 1242:                          	; Now, test the external memory
 1243:                          	;
 1244:      03AA 75 3E 4D       	MOV	SPSAV,#CMNDSP	;SET UP THE STACK
 1245:      03AD 85 3E 81       	MOV	SP,SPSAV
 1246:                          ;
 1247:                          ;***************************************
 1248:                          ;****** Karmann 1 Bugfix ***************
 1249:                          ;
 1250:      03B0 12 17 E0       	lcall	TEST_USER	;chek for user command 
 1251:                          ;
 1252:                          ;****** continue with original code: ***
 1253:                          ;
 1254:      03B3 75 13 80       	MOV	BOFAH,#HIGH ROMADR
 1255:      03B6 75 14 11       	MOV	BOFAL,#LOW ROMADR+17
 1256:      03B9 90 80 00       	MOV	DPTR,#ROMADR	;GET THE BYTE AT 8000H
 1257:      03BC E0             	MOVX	A,@DPTR
 1258:      03BD C3             	CLR	C
 1259:      03BE 94 31          	SUBB	A,#31H		;FOR BIAS
 1260:      03C0 F5 45          	MOV	MT1,A		;SAVE IN DIRECT MATH LOC
 1261:      03C2 C2 E2          	CLR	ACC.2		;SAVE FOR RESET
 1262:      03C4 FF             	MOV	R7,A		;SAVE IT IN R7
 1263:      03C5 A3             	INC	DPTR
 1264:      03C6 B1 BA          	ACALL	L31DPI		;SAVE BAUD RATE
 1265:      03C8 12 08 85       	LCALL	RCL
 1266:      03CB A3             	INC	DPTR		;GET MEMTOP
 1267:      03CC B1 BA          	ACALL	L31DPI
 1268:      03CE 90 00 5F       	MOV	DPTR,#5FH	;READ THE EXTERNAL BYTE
 1269:      03D1 E0             	MOVX	A,@DPTR
 1270:      03D2 90 00 00       	MOV	DPTR,#0 	;ESTABLISH BASE FOR CLEAR
 1271:      03D5 B4 A5 08       	CJNE	A,#0A5H,CRS	;Erase the memory
 1272:      03D8 E5 45          	MOV	A,MT1
 1273:      03DA C2 E0          	CLR	ACC.0		;CLEAR BIT ONE
 1274:      03DC 64 04          	XRL	A,#4H
 1275:      03DE 60 2C          	JZ	CR2
 1276:                          	;
 1277:      03E0 BF 02 02       CRS:	CJNE	R7,#2,CRS1
 1278:      03E3 80 03          	SJMP	CRS2
 1279:      03E5 BF 03 04       CRS1:	CJNE	R7,#3,CR0
 1280:      03E8 D1 7D          CRS2:	ACALL	CL_1
 1281:      03EA 80 14          	SJMP	CR1
 1282:                          	;
 1283:      03EC AB 83          CR0:	MOV	R3,DPH		;SAVE THE DPTR
 1284:      03EE A9 82          	MOV	R1,DPL
 1285:      03F0 A3             	INC	DPTR
 1286:      03F1 74 5A          	MOV	A,#5AH
 1287:      03F3 F0             	MOVX	@DPTR,A 	;Test external memory
 1288:      03F4 E0             	MOVX	A,@DPTR
 1289:      03F5 B4 5A 08       	CJNE	A,#5AH,CR1
 1290:      03F8 E4             	CLR	A
 1291:      03F9 F0             	MOVX	@DPTR,A
 1292:                          ;
 1293:                          ;***************************************
 1294:                          ;******* Skowronek alterations to progra
 1295:                          ;
 1296:                          ;	CJNE	R3,#0E0H,CR0
 1297:                          ;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 25



 Line    I  Addr Code           Source

 1298:                          ;=== CH552 Replaced =====
 1299:                          ;	CJNE	R3,#HIGH ROMADR-1,CR0	;Stop the t
 1300:                          ;	CJNE	R1,#LOW ROMADR-2,CR0	;EEPROM star
 1301:                          ;
 1302:      03FA BB 03 EF       	CJNE	R3,#HIGH ERAMEND,CR0	; Stop the te
 1303:      03FD B9 FE EC       	CJNE	R1,#LOW ERAMEND-1,CR0	; EXT-RAM en
 1304:                          ;========================
 1305:                          ;
 1306:                          ;***************************************
 1307:                          ;
 1308:      0400 BB 03 00       CR1:	CJNE	R3,#03H,CR11	;NEED THIS MUCH R
 1309:      0403 40 86          CR11:	JC	CRST
 1310:      0405 90 01 0A       	MOV	DPTR,#MEMTOP	;SAVE MEMTOP
 1311:      0408 D1 03          	ACALL	S31DP2		;SAVE MEMTOP AND SEED RCE
 1312:      040A D1 5C          	ACALL	CNEW		;CLEAR THE MEMORY AND SET U
 1313:                          	;
 1314:      040C D1 6F          CR2:	ACALL	RC1		;SET UP STACKS IF NOT DO
 1315:                          	;
 1316:      040E 12 16 57       	LCALL	AXTAL0		;DO THE CRYSTAL
 1317:      0411 E5 45          	MOV	A,MT1		;GET THE RESET BYTE
 1318:      0413 B4 05 03       	CJNE	A,#5,CR20
 1319:      0416 12 40 39       	LCALL	4039H
 1320:      0419 50 0D          CR20:	JNC	BG1		;CHECK FOR 0,1,2,3, OR 4
 1321:      041B 30 E0 49       	JNB	ACC.0,BG3	;NO RUN IF WRONG TYPE
 1322:      041E 90 80 10       	MOV	DPTR,#ROMADR+16
 1323:      0421 E0             	MOVX	A,@DPTR 	;READ THE BYTE
 1324:      0422 B4 55 42       	CJNE	A,#55H,BG3
 1325:      0425 02 08 02       	LJMP	CRUN
 1326:                          ;
 1327:                          ;***************************************
 1328:                          ;******* New baudrate detection ********
 1329:                          ;******* Wulf 3 alteration 1 ***********
 1330:                          ;
 1331:                          ;BG1:	 CLR	 A		 ;DO BAUD RATE
 1332:                          ;	 MOV	 R3,A
 1333:                          ;	 MOV	 R1,A
 1334:                          ;	 MOV	 R0,#4
 1335:                          ;	 JB	 RXD,$		 ;LOOP UNTIL A CHARACTER I
 1336:                          ;	;
 1337:                          ;BG2:	 DJNZ	 R0,$		 ;FOUR CLOCKS, IN LOO
 1338:                          ;	 CALL	 DEC3211	 ;NINE CLOCKS
 1339:                          ;	 MOV	 R0,#2		 ;ONE CLOCK
 1340:                          ;	 JNB	 RXD,BG2	 ;TWO CLOCKS, LOOP UNTIL
 1341:                          ;	 JB	 RXD,$		 ;WAIT FOR STOP CHARACTER 
 1342:                          ;	 JNB	 RXD,$
 1343:                          ;
 1344:                          ;***************************************
 1345:                          ;******* New processor type detection **
 1346:                          ;******* Wulf 4 ************************
 1347:                          ;
 1348:                          ;-- comment out for AT98LP52 -----------
 1349:                          ;
 1350:                          ;BG1:	clr	a
 1351:                          ;	mov	t2con,a
 1352:                          ;	mov	TH2,#0FFh
 1353:                          ;	mov	TL2,#0F8h

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 26



 Line    I  Addr Code           Source

 1354:                          ;	jb	rxd,$
 1355:                          ;	mov	t2con,#5	;Timer2 start
 1356:                          ;	jnb	rxd,$
 1357:                          ;	mov	t2con,a 	;Timer2 stop
 1358:                          ;	jb	rxd,$
 1359:                          ;	jnb	rxd,$
 1360:                          ;	call	sercalc 	;r3=timer2 MSB default
 1361:                          ;	;
 1362:                          ;	cjne	a,ADCON,BG10	;jump if A/D process
 1363:                          ;BG14:	mov	a,S0RELL
 1364:                          ;	cjne	a,#B9600,BG2	;jump if not 805x7A
 1365:                          ;	mov	a,r3
 1366:                          ;	anl	S0RELH,a
 1367:                          ;	mov	S0RELL,r1	;start Baudratetimer 805
 1368:                          ;	sjmp	BG11
 1369:                          ;	;
 1370:                          ;BG10:	cjne	r1,#B9600,BG12	;jump if wron
 1371:                          ;BG11:	orl	PCON0,#080h	;setb smod for fa
 1372:                          ;	sjmp	BG13
 1373:                          ;	;
 1374:                          ;BG12:	cjne	r1,#B4800,BG14	;jump if wron
 1375:                          ;BG13:	setb	BD		;enable baudrategenerato
 1376:                          ;	sjmp	BG15
 1377:                          ;	;
 1378:                          ;BG2:	mov	t2con,#34h	;configure Timer2 a
 1379:                          ;BG15:	CALL	RCL		;LOAD THE TIMER
 1380:                          
 1381:                          ;
 1382:                          ;-- insert for AT98LP52 ----------------
 1383:                          ;
 1384:                          ;BG1:	mov	r6,#0		; Speed Table Index
 1385:                          ;	mov	r3,#0FFH	; Set R3 = RCAP2H
 1386:                          ;
 1387:                          ;BG11:	mov	dptr,#SPEED_TBL	; Speed Table
 1388:                          ;	mov	a,r6		; Speed Table Index
 1389:                          ;	movc	a,@a+dptr	; Fetch Speed Table
 1390:                          ;	inc	r6
 1391:                          ;	jz	bg3		; Table End, Use Last Speed
 1392:                          ;
 1393:                          ;	mov	r1,a		; Set R1 = RCAP2L
 1394:                          ;	mov	t2con,#34h	;configure Timer2 as ba
 1395:                          ;	call	RCL		;LOAD THE TIMER
 1396:                          ;
 1397:                          ;	mov	dptr,#TEST_MSG	; Put Test Message
 1398:                          ;	mov	r7,#0		; Message Text Index
 1399:                          ;
 1400:                          ;BG13:	mov	a,r7		; Text Index
 1401:                          ;	movc	a,@a+dptr	; Fetch Message String
 1402:                          ;	jz	BG14		; String End ?
 1403:                          ;	jnb	TI,$		; Wait Until Transmmit End
 1404:                          ;	clr	TI		; Clear TX Flag
 1405:                          ;	mov	SBUF,a	 	; Output Character
 1406:                          ;	inc	r7		; Next Character
 1407:                          ;	sjmp	BG13
 1408:                          ;
 1409:                          ;BG14:	jnb	RI,$		; Wait Until Receive En

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 27



 Line    I  Addr Code           Source

 1410:                          ;	mov	a,SBUF		; Get Receive Character
 1411:                          ;	clr	RI		; Reset Flag
 1412:                          ;	anl	a,#07FH		; Clear Bit-7
 1413:                          ;	cjne	a,#'y',BG11	; Ok?, Test Next Spee
 1414:                          ;	sjmp	BG3
 1415:                          ;
 1416:                          ;SPEED_TBL:	db	0A0H	; RCAP2H,L = FFA0H (
 1417:                          ;		db	0B8H	; RCAP2H,L = FFB8H (19.2Kbps,
 1418:                          ;		db	0D0H	; RCAP2H,L = FFD0H (19.2Kbbs,
 1419:                          ;		db	0DCH	; RCAP2H,L = FFDCH (19.2Kbps,
 1420:                          ;		db	00h	; Table End
 1421:                          
 1422:                          ;-- CH552 Insert Start -----------------
 1423:                          ;=======================================
 1424:                          ;  CH552 Set Fixed baudrate 19.23Kbps
 1425:                          ;  RCAP2H,L = 65536 - (Fsys/16/Baud Rate
 1426:                          ;=======================================
 1427:           N      FFB2    baud19K	equ	0ffb2h		; RCAP2H,L Value of 
 1428:                          ;
 1429:                          BG1:
 1430:      0428 43 C9 C0       	orl		t2mod,#0C0H		; Set bTMR_CLK, bT2_C
 1431:      042B 7B FF          	mov		r3,#high baud19k	; Set R3 = RCAP2H
 1432:      042D 79 B2          	mov		r1,#low baud19k		; Set R1 = RCAP2L
 1433:      042F 75 C8 34       	mov		t2con,#34h		; configure Timer2 as 
 1434:      0432 12 08 85       	call	RCL				; LOAD THE TIMER
 1435:                          
 1436:      0435 80 30          	sjmp	BG3
 1437:                          
 1438:                          ;=======================================
 1439:                          ;  CH552 System Clock (Fsys) Up 6MHz -> 
 1440:                          ;=======================================
 1441:                          setfsys:
 1442:      0437 E5 B9          	mov	a,CLOCK_CFG		; Get CLOCK_CFG
 1443:      0439 54 F8          	anl	a,#0F8H			;  Clear MASK_SYS_CK_SEL
 1444:      043B 44 06          	orl	a,#006H			;  Set MASK_SYS_CK_SEL = 
 1445:                          
 1446:      043D 75 A1 55       	mov	SAFE_MOD,#055H	; Enter Safe_Mode Ke
 1447:      0440 75 A1 AA       	mov	SAFE_MOD,#0AAH	; Enter Safe_Mode Ke
 1448:                          
 1449:      0443 F5 B9          	mov	CLOCK_CFG,a		; Rewrite CLOCK_CFG
 1450:                          
 1451:      0445 75 A1 00       	mov	SAFE_MOD,#00	; Exit Safe_Mode
 1452:                          
 1453:      0448 22             	ret
 1454:                          
 1455:           N      0467    	org	0467h		; Insert Dummy Space, 0467H 
 1456:                          ;
 1457:                          ;-- insert end -------------------------
 1458:                          ;
 1459:                          ;****** Original code from here ********
 1460:                          ;
 1461:      0467 90 1F D3       BG3:	MOV	DPTR,#S_N	;GET THE MESSAGE
 1462:      046A D1 AD          	ACALL	CRP		;PRINT IT
 1463:      046C 02 17 7F       	LJMP	CRAM
 1464:                          	;
 1465:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 28



 Line    I  Addr Code           Source

 1466:                          	;
 1467:                          	; CIPROG AND CPROG - Program a prom
 1468:                          	;
 1469:                          	;**************************************
 1470:                          	;
 1471:      046F 7F 00          PG8:	MOV	R7,#00H 	;PROGRAM ONE BYTE AT A
 1472:      0471 7E 01          	MOV	R6,#01H
 1473:      0473 7A 7F          	MOV	R2,#HIGH ROMADR-1
 1474:      0475 78 FF          	MOV	R0,#LOW ROMADR-1;LOAD PROM ADDRESS
 1475:      0477 91 B5          	ACALL	PG101
 1476:      0479 0E             	INC	R6
 1477:      047A E5 CB          	MOV	A,RCAPH2
 1478:                          ;	DB	0E5H		;MOV A DIRECT OP CODE
 1479:                          ;	DB	0CBH		;ADDRESS OF R2CAP HIGH
 1480:      047C 91 B5          	ACALL	PG101
 1481:      047E E5 CA          	MOV	A,RCAPL2
 1482:                          ;	DB	0E5H		;MOV A, DIRECT OP CODE
 1483:                          ;	DB	0CAH		;R2CAP LOW
 1484:      0480 7E 03          	MOV	R6,#3
 1485:      0482 79 09          	MOV	R1,#LOW MEMTOP-1
 1486:      0484 7B 01          	MOV	R3,#HIGH MEMTOP
 1487:      0486 91 B5          	ACALL	PG101		;SAVE MEMTOP
 1488:      0488 80 29          	SJMP	PGR
 1489:                          ;
 1490:                          ;
 1491:                          ;***************************************
 1492:                          ;****** Skowronek alterations to program
 1493:                          ;****** Support the "PGM" statement was 
 1494:                          ;****** Disable Intel programming and co
 1495:                          ;
 1496:                          ;CIPROG: MOV	DPTR,#IPROGS	;LOAD IPROG LO
 1497:                          ;	SETB	INTELB
 1498:                          ;	SJMP	CPROG1		;GO DO PROG
 1499:                          ;	;
 1500:                          ;CPROG: MOV	DPTR,#PROGS	;LOAD PROG LOCAT
 1501:                          ;	CLR	INTELB
 1502:                          ;	;
 1503:                          ;CPROG1: ACALL	LD_T		;LOAD THE TIMER
 1504:                          ;	CLR	PROMV		;TURN ON THE PROM VOLTAGE
 1505:                          ;	CALL	DELTST		;SEE IF A CR
 1506:                          ;	JNZ	PG8		;SAVE TIMER IF SO
 1507:                          ;	MOV	R4,#0FEH
 1508:                          ;	SETB	INBIT
 1509:                          ;	ACALL	ROMFD		;GET THE ROM ADDRESS OF T
 1510:                          ;	CALL	TEMPD		;SAVE THE ADDRESS
 1511:                          ;	MOV	A,R4		;GET COUNT
 1512:                          ;	CPL	A
 1513:                          ;	CALL	TWO_R2		;PUT IT ON THE STACK
 1514:                          ;	CALL	FP_BASE7	;OUTPUT IT
 1515:                          ;	ACALL	CCAL		;GET THE PROGRAM
 1516:                          ;	ACALL	CRLF		;DO CRLF
 1517:                          ;	MOV	R0,TEMP4	;GET ADDRESS
 1518:                          ;	MOV	R2,TEMP5
 1519:                          ;	MOV	A,#55H		;LOAD SIGNIFIER
 1520:                          ;	INC	R6		;LOAD LEN + 1
 1521:                          ;	CJNE	R6,#00,CPROG2

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 29



 Line    I  Addr Code           Source

 1522:                          ;	INC	R7
 1523:                          ;CPROG2: ACALL	 PG102
 1524:                          ;
 1525:                          ;PGR:	SETB	PROMV
 1526:                          ;	AJMP	C_K
 1527:                          ;
 1528:                          ;PG1:	MOV	P2,R3		;GET THE BYTE TO PROGRA
 1529:                          ;	MOVX	A,@R1
 1530:                          ;PG101:  LCALL	 INC3210	 ;BUMP POINTERS
 1531:                          ;PG102:  MOV	 R5,#1		 ;SET UP INTELLIGEN
 1532:                          ;
 1533:                          ;PG2:	MOV	R4,A		;SAVE THE BYTE IN R4
 1534:                          ;	ACALL	PG7		;PROGRAM THE BYTE
 1535:                          ;	ACALL	PG9
 1536:                          ;	JB	INTELB,PG4	;SEE IF INTELLIGENT PROG
 1537:                          ;
 1538:                          ;PG3:	XRL	A,R4
 1539:                          ;	JNZ	PG6		;ERROR IF NOT THE SAME
 1540:                          ;	CALL	DEC76		;BUMP THE COUNTERS
 1541:                          ;	JNZ	PG1		;LOOP IF NOT DONE
 1542:                          ;	ANL	PSW,#11100111B	;INSURE RB0
 1543:                          ;PG31:	 RET
 1544:                          ;
 1545:                          ;PG4:	XRL	A,R4		;SEE IF PROGRAMMED
 1546:                          ;	JNZ	PG5		;JUMP IF NOT
 1547:                          ;	MOV	A,R4		;GET THE DATA BACK
 1548:                          ;	ACALL	PG7		;PROGRAM THE LOCATION
 1549:                          ;PG41:	 ACALL	 ZRO		 ;AGAIN
 1550:                          ;	ACALL	ZRO		;AND AGAIN
 1551:                          ;	ACALL	ZRO		;AND AGAIN
 1552:                          ;	DJNZ	R5,PG41 	;KEEP DOING IT
 1553:                          ;	ACALL	PG9		;RESET PROG
 1554:                          ;	SJMP	PG3		;FINISH THE LOOP
 1555:                          ;
 1556:                          ;PG5:	INC	R5		;BUMP THE COUNTER
 1557:                          ;	MOV	A,R4		;GET THE BYTE
 1558:                          ;	CJNE	R5,#25,PG2	;SEE IF TRIED 25 TIMES
 1559:                          ;
 1560:                          ;PG6:	SETB	PROMV		;TURN OFF PROM VOLTAGE
 1561:                          ;	MOV	PSW,#0		;INSURE RB0
 1562:                          ;	JNB	DIRF,PG31	;EXIT IF IN RUN MODE
 1563:                          ;	MOV	DPTR,#E16X	;PROGRAMMING ERROR
 1564:                          ;
 1565:                          ;ERRLK: LJMP	ERROR		;PROCESS THE ERROR
 1566:                          ;
 1567:                          ;PG7:	MOV	P0,R0		;SET UP THE PORTS
 1568:                          ;	MOV	P2,R2		;LATCH LOW ORDER ADDRESS
 1569:                          ;	ACALL	PG11		;DELAY FOR 8748/9
 1570:                          ;	CLR	ALED
 1571:                          ;	MOV	P0,A		;PUT DATA ON THE PORT
 1572:                          ;	;
 1573:                          ;ZRO:	NOP			;SETTLEING TIME + FP ZERO
 1574:                          ;	NOP
 1575:                          ;	NOP
 1576:                          ;	NOP
 1577:                          ;	NOP

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 30



 Line    I  Addr Code           Source

 1578:                          ;	NOP
 1579:                          ;	ACALL	PG11		;DELAY A WHILE
 1580:                          ;	CLR	PROMP		;START PROGRAMMING
 1581:                          ;	ACALL	TIMER_LOAD	;START THE TIMER
 1582:                          ;	JNB	TF1,$		;WAIT FOR PART TO PROGRAM
 1583:                          ;	RET			;EXIT
 1584:                          ;
 1585:                          ;PG9:	SETB	PROMP
 1586:                          ;	ACALL	PG11		;DELAY FOR A WHILE
 1587:                          ;	JNB	P3.2,$		;LOOP FOR EEPROMS
 1588:                          ;	MOV	P0,#0FFH
 1589:                          ;	CLR	P3.7		;LOWER READ
 1590:                          ;	ACALL	PG11
 1591:                          ;	MOV	A,P0		;READ THE PORT
 1592:                          ;	SETB	P3.7
 1593:                          ;	SETB	ALED
 1594:                          ;	RET
 1595:                          ;
 1596:                          ;PG11:	MOV	TEMP5,#12	;DELAY 30uS AT 12 M
 1597:                          ;	DJNZ	TEMP5,$
 1598:                          ;	RET
 1599:                          ;
 1600:                          ;	;*************************************
 1601:                          ;	;
 1602:                          ;PGU:	;PROGRAM A PROM FOR THE USER
 1603:                          ;	;
 1604:                          ;	;*************************************
 1605:                          ;
 1606:                          ;	CLR	PROMV		;TURN ON THE VOLTAGE
 1607:                          ;	MOV	PSW,#00011000B	;SELECT RB3
 1608:                          ;	ACALL	PG1		;DO IT
 1609:                          ;	SETB	PROMV		;TURN IT OFF
 1610:                          ;	RET
 1611:                          ;
 1612:                          ;****** alteredet code starts here: ****
 1613:                          ;
 1614:      048A 90 01 28       CPROG:	MOV	DPTR,#PROGS	;LOAD PROG LOCATI
 1615:                          	;
 1616:      048D B1 82          CPROG1: ACALL	LD_T		;LOAD THE TIMER
 1617:      048F 12 0E E1       	CALL	DELTST		;SEE IF A CR
 1618:      0492 70 DB          	JNZ	PG8		;SAVE TIMER IF SO
 1619:      0494 7C FE          	MOV	R4,#0FEH
 1620:      0496 D2 1D          	SETB	INBIT
 1621:      0498 B1 5B          	ACALL	ROMFD		;GET THE ROM ADDRESS OF TH
 1622:      049A 12 18 54       	CALL	TEMPD		;SAVE THE ADDRESS
 1623:      049D EC             	MOV	A,R4		;GET COUNT
 1624:      049E F4             	CPL	A
 1625:      049F 12 14 B1       	CALL	TWO_R2		;PUT IT ON THE STACK
 1626:      04A2 12 19 7D       	CALL	FP_BASE7	;OUTPUT IT
 1627:      04A5 B1 1C          	ACALL	CCAL		;GET THE PROGRAM
 1628:      04A7 D1 A5          	ACALL	CRLF		;DO CRLF
 1629:      04A9 A8 0E          	MOV	R0,TEMP4	;GET ADDRESS
 1630:      04AB AA 0F          	MOV	R2,TEMP5
 1631:      04AD 74 55          	MOV	A,#55H		;LOAD SIGNIFIER
 1632:      04AF 0E             	INC	R6		;LOAD LEN + 1
 1633:      04B0 0F             	INC	R7

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 31



 Line    I  Addr Code           Source

 1634:      04B1 91 C3          CPROG2: ACALL	PG2
 1635:                          	;
 1636:      04B3 A1 40          PGR:	AJMP	C_K		;Exit to command mode
 1637:                          	;
 1638:      04B5 0F             PG101:	INC	R7
 1639:      04B6 BE 00 07       	CJNE	R6,#0,PG4
 1640:      04B9 1F             	DEC	R7
 1641:      04BA 80 04          	SJMP	PG4
 1642:                          	;
 1643:      04BC 0F             PG10:	INC	R7
 1644:                          	;
 1645:      04BD 8B A0          PG1:	MOV	P2,R3		;GET THE BYTE TO PROGRAM
 1646:      04BF E3             	MOVX	A,@R1
 1647:      04C0 12 15 76       PG4:	LCALL	INC3210 	;BUMP POINTERS
 1648:                          	;
 1649:      04C3 91 D9          PG2:	ACALL	PG7		;Write the byte
 1650:      04C5 70 04          	JNZ	PG5		;exit if error
 1651:      04C7 DE F4          	DJNZ	R6,PG1
 1652:      04C9 DF F2          	DJNZ	R7,PG1		;LOOP IF NOT DONE
 1653:                          	;
 1654:      04CB 53 D0 E7       PG5:	ANL	PSW,#11100111B	;INSURE RB0
 1655:      04CE 60 27          	JZ	PG31		;Jump if none error
 1656:                          	;
 1657:      04D0 30 2F 24       PG6:	JNB	DIRF,PG31	;EXIT IF IN RUN MODE
 1658:      04D3 90 1F 9A       	MOV	DPTR,#E16X	;PROGRAMMING ERROR
 1659:      04D6 02 18 8F       ERRLK:	LJMP	ERROR		;PROCESS THE ERROR
 1660:                          	;
 1661:                          	;
 1662:      04D9 FC             PG7:	MOV	R4,A		;SAVE THE BYTE IN R4 for 
 1663:      04DA 8A 83          	mov	dph,r2		;load data pointer with eep
 1664:      04DC 88 82          	mov	dpl,r0
 1665:      04DE F0             	movx	@dptr,a 	;write the byte
 1666:      04DF 7D             	DB	07DH		;mov	 r5,#0
 1667:                          	;
 1668:      04E0 00             ZRO:	NOP
 1669:      04E1 00             	NOP			;SETTLEING TIME + FP ZERO
 1670:      04E2 00             	NOP			;Atenttion. This 6 NOP's a not on
 1671:      04E3 00             	NOP			;for settleing time, it is also t
 1672:      04E4 00             	NOP			;floating point zero!
 1673:      04E5 00             	NOP
 1674:      04E6 75 0F 0C       	MOV	TEMP5,#12	;DELAY 30uS AT 12 MHZ
 1675:      04E9 D5 0F FD       	DJNZ	TEMP5,$
 1676:      04EC B1 2D          	ACALL	TIMER_LOAD	;START THE TIMER
 1677:      04EE 30 8F FD       	JNB	TF1,$		;WAIT FOR PART TO PROGRAM
 1678:      04F1 E0             	movx	A,@DPTR 	;Read back for error dete
 1679:      04F2 6C             	xrl	A,R4		;Test for error
 1680:      04F3 60 02          	jz	PG31
 1681:      04F5 DD E9          	djnz	r5,ZRO
 1682:      04F7 22             PG31:	RET
 1683:                          	;
 1684:                          	;**************************************
 1685:                          	;
 1686:                          PGU:	;PROGRAM A PROM FOR THE USER (state
 1687:                          	;
 1688:                          	;**************************************
 1689:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 32



 Line    I  Addr Code           Source

 1690:      04F8 75 D0 18       	MOV	PSW,#00011000B	;SELECT RB3
 1691:      04FB BE 00 BE       	CJNE	R6,#0,PG10
 1692:      04FE 80 BD          	SJMP	PG1
 1693:                          ;
 1694:                          ;***************************************
 1695:                          ;****** The new command "ERASE" to fill 
 1696:                          ;****** Boehling 3 *********************
 1697:                          ;
 1698:      0500 7F 40          CERASE: mov	R7,#40H 		;Erase 16K byte
 1699:      0502 7E 00          	mov	R6,#00H
 1700:      0504 7A 7F          	mov	R2,#HIGH ROMADR-1	;Startaddress EEP
 1701:      0506 78 FF          	mov	R0,#LOW ROMADR-1
 1702:      0508 90 01 28       	mov	DPTR,#PROGS		;Point to EEPROM timei
 1703:      050B B1 82          	acall	LD_T			;Load the timer
 1704:                          	;
 1705:      050D 12 15 76       ERA1:	lcall	INC3210 		;Bump pointers
 1706:      0510 74 FF          	mov	A,#0FFH 		;Fill the EEPROM with 0FF
 1707:      0512 91 D9          	acall	PG7			;Write the byte
 1708:      0514 70 BA          	jnz	PG6			;Exit if error
 1709:      0516 DE F5          	DJNZ	R6,ERA1
 1710:      0518 DF F3          	DJNZ	R7,ERA1 		;Do the loop
 1711:      051A A1 40          	ajmp	C_K			;Exit to command mode
 1712:                          ;
 1713:                          ;***************************************
 1714:                          ;
 1715:                          ;****** continue with original code: ***
 1716:                          	;
 1717:                          	;**************************************
 1718:                          	;
 1719:                          CCAL:	; Set up for prom moves
 1720:                          	; R3:R1 gets source
 1721:                          	; R7:R6 gets # of bytes
 1722:                          	;
 1723:                          	;**************************************
 1724:                          	;
 1725:      051C B1 8A          	ACALL	GETEND		;GET THE LAST LOCATION
 1726:      051E A3             	INC	DPTR		;BUMP TO LOAD EOF
 1727:      051F AB 13          	MOV	R3,BOFAH
 1728:      0521 A9 14          	MOV	R1,BOFAL	;RESTORE START
 1729:      0523 C3             	CLR	C		;PREPARE FOR SUBB
 1730:      0524 E5 82          	MOV	A,DPL		;SUB DPTR - BOFA > R7:R6
 1731:      0526 99             	SUBB	A,R1
 1732:      0527 FE             	MOV	R6,A
 1733:      0528 E5 83          	MOV	A,DPH
 1734:      052A 9B             	SUBB	A,R3
 1735:      052B FF             	MOV	R7,A
 1736:      052C 22             CCAL1:	RET
 1737:                          	;
 1738:                          	;**************************************
 1739:                          	;
 1740:                          TIMER_LOAD:; Load the timer
 1741:                          	;
 1742:                          	;**************************************
 1743:                          	;
 1744:      052D B1 2C          	ACALL	CCAL1		;DELAY FOUR CLOCKS
 1745:                          TIMER_LOAD1:

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 33



 Line    I  Addr Code           Source

 1746:      052F C2 8E          	CLR	TR1		;STOP IT WHILE IT'S LOADED
 1747:      0531 85 40 8D       	MOV	TH1,T_HH
 1748:      0534 85 41 8B       	MOV	TL1,T_LL
 1749:      0537 C2 8F          	CLR	TF1		;CLEAR THE OVERFLOW FLAG
 1750:      0539 D2 8E          	SETB	TR1		;START IT NOW
 1751:      053B 22             	RET
 1752:                          	;
 1753:                          	;**************************************
 1754:                          	;
 1755:                          CROM:	; The command action routine - ROM
 1756:                          	;
 1757:                          	;**************************************
 1758:                          	;
 1759:      053C C2 17          	CLR	CONB		;CAN'T CONTINUE IF MODE CHANG
 1760:      053E B1 43          	ACALL	RO1		;DO IT
 1761:                          	;
 1762:      0540 02 10 92       C_K:	LJMP	CL3		;EXIT
 1763:                          	;
 1764:                          ;RO1:	 CALL	 INTGER 	;SEE IF INTGER PRES
 1765:                          ;	 MOV	 R4,R0B0	;SAVE THE NUMBER
 1766:                          ;	 JNC	 $+4
 1767:                          ;	 MOV	 R4,#01H	;ONE IF NO INTEGER PRESE
 1768:                          ;	ACALL	ROMFD		;FIND THE PROGRAM
 1769:                          ;
 1770:      0543 12 0E E1       RO1:	CALL	DELTST
 1771:      0546 7C 01          	MOV	R4,#1
 1772:      0548 50 04          	JNC	RO11
 1773:      054A 12 0E 8E       	CALL	ONE
 1774:      054D FC             	MOV	R4,A
 1775:                          ;
 1776:      054E B1 5B          RO11:	ACALL	ROMFD
 1777:      0550 BC 00 11       	CJNE	R4,#0,RFX	;EXIT IF R4 <> 0
 1778:      0553 A3             	INC	DPTR		;BUMP PAST TAG
 1779:      0554 85 83 13       	MOV	BOFAH,DPH	;SAVE THE ADDRESS
 1780:      0557 85 82 14       	MOV	BOFAL,DPL
 1781:      055A 22             	RET
 1782:                          	;
 1783:      055B 90 80 10       ROMFD:	MOV	DPTR,#ROMADR+16 ;START OF USE
 1784:                          	;
 1785:      055E E0             RF1:	MOVX	A,@DPTR 	;GET THE BYTE
 1786:      055F B4 55 09       	CJNE	A,#55H,RF3	;SEE IF PROPER TAG
 1787:      0562 DC 01          	DJNZ	R4,RF2		;BUMP COUNTER
 1788:                          	;
 1789:      0564 22             RFX:	RET			;DPTR HAS THE START ADDRESS
 1790:                          	;
 1791:      0565 A3             RF2:	INC	DPTR		;BUMP PAST TAG
 1792:      0566 B1 AC          	ACALL	G5
 1793:      0568 A3             	INC	DPTR		;BUMP TO NEXT PROGRAM
 1794:      0569 80 F3          	SJMP	RF1		;DO IT AGAIN
 1795:                          	;
 1796:      056B 10 1D F6       RF3:	JBC	INBIT,RFX	;EXIT IF SET
 1797:                          	;
 1798:      056E 90 1F C9       NOGO:	MOV	DPTR,#NOROM
 1799:      0571 81 D6          	AJMP	ERRLK
 1800:                          	;
 1801:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 34



 Line    I  Addr Code           Source

 1802:                          	;
 1803:                          L20DPI: ; load R2:R0 with the location t
 1804:                          	;
 1805:                          	;**************************************
 1806:                          	;
 1807:      0573 E0             	MOVX	A,@DPTR
 1808:      0574 FA             	MOV	R2,A
 1809:      0575 A3             	INC	DPTR
 1810:      0576 E0             	MOVX	A,@DPTR
 1811:      0577 F8             	MOV	R0,A
 1812:      0578 22             	RET			;DON'T BUMP DPTR
 1813:                          	;
 1814:                          	;**************************************
 1815:                          	;
 1816:                          X31DP:	; swap R3:R1 with DPTR
 1817:                          	;
 1818:                          	;**************************************
 1819:                          	;
 1820:      0579 CB             	XCH	A,R3
 1821:      057A C5 83          	XCH	A,DPH
 1822:      057C CB             	XCH	A,R3
 1823:      057D C9             	XCH	A,R1
 1824:      057E C5 82          	XCH	A,DPL
 1825:      0580 C9             	XCH	A,R1
 1826:      0581 22             	RET
 1827:                          	;
 1828:                          	;**************************************
 1829:                          	;
 1830:                          LD_T:	; Load the timer save location wit
 1831:                          	; pointing to.
 1832:                          	;
 1833:                          	;**************************************
 1834:                          	;
 1835:      0582 E0             	MOVX	A,@DPTR
 1836:      0583 F5 40          	MOV	T_HH,A
 1837:      0585 A3             	INC	DPTR
 1838:      0586 E0             	MOVX	A,@DPTR
 1839:      0587 F5 41          	MOV	T_LL,A
 1840:      0589 22             	RET
 1841:                          	;
 1842:                          	;
 1843:                          	;**************************************
 1844:                          	;
 1845:                          	;GETLIN - FIND THE LOCATION OF THE LINE
 1846:                          	;	  IF ACC = 0 THE LINE WAS NOT FOUND I
 1847:                          	;	  WAS TOO BIG, ELSE ACC <> 0 AND THE 
 1848:                          	;	  AT THE LINE THAT IS GREATER THAN OR
 1849:                          	;	  VALUE IN R3:R1.
 1850:                          	;
 1851:                          	;**************************************
 1852:                          	;
 1853:      058A D2 29          GETEND: SETB	ENDBIT		;GET THE END OF THE
 1854:                          	;
 1855:      058C 12 0E 9B       GETLIN: CALL	DP_B		;GET BEGINNING ADDRES
 1856:                          	;
 1857:      058F 12 0A A4       G1:	CALL	B_C

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 35



 Line    I  Addr Code           Source

 1858:      0592 60 12          	JZ	G3		;EXIT WITH A ZERO IN A IF AT END
 1859:      0594 A3             	INC	DPTR		;POINT AT THE LINE NUMBER
 1860:      0595 20 29 0A       	JB	ENDBIT,G2	;SEE IF WE WANT TO FIND TH
 1861:      0598 B1 CC          	ACALL	DCMPX		;SEE IF (DPTR) = R3:R1
 1862:      059A B1 C2          	ACALL	DECDP		;POINT AT LINE COUNT
 1863:      059C E0             	MOVX	A,@DPTR 	;PUT LINE LENGTH INTO ACC
 1864:      059D 20 2A 06       	JB	UBIT,G3 	;EXIT IF EQUAL
 1865:      05A0 40 04          	JC	G3		;SEE IF LESS THAN OR ZERO
 1866:                          	;
 1867:      05A2 B1 DE          G2:	ACALL	ADDPTR		;ADD IT TO DPTR
 1868:      05A4 80 E9          	SJMP	G1		;LOOP
 1869:                          	;
 1870:      05A6 C2 29          G3:	CLR	ENDBIT		;RESET ENDBIT
 1871:      05A8 22             	RET			;EXIT
 1872:                          	;
 1873:      05A9 90 02 00       G4:	MOV	DPTR,#PSTART	;DO RAM
 1874:                          	;
 1875:      05AC D2 29          G5:	SETB	ENDBIT
 1876:      05AE 80 DF          	SJMP	G1		;NOW DO TEST
 1877:                          	;
 1878:                          	;**************************************
 1879:                          	;
 1880:                          	; LDPTRI - Load the DATA POINTER with t
 1881:                          	;	   to - DPH = (DPTR) , DPL = (DPTR+1)
 1882:                          	;
 1883:                          	; acc gets wasted
 1884:                          	;
 1885:                          	;**************************************
 1886:                          	;
 1887:      05B0 E0             LDPTRI: MOVX	A,@DPTR 	;GET THE HIGH BYTE
 1888:      05B1 C0 E0          	PUSH	ACC		;SAVE IT
 1889:      05B3 A3             	INC	DPTR		;BUMP THE POINTER
 1890:      05B4 E0             	MOVX	A,@DPTR 	;GET THE LOW BYTE
 1891:      05B5 F5 82          	MOV	DPL,A		;PUT IT IN DPL
 1892:      05B7 D0 83          	POP	DPH		;GET THE HIGH BYTE
 1893:      05B9 22             	RET			;GO BACK
 1894:                          	;
 1895:                          	;**************************************
 1896:                          	;
 1897:                          	;L31DPI - LOAD R3 WITH (DPTR) AND R1 WI
 1898:                          	;
 1899:                          	;ACC GETS CLOBBERED
 1900:                          	;
 1901:                          	;**************************************
 1902:                          	;
 1903:      05BA E0             L31DPI: MOVX	A,@DPTR 	;GET THE HIGH BYTE
 1904:      05BB FB             	MOV	R3,A		;PUT IT IN THE REG
 1905:      05BC A3             	INC	DPTR		;BUMP THE POINTER
 1906:      05BD E0             	MOVX	A,@DPTR 	;GET THE NEXT BYTE
 1907:      05BE F9             	MOV	R1,A		;SAVE IT
 1908:      05BF 22             	RET
 1909:                          	;
 1910:                          	;**************************************
 1911:                          	;
 1912:                          	;DECDP - DECREMENT THE DATA POINTER - U
 1913:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 36



 Line    I  Addr Code           Source

 1914:                          	;**************************************
 1915:                          	;
 1916:      05C0 B1 C2          DECDP2: ACALL	DECDP
 1917:                          	;
 1918:      05C2 C5 82          DECDP:	XCH	A,DPL		;GET DPL
 1919:      05C4 70 02          	JNZ	DECDP1		;BUMP IF ZERO
 1920:      05C6 15 83          	DEC	DPH
 1921:      05C8 14             DECDP1: DEC	A		;DECREMENT IT
 1922:      05C9 C5 82          	XCH	A,DPL		;GET A BACK
 1923:      05CB 22             	RET			;EXIT
 1924:                          	;
 1925:                          	;**************************************
 1926:                          	;
 1927:                          	;DCMPX - DOUBLE COMPARE - COMPARE (DPTR
 1928:                          	;R3:R1 - (DPTR) = SET CARRY FLAG
 1929:                          	;
 1930:                          	;IF R3:R1 > (DPTR) THEN C = 0
 1931:                          	;IF R3:R1 < (DPTR) THEN C = 1
 1932:                          	;IF R3:R1 = (DPTR) THEN C = 0
 1933:                          	;
 1934:                          	;**************************************
 1935:                          	;
 1936:      05CC C2 2A          DCMPX:	CLR	UBIT		;ASSUME NOT EQUAL
 1937:      05CE E0             	MOVX	A,@DPTR 	;GET THE BYTE
 1938:      05CF B5 03 0A       	CJNE	A,R3B0,D1	;IF A IS GREATER THAN R3
 1939:                          				;WHICH IS R3<@DPTR = NO CARRY AND
 1940:                          				;R3>@DPTR CARRY IS SET
 1941:      05D2 A3             	INC	DPTR		;BUMP THE DATA POINTER
 1942:      05D3 E0             	MOVX	A,@DPTR 	;GET THE BYTE
 1943:      05D4 B1 C2          	ACALL	DECDP		;PUT DPTR BACK
 1944:      05D6 B5 01 03       	CJNE	A,R1B0,D1	;DO THE COMPARE
 1945:      05D9 B3             	CPL	C		;FLIP CARRY
 1946:                          	;
 1947:      05DA B2 2A          	CPL	UBIT		;SET IT
 1948:      05DC B3             D1:	CPL	C		;GET THE CARRY RIGHT
 1949:      05DD 22             	RET			;EXIT
 1950:                          	;
 1951:                          	;**************************************
 1952:                          	;
 1953:                          	; ADDPTR - Add acc to the dptr
 1954:                          	;
 1955:                          	; acc gets wasted
 1956:                          	;
 1957:                          	;**************************************
 1958:                          	;
 1959:      05DE 25 82          ADDPTR: ADD	A,DPL		;ADD THE ACC TO DPL
 1960:      05E0 F5 82          	MOV	DPL,A		;PUT IT IN DPL
 1961:      05E2 50 02          	JNC	ADDPTR1 	;JUMP IF NO CARRY
 1962:      05E4 05 83          	INC	DPH		;BUMP DPH
 1963:      05E6 22             ADDPTR1:RET			;EXIT
 1964:                          	;
 1965:                          	;**************************************
 1966:                          	;
 1967:                          LCLR:	; Set up the storage allocation
 1968:                          	;
 1969:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 37



 Line    I  Addr Code           Source

 1970:                          	;
 1971:      05E7 D1 9A          	ACALL	ICLR		;CLEAR THE INTERRUPTS
 1972:      05E9 B1 A9          	ACALL	G4		;PUT END ADDRESS INTO DPTR
 1973:      05EB 74 06          	MOV	A,#6		;ADJUST MATRIX SPACE
 1974:      05ED B1 DE          	ACALL	ADDPTR		;ADD FOR PROPER BOUNDS
 1975:      05EF B1 79          	ACALL	X31DP		;PUT MATRIX BOUNDS IN R3:R
 1976:      05F1 90 01 08       	MOV	DPTR,#MT_ALL	;SAVE R3:R1 IN MATRIX 
 1977:      05F4 D1 05          	ACALL	S31DP		;DPTR POINTS TO MEMTOP
 1978:      05F6 B1 BA          	ACALL	L31DPI		;LOAD MEMTOP INTO R3:R1
 1979:      05F8 90 01 22       	MOV	DPTR,#STR_AL	;GET MEMORY ALLOCATED 
 1980:      05FB B1 B0          	ACALL	LDPTRI
 1981:      05FD 12 0A 02       	CALL	DUBSUB		;R3:R1 = MEMTOP - STRING A
 1982:      0600 90 01 04       	MOV	DPTR,#VARTOP	;SAVE R3:R1 IN VARTOP
 1983:                          	;
 1984:                          	; FALL THRU TO S31DP2
 1985:                          	;
 1986:                          	;**************************************
 1987:                          	;
 1988:                          	;S31DP - STORE R3 INTO (DPTR) AND R1 IN
 1989:                          	;
 1990:                          	;ACC GETS CLOBBERED
 1991:                          	;
 1992:                          	;**************************************
 1993:                          	;
 1994:      0603 D1 05          S31DP2: ACALL	S31DP		;DO IT TWICE
 1995:                          	;
 1996:      0605 EB             S31DP:	MOV	A,R3		;GET R3 INTO ACC
 1997:      0606 F0             	MOVX	@DPTR,A 	;STORE IT
 1998:      0607 A3             	INC	DPTR		;BUMP DPTR
 1999:      0608 E9             	MOV	A,R1		;GET R1
 2000:      0609 F0             	MOVX	@DPTR,A 	;STORE IT
 2001:      060A A3             	INC	DPTR		;BUMP IT AGAIN TO SAVE PROGRA
 2002:      060B 22             	RET			;GO BACK
 2003:                          	;
 2004:                          	;
 2005:                          	;**************************************
 2006:                          	;
 2007:                          STRING: ; Allocate memory for strings
 2008:                          	;
 2009:                          	;**************************************
 2010:                          	;
 2011:      060C 12 0E 85       	LCALL	TWO		;R3:R1 = NUMBER, R2:R0 = LEN
 2012:      060F 90 01 22       	MOV	DPTR,#STR_AL	;SAVE STRING ALLOCATIO
 2013:      0612 D1 05          	ACALL	S31DP
 2014:      0614 0E             	INC	R6		;BUMP
 2015:      0615 8E 3F          	MOV	S_LEN,R6	;SAVE STRING LENGTH
 2016:      0617 C1 64          	AJMP	RCLEAR		;CLEAR AND SET IT UP
 2017:                          	;
 2018:                          	;**************************************
 2019:                          	;
 2020:                          	; F_VAR - Find	the variable in symbol t
 2021:                          	;	  R7:R6 contain the variable name
 2022:                          	;	  If not found create a zero entry an
 2023:                          	;	  R2:R0 has the address of variable o
 2024:                          	;
 2025:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 38



 Line    I  Addr Code           Source

 2026:                          	;
 2027:      0619 90 01 04       F_VAR:	MOV	DPTR,#VARTOP	;PUT VARTOP IN D
 2028:      061C B1 B0          	ACALL	LDPTRI
 2029:      061E B1 C0          	ACALL	DECDP2		;ADJUST DPTR FOR LOOKUP
 2030:                          	;
 2031:      0620 E0             F_VAR0: MOVX	A,@DPTR 	;LOAD THE VARIABLE
 2032:      0621 60 20          	JZ	F_VAR2		;TEST IF AT THE END OF THE T
 2033:      0623 A3             	INC	DPTR		;BUMP FOR NEXT BYTE
 2034:      0624 B5 07 0F       	CJNE	A,R7B0,F_VAR1	;SEE IF MATCH
 2035:      0627 E0             	MOVX	A,@DPTR 	;LOAD THE NAME
 2036:      0628 B5 06 0B       	CJNE	A,R6B0,F_VAR1
 2037:                          	;
 2038:                          	; Found the variable now adjust and put
 2039:                          	;
 2040:      062B E5 82          DLD:	MOV	A,DPL		;R2:R0 = DPTR-2
 2041:      062D 94 02          	SUBB	A,#2
 2042:      062F F8             	MOV	R0,A
 2043:      0630 E5 83          	MOV	A,DPH
 2044:      0632 94 00          	SUBB	A,#0		;CARRY IS CLEARED
 2045:      0634 FA             	MOV	R2,A
 2046:      0635 22             	RET
 2047:                          	;
 2048:      0636 E5 82          F_VAR1: MOV	A,DPL		;SUBTRACT THE STACK S
 2049:      0638 C3             	CLR	C
 2050:      0639 94 09          	SUBB	A,#STESIZ
 2051:      063B F5 82          	MOV	DPL,A		;RESTORE DPL
 2052:      063D 50 E1          	JNC	F_VAR0
 2053:      063F 15 83          	DEC	DPH
 2054:      0641 80 DD          	SJMP	F_VAR0		;CONTINUE COMPARE
 2055:                          	;
 2056:                          	;
 2057:                          	; Add the entry to the symbol table
 2058:                          	;
 2059:      0643 12 0D EF       F_VAR2: LCALL	R76S		;SAVE R7 AND R6
 2060:      0646 C3             	CLR	C
 2061:      0647 D1 2B          	ACALL	DLD		;BUMP THE POINTER TO GET ENT
 2062:                          	;
 2063:                          	; Adjust pointer and save storage alloc
 2064:                          	; and make sure we aren't wiping anythi
 2065:                          	; First calculate new storage allocatio
 2066:                          	;
 2067:      0649 E8             	MOV	A,R0
 2068:      064A 94 06          	SUBB	A,#STESIZ-3	;NEED THIS MUCH RAM
 2069:      064C F9             	MOV	R1,A
 2070:      064D EA             	MOV	A,R2
 2071:      064E 94 00          	SUBB	A,#0
 2072:      0650 FB             	MOV	R3,A
 2073:                          	;
 2074:                          	; Now save the new storage allocation
 2075:                          	;
 2076:      0651 90 01 06       	MOV	DPTR,#ST_ALL
 2077:      0654 D1 05          	CALL	S31DP		;SAVE STORAGE ALLOCATION
 2078:                          	;
 2079:                          	; Now make sure we didn't blow it, by w
 2080:                          	;
 2081:      0656 B1 CC          	ACALL	DCMPX		;COMPARE STORAGE ALLOCATIO

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 39



 Line    I  Addr Code           Source

 2082:      0658 40 32          	JC	CCLR3		;ERROR IF CARRY
 2083:      065A D3             	SETB	C		;DID NOT FIND ENTRY
 2084:      065B 22             	RET			;EXIT IF TEST IS OK
 2085:                          	;
 2086:                          	;**************************************
 2087:                          	;
 2088:                          	; Command action routine - NEW
 2089:                          	;
 2090:                          	;**************************************
 2091:                          	;
 2092:      065C 90 02 00       CNEW:	MOV	DPTR,#PSTART	;SAVE THE START O
 2093:      065F 74 01          	MOV	A,#EOF		;END OF FILE
 2094:      0661 F0             	MOVX	@DPTR,A 	;PUT IT IN MEMORY
 2095:                          	;
 2096:                          	; falls thru
 2097:                          	;
 2098:                          	;**************************************
 2099:                          	;
 2100:                          	; The statement action routine - CLEAR
 2101:                          	;
 2102:                          	;**************************************
 2103:                          	;
 2104:      0662 C2 15          CNEW1:	CLR	LINEB		;SET UP FOR RUN AND GO
 2105:                          	;
 2106:      0664 B1 E7          RCLEAR: ACALL	LCLR		;CLEAR THE INTERRUPT
 2107:      0666 90 01 0A       	MOV	DPTR,#MEMTOP	;PUT MEMTOP IN R3:R1
 2108:      0669 B1 BA          	ACALL	L31DPI
 2109:      066B B1 A9          	ACALL	G4		;DPTR GETS END ADDRESS
 2110:      066D D1 7D          	ACALL	CL_1		;CLEAR THE MEMORY
 2111:                          	;
 2112:      066F 90 00 FE       RC1:	MOV	DPTR,#STACKTP	;POINT AT CONTROL
 2113:      0672 E4             	CLR	A		;CONTROL UNDERFLOW
 2114:                          	;
 2115:      0673 F0             RC2:	MOVX	@DPTR,A 	;SAVE IN MEMORY
 2116:      0674 75 11 FE       	MOV	CSTKA,#STACKTP
 2117:      0677 75 09 FE       	MOV	ASTKA,#STACKTP
 2118:      067A C2 17          	CLR	CONB		;CAN'T CONTINUE
 2119:      067C 22             	RET
 2120:                          	;
 2121:                          	;**************************************
 2122:                          	;
 2123:                          	; Loop until the memory is cleared
 2124:                          	;
 2125:                          	;**************************************
 2126:                          	;
 2127:      067D A3             CL_1:	INC	DPTR		;BUMP MEMORY POINTER
 2128:      067E E4             	CLR	A		;CLEAR THE MEMORY
 2129:      067F F0             	MOVX	@DPTR,A 	;CLEAR THE RAM
 2130:      0680 E0             	MOVX	A,@DPTR 	;READ IT
 2131:      0681 70 09          	JNZ	CCLR3		;MAKE SURE IT IS CLEARED
 2132:      0683 EB             	MOV	A,R3		;GET POINTER FOR COMPARE
 2133:      0684 B5 83 F6       	CJNE	A,DPH,CL_1	;SEE TO LOOP
 2134:      0687 E9             	MOV	A,R1		;NOW TEST LOW BYTE
 2135:      0688 B5 82 F2       	CJNE	A,DPL,CL_1
 2136:                          	;
 2137:      068B 22             CL_2:	RET

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 40



 Line    I  Addr Code           Source

 2138:                          	;
 2139:      068C 02 15 B5       CCLR3:	JMP	TB		;ALLOCATED MEMORY DOESN'T
 2140:                          	;
 2141:                          	;**************************************
 2142:                          	;
 2143:                          SCLR:	;Entry point for clear return
 2144:                          	;
 2145:                          	;**************************************
 2146:                          	;
 2147:      068F 12 0E E1       	CALL	DELTST		;TEST FOR A CR
 2148:      0692 50 D0          	JNC	RCLEAR
 2149:      0694 12 0E D7       	CALL	GCI1		;BUMP THE TEST POINTER
 2150:      0697 B4 49 D5       	CJNE	A,#'I',RC1      ;SEE IF I, ELSE RE
 2151:                          	;
 2152:                          	;**************************************
 2153:                          	;
 2154:                          ICLR:	; Clear interrupts and system garb
 2155:                          	;
 2156:                          	;**************************************
 2157:                          	;
 2158:      069A 30 12 02       	JNB	INTBIT,ICLR1	;SEE IF BASIC HAS INTE
 2159:      069D C2 AA          	CLR	EX1		;IF SO, CLEAR INTERRUPTS
 2160:      069F 53 22 20       ICLR1:	ANL	34,#00100000B	;SET INTERRUPTS
 2161:      06A2 32             	RETI
 2162:                          	;
 2163:                          	;**************************************
 2164:                          	;
 2165:                          	;OUTPUT ROUTINES
 2166:                          	;
 2167:                          	;**************************************
 2168:                          	;
 2169:      06A3 D1 A5          CRLF2:	ACALL	CRLF		;DO TWO CRLF'S
 2170:                          	;
 2171:      06A5 7D 0D          CRLF:	MOV	R5,#CR		;LOAD THE CR
 2172:      06A7 F1 11          	ACALL	TEROT		;CALL TERMINAL OUT
 2173:      06A9 7D 0A          	MOV	R5,#LF		;LOAD THE LF
 2174:      06AB E1 11          	AJMP	TEROT		;OUTPUT IT AND RETURN
 2175:                          	;
 2176:                          	;PRINT THE MESSAGE ADDRESSED IN ROM OR 
 2177:                          	;ENDS WITH THE CHARACTER IN R4
 2178:                          	;DPTR HAS THE ADDRESS OF THE TERMINATOR
 2179:                          	;
 2180:      06AD D1 A5          CRP:	ACALL	CRLF		;DO A CR THEN PRINT ROM
 2181:                          	;
 2182:      06AF E4             ROM_P:	CLR	A		;CLEAR A FOR LOOKUP
 2183:      06B0 93             	MOVC	A,@A+DPTR	;GET THE CHARACTER
 2184:      06B1 C2 E7          	CLR	ACC.7		;CLEAR MS BIT
 2185:      06B3 B4 22 01       	CJNE	A,#'"',ROM_P1   ;EXIT IF TERMINATO
 2186:      06B6 22             	RET
 2187:      06B7 D2 34          ROM_P1: SETB	C0ORX1
 2188:                          	;
 2189:      06B9 FD             PN1:	MOV	R5,A		;OUTPUT THE CHARACTER
 2190:      06BA F1 11          	ACALL	TEROT
 2191:      06BC A3             	INC	DPTR		;BUMP THE POINTER
 2192:      06BD 80 04          	SJMP	PN0
 2193:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 41



 Line    I  Addr Code           Source

 2194:      06BF B1 79          UPRNT:	ACALL	X31DP
 2195:                          	;
 2196:      06C1 7C 0D          PRNTCR: MOV	R4,#CR		;OUTPUT UNTIL A CR
 2197:                          	;
 2198:      06C3 10 34 E9       PN0:	JBC	C0ORX1,ROM_P
 2199:      06C6 E0             	MOVX	A,@DPTR 	;GET THE RAM BYTE
 2200:      06C7 60 03          	JZ	PN01
 2201:      06C9 B5 04 01       	CJNE	A,R4B0,PN02	;SEE IF THE SAME AS TE
 2202:      06CC 22             PN01:	RET			;EXIT IF THE SAME
 2203:      06CD B4 0D E9       PN02:	CJNE	A,#CR,PN1	;NEVER PRINT A CR I
 2204:      06D0 02 18 85       	LJMP	E1XX		;BAD SYNTAX
 2205:                          	;
 2206:                          	;**************************************
 2207:                          	;
 2208:                          	; INLINE - Input a line to IBUF, exit w
 2209:                          	;
 2210:                          	;**************************************
 2211:                          	;
 2212:      06D3 B4 04 16       INL2:	CJNE	A,#CNTRLD,INL2B ;SEE IF A CON
 2213:                          	;
 2214:      06D6 D1 A5          INL0:	ACALL	CRLF		;DO A CR
 2215:                          	;
 2216:      06D8 75 A0 00       INLINE: MOV	P2,#HIGH IBUF	;IBUF IS IN TH
 2217:      06DB 78 07          	MOV	R0,#LOW IBUF	;POINT AT THE INPUT BU
 2218:                          	;
 2219:      06DD F1 91          INL1:	ACALL	INCHAR		;GET A CHARACTER
 2220:      06DF FD             	MOV	R5,A		;SAVE IN R5 FOR OUTPUT
 2221:      06E0 B4 7F F0       	CJNE	A,#7FH,INL2	;SEE IF A DELETE CHARA
 2222:      06E3 B8 07 18       	CJNE	R0,#LOW IBUF,INL6
 2223:      06E6 7D 07          INL11:	MOV	R5,#BELL	;OUTPUT A BELL
 2224:                          	;
 2225:      06E8 F1 11          INLX:	ACALL	TEROT		;OUTPUT CHARACTER
 2226:      06EA 80 F1          	SJMP	INL1		;DO IT AGAIN
 2227:                          	;
 2228:      06EC F2             INL2B:	MOVX	@R0,A		;SAVE THE CHARACTER
 2229:      06ED B4 0D 02       	CJNE	A,#CR,INL2B1	;IS IT A CR
 2230:      06F0 C1 A5          	AJMP	CRLF		;OUTPUT A CRLF AND EXIT
 2231:      06F2 B4 20 00       INL2B1: CJNE	A,#20H,INL2B2
 2232:      06F5 40 F1          INL2B2: JC	INLX		;ONLY ECHO CONTROL CHAR
 2233:      06F7 08             	INC	R0		;BUMP THE POINTER
 2234:      06F8 B8 56 ED       	CJNE	R0,#IBUF+79,INLX
 2235:      06FB 18             	DEC	R0		;FORCE 79
 2236:      06FC 80 E8          	SJMP	INL11		;OUTPUT A BELL
 2237:                          	;
 2238:      06FE 18             INL6:	DEC	R0		;DEC THE RAM POINTER
 2239:      06FF 7D 08          	MOV	R5,#BS		;OUTPUT A BACK SPACE
 2240:      0701 F1 11          	ACALL	TEROT
 2241:      0703 F1 0F          	ACALL	STEROT		;OUTPUT A SPACE
 2242:      0705 7D 08          	MOV	R5,#BS		;ANOTHER BACK SPACE
 2243:      0707 80 DF          	SJMP	INLX		;OUTPUT IT
 2244:                          ;
 2245:                          ;***************************************
 2246:                          ;****** Use XTAL up to 47 MHz **********
 2247:                          ;****** Wulf 2 *************************
 2248:                          ;
 2249:                          ;PTIME: DB	128-2		;PROM PROGRAMMER TIMER

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 42



 Line    I  Addr Code           Source

 2250:                          ;	DB	00H
 2251:                          ;	DB	00H
 2252:                          ;	DB	50H
 2253:                          ;	DB	67H
 2254:                          ;	DB	41H
 2255:                          ;
 2256:      0709 7D             ptime:	db	128-3		;New programmer timer v
 2257:      070A 00             	db	00H		;divide by 5
 2258:      070B 00             	db	00H		;(50ms EPROM timeing to 10ms fo
 2259:      070C 00             	db	00H
 2260:      070D 35             	db	35H
 2261:      070E 83             	db	83H
 2262:                          ;
 2263:                          ;***************************************
 2264:                          ;
 2265:                          	;**************************************
 2266:                          	;
 2267:                          	; TEROT - Output a character to the sys
 2268:                          	;	  update PHEAD position.
 2269:                          	;
 2270:                          	;**************************************
 2271:                          	;
 2272:      070F 7D 20          STEROT: MOV	R5,#' '         ;OUTPUT A SP
 2273:                          	;
 2274:      0711 C0 E0          TEROT:	PUSH	ACC		;SAVE THE ACCUMULATOR
 2275:      0713 C0 83          	PUSH	DPH		;SAVE THE DPTR
 2276:      0715 C0 82          	PUSH	DPL
 2277:      0717 30 35 04       TEROT01:JNB	CNT_S,TEROT02	;WAIT FOR A CO
 2278:      071A F1 8D          	ACALL	BCK		;GET SERIAL STATUS
 2279:      071C 80 F9          	SJMP	TEROT01
 2280:      071E ED             TEROT02:MOV	A,R5		;PUT OUTPUT BYTE IN A
 2281:      071F 30 2C 05       	JNB	BO,TEROT03	;CHECK FOR MONITOR
 2282:      0722 12 20 40       	LCALL	2040H		;DO THE MONITOR
 2283:      0725 E1 66          	AJMP	TEROT1		;CLEAN UP
 2284:      0727 30 1C 05       TEROT03:JNB	COUB,TEROT04	;SEE IF USER WA
 2285:      072A 12 40 30       	LCALL	4030H
 2286:      072D E1 66          	AJMP	TEROT1
 2287:      072F 30 27 08       TEROT04:JNB	UPB,T_1 	;NO AT IF NO XBIT
 2288:      0732 30 19 05       	JNB	LPB,T_1 	;AT PRINT
 2289:      0735 12 40 3C       	LCALL	403CH		;CALL AT LOCATION
 2290:      0738 E1 66          	AJMP	TEROT1		;FINISH OFF OUTPUT
 2291:                          	;
 2292:      073A 30 1B 22       T_1:	JNB	COB,TXX 	;SEE IF LIST SET
 2293:      073D 90 01 24       	MOV	DPTR,#SPV	;LOAD BAUD RATE
 2294:      0740 B1 82          	ACALL	LD_T
 2295:      0742 C2 97          	CLR	LP		;OUTPUT START BIT
 2296:      0744 B1 2D          	ACALL	TIMER_LOAD	;LOAD AND START THE TI
 2297:      0746 ED             	MOV	A,R5		;GET THE OUTPUT BYTE
 2298:      0747 D3             	SETB	C		;SET CARRY FOR LAST OUTPUT
 2299:      0748 7D 09          	MOV	R5,#9		;LOAD TIMER COUNTDOWN
 2300:                          	;
 2301:      074A 13             LTOUT1: RRC	A		;ROTATE A
 2302:      074B 30 8F FD       	JNB	TF1,$		;WAIT TILL TIMER READY
 2303:      074E 92 97          	MOV	LP,C		;OUTPUT THE BIT
 2304:      0750 B1 2D          	ACALL	TIMER_LOAD	;DO THE NEXT BIT
 2305:      0752 DD F6          	DJNZ	R5,LTOUT1	;LOOP UNTIL DONE

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 43



 Line    I  Addr Code           Source

 2306:      0754 30 8F FD       	JNB	TF1,$		;FIRST STOP BIT
 2307:      0757 B1 2D          	ACALL	TIMER_LOAD
 2308:      0759 30 8F FD       	JNB	TF1,$		;SECOND STOP BIT
 2309:      075C FD             	MOV	R5,A		;RESTORE R5
 2310:      075D 80 07          	SJMP	TEROT1		;BACK TO TEROT
 2311:                          	;
 2312:      075F 30 99 FD       TXX:	JNB	TI,$		;WAIT FOR TRANSMIT READY
 2313:      0762 C2 99          	CLR	TI
 2314:      0764 8D 99          	MOV	SBUF,R5 	;SEND OUT THE CHARACTER
 2315:                          	;
 2316:      0766 BD 0D 03       TEROT1: CJNE	R5,#CR,TEROT11	;SEE IF A CR
 2317:      0769 75 16 00       	MOV	PHEAD,#00H	;IF A CR, RESET PHEAD AN
 2318:                          	;
 2319:      076C BD 0A 0B       TEROT11:CJNE	R5,#LF,NLC	;SEE IF A LF
 2320:      076F E5 15          	MOV	A,NULLCT	;GET THE NULL COUNT
 2321:      0771 60 07          	JZ	NLC		;NO NULLS IF ZERO
 2322:                          	;
 2323:      0773 7D 00          TEROT2: MOV	R5,#NULL	;PUT THE NULL IN TH
 2324:      0775 F1 11          	ACALL	TEROT		;OUTPUT THE NULL
 2325:      0777 14             	DEC	A		;DECREMENT NULL COUNT
 2326:      0778 70 F9          	JNZ	TEROT2		;LOOP UNTIL DONE
 2327:                          	;
 2328:      077A BD 08 02       NLC:	CJNE	R5,#BS,NLC1	;DEC PHEAD IF A BA
 2329:      077D 15 16          	DEC	PHEAD
 2330:      077F BD 20 00       NLC1:	CJNE	R5,#20H,NLC2	;IS IT A PRINTAB
 2331:      0782 40 02          NLC2:	JC	NLC3		;DON'T INCREMENT PHEAD IF
 2332:      0784 05 16          	INC	PHEAD		;BUMP PRINT HEAD
 2333:      0786 D0 82          NLC3:	POP	DPL		;RESTORE DPTR
 2334:      0788 D0 83          	POP	DPH
 2335:      078A D0 E0          	POP	ACC		;RESTORE ACC
 2336:      078C 22             	RET			;EXIT
 2337:                          	;
 2338:      078D F1 C8          BCK:	ACALL	CSTS		;CHECK STATUS
 2339:      078F 50 2E          	JNC	CI_RET1 	;EXIT IF NO CHARACTER
 2340:                          	;
 2341:                          	;**************************************
 2342:                          	;
 2343:                          	;INPUTS A CHARACTER FROM THE SYSTEM CON
 2344:                          	;
 2345:                          	;**************************************
 2346:                          	;
 2347:      0791 30 32 05       INCHAR: JNB	BI,INCHAR1	;CHECK FOR MONITO
 2348:      0794 12 20 60       	LCALL	2060H
 2349:      0797 80 11          	SJMP	INCH1
 2350:      0799 30 1E 05       INCHAR1:JNB	CIUB,INCHAR2	;CHECK FOR USER
 2351:      079C 12 40 33       	LCALL	4033H
 2352:      079F 80 09          	SJMP	INCH1
 2353:      07A1 30 98 FD       INCHAR2:JNB	RI,$		;WAIT FOR RECEIVER REA
 2354:      07A4 E5 99          	MOV	A,SBUF
 2355:      07A6 C2 98          	CLR	RI		;RESET READY
 2356:      07A8 C2 E7          	CLR	ACC.7		;NO BIT 7
 2357:                          	;
 2358:      07AA B4 13 02       INCH1:	CJNE	A,#13H,INCH11
 2359:      07AD D2 35          	SETB	CNT_S
 2360:      07AF B4 11 02       INCH11: CJNE	A,#11H,INCH12
 2361:      07B2 C2 35          	CLR	CNT_S

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 44



 Line    I  Addr Code           Source

 2362:      07B4 B4 03 04       INCH12: CJNE	A,#CNTRLC,INCH13
 2363:      07B7 30 30 1D       	JNB	NO_C,C_EX	;TRAP NO CONTROL C
 2364:      07BA 22             	RET
 2365:                          	;
 2366:                          ;
 2367:                          ;***************************************
 2368:                          ;****** Sorry - but the ego message had 
 2369:                          ;
 2370:                          INCH13:
 2371:                          ;	CLR	JKBIT
 2372:      07BB B4 17 00       	CJNE	A,#17H,CI_RET	;CONTROL W
 2373:                          ;	SETB	JKBIT
 2374:                          ;
 2375:                          ;***************************************
 2376:                          	;
 2377:      07BE D3             CI_RET: SETB	C		;CARRY SET IF A CHARACTE
 2378:      07BF 22             CI_RET1:RET			;EXIT
 2379:                          	;
 2380:                          	;**************************************
 2381:                          	;
 2382:                          	;RROM - The Statement Action Routine RR
 2383:                          	;
 2384:                          	;**************************************
 2385:                          	;
 2386:      07C0 D2 1D          RROM:	SETB	INBIT		;SO NO ERRORS
 2387:      07C2 B1 43          	ACALL	RO1		;FIND THE LINE NUMBER
 2388:      07C4 10 1D 3B       	JBC	INBIT,CRUN
 2389:      07C7 22             	RET			;EXIT
 2390:                          	;
 2391:                          	;**************************************
 2392:                          	;
 2393:                          CSTS:	;	RETURNS CARRY = 1 IF THERE IS A 
 2394:                          	;	THE SYSTEM CONSOLE. IF NO CHARACTER T
 2395:                          	;	WILL BE CLEARED
 2396:                          	;
 2397:                          	;**************************************
 2398:                          	;
 2399:      07C8 30 32 03       	JNB	BI,CSTS1	;BUBBLE STATUS
 2400:      07CB 02 20 68       	LJMP	2068H
 2401:      07CE 30 1E 03       CSTS1:	JNB	CIUB,CSTS2	;SEE IF EXTERNAL C
 2402:      07D1 02 40 36       	LJMP	4036H
 2403:      07D4 A2 98          CSTS2:	MOV	C,RI
 2404:      07D6 22             	RET
 2405:                          	;
 2406:                          ;
 2407:                          ;***************************************
 2408:                          ;****** Sorry - but the ego message had 
 2409:                          ;
 2410:                          ;C_EX0:  MOV	 DPTR,#WB	 ;EGO MESSAGE
 2411:                          ;	 ACALL	 ROM_P
 2412:                          ;
 2413:                          ;***************************************
 2414:                          	;
 2415:      07D7 C2 35          C_EX:	CLR	CNT_S		;NO OUTPUT STOP
 2416:      07D9 12 0C 31       	LCALL	SPRINT1 	;ASSURE CONSOLE
 2417:      07DC D1 A5          	ACALL	CRLF

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 45



 Line    I  Addr Code           Source

 2418:                          ;
 2419:                          ;***************************************
 2420:                          ;****** Sorry - but the ego message had 
 2421:                          ;
 2422:                          ;	 JBC	 JKBIT,C_EX0
 2423:                          ;
 2424:                          ;***************************************
 2425:                          ;
 2426:      07DE 30 2F 7F       	JNB	DIRF,SSTOP0
 2427:      07E1 A1 40          	AJMP	C_K		;CLEAR COB AND EXIT
 2428:                          	;
 2429:      07E3 E5 48          T_CMP:	MOV	A,TVH		;COMPARE TIMER TO SP_H
 2430:      07E5 A9 49          	MOV	R1,TVL
 2431:      07E7 B5 48 F9       	CJNE	A,TVH,T_CMP
 2432:      07EA C9             	XCH	A,R1
 2433:      07EB 95 4C          	SUBB	A,SP_L
 2434:      07ED E9             	MOV	A,R1
 2435:      07EE 95 4B          	SUBB	A,SP_H
 2436:      07F0 22             	RET
 2437:                          	;
 2438:                          	;**************************************
 2439:                          	;
 2440:                          BR0:	; Trap the timer interrupt
 2441:                          	;
 2442:                          	;**************************************
 2443:                          	;
 2444:      07F1 F1 E3          	CALL	T_CMP		;COMPARE TIMER
 2445:      07F3 40 40          	JC	BCHR1		;EXIT IF TEST FAILS
 2446:      07F5 D2 14          	SETB	OTI		;DOING THE TIMER INTERRUPT
 2447:      07F7 C2 10          	CLR	OTS		;CLEAR TIMER BIT
 2448:      07F9 A2 11          	MOV	C,INPROG	;SAVE IN PROGRESS
 2449:      07FB 92 2B          	MOV	ISAV,C
 2450:      07FD 90 01 26       	MOV	DPTR,#TIV
 2451:      0800 80 3C          	SJMP	BR2
 2452:                          	;
 2453:                          	;**************************************
 2454:                          	;
 2455:                          	; The command action routine - RUN
 2456:                          	;
 2457:                          	;**************************************
 2458:                          	;
 2459:      0802 12 06 62       CRUN:	LCALL	CNEW1		;CLEAR THE STORAGE AR
 2460:      0805 71 D0          	ACALL	SRESTR1 	;GET THE STARTING ADDRES
 2461:      0807 51 A4          	ACALL	B_C
 2462:      0809 60 4A          	JZ	CMNDLK		;IF NULL GO TO COMMAND MODE
 2463:                          	;
 2464:      080B D1 B8          	ACALL	T_DP
 2465:      080D F1 23          	ACALL	B_TXA		;BUMP TO STARTING LINE
 2466:                          	;
 2467:      080F 91 3C          CILOOP: ACALL	SP0		;DO A CR AND A LF
 2468:      0811 C2 2F          CILOOP1:CLR	DIRF		;NOT IN DIRECT MODE
 2469:                          	;
 2470:                          	;INTERPERTER DRIVER
 2471:                          	;
 2472:      0813 85 3E 81       ILOOP:	MOV	SP,SPSAV	;RESTORE THE STACK E
 2473:      0816 20 2F 06       	JB	DIRF,ILOOP1	;NO INTERRUPTS IF IN DIR

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 46



 Line    I  Addr Code           Source

 2474:      0819 85 0A 42       	MOV	INTXAH,TXAH	;SAVE THE TEXT POINTER
 2475:      081C 85 08 43       	MOV	INTXAL,TXAL
 2476:      081F 12 07 8D       ILOOP1: LCALL	BCK		;GET CONSOLE STATUS
 2477:      0822 20 2F 24       	JB	DIRF,I_L	;DIRECT MODE
 2478:      0825 B0 18          	ANL	C,/GTRD 	;SEE IF CHARACTER READY
 2479:      0827 50 06          	JNC	BCHR		;NO CHARACTER = NO CARRY
 2480:                          	;
 2481:                          	; DO TRAP OPERATION
 2482:                          	;
 2483:      0829 90 01 00       	MOV	DPTR,#GTB	;SAVE TRAP CHARACTER
 2484:      082C F0             	MOVX	@DPTR,A
 2485:      082D D2 18          	SETB	GTRD		;SAYS READ A BYTE
 2486:                          	;
 2487:      082F 20 14 17       BCHR:	JB	OTI,I_L 	;EXIT IF TIMER INTERRU
 2488:      0832 20 10 BC       	JB	OTS,BR0 	;TEST TIMER VALUE IF SET
 2489:      0835 30 16 11       BCHR1:	JNB	INTPEN,I_L	;SEE IF INTERRUPT 
 2490:      0838 20 11 0E       	JB	INPROG,I_L	;DON'T DO IT AGAIN IF IN 
 2491:      083B 90 01 20       	MOV	DPTR,#INTLOC	;POINT AT INTERRUPT LO
 2492:                          	;
 2493:      083E 7C 02          BR2:	MOV	R4,#GTYPE	;SETUP FOR A FORCED G
 2494:      0840 71 35          	ACALL	SGS1		;PUT TXA ON STACK
 2495:      0842 D2 11          	SETB	INPROG		;INTERRUPT IN PROGRESS
 2496:                          	;
 2497:      0844 12 05 73       ERL4:	CALL	L20DPI
 2498:      0847 41 F8          	AJMP	D_L1		;GET THE LINE NUMBER
 2499:                          	;
 2500:      0849 11 F8          I_L:	ACALL	ISTAT		;LOOP
 2501:      084B F1 17          	ACALL	CLN_UP		;FINISH IT OFF
 2502:      084D 50 C4          	JNC	ILOOP		;LOOP ON THE DRIVER
 2503:      084F 30 2F 03       	JNB	DIRF,CMNDLK	;CMND1 IF IN RUN MODE
 2504:      0852 02 17 94       	LJMP	CMNDR		;DON'T PRINT READY
 2505:                          	;
 2506:      0855 02 17 87       CMNDLK: JMP	CMND1		;DONE
 2507:                          	;**************************************
 2508:                          	;
 2509:                          	; The Statement Action Routine - STOP
 2510:                          	;
 2511:                          	;**************************************
 2512:                          	;
 2513:      0858 F1 17          SSTOP:	ACALL	CLN_UP		;FINISH OFF THIS LI
 2514:      085A 85 0A 42       	MOV	INTXAH,TXAH	;SAVE TEXT POINTER FOR 
 2515:      085D 85 08 43       	MOV	INTXAL,TXAL
 2516:                          	;
 2517:      0860 D2 17          SSTOP0: SETB	CONB		;CONTINUE WILL WORK
 2518:      0862 90 00 EE       	MOV	DPTR,#STP	;PRINT THE STOP MESSAGE
 2519:      0865 D2 20          	SETB	STOPBIT 	;SET FOR ERROR ROUTINE
 2520:      0867 02 18 AD       	JMP	ERRS		;JUMP TO ERROR ROUTINE
 2521:                          	;
 2522:                          	;**************************************
 2523:                          	;
 2524:                          	; ITRAP - Trap special function registe
 2525:                          	;
 2526:                          	;**************************************
 2527:                          	;
 2528:      086A B4 C8 05       ITRAP:	CJNE	A,#TMR0,ITRAP1	;TIMER 0
 2529:      086D 8B 8C          	MOV	TH0,R3

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 47



 Line    I  Addr Code           Source

 2530:      086F 89 8A          	MOV	TL0,R1
 2531:      0871 22             	RET
 2532:                          	;
 2533:      0872 B4 C9 05       ITRAP1: CJNE	A,#TMR1,ITRAP2	;TIMER 1
 2534:      0875 8B 8D          	MOV	TH1,R3
 2535:      0877 89 8B          	MOV	TL1,R1
 2536:      0879 22             	RET
 2537:                          	;
 2538:      087A B4 CA 05       ITRAP2: CJNE	A,#TMR2,ITRAP3	;TIMER 2
 2539:      087D 8B CD          ITRAP21:MOV	TH2,R3
 2540:      087F 89 CC          	MOV	TL2,R1
 2541:                          ;	DB	8BH		;MOV R3 DIRECT OP CODE
 2542:                          ;	DB	0CDH		;T2H LOCATION
 2543:                          ;	DB	89H		;MOV R1 DIRECT OP CODE
 2544:                          ;	DB	0CCH		;T2L LOCATION
 2545:      0881 22             	RET
 2546:                          	;
 2547:      0882 B4 CE 05       ITRAP3: CJNE	A,#TRC2,RCL1	;RCAP2 TOKEN
 2548:      0885 8B CB          RCL:	MOV	RCAPH2,R3
 2549:      0887 89 CA          	MOV	RCAPL2,R1
 2550:                          ;	DB	8BH		;MOV R3 DIRECT OP CODE
 2551:                          ;	DB	0CBH		;RCAP2H LOCATION
 2552:                          ;	DB	89H		;MOV R1 DIRECT OP CODE
 2553:                          ;	DB	0CAH		;RCAP2L LOCATION
 2554:      0889 22             	RET
 2555:                          	;
 2556:      088A 31 D5          RCL1:	ACALL	R3CK		;MAKE SURE THAT R3 IS 
 2557:      088C B4 CB 03       	CJNE	A,#TT2C,RCL2
 2558:      088F 89 C8          	MOV	T2CON,R1
 2559:                          ;	DB	89H		;MOV R1 DIRECT OP CODE
 2560:                          ;	DB	0C8H		;T2CON LOCATION
 2561:      0891 22             	RET
 2562:                          	;
 2563:      0892 B4 C6 03       RCL2:	CJNE	A,#T_IE,RCL3	;IE TOKEN
 2564:      0895 89 A8          	MOV	IE,R1
 2565:      0897 22             	RET
 2566:                          	;
 2567:      0898 B4 C7 03       RCL3:	CJNE	A,#T_IP,RCL4	;IP TOKEN
 2568:      089B 89 B8          	MOV	IP,R1
 2569:      089D 22             	RET
 2570:                          	;
 2571:      089E B4 CC 03       RCL4:	CJNE	A,#TTC,RCL5	;TCON TOKEN
 2572:      08A1 89 88          	MOV	TCON,R1
 2573:      08A3 22             	RET
 2574:                          	;
 2575:      08A4 B4 CD 03       RCL5:	CJNE	A,#TTM,RCL6	;TMOD TOKEN
 2576:      08A7 89 89          	MOV	TMOD,R1
 2577:      08A9 22             	RET
 2578:                          	;
 2579:      08AA B4 CF 32       RCL6:	CJNE	A,#T_P1,T_T2	;P1 TOKEN
 2580:      08AD 89 90          	MOV	P1,R1
 2581:      08AF 22             	RET
 2582:                          	;
 2583:                          	;**************************************
 2584:                          	;
 2585:                          	; T_TRAP - Trap special operators

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 48



 Line    I  Addr Code           Source

 2586:                          	;
 2587:                          	;**************************************
 2588:                          	;
 2589:      08B0 F5 0F          T_T:	MOV	TEMP5,A 	;SAVE THE TOKEN
 2590:      08B2 D1 D7          	ACALL	GCI1		;BUMP POINTER
 2591:      08B4 31 C8          	ACALL	SLET2		;EVALUATE AFTER =
 2592:      08B6 E5 0F          	MOV	A,TEMP5 	;GET THE TOKEN BACK
 2593:      08B8 B4 C3 03       	CJNE	A,#T_XTAL,T_T01
 2594:      08BB 02 16 5C       	LJMP	AXTAL1		;SET UP CRYSTAL
 2595:                          	;
 2596:      08BE D1 90          T_T01:	ACALL	IFIXL		;R3:R1 HAS THE TOS
 2597:      08C0 E5 0F          	MOV	A,TEMP5 	;GET THE TOKEN AGAIN
 2598:      08C2 B4 C4 09       	CJNE	A,#T_MTOP,T_T1	;SEE IF MTOP TOKEN
 2599:      08C5 90 01 0A       	MOV	DPTR,#MEMTOP
 2600:      08C8 12 06 05       	CALL	S31DP
 2601:      08CB 02 06 64       	JMP	RCLEAR		;CLEAR THE MEMORY
 2602:                          	;
 2603:      08CE B4 C5 99       T_T1:	CJNE	A,#T_TIME,ITRAP ;SEE IF A TIM
 2604:      08D1 A2 AF          	MOV	C,EA		;SAVE INTERRUPTS
 2605:      08D3 C2 AF          	CLR	EA		;NO TIMER 0 INTERRUPTS DURING L
 2606:      08D5 8B 48          	MOV	TVH,R3		;SAVE THE TIME
 2607:      08D7 89 49          	MOV	TVL,R1
 2608:                          ;
 2609:                          ;***************************************
 2610:                          ;****** Reset millisecond counter on "TI
 2611:                          ;****** Boehling 2 *********************
 2612:                          ;
 2613:      08D9 75 47 00       	mov	MILLIV,#0	;Reset millisecond counte
 2614:                          ;
 2615:                          ;***************************************
 2616:                          ;
 2617:      08DC 92 AF          	MOV	EA,C		;RESTORE INTERRUPTS
 2618:      08DE 22             	RET			;EXIT
 2619:                          	;
 2620:      08DF B4 D0 56       T_T2:	CJNE	A,#T_PC,INTERX	;PCON TOKEN
 2621:      08E2 89 87          	MOV	PCON,R1
 2622:                          ;	DB	89H		;MOV DIRECT, R1 OP CODE
 2623:                          ;	DB	87H		;ADDRESS OF PCON
 2624:      08E4 22             	RET			;EXIT
 2625:                          	;
 2626:      08E5 B4 D1 C8       T_TRAP: CJNE	A,#T_ASC,T_T	;SEE IF ASC TO
 2627:      08E8 D1 CB          	ACALL	IGC		;EAT IT AND GET THE NEXT CHA
 2628:      08EA B4 24 4B       	CJNE	A,#'$',INTERX   ;ERROR IF NOT A ST
 2629:      08ED 51 1E          	ACALL	CSY		;CALCULATE ADDRESS
 2630:      08EF B1 AD          	ACALL	X3120
 2631:      08F1 12 14 B4       	CALL	TWO_EY
 2632:      08F4 31 DD          	ACALL	SPEOP1		;EVALUATE AFTER EQUALS
 2633:      08F6 21 21          	AJMP	ISTAX1		;SAVE THE CHARACTER
 2634:                          	;
 2635:                          	;**************************************
 2636:                          	;
 2637:                          	;INTERPERT THE STATEMENT POINTED TO BY 
 2638:                          	;
 2639:                          	;**************************************
 2640:                          	;
 2641:      08F8 D1 CD          ISTAT:	ACALL	GC		;GET THR FIRST CHARACTE

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 49



 Line    I  Addr Code           Source

 2642:      08FA 30 2D 0E       	JNB	XBIT,IAT	;TRAP TO EXTERNAL RUN PACK
 2643:      08FD B4 20 00       	CJNE	A,#20H,ISTAT1
 2644:      0900 50 09          ISTAT1: JNC	IAT
 2645:      0902 12 20 70       	LCALL	2070H		;LET THE USER SET UP THE D
 2646:      0905 D1 D7          	ACALL	GCI1
 2647:      0907 54 0F          	ANL	A,#0FH		;STRIP OFF BIAS
 2648:      0909 80 51          	SJMP	ISTA1
 2649:                          	;
 2650:      090B B4 C3 00       IAT:	CJNE	A,#T_XTAL,IAT1
 2651:      090E 50 D5          IAT1:	JNC	T_TRAP
 2652:      0910 30 E7 5B       	JNB	ACC.7,SLET	;IMPLIED LET IF BIT 7 NO
 2653:      0913 B4 BC 06       	CJNE	A,#T_UOP+12,ISTAX	;DBYTE TOKEN
 2654:      0916 31 D9          	ACALL	SPEOP		;EVALUATE SPECIAL OPERATOR
 2655:      0918 31 D5          	ACALL	R3CK		;CHECK LOCATION
 2656:      091A F7             	MOV	@R1,A		;SAVE IT
 2657:      091B 22             	RET
 2658:                          	;
 2659:      091C B4 BD 06       ISTAX:	CJNE	A,#T_UOP+13,ISTAY	;XBYTE TOK
 2660:      091F 31 D9          	ACALL	SPEOP
 2661:                          	;
 2662:      0921 8B A0          ISTAX1: MOV	P2,R3
 2663:      0923 F3             	MOVX	@R1,A
 2664:      0924 22             	RET
 2665:                          	;
 2666:      0925 B4 AB 00       ISTAY:	CJNE	A,#T_CR+1,ISTAY1;TRAP NEW OP
 2667:      0928 40 09          ISTAY1: JC	I_S
 2668:      092A B4 B0 00       	CJNE	A,#0B0H,ISTAY2	;SEE IF TOO BIG
 2669:      092D 50 09          ISTAY2: JNC	INTERX
 2670:      092F 24 F9          	ADD	A,#0F9H 	;BIAS FOR LOOKUP TABLE
 2671:      0931 80 1D          	SJMP	ISTA0		;DO THE OPERATION
 2672:                          	;
 2673:      0933 B4 A4 00       I_S:	CJNE	A,#T_LAST,I_S1	;MAKE SURE AN I
 2674:      0936 40 03          I_S1:	JC	INTERX1 	;ERROR IF NOT
 2675:                          	;
 2676:      0938 02 18 85       INTERX: LJMP	E1XX		;SYNTAX ERROR
 2677:                          	;
 2678:      093B 30 2F 12       INTERX1:JNB	DIRF,ISTA0	;EXECUTE ALL STAT
 2679:      093E B4 90 00       	CJNE	A,#T_DIR,INTERX2;SEE IF ON TOKEN
 2680:      0941 40 0D          INTERX2:JC	ISTA0		;OK IF DIRECT
 2681:      0943 B4 A0 02       	CJNE	A,#T_GOSB+1,INTERX3;SEE IF FOR
 2682:      0946 80 08          	SJMP	ISTA0		;FOR IS OK
 2683:      0948 B4 97 02       INTERX3:CJNE	A,#T_REM+1,INTERX4	;NEXT IS
 2684:      094B 80 03          	SJMP	ISTA0
 2685:      094D B4 96 E8       INTERX4:CJNE	A,#T_STOP+6,INTERX	;SO IS R
 2686:                          	;
 2687:      0950 D1 D7          ISTA0:	ACALL	GCI1		;ADVANCE THE TEXT POI
 2688:      0952 90 01 23       	MOV	DPTR,#STATD	;POINT DPTR TO LOOKUP T
 2689:      0955 B4 80 02       	CJNE	A,#T_GOTO-3,ISTA01;SEE IF LET TOKE
 2690:      0958 80 9E          	SJMP	ISTAT		;WASTE LET TOKEN
 2691:      095A 54 3F          ISTA01: ANL	A,#3FH		;STRIP OFF THE GARBA
 2692:                          	;
 2693:      095C 23             ISTA1:	RL	A		;ROTATE FOR OFFSET
 2694:      095D 25 82          	ADD	A,DPL		;BUMP
 2695:      095F F5 82          	MOV	DPL,A		;SAVE IT
 2696:      0961 E4             	CLR	A
 2697:      0962 93             	MOVC	A,@A+DPTR	;GET HIGH BYTE

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 50



 Line    I  Addr Code           Source

 2698:      0963 C0 E0          	PUSH	ACC		;SAVE IT
 2699:      0965 A3             	INC	DPTR
 2700:      0966 E4             	CLR	A
 2701:      0967 93             	MOVC	A,@A+DPTR	;GET LOW BYTE
 2702:      0968 D0 83          	POP	DPH
 2703:      096A F5 82          	MOV	DPL,A
 2704:                          	;
 2705:      096C E4             AC1:	CLR	A
 2706:      096D 73             	JMP	@A+DPTR 	;GO DO IT
 2707:                          	;
 2708:                          	;**************************************
 2709:                          	;
 2710:                          	; The statement action routine - LET
 2711:                          	;
 2712:                          	;**************************************
 2713:                          	;
 2714:      096E D1 BF          SLET:	ACALL	S_C		;CHECK FOR POSSIBLE STR
 2715:      0970 40 50          	JC	SLET0		;NO STRING
 2716:      0972 C2 15          	CLR	LINEB		;USED STRINGS
 2717:                          	;
 2718:      0974 12 05 79       	CALL	X31DP		;PUT ADDRESS IN DPTR
 2719:      0977 7F EA          	MOV	R7,#T_EQU	;WASTE =
 2720:      0979 91 E5          	ACALL	EATC
 2721:      097B D1 CD          	ACALL	GC		;GET THE NEXT CHARACTER
 2722:      097D B4 22 11       	CJNE	A,#'"',S_3      ;CHECK FOR A "
 2723:      0980 AF 3F          	MOV	R7,S_LEN	;GET THE STRING LENGTH
 2724:                          	;
 2725:      0982 D1 D7          S_0:	ACALL	GCI1		;BUMP PAST "
 2726:      0984 D1 E1          	ACALL	DELTST		;CHECK FOR DELIMITER
 2727:      0986 60 B0          	JZ	INTERX		;EXIT IF CARRIAGE RETURN
 2728:      0988 F0             	MOVX	@DPTR,A 	;SAVE THE CHARACTER
 2729:      0989 B4 22 26       	CJNE	A,#'"',S_1      ;SEE IF DONE
 2730:                          	;
 2731:      098C 74 0D          S_E:	MOV	A,#CR		;PUT A CR IN A
 2732:      098E F0             	MOVX	@DPTR,A 	;SAVE CR
 2733:      098F C1 D7          	AJMP	GCI1
 2734:                          	;
 2735:      0991 C0 83          S_3:	PUSH	DPH
 2736:      0993 C0 82          	PUSH	DPL		;SAVE DESTINATION
 2737:      0995 D1 BF          	ACALL	S_C		;CALCULATE SOURCE
 2738:      0997 40 9F          	JC	INTERX		;ERROR IF CARRY
 2739:      0999 D0 00          	POP	R0B0		;GET DESTINATION BACK
 2740:      099B D0 02          	POP	R2B0
 2741:                          	;
 2742:      099D AF 3F          SSOOP:	MOV	R7,S_LEN	;SET UP COUNTER
 2743:                          	;
 2744:      099F 12 15 96       S_4:	CALL	TBYTE		;TRANSFER THE BYTE
 2745:      09A2 B4 0D 01       	CJNE	A,#CR,S_41	;EXIT IF A CR
 2746:      09A5 22             	RET
 2747:      09A6 DF 05          S_41:	DJNZ	R7,S_5		;BUMP COUNTER
 2748:      09A8 74 0D          	MOV	A,#CR		;SAVE A CR
 2749:      09AA F2             	MOVX	@R0,A
 2750:      09AB C1 4E          	AJMP	EIGP		;PRINT EXTRA IGNORED
 2751:                          	;
 2752:                          	;
 2753:      09AD 12 15 76       S_5:	CALL	INC3210 	;BUMP POINTERS

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 51



 Line    I  Addr Code           Source

 2754:      09B0 80 ED          	SJMP	S_4		;LOOP
 2755:                          	;
 2756:      09B2 DF 06          S_1:	DJNZ	R7,S_11 	;SEE IF DONE
 2757:      09B4 31 8C          	ACALL	S_E
 2758:      09B6 D1 4E          	ACALL	EIGP		;PRINT EXTRA IGNORED
 2759:      09B8 C1 EC          	AJMP	FINDCR		;GO FIND THE END
 2760:      09BA A3             S_11:	INC	DPTR		;BUMP THE STORE POINTER
 2761:      09BB 80 C5          	SJMP	S_0		;CONTINUE TO LOOP
 2762:                          	;
 2763:      09BD 90 18 28       E3XX:	MOV	DPTR,#E3X	;BAD ARG ERROR
 2764:      09C0 81 0E          	AJMP	EK
 2765:                          	;
 2766:      09C2 31 C6          SLET0:	ACALL	SLET1
 2767:      09C4 E1 D3          	AJMP	POPAS		;COPY EXPRESSION TO VARIABL
 2768:                          	;
 2769:      09C6 F1 01          SLET1:	ACALL	VAR_ER		;CHECK FOR A"VARIAB
 2770:                          	;
 2771:      09C8 C0 02          SLET2:	PUSH	R2B0		;SAVE THE VARIABLE ADD
 2772:      09CA C0 00          	PUSH	R0B0
 2773:      09CC 7F EA          	MOV	R7,#T_EQU	;GET EQUAL TOKEN
 2774:      09CE F1 41          	ACALL	WE
 2775:      09D0 D0 01          	POP	R1B0		;POP VARIABLE TO R3:R1
 2776:      09D2 D0 03          	POP	R3B0
 2777:      09D4 22             	RET			;EXIT
 2778:                          	;
 2779:      09D5 BB 00 E5       R3CK:	CJNE	R3,#00H,E3XX	;CHECK TO SEE IF
 2780:      09D8 22             	RET
 2781:                          	;
 2782:      09D9 D1 D7          SPEOP:	ACALL	GCI1		;BUMP TXA
 2783:      09DB 91 DF          	ACALL	P_E		;EVALUATE PAREN
 2784:      09DD 31 C8          SPEOP1: ACALL	SLET2		;EVALUATE AFTER =
 2785:      09DF 12 14 A1       	CALL	TWOL		;R7:R6 GETS VALUE, R3:R1 GET
 2786:      09E2 EE             	MOV	A,R6		;SAVE THE VALUE
 2787:                          	;
 2788:      09E3 BF 00 D7       	CJNE	R7,#00H,E3XX	;R2 MUST BE = 0
 2789:      09E6 22             	RET
 2790:                          	;
 2791:                          	;**************************************
 2792:                          	;
 2793:                          	; ST_CAL - Calculate string Address
 2794:                          	;
 2795:                          	;**************************************
 2796:                          	;
 2797:                          IST_CAL:;
 2798:                          	;
 2799:      09E7 D1 95          	ACALL	I_PI		;BUMP TEXT, THEN EVALUATE
 2800:      09E9 31 D5          	ACALL	R3CK		;ERROR IF R3 <> 0
 2801:      09EB 09             	INC	R1		;BUMP FOR OFFSET
 2802:      09EC E9             	MOV	A,R1		;ERROR IF R1 = 255
 2803:      09ED 60 CE          	JZ	E3XX
 2804:      09EF 90 01 04       	MOV	DPTR,#VARTOP	;GET TOP OF VARIABLE S
 2805:      09F2 85 3F F0       	MOV	B,S_LEN 	;MULTIPLY FOR LOCATION
 2806:      09F5 51 10          	ACALL	VARD		;CALCULATE THE LOCATION
 2807:      09F7 90 01 0A       	MOV	DPTR,#MEMTOP	;SEE IF BLEW IT
 2808:      09FA 12 15 B0       	CALL	FUL1
 2809:      09FD 85 3F 82       	MOV	DPL,S_LEN	;GET STRING LENGTH, DPH =

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 52



 Line    I  Addr Code           Source

 2810:      0A00 15 83          	DEC	DPH		;DPH = 0
 2811:                          	;
 2812:      0A02 C3             DUBSUB: CLR	C
 2813:      0A03 E9             	MOV	A,R1
 2814:      0A04 95 82          	SUBB	A,DPL
 2815:      0A06 F9             	MOV	R1,A
 2816:      0A07 EB             	MOV	A,R3
 2817:      0A08 95 83          	SUBB	A,DPH
 2818:      0A0A FB             	MOV	R3,A
 2819:      0A0B 49             	ORL	A,R1
 2820:      0A0C 22             	RET
 2821:                          	;
 2822:                          	;**************************************
 2823:                          	;
 2824:                          	;VARD - Calculate the offset base
 2825:                          	;
 2826:                          	;**************************************
 2827:                          	;
 2828:      0A0D 75 F0 06       VARB:	MOV	B,#FPSIZ	;SET UP FOR OPERATION
 2829:                          	;
 2830:      0A10 12 05 B0       VARD:	CALL	LDPTRI		;LOAD DPTR
 2831:      0A13 E9             	MOV	A,R1		;MULTIPLY BASE
 2832:      0A14 A4             	MUL	AB
 2833:      0A15 25 82          	ADD	A,DPL
 2834:      0A17 F9             	MOV	R1,A
 2835:      0A18 E5 F0          	MOV	A,B
 2836:      0A1A 35 83          	ADDC	A,DPH
 2837:      0A1C FB             	MOV	R3,A
 2838:      0A1D 22             	RET
 2839:                          	;
 2840:                          	;**************************************
 2841:                          	;
 2842:                          CSY:	; Calculate a biased string address
 2843:                          	;
 2844:                          	;**************************************
 2845:                          	;
 2846:      0A1E 31 E7          	ACALL	IST_CAL 	;CALCULATE IT
 2847:      0A20 C0 03          	PUSH	R3B0		;SAVE IT
 2848:      0A22 C0 01          	PUSH	R1B0
 2849:      0A24 7F 2C          	MOV	R7,#','         ;WASTE THE COMMA
 2850:      0A26 91 E5          	ACALL	EATC
 2851:      0A28 D1 8E          	ACALL	ONE		;GET THE NEXT EXPRESSION
 2852:      0A2A E9             	MOV	A,R1		;CHECK FOR BOUNDS
 2853:      0A2B B5 3F 00       	CJNE	A,S_LEN,CSY1
 2854:      0A2E 50 8D          CSY1:	JNC	E3XX		;MUST HAVE A CARRY
 2855:      0A30 19             	DEC	R1		;BIAS THE POINTER
 2856:      0A31 D0 E0          	POP	ACC		;GET VALUE LOW
 2857:      0A33 29             	ADD	A,R1		;ADD IT TO BASE
 2858:      0A34 F9             	MOV	R1,A		;SAVE IT
 2859:      0A35 D0 03          	POP	R3B0		;GET HIGH ADDRESS
 2860:      0A37 50 01          	JNC	CSY2		;PROPAGATE THE CARRY
 2861:      0A39 0B             	INC	R3
 2862:      0A3A 81 E3          CSY2:	AJMP	ERPAR		;WASTE THE RIGHT PAREN
 2863:                          	;
 2864:                          	;**************************************
 2865:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 53



 Line    I  Addr Code           Source

 2866:                          	; The statement action routine FOR
 2867:                          	;
 2868:                          	;**************************************
 2869:                          	;
 2870:      0A3C 31 C6          SFOR:	ACALL	SLET1		;SET UP CONTROL VARIA
 2871:      0A3E C0 03          	PUSH	R3B0		;SAVE THE CONTROL VARIABLE L
 2872:      0A40 C0 01          	PUSH	R1B0
 2873:      0A42 F1 D3          	ACALL	POPAS		;POP ARG STACK AND COPY CO
 2874:      0A44 7F A6          	MOV	R7,#T_TO	;GET TO TOKEN
 2875:      0A46 F1 41          	ACALL	WE
 2876:      0A48 D1 CD          	ACALL	GC		;GET NEXT CHARACTER
 2877:      0A4A B4 A7 06       	CJNE	A,#T_STEP,SF2
 2878:      0A4D D1 D7          	ACALL	GCI1		;EAT THE TOKEN
 2879:      0A4F F1 43          	ACALL	EXPRB		;EVALUATE EXPRESSION
 2880:      0A51 80 03          	SJMP	SF21		;JUMP OVER
 2881:                          	;
 2882:      0A53 12 14 43       SF2:	LCALL	PUSH_ONE	;PUT ONE ON THE STAC
 2883:                          	;
 2884:      0A56 74 EF          SF21:	MOV	A,#-FSIZE	;ALLOCATE FSIZE BYTE
 2885:      0A58 71 B1          	ACALL	PUSHCS		;GET CS IN R0
 2886:      0A5A 71 BD          	ACALL	CSC		;CHECK CONTROL STACK
 2887:      0A5C 7B 00          	MOV	R3,#CSTKAH	;IN CONTROL STACK
 2888:      0A5E A9 00          	MOV	R1,R0B0 	;STACK ADDRESS
 2889:      0A60 F1 D3          	ACALL	POPAS		;PUT STEP ON STACK
 2890:      0A62 F1 D3          	ACALL	POPAS		;PUT LIMIT ON STACK
 2891:      0A64 D1 A2          	ACALL	DP_T		;DPTR GETS TEXT
 2892:      0A66 A8 01          	MOV	R0,R1B0 	;GET THE POINTER
 2893:      0A68 71 39          	ACALL	T_X_S		;SAVE THE TEXT
 2894:      0A6A D0 08          	POP	TXAL		;GET CONTROL VARIABLE
 2895:      0A6C D0 0A          	POP	TXAH
 2896:      0A6E 7C 01          	MOV	R4,#FTYPE	;AND THE TYPE
 2897:      0A70 71 39          	ACALL	T_X_S		;SAVE IT
 2898:                          	;
 2899:      0A72 D1 B8          SF3:	ACALL	T_DP		;GET THE TEXT POINTER
 2900:      0A74 01 13          	AJMP	ILOOP		;CONTINUE TO PROCESS
 2901:                          	;
 2902:                          	;**************************************
 2903:                          	;
 2904:                          	; The statement action routines - PUSH 
 2905:                          	;
 2906:                          	;**************************************
 2907:                          	;
 2908:      0A76 F1 43          SPUSH:	ACALL	EXPRB		;PUT EXPRESSION ON S
 2909:      0A78 D1 C6          	ACALL	C_TST		;SEE IF MORE TO DO
 2910:      0A7A 50 FA          	JNC	SPUSH		;IF A COMMA PUSH ANOTHER
 2911:      0A7C 22             	RET
 2912:                          	;
 2913:                          	;
 2914:      0A7D F1 01          SPOP:	ACALL	VAR_ER		;GET VARIABLE
 2915:      0A7F F1 D1          	ACALL	XPOP		;FLIP THE REGISTERS FOR POP
 2916:      0A81 D1 C6          	ACALL	C_TST		;SEE IF MORE TO DO
 2917:      0A83 50 F8          	JNC	SPOP
 2918:                          	;
 2919:      0A85 22             SPOP1:	RET
 2920:                          	;
 2921:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 54



 Line    I  Addr Code           Source

 2922:                          	;
 2923:                          	; The statement action routine - IF
 2924:                          	;
 2925:                          	;**************************************
 2926:                          	;
 2927:      0A86 51 C7          SIF:	ACALL	RTST		;EVALUATE THE EXPRESSIO
 2928:      0A88 F9             	MOV	R1,A		;SAVE THE RESULT
 2929:      0A89 D1 CD          	ACALL	GC		;GET THE CHARACTER AFTER EXPR
 2930:      0A8B B4 A5 02       	CJNE	A,#T_THEN,SIF1	;SEE IF THEN TOKEN
 2931:      0A8E D1 D7          	ACALL	GCI1		;WASTE THEN TOKEN
 2932:      0A90 B9 00 0B       SIF1:	CJNE	R1,#0,T_F1	;CHECK R_OP RESULT
 2933:                          	;
 2934:      0A93 7F A8          E_FIND: MOV	R7,#T_ELSE	;FIND ELSE TOKEN
 2935:      0A95 D1 EE          	ACALL	FINDC
 2936:      0A97 60 EC          	JZ	SPOP1		;EXIT IF A CR
 2937:      0A99 D1 D7          	ACALL	GCI1		;BUMP PAST TOKEN
 2938:      0A9B B4 A8 F5       	CJNE	A,#T_ELSE,E_FIND;WASTE IF NO ELSE
 2939:                          	;
 2940:      0A9E F1 35          T_F1:	ACALL	INTGER		;SEE IF NUMBER
 2941:      0AA0 50 56          	JNC	D_L1		;EXECUTE LINE NUMBER
 2942:      0AA2 01 F8          	AJMP	ISTAT		;EXECUTE STATEMENT IN NOT
 2943:                          	;
 2944:      0AA4 E0             B_C:	MOVX	A,@DPTR
 2945:      0AA5 14             	DEC	A
 2946:      0AA6 20 E7 2E       	JB	ACC.7,FL11
 2947:      0AA9 22             	RET
 2948:                          	;
 2949:                          	;**************************************
 2950:                          	;
 2951:                          	; The statement action routine - GOTO
 2952:                          	;
 2953:                          	;**************************************
 2954:                          	;
 2955:      0AAA 51 F2          SGOTO:	ACALL	RLINE		;R2:R0 AND DPTR GET 
 2956:                          	;
 2957:      0AAC D1 B8          SGT1:	ACALL	T_DP		;TEXT POINTER GETS DPT
 2958:                          	;
 2959:      0AAE 10 25 08       	JBC	RETBIT,SGT2	;SEE IF RETI EXECUTED
 2960:                          	;
 2961:      0AB1 30 15 03       	JNB	LINEB,SGT11	;SEE IF A LINE WAS EDIT
 2962:      0AB4 12 06 62       	LCALL	CNEW1		;CLEAR THE MEMORY IF SET
 2963:      0AB7 01 11          SGT11:	AJMP	CILOOP1 	;CLEAR DIRF AND LOO
 2964:                          	;
 2965:      0AB9 10 14 05       SGT2:	JBC	OTI,SGT21	;SEE IF TIMER INTERR
 2966:      0ABC 53 22 BD       	ANL	34,#10111101B	;CLEAR INTERRUPTS
 2967:      0ABF 01 13          	AJMP	ILOOP		;EXECUTE
 2968:      0AC1 A2 2B          SGT21:	MOV	C,ISAV
 2969:      0AC3 92 11          	MOV	INPROG,C
 2970:      0AC5 01 13          	AJMP	ILOOP		;RESTORE INTERRUPTS AND RET
 2971:                          	;
 2972:                          	;
 2973:                          	;**************************************
 2974:                          	;
 2975:                          RTST:	; Test for ZERO
 2976:                          	;
 2977:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 55



 Line    I  Addr Code           Source

 2978:                          	;
 2979:      0AC7 F1 43          	ACALL	EXPRB		;EVALUATE EXPRESSION
 2980:      0AC9 12 12 4F       	CALL	INC_ASTKA	;BUMP ARG STACK
 2981:      0ACC 60 02          	JZ	RTST1		;EXIT WITH ZERO OR 0FFH
 2982:      0ACE 74 FF          	MOV	A,#0FFH
 2983:      0AD0 22             RTST1:	RET
 2984:                          	;
 2985:                          	;
 2986:                          	;**************************************
 2987:                          	;
 2988:                          	; GLN - get the line number in R2:R0, r
 2989:                          	;
 2990:                          	;**************************************
 2991:                          	;
 2992:      0AD1 D1 9B          GLN:	ACALL	DP_B		;GET THE BEGINNING ADDR
 2993:                          	;
 2994:      0AD3 E0             FL1:	MOVX	A,@DPTR 	;GET THE LENGTH
 2995:      0AD4 FF             	MOV	R7,A		;SAVE THE LENGTH
 2996:      0AD5 DF 05          	DJNZ	R7,FL3		;SEE IF END OF FILE
 2997:                          	;
 2998:      0AD7 90 1F B5       FL11:	MOV	DPTR,#E10X	;NO LINE NUMBER
 2999:      0ADA 81 0E          	AJMP	EK		;HANDLE THE ERROR
 3000:                          	;
 3001:      0ADC 20 E7 F8       FL3:	JB	ACC.7,FL11	;CHECK FOR BIT 7
 3002:      0ADF A3             	INC	DPTR		;POINT AT HIGH BYTE
 3003:      0AE0 E0             	MOVX	A,@DPTR 	;GET HIGH BYTE
 3004:      0AE1 B5 02 08       	CJNE	A,R2B0,FL2	;SEE IF MATCH
 3005:      0AE4 A3             	INC	DPTR		;BUMP TO LOW BYTE
 3006:      0AE5 1F             	DEC	R7		;ADJUST AGAIN
 3007:      0AE6 E0             	MOVX	A,@DPTR 	;GET THE LOW BYTE
 3008:      0AE7 B5 00 02       	CJNE	A,R0B0,FL2	;SEE IF LOW BYTE MATCH
 3009:      0AEA A3             	INC	DPTR		;POINT AT FIRST CHARACTER
 3010:      0AEB 22             	RET			;FOUND IT
 3011:                          	;
 3012:      0AEC EF             FL2:	MOV	A,R7		;GET THE LENGTH COUNTER
 3013:      0AED 12 05 DE       	CALL	ADDPTR		;ADD A TO DATA POINTER
 3014:      0AF0 80 E1          	SJMP	FL1		;LOOP
 3015:                          	;
 3016:                          	;
 3017:                          	;**************************************
 3018:                          	;
 3019:                          	;RLINE - Read in ASCII string, get line
 3020:                          	;
 3021:                          	;**************************************
 3022:                          	;
 3023:      0AF2 F1 30          RLINE:	ACALL	INTERR		;GET THE INTEGER
 3024:                          	;
 3025:      0AF4 51 D1          RL1:	ACALL	GLN
 3026:      0AF6 E1 17          	AJMP	CLN_UP
 3027:                          	;
 3028:                          	;
 3029:      0AF8 51 D1          D_L1:	ACALL	GLN		;GET THE LINE
 3030:      0AFA 41 AC          	AJMP	SGT1		;EXECUTE THE LINE
 3031:                          	;
 3032:                          	;**************************************
 3033:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 56



 Line    I  Addr Code           Source

 3034:                          	; The statement action routines WHILE a
 3035:                          	;
 3036:                          	;**************************************
 3037:                          	;
 3038:      0AFC 51 C7          SWHILE: ACALL	RTST		;EVALUATE RELATIONAL
 3039:      0AFE F4             	CPL	A
 3040:      0AFF 80 02          	SJMP	S_WU
 3041:                          	;
 3042:      0B01 51 C7          SUNTIL: ACALL	RTST		;EVALUATE RELATIONAL
 3043:                          	;
 3044:      0B03 7C 03          S_WU:	MOV	R4,#DTYPE	;DO EXPECTED
 3045:      0B05 FD             	MOV	R5,A		;SAVE R_OP RESULT
 3046:      0B06 80 0C          	SJMP	SR0		;GO PROCESS
 3047:                          	;
 3048:                          	;
 3049:                          	;**************************************
 3050:                          	;
 3051:                          CNULL:	; The Command Action Routine - NU
 3052:                          	;
 3053:                          	;**************************************
 3054:                          	;
 3055:      0B08 F1 30          	ACALL	INTERR		;GET AN INTEGER FOLLOWING
 3056:      0B0A 88 15          	MOV	NULLCT,R0	;SAVE THE NULLCOUNT
 3057:      0B0C 01 55          	AJMP	CMNDLK		;JUMP TO COMMAND MODE
 3058:                          	;
 3059:                          	;**************************************
 3060:                          	;
 3061:                          	; The statement action routine - RETI
 3062:                          	;
 3063:                          	;**************************************
 3064:                          	;
 3065:      0B0E D2 25          SRETI:	SETB	RETBIT		;SAYS THAT RETI HAS 
 3066:                          	;
 3067:                          	;**************************************
 3068:                          	;
 3069:                          	; The statement action routine - RETURN
 3070:                          	;
 3071:                          	;**************************************
 3072:                          	;
 3073:      0B10 7C 02          SRETRN: MOV	R4,#GTYPE	;MAKE SURE OF GOSU
 3074:      0B12 7D 55          	MOV	R5,#55H 	;TYPE RETURN TYPE
 3075:                          	;
 3076:      0B14 71 4B          SR0:	ACALL	CSETUP		;SET UP CONTROL STACK
 3077:      0B16 E2             	MOVX	A,@R0		;GET RETURN TEXT ADDRESS
 3078:      0B17 F5 83          	MOV	DPH,A
 3079:      0B19 08             	INC	R0
 3080:      0B1A E2             	MOVX	A,@R0
 3081:      0B1B F5 82          	MOV	DPL,A
 3082:      0B1D 08             	INC	R0		;POP CONTROL STACK
 3083:      0B1E E0             	MOVX	A,@DPTR 	;SEE IF GOSUB WAS THE LAS
 3084:      0B1F B4 01 02       	CJNE	A,#EOF,SR01
 3085:      0B22 01 55          	AJMP	CMNDLK
 3086:      0B24 ED             SR01:	MOV	A,R5		;GET TYPE
 3087:      0B25 60 85          	JZ	SGT1		;EXIT IF ZERO
 3088:      0B27 88 11          	MOV	CSTKA,R0	;POP THE STACK
 3089:      0B29 F4             	CPL	A		;OPTION TEST, 00H, 55H, 0FFH, NO

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 57



 Line    I  Addr Code           Source

 3090:      0B2A 70 80          	JNZ	SGT1		;MUST BE GOSUB
 3091:      0B2C 22             	RET			;NORMAL FALL THRU EXIT FOR NO MAT
 3092:                          	;
 3093:                          	;**************************************
 3094:                          	;
 3095:                          	; The statement action routine - GOSUB
 3096:                          	;
 3097:                          	;**************************************
 3098:                          	;
 3099:      0B2D 51 F2          SGOSUB: ACALL	RLINE		;NEW TXA IN DPTR
 3100:                          	;
 3101:      0B2F 7C 02          SGS0:	MOV	R4,#GTYPE
 3102:      0B31 71 35          	ACALL	SGS1		;SET EVERYTHING UP
 3103:      0B33 41 72          	AJMP	SF3		;EXIT
 3104:                          	;
 3105:      0B35 74 FD          SGS1:	MOV	A,#-3		;ALLOCATE 3 BYTES ON CO
 3106:      0B37 71 B1          	ACALL	PUSHCS
 3107:                          	;
 3108:      0B39 75 A0 00       T_X_S:	MOV	P2,#CSTKAH	;SET UP PORT FOR C
 3109:      0B3C E5 08          	MOV	A,TXAL		;GET RETURN ADDRESS AND SAV
 3110:      0B3E F2             	MOVX	@R0,A
 3111:      0B3F 18             	DEC	R0
 3112:      0B40 E5 0A          	MOV	A,TXAH
 3113:      0B42 F2             	MOVX	@R0,A
 3114:      0B43 18             	DEC	R0
 3115:      0B44 EC             	MOV	A,R4		;GET TYPE
 3116:      0B45 F2             	MOVX	@R0,A		;SAVE TYPE
 3117:      0B46 22             	RET			;EXIT
 3118:                          	;
 3119:                          	;
 3120:      0B47 74 03          CS1:	MOV	A,#3		;POP 3 BYTES
 3121:      0B49 71 B1          	ACALL	PUSHCS
 3122:                          	;
 3123:      0B4B A8 11          CSETUP: MOV	R0,CSTKA	;GET CONTROL STACK
 3124:      0B4D 75 A0 00       	MOV	P2,#CSTKAH
 3125:      0B50 E2             	MOVX	A,@R0		;GET BYTE
 3126:      0B51 B5 04 02       	CJNE	A,R4B0,CSETUP1	;SEE IF TYPE MATCH
 3127:      0B54 08             	INC	R0
 3128:      0B55 22             	RET
 3129:      0B56 60 69          CSETUP1:JZ	E4XX		;EXIT IF STACK UNDERFLO
 3130:      0B58 B4 01 EC       	CJNE	A,#FTYPE,CS1	;SEE IF FOR TYPE
 3131:      0B5B 71 AF          	ACALL	XXI3		;WASTE THE FOR TYPE
 3132:      0B5D 80 EC          	SJMP	CSETUP		;LOOP
 3133:                          	;
 3134:                          	;**************************************
 3135:                          	;
 3136:                          	; The statement action routine - NEXT
 3137:                          	;
 3138:                          	;**************************************
 3139:                          	;
 3140:      0B5F 7C 01          SNEXT:	MOV	R4,#FTYPE	;FOR TYPE
 3141:      0B61 71 4B          	ACALL	CSETUP		;SETUP CONTROL STACK
 3142:      0B63 88 0F          	MOV	TEMP5,R0	;SAVE CONTROL VARIABLE ADD
 3143:      0B65 79 0B          	MOV	R1,#TEMP1	;SAVE VAR + RETURN IN TEM
 3144:                          	;
 3145:      0B67 E2             XXI:	MOVX	A,@R0		;LOOP UNTIL DONE

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 58



 Line    I  Addr Code           Source

 3146:      0B68 F7             	MOV	@R1,A
 3147:      0B69 09             	INC	R1
 3148:      0B6A 08             	INC	R0
 3149:      0B6B B9 0F F9       	CJNE	R1,#TEMP5,XXI
 3150:                          	;
 3151:      0B6E B1 65          	ACALL	VAR		;SEE IF THE USER HAS A VARIA
 3152:      0B70 50 04          	JNC	XXI1
 3153:      0B72 AA 0B          	MOV	R2,TEMP1
 3154:      0B74 A8 0C          	MOV	R0,TEMP2
 3155:      0B76 EA             XXI1:	MOV	A,R2		;SEE IF VAR'S AGREE
 3156:      0B77 B5 0B 47       	CJNE	A,TEMP1,E4XX
 3157:      0B7A E8             	MOV	A,R0
 3158:      0B7B B5 0C 43       	CJNE	A,TEMP2,E4XX
 3159:      0B7E F1 DD          	ACALL	PUSHAS		;PUT CONTROL VARIABLE ON 
 3160:      0B80 74 0E          	MOV	A,#FPSIZ+FPSIZ+2;COMPUTE ADDRESS TO
 3161:      0B82 25 0F          	ADD	A,TEMP5 	;ADD IT TO BASE OF STACK
 3162:      0B84 F8             	MOV	R0,A		;SAVE IN R0
 3163:      0B85 7A 00          	MOV	R2,#CSTKAH	;SET UP TO PUSH STEP VAL
 3164:      0B87 8A A0          	MOV	P2,R2		;SET UP PORT
 3165:      0B89 E2             	MOVX	A,@R0		;GET SIGN
 3166:      0B8A 08             	INC	R0		;BACK TO EXPONENT
 3167:      0B8B C0 E0          	PUSH	ACC		;SAVE SIGN OF STEP
 3168:      0B8D F1 DD          	ACALL	PUSHAS		;PUT STEP VALUE ON STACK
 3169:      0B8F C0 00          	PUSH	R0B0		;SAVE LIMIT VALUE LOCATION
 3170:      0B91 12 17 41       	CALL	AADD		;ADD STEP VALUE TO VARIABLE
 3171:      0B94 12 14 2C       	CALL	CSTAKA		;COPY STACK
 3172:      0B97 AB 0B          	MOV	R3,TEMP1	;GET CONTROL VARIABLE
 3173:      0B99 A9 0C          	MOV	R1,TEMP2
 3174:      0B9B F1 D3          	ACALL	POPAS		;SAVE THE RESULT
 3175:      0B9D 7A 00          	MOV	R2,#CSTKAH	;RESTORE LIMIT LOCATION
 3176:      0B9F D0 00          	POP	R0B0
 3177:      0BA1 F1 DD          	ACALL	PUSHAS		;PUT LIMIT ON STACK
 3178:      0BA3 12 19 73       	CALL	FP_BASE2	;DO THE COMPARE
 3179:      0BA6 D0 E0          	POP	ACC		;GET LIMIT SIGN BACK
 3180:      0BA8 60 01          	JZ	XXI2		;IF SIGN NEGATIVE, TEST "BACKW
 3181:      0BAA B3             	CPL	C
 3182:      0BAB 72 D5          XXI2:	ORL	C,F0		;SEE IF EQUAL
 3183:      0BAD 40 17          	JC	N4		;STILL SMALLER THAN LIMIT?
 3184:      0BAF 74 11          XXI3:	MOV	A,#FSIZE	;REMOVE CONTROL STACK
 3185:                          	;
 3186:                          	; Fall thru to PUSHCS
 3187:                          	;
 3188:                          	;**************************************
 3189:                          	;
 3190:                          	; PUSHCS - push frame onto control stac
 3191:                          	;	   acc has - number of bytes, also te
 3192:                          	;
 3193:                          	;**************************************
 3194:                          	;
 3195:      0BB1 25 11          PUSHCS: ADD	A,CSTKA 	;BUMP CONTROL STACK
 3196:      0BB3 B4 61 00       	CJNE	A,#CONVT+17,PUSHCS1 ;SEE IF OVERFL
 3197:      0BB6 40 09          PUSHCS1:JC	E4XX		;EXIT IF STACK OVERFLOW
 3198:      0BB8 C5 11          	XCH	A,CSTKA 	;STORE NEW CONTROL STACK V
 3199:      0BBA 14             	DEC	A		;BUMP OLD VALUE
 3200:      0BBB F8             	MOV	R0,A		;PUT OLD-1 IN R0
 3201:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 59



 Line    I  Addr Code           Source

 3202:      0BBC 22             PUSHCS2:RET			;EXIT
 3203:                          	;
 3204:      0BBD F1 17          CSC:	ACALL	CLN_UP		;FINISH OFF THE LINE
 3205:      0BBF 50 FB          	JNC	PUSHCS2 	;EXIT IF NO TERMINATOR
 3206:                          	;
 3207:      0BC1 90 03 83       E4XX:	MOV	DPTR,#EXC	;CONTROL STACK ERROR
 3208:      0BC4 81 0E          	AJMP	EK		;STACK ERROR
 3209:                          	;
 3210:      0BC6 85 0D 0A       N4:	MOV	TXAH,TEMP3	;GET TEXT POINTER
 3211:      0BC9 85 0E 08       	MOV	TXAL,TEMP4
 3212:      0BCC 01 13          	AJMP	ILOOP		;EXIT
 3213:                          	;
 3214:                          	;**************************************
 3215:                          	;
 3216:                          	; The statement action routine - RESTOR
 3217:                          	;
 3218:                          	;**************************************
 3219:                          	;
 3220:      0BCE 71 D6          SRESTR: ACALL	X_TR		;SWAP POINTERS
 3221:      0BD0 D1 9B          SRESTR1:ACALL	DP_B		;GET THE STARTING AD
 3222:      0BD2 D1 B8          	ACALL	T_DP		;PUT STARTING ADDRESS IN TE
 3223:      0BD4 F1 23          	ACALL	B_TXA		;BUMP TXA
 3224:                          	;
 3225:                          	; Fall thru
 3226:                          	;
 3227:                          X_TR:	;swap txa and rtxa
 3228:                          	;
 3229:      0BD6 C5 0A          	XCH	A,TXAH
 3230:      0BD8 C5 12          	XCH	A,RTXAH
 3231:      0BDA C5 0A          	XCH	A,TXAH
 3232:      0BDC C5 08          	XCH	A,TXAL
 3233:      0BDE C5 10          	XCH	A,RTXAL
 3234:      0BE0 C5 08          	XCH	A,TXAL
 3235:      0BE2 22             	RET			;EXIT
 3236:                          	;
 3237:                          	;**************************************
 3238:                          	;
 3239:                          	; The statement action routine - READ
 3240:                          	;
 3241:                          	;**************************************
 3242:                          	;
 3243:      0BE3 71 D6          SREAD:	ACALL	X_TR		;SWAP POINTERS
 3244:                          	;
 3245:      0BE5 D1 C6          SRD0:	ACALL	C_TST		;CHECK FOR COMMA
 3246:      0BE7 40 16          	JC	SRD4		;SEE WHAT IT IS
 3247:                          	;
 3248:      0BE9 F1 43          SRD:	ACALL	EXPRB		;EVALUATE THE EXPRESSI
 3249:      0BEB D1 CD          	ACALL	GC		;GET THE CHARACTER AFTER EXPR
 3250:      0BED B4 2C 02       	CJNE	A,#',',SRD1     ;SEE IF MORE DATA
 3251:      0BF0 80 02          	SJMP	SRD2		;BYBASS CLEAN UP IF A COMMA
 3252:                          	;
 3253:      0BF2 F1 17          SRD1:	ACALL	CLN_UP		;FINISH OFF THE LINE
 3254:                          	;
 3255:      0BF4 71 D6          SRD2:	ACALL	X_TR		;RESTORE POINTERS
 3256:      0BF6 F1 01          	ACALL	VAR_ER		;GET VARIABLE ADDRESS
 3257:      0BF8 F1 D1          	ACALL	XPOP		;FLIP THE REGISTERS FOR POP

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 60



 Line    I  Addr Code           Source

 3258:      0BFA D1 C6          	ACALL	C_TST		;SEE IF A COMMA
 3259:      0BFC 50 E5          	JNC	SREAD		;READ AGAIN IF A COMMA
 3260:      0BFE 22             SRD21:	RET			;EXIT IF NOT
 3261:                          	;
 3262:      0BFF B4 9C 04       SRD4:	CJNE	A,#T_DATA,SRD5	;SEE IF DATA
 3263:      0C02 D1 D7          	ACALL	GCI1		;BUMP POINTER
 3264:      0C04 80 E3          	SJMP	SRD
 3265:                          	;
 3266:      0C06 B4 01 08       SRD5:	CJNE	A,#EOF,SRD6	;SEE IF YOU BLEW 
 3267:      0C09 71 D6          SRD51:	ACALL	X_TR		;GET THE TEXT POINTER
 3268:      0C0B 90 1F 81       	MOV	DPTR,#E14X	;READ ERROR
 3269:                          	;
 3270:      0C0E 02 18 8F       EK:	LJMP	ERROR
 3271:                          	;
 3272:      0C11 D1 EC          SRD6:	ACALL	FINDCR		;WASTE THIS LINE
 3273:      0C13 F1 17          	ACALL	CLN_UP		;CLEAN IT UP
 3274:      0C15 40 F2          	JC	SRD51		;ERROR IF AT END
 3275:      0C17 80 CC          	SJMP	SRD0
 3276:                          	;
 3277:      0C19 D1 CD          NUMC:	ACALL	GC		;GET A CHARACTER
 3278:      0C1B B4 23 04       	CJNE	A,#'#',NUMC1    ;SEE IF A #
 3279:      0C1E D2 1B          	SETB	COB		;VALID LINE PRINT
 3280:      0C20 C1 CB          	AJMP	IGC		;BUMP THE TEXT POINTER
 3281:                          	;
 3282:      0C22 B4 40 D9       NUMC1:	CJNE	A,#'@',SRD21    ;EXIT IF NO 
 3283:      0C25 D2 19          	SETB	LPB
 3284:      0C27 C1 CB          	AJMP	IGC
 3285:                          	;
 3286:                          	;**************************************
 3287:                          	;
 3288:                          	; The statement action routine - PRINT
 3289:                          	;
 3290:                          	;**************************************
 3291:                          	;
 3292:      0C29 D2 36          SPH0:	SETB	ZSURP		;NO ZEROS
 3293:                          	;
 3294:      0C2B D2 37          SPH1:	SETB	HMODE		;HEX MODE
 3295:                          	;
 3296:      0C2D 91 19          SPRINT: ACALL	NUMC		;TEST FOR A LINE PRI
 3297:      0C2F 91 38          	ACALL	SPRINT2 	;PROCEED
 3298:      0C31 53 23 F5       SPRINT1:ANL	35,#11110101B	;CLEAR COB AND
 3299:      0C34 53 26 3F       	ANL	38,#00111111B	;NO HEX MODE
 3300:                          	;
 3301:      0C37 22             	RET
 3302:                          	;
 3303:      0C38 D1 E1          SPRINT2:ACALL	DELTST		;CHECK FOR A DELIM
 3304:      0C3A 40 07          	JC	SP1
 3305:                          	;
 3306:      0C3C 02 06 A5       SP0:	JMP	CRLF		;EXIT WITH A CR IF SO
 3307:                          	;
 3308:      0C3F D1 C6          SP2:	ACALL	C_TST		;CHECK FOR A COMMA
 3309:      0C41 40 F9          	JC	SP0		;EXIT IF NO COMMA
 3310:                          	;
 3311:      0C43 D1 A9          SP1:	ACALL	CPS		;SEE IF A STRING TO PRIN
 3312:      0C45 50 F8          	JNC	SP2		;IF A STRING, CHECK FOR A COMM
 3313:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 61



 Line    I  Addr Code           Source

 3314:      0C47 B4 A4 08       SP4:	CJNE	A,#T_TAB,SP6
 3315:      0C4A D1 95          	ACALL	I_PI		;ALWAYS CLEARS CARRY
 3316:      0C4C 95 16          	SUBB	A,PHEAD 	;TAKE DELTA BETWEEN TAB A
 3317:      0C4E 40 EF          	JC	SP2		;EXIT IF PHEAD > TAB
 3318:      0C50 80 05          	SJMP	SP7		;OUTPUT SPACES
 3319:                          	;
 3320:      0C52 B4 A9 0A       SP6:	CJNE	A,#T_SPC,SM
 3321:      0C55 D1 95          	ACALL	I_PI		;SET UP PAREN VALUE
 3322:                          	;
 3323:      0C57 60 E6          SP7:	JZ	SP2
 3324:      0C59 12 07 0F       	LCALL	STEROT		;OUTPUT A SPACE
 3325:      0C5C 14             	DEC	A		;DECREMENT COUNTER
 3326:      0C5D 80 F8          	SJMP	SP7		;LOOP
 3327:                          	;
 3328:      0C5F B4 D3 13       SM:	CJNE	A,#T_CHR,SP8
 3329:      0C62 D1 CB          	ACALL	IGC
 3330:      0C64 B4 24 06       	CJNE	A,#'$',SM01
 3331:      0C67 F1 F9          	ACALL	CNX		;PUT THE CHARACTER ON THE ST
 3332:      0C69 D1 90          	ACALL	IFIXL		;PUT THE CHARACTER IN R1
 3333:      0C6B 80 04          	SJMP	SM02
 3334:      0C6D D1 8E          SM01:	ACALL	ONE		;EVALUATE THE EXPRESSIO
 3335:      0C6F 91 E3          	ACALL	ERPAR
 3336:      0C71 AD 01          SM02:	MOV	R5,R1B0 	;BYTE TO OUTPUT
 3337:      0C73 80 07          	SJMP	SQ
 3338:                          	;
 3339:      0C75 B4 AA 09       SP8:	CJNE	A,#T_CR,SX
 3340:      0C78 D1 D7          	ACALL	GCI1		;EAT THE TOKEN
 3341:      0C7A 7D 0D          	MOV	R5,#CR
 3342:                          	;
 3343:      0C7C 12 07 11       SQ:	CALL	TEROT
 3344:      0C7F 80 BE          	SJMP	SP2		;OUTPUT A CR AND DO IT AGAIN
 3345:                          	;
 3346:      0C81 B4 D2 53       SX:	CJNE	A,#T_USE,SP9	;USING TOKEN
 3347:      0C84 D1 CB          	ACALL	IGC		;GE THE CHARACTER AFTER THE 
 3348:      0C86 B4 46 16       	CJNE	A,#'F',U4       ;SEE IF FLOATING
 3349:      0C89 75 17 F0       	MOV	FORMAT,#0F0H	;SET FLOATING
 3350:      0C8C D1 CB          	ACALL	IGC		;BUMP THE POINTER AND GET TH
 3351:      0C8E D1 D7          	ACALL	GCI1		;BUMP IT AGAIN
 3352:      0C90 54 0F          	ANL	A,#0FH		;STRIP OFF ASCII BIAS
 3353:      0C92 60 07          	JZ	U3		;EXIT IF ZERO
 3354:      0C94 B4 03 00       	CJNE	A,#3,SX1	;SEE IF AT LEAST A THREE
 3355:      0C97 50 02          SX1:	JNC	U3		;FORCE A THREE IF NOT A THR
 3356:      0C99 74 03          	MOV	A,#3
 3357:                          	;
 3358:      0C9B 42 17          U3:	ORL	FORMAT,A	;PUT DIGIT IN FORMAT
 3359:      0C9D 80 2A          	SJMP	U8		;CLEAN UP END
 3360:                          	;
 3361:      0C9F B4 30 07       U4:	CJNE	A,#'0',U5
 3362:      0CA2 75 17 00       	MOV	FORMAT,#0	;FREE FORMAT
 3363:      0CA5 D1 D7          	ACALL	GCI1		;BUMP THE POINTER
 3364:      0CA7 80 20          	SJMP	U8
 3365:                          	;
 3366:      0CA9 B4 23 1D       U5:	CJNE	A,#'#',U8       ;SEE IF INTGER 
 3367:      0CAC 91 CD          	ACALL	U6
 3368:      0CAE 8F 17          	MOV	FORMAT,R7	;SAVE THE FORMAT
 3369:      0CB0 B4 2E 11       	CJNE	A,#'.',U8A      ;SEE IF TERMINATOR

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 62



 Line    I  Addr Code           Source

 3370:      0CB3 D1 CB          	ACALL	IGC		;BUMP PAST .
 3371:      0CB5 91 CD          	ACALL	U6		;LOOP AGAIN
 3372:      0CB7 EF             	MOV	A,R7		;GET COUNT
 3373:      0CB8 25 17          	ADD	A,FORMAT	;SEE IF TOO BIG
 3374:      0CBA 24 F7          	ADD	A,#0F7H
 3375:      0CBC 50 02          	JNC	U5A
 3376:                          	;
 3377:      0CBE 21 38          SE0:	AJMP	INTERX		;ERROR, BAD SYNTAX
 3378:                          	;
 3379:      0CC0 EF             U5A:	MOV	A,R7		;GET THE COUNT BACK
 3380:      0CC1 C4             	SWAP	A		;ADJUST
 3381:      0CC2 42 17          	ORL	FORMAT,A	;GET THE COUNT
 3382:                          	;
 3383:      0CC4 E5 17          U8A:	MOV	A,FORMAT
 3384:                          	;
 3385:      0CC6 C4             U8B:	SWAP	A		;GET THE FORMAT RIGHT
 3386:      0CC7 F5 17          	MOV	FORMAT,A
 3387:                          	;
 3388:      0CC9 91 E3          U8:	ACALL	ERPAR
 3389:      0CCB 81 3F          	AJMP	SP2		;DONE
 3390:                          	;
 3391:      0CCD 7F 00          U6:	MOV	R7,#0		;SET COUNTER
 3392:                          	;
 3393:      0CCF B4 23 0C       U7:	CJNE	A,#'#',SP9A     ;EXIT IF NOT A 
 3394:      0CD2 0F             	INC	R7		;BUMP COUNTER
 3395:      0CD3 D1 CB          	ACALL	IGC		;GET THE NEXT CHARACTER
 3396:      0CD5 80 F8          	SJMP	U7		;LOOP
 3397:                          	;
 3398:      0CD7 D1 E3          SP9:	ACALL	DELTST1 	;CHECK FOR DELIMITER
 3399:      0CD9 50 03          	JNC	SP9A		;EXIT IF A DELIMITER
 3400:                          	;
 3401:      0CDB B4 A8 34       	CJNE	A,#T_ELSE,SS
 3402:                          	;
 3403:      0CDE 22             SP9A:	RET			;EXIT IF ELSE TOKEN
 3404:                          	;
 3405:                          	;**************************************
 3406:                          	;
 3407:                          	; P_E - Evaluate an expression in paren
 3408:                          	;
 3409:                          	;**************************************
 3410:                          	;
 3411:      0CDF 7F E0          P_E:	MOV	R7,#T_LPAR
 3412:      0CE1 F1 41          	ACALL	WE
 3413:                          	;
 3414:      0CE3 7F 29          ERPAR:	MOV	R7,#')'         ;EAT A RIGHT 
 3415:                          	;
 3416:      0CE5 D1 D5          EATC:	ACALL	GCI		;GET THE CHARACTER
 3417:      0CE7 B5 07 D4       	CJNE	A,R7B0,SE0	;ERROR IF NOT THE SAME
 3418:      0CEA 22             	RET
 3419:                          	;
 3420:                          	;**************************************
 3421:                          	;
 3422:                          S_ON:	; ON Statement
 3423:                          	;
 3424:                          	;**************************************
 3425:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 63



 Line    I  Addr Code           Source

 3426:      0CEB D1 8E          	ACALL	ONE		;GET THE EXPRESSION
 3427:      0CED D1 D5          	ACALL	GCI		;GET THE NEXT CHARACTER
 3428:      0CEF B4 83 04       	CJNE	A,#T_GOTO,C0
 3429:      0CF2 91 FD          	ACALL	C1		;EAT THE COMMAS
 3430:      0CF4 41 72          	AJMP	SF3		;DO GOTO
 3431:                          	;
 3432:      0CF6 B4 9F C5       C0:	CJNE	A,#T_GOSB,SE0
 3433:      0CF9 91 FD          	ACALL	C1
 3434:      0CFB 61 2F          	AJMP	SGS0		;DO GOSUB
 3435:                          	;
 3436:      0CFD B9 00 06       C1:	CJNE	R1,#0,C2
 3437:      0D00 F1 30          	ACALL	INTERR		;GET THE LINE NUMBER
 3438:      0D02 D1 EC          	ACALL	FINDCR
 3439:      0D04 41 F4          	AJMP	RL1		;FINISH UP THIS LINE
 3440:                          	;
 3441:      0D06 7F 2C          C2:	MOV	R7,#','
 3442:      0D08 D1 EE          	ACALL	FINDC
 3443:      0D0A B4 2C B1       	CJNE	A,#',',SE0      ;ERROR IF NOT A CO
 3444:      0D0D 19             	DEC	R1
 3445:      0D0E D1 D7          	ACALL	GCI1		;BUMP PAST COMMA
 3446:      0D10 80 EB          	SJMP	C1
 3447:                          	;
 3448:      0D12 D1 BF          SS:	ACALL	S_C		;SEE IF A STRING
 3449:      0D14 40 05          	JC	SA		;NO STRING IF CARRY IS SET
 3450:      0D16 12 06 BF       	LCALL	UPRNT		;PUT POINTER IN DPTR
 3451:      0D19 81 3F          	AJMP	SP2		;SEE IF MORE
 3452:                          	;
 3453:      0D1B F1 43          SA:	ACALL	EXPRB		;MUST BE AN EXPRESSION
 3454:      0D1D 74 48          	MOV	A,#72
 3455:      0D1F B5 16 00       	CJNE	A,PHEAD,SA1	;CHECK PHEAD POSITION
 3456:      0D22 50 02          SA1:	JNC	SA2
 3457:      0D24 91 3C          	ACALL	SP0		;FORCE A CRLF
 3458:      0D26 30 37 14       SA2:	JNB	HMODE,S13	;HEX MODE?
 3459:      0D29 12 12 02       	CALL	FCMP		;SEE IF TOS IS < 0FFFH
 3460:      0D2C 40 0F          	JC	S13		;EXIT IF GREATER
 3461:      0D2E 12 13 8F       	CALL	AABS		;GET THE SIGN
 3462:      0D31 70 07          	JNZ	OOPS		;WASTE IF NEGATIVE
 3463:      0D33 D1 90          	ACALL	IFIXL
 3464:      0D35 12 19 85       	CALL	FP_BASE11	;PRINT HEXMODE
 3465:      0D38 81 3F          	AJMP	SP2
 3466:      0D3A 12 13 A1       OOPS:	CALL	ANEG		;MAKE IT NEGATIVE
 3467:                          	;
 3468:      0D3D 12 19 7D       S13:	CALL	FP_BASE7	;DO FP OUTPUT
 3469:      0D40 74 01          	MOV	A,#1		;OUTPUT A SPACE
 3470:      0D42 81 57          	AJMP	SP7
 3471:                          	;
 3472:                          	;**************************************
 3473:                          	;
 3474:                          	; ANU -  Get variable name from text - 
 3475:                          	;	 if succeeds returns variable in R7:R
 3476:                          	;	 R6 = 0 if no digit in name
 3477:                          	;
 3478:                          	;**************************************
 3479:                          	;
 3480:      0D44 D1 CB          ANU:	ACALL	IGC		;INCREMENT AND GET CHARA
 3481:      0D46 12 1F ED       	LCALL	DIGIT_CHECK	;CHECK FOR DIGIT

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 64



 Line    I  Addr Code           Source

 3482:      0D49 40 0C          	JC	AL2		;EXIT IF VALID DIGIT
 3483:      0D4B B4 5F 01       	CJNE	A,#'_',AL       ;SEE IF A _
 3484:      0D4E 22             	RET
 3485:                          	;
 3486:      0D4F B4 41 00       AL:	CJNE	A,#'A',AL1      ;IS IT AN ASCII
 3487:      0D52 40 04          AL1:	JC	AL3		;EXIT IF CARRY IS SET
 3488:      0D54 B4 5B 00       	CJNE	A,#'Z'+1,AL2    ;IS IT LESS THAN A
 3489:      0D57 B3             AL2:	CPL	C		;FLIP CARRY
 3490:      0D58 22             AL3:	RET
 3491:                          	;
 3492:      0D59 30 D5 3E       SD01:	JNB	F0,VAR2
 3493:                          	;
 3494:      0D5C 90 17 61       SD0:	MOV	DPTR,#E6X
 3495:      0D5F 81 0E          	AJMP	EK
 3496:                          	;
 3497:      0D61 D2 D5          SDIMX:	SETB	F0		;SAYS DOING A DIMENSION
 3498:      0D63 80 02          	SJMP	VAR1
 3499:                          	;
 3500:      0D65 C2 D5          VAR:	CLR	F0		;SAYS DOING A VARIABLE
 3501:                          	;
 3502:      0D67 D1 CD          VAR1:	ACALL	GC		;GET THE CHARACTER
 3503:      0D69 B1 4F          	ACALL	AL		;CHECK FOR ALPHA
 3504:      0D6B 50 04          	JNC	VAR11		;ERROR IF IN DIM
 3505:      0D6D 20 D5 EC       	JB	F0,SD0
 3506:      0D70 22             	RET
 3507:      0D71 FF             VAR11:	MOV	R7,A		;SAVE ALPHA CHARACTER
 3508:      0D72 E4             	CLR	A		;ZERO IN CASE OF FAILURE
 3509:      0D73 FD             	MOV	R5,A		;SAVE IT
 3510:                          	;
 3511:      0D74 FE             VY:	MOV	R6,A
 3512:      0D75 B1 44          	ACALL	ANU		;CHECK FOR ALPHA OR NUMBER
 3513:      0D77 40 07          	JC	VX		;EXIT IF NO ALPHA OR NUM
 3514:                          	;
 3515:      0D79 CF             	XCH	A,R7
 3516:      0D7A 2D             	ADD	A,R5		;NUMBER OF CHARACTERS IN ALPH
 3517:      0D7B CF             	XCH	A,R7		;PUT IT BACK
 3518:      0D7C 7D 1A          	MOV	R5,#26		;FOR THE SECOND TIME AROUND
 3519:      0D7E 80 F4          	SJMP	VY
 3520:                          	;
 3521:      0D80 C2 15          VX:	CLR	LINEB		;TELL EDITOR A VARIABLE I
 3522:      0D82 B4 E0 2F       	CJNE	A,#T_LPAR,V4	;SEE IF A LEFT PAREN
 3523:                          	;
 3524:      0D85 43 06 80       	ORL	R6B0,#80H	;SET BIT 7 TO SIGINIFY MA
 3525:      0D88 12 06 19       	CALL	F_VAR		;FIND THE VARIABLE
 3526:      0D8B C0 02          	PUSH	R2B0		;SAVE THE LOCATION
 3527:      0D8D C0 00          	PUSH	R0B0
 3528:      0D8F 50 C8          	JNC	SD01		;DEFAULT IF NOT IN TABLE
 3529:      0D91 20 D5 28       	JB	F0,SDI		;NO DEFAULT FOR DIMENSION
 3530:      0D94 79 0A          	MOV	R1,#10
 3531:      0D96 7B 00          	MOV	R3,#0
 3532:      0D98 B1 CC          	ACALL	D_CHK
 3533:                          	;
 3534:      0D9A D1 97          VAR2:	ACALL	PAREN_INT	;EVALUATE INTEGER 
 3535:      0D9C BB 00 BD       	CJNE	R3,#0,SD0	;ERROR IF R3<>0
 3536:      0D9F D0 82          	POP	DPL		;GET VAR FOR LOOKUP
 3537:      0DA1 D0 83          	POP	DPH

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 65



 Line    I  Addr Code           Source

 3538:      0DA3 E0             	MOVX	A,@DPTR 	;GET DIMENSION
 3539:      0DA4 14             	DEC	A		;BUMP OFFSET
 3540:      0DA5 99             	SUBB	A,R1		;A MUST BE > R1
 3541:      0DA6 40 B4          	JC	SD0
 3542:      0DA8 12 05 C0       	LCALL	DECDP2		;BUMP POINTER TWICE
 3543:      0DAB 51 0D          	ACALL	VARB		;CALCULATE THE BASE
 3544:                          	;
 3545:      0DAD C9             X3120:	XCH	A,R1		;SWAP R2:R0, R3:R1
 3546:      0DAE C8             	XCH	A,R0
 3547:      0DAF C9             	XCH	A,R1
 3548:      0DB0 CB             	XCH	A,R3
 3549:      0DB1 CA             	XCH	A,R2
 3550:      0DB2 CB             	XCH	A,R3
 3551:      0DB3 22             	RET
 3552:                          	;
 3553:      0DB4 20 D5 A5       V4:	JB	F0,SD0		;ERROR IF NO LPAR FOR DIM
 3554:      0DB7 12 06 19       	LCALL	F_VAR		;GET SCALAR VARIABLE
 3555:      0DBA C3             	CLR	C
 3556:      0DBB 22             	RET
 3557:                          	;
 3558:      0DBC D1 97          SDI:	ACALL	PAREN_INT	;EVALUATE PAREN EXP
 3559:      0DBE BB 00 9B       	CJNE	R3,#0,SD0	;ERROR IF NOT ZERO
 3560:      0DC1 D0 00          	POP	R0B0		;SET UP R2:R0
 3561:      0DC3 D0 02          	POP	R2B0
 3562:      0DC5 B1 CC          	ACALL	D_CHK		;DO DIM
 3563:      0DC7 D1 C6          	ACALL	C_TST		;CHECK FOR COMMA
 3564:      0DC9 50 96          	JNC	SDIMX		;LOOP IF COMMA
 3565:      0DCB 22             	RET			;RETURN IF NO COMMA
 3566:                          	;
 3567:      0DCC 09             D_CHK:	INC	R1		;BUMP FOR TABLE LOOKUP
 3568:      0DCD E9             	MOV	A,R1
 3569:      0DCE 60 8C          	JZ	SD0		;ERROR IF 0FFFFH
 3570:      0DD0 FC             	MOV	R4,A		;SAVE FOR LATER
 3571:      0DD1 90 01 08       	MOV	DPTR,#MT_ALL	;GET MATRIX ALLOCATION
 3572:      0DD4 51 0D          	ACALL	VARB		;DO THE CALCULATION
 3573:      0DD6 AF 83          	MOV	R7,DPH		;SAVE MATRIX ALLOCATION
 3574:      0DD8 AE 82          	MOV	R6,DPL
 3575:      0DDA 90 01 06       	MOV	DPTR,#ST_ALL	;SEE IF TOO MUCH MEMOR
 3576:      0DDD 12 15 B0       	CALL	FUL1		;ST_ALL SHOULD BE > R3:R1
 3577:      0DE0 90 01 08       	MOV	DPTR,#MT_ALL	;SAVE THE NEW MATRIX P
 3578:      0DE3 12 06 05       	CALL	S31DP
 3579:      0DE6 88 82          	MOV	DPL,R0		;GET VARIABLE ADDRESS
 3580:      0DE8 8A 83          	MOV	DPH,R2
 3581:      0DEA EC             	MOV	A,R4		;DIMENSION SIZE
 3582:      0DEB F0             	MOVX	@DPTR,A 	;SAVE IT
 3583:      0DEC 12 05 C0       	CALL	DECDP2		;SAVE TARGET ADDRESS
 3584:                          	;
 3585:      0DEF EF             R76S:	MOV	A,R7
 3586:      0DF0 F0             	MOVX	@DPTR,A
 3587:      0DF1 A3             	INC	DPTR
 3588:      0DF2 EE             	MOV	A,R6		;ELEMENT SIZE
 3589:      0DF3 F0             	MOVX	@DPTR,A
 3590:      0DF4 22             	RET			;R2:R0 STILL HAS SYMBOL TABLE ADD
 3591:                          	;
 3592:                          	;**************************************
 3593:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 66



 Line    I  Addr Code           Source

 3594:                          	; The statement action routine - INPUT
 3595:                          	;
 3596:                          	;**************************************
 3597:                          	;
 3598:      0DF5 D1 A9          SINPUT: ACALL	CPS		;PRINT STRING IF THER
 3599:                          	;
 3600:      0DF7 D1 C6          	ACALL	C_TST		;CHECK FOR A COMMA
 3601:      0DF9 50 07          	JNC	IN2A		;NO CRLF
 3602:      0DFB 91 3C          	ACALL	SP0		;DO A CRLF
 3603:                          	;
 3604:      0DFD 7D 3F          IN2:	MOV	R5,#'?'         ;OUTPUT A ?
 3605:      0DFF 12 07 11       	CALL	TEROT
 3606:                          	;
 3607:      0E02 D2 22          IN2A:	SETB	INP_B		;DOING INPUT
 3608:      0E04 12 06 D8       	CALL	INLINE		;INPUT THE LINE
 3609:      0E07 C2 22          	CLR	INP_B
 3610:      0E09 75 0F 00       	MOV	TEMP5,#HIGH IBUF
 3611:      0E0C 75 0E 07       	MOV	TEMP4,#LOW IBUF
 3612:                          	;
 3613:      0E0F D1 BF          IN3:	ACALL	S_C		;SEE IF A STRING
 3614:      0E11 40 0D          	JC	IN3A		;IF CARRY IS SET, NO STRING
 3615:      0E13 B1 AD          	ACALL	X3120		;FLIP THE ADDRESSES
 3616:      0E15 AB 0F          	MOV	R3,TEMP5
 3617:      0E17 A9 0E          	MOV	R1,TEMP4
 3618:      0E19 31 9D          	ACALL	SSOOP
 3619:      0E1B D1 C6          	ACALL	C_TST		;SEE IF MORE TO DO
 3620:      0E1D 50 DE          	JNC	IN2
 3621:      0E1F 22             	RET
 3622:                          	;
 3623:      0E20 12 18 4D       IN3A:	CALL	DTEMP		;GET THE USER LOCATION
 3624:      0E23 12 19 57       	CALL	GET_NUM 	;GET THE USER SUPPLIED NU
 3625:      0E26 70 18          	JNZ	IN5		;ERROR IF NOT ZERO
 3626:      0E28 12 18 54       	CALL	TEMPD		;SAVE THE DATA POINTER
 3627:      0E2B F1 01          	ACALL	VAR_ER		;GET THE VARIABLE
 3628:      0E2D F1 D1          	ACALL	XPOP		;SAVE THE VARIABLE
 3629:      0E2F 12 18 4D       	CALL	DTEMP		;GET DPTR BACK FROM VAR_ER
 3630:      0E32 D1 C6          	ACALL	C_TST		;SEE IF MORE TO DO
 3631:      0E34 40 13          	JC	IN6		;EXIT IF NO COMMA
 3632:      0E36 E0             	MOVX	A,@DPTR 	;GET INPUT TERMINATOR
 3633:      0E37 B4 2C 06       	CJNE	A,#',',IN5      ;IF NOT A COMMA DO
 3634:      0E3A A3             	INC	DPTR		;BUMP PAST COMMA AND READ NEX
 3635:      0E3B 12 18 54       	CALL	TEMPD
 3636:      0E3E 80 CF          	SJMP	IN3
 3637:                          	;
 3638:      0E40 90 00 F3       IN5:	MOV	DPTR,#IAN	;PRINT INPUT A NUMBER
 3639:      0E43 12 06 AD       	CALL	CRP		;DO A CR, THEN, PRINT FROM RO
 3640:      0E46 02 18 44       	LJMP	CC1		;TRY IT AGAIN
 3641:                          	;
 3642:      0E49 E0             IN6:	MOVX	A,@DPTR
 3643:      0E4A B4 0D 01       	CJNE	A,#CR,EIGP
 3644:      0E4D 22             	RET
 3645:                          	;
 3646:      0E4E 90 03 6D       EIGP:	MOV	DPTR,#EIG
 3647:      0E51 12 06 AD       	CALL	CRP		;PRINT THE MESSAGE AND EXIT
 3648:      0E54 81 3C          	AJMP	SP0		;EXIT WITH A CRLF
 3649:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 67



 Line    I  Addr Code           Source

 3650:                          	;**************************************
 3651:                          	;
 3652:                          SOT:	; On timer interrupt
 3653:                          	;
 3654:                          	;**************************************
 3655:                          	;
 3656:      0E56 D1 85          	ACALL	TWO		;GET THE NUMBERS
 3657:      0E58 8B 4B          	MOV	SP_H,R3
 3658:      0E5A 89 4C          	MOV	SP_L,R1
 3659:      0E5C 90 01 26       	MOV	DPTR,#TIV	;SAVE THE NUMBER
 3660:      0E5F D2 10          	SETB	OTS
 3661:      0E61 A1 EF          	AJMP	R76S		;EXIT
 3662:                          	;
 3663:                          	;
 3664:                          	;**************************************
 3665:                          	;
 3666:                          SCALL:	; Call a user rountine
 3667:                          	;
 3668:                          	;**************************************
 3669:                          	;
 3670:      0E63 F1 30          	ACALL	INTERR		;CONVERT INTEGER
 3671:      0E65 BA 00 0A       	CJNE	R2,#0,S_C_1	;SEE IF TRAP
 3672:      0E68 E8             	MOV	A,R0
 3673:      0E69 20 E7 06       	JB	ACC.7,S_C_1
 3674:      0E6C 28             	ADD	A,R0
 3675:      0E6D 90 41 00       	MOV	DPTR,#4100H
 3676:      0E70 F5 82          	MOV	DPL,A
 3677:                          	;
 3678:      0E72 31 6C          S_C_1:	ACALL	AC1		;JUMP TO USER PROGRAM
 3679:      0E74 53 D0 E7       	ANL	PSW,#11100111B	;BACK TO BANK 0
 3680:      0E77 22             	RET			;EXIT
 3681:                          	;
 3682:                          	;**************************************
 3683:                          	;
 3684:                          THREE:	; Save value for timer function
 3685:                          	;
 3686:                          	;**************************************
 3687:                          	;
 3688:      0E78 D1 8E          	ACALL	ONE		;GET THE FIRST INTEGER
 3689:      0E7A 12 16 7B       	CALL	CBIAS		;BIAS FOR TIMER LOAD
 3690:      0E7D 8B 40          	MOV	T_HH,R3
 3691:      0E7F 89 41          	MOV	T_LL,R1
 3692:      0E81 7F 2C          	MOV	R7,#','         ;WASTE A COMMA
 3693:      0E83 91 E5          	ACALL	EATC		;FALL THRU TO TWO
 3694:                          	;
 3695:                          	;**************************************
 3696:                          	;
 3697:                          TWO:	; Get two values seperated by a com
 3698:                          	;
 3699:                          	;**************************************
 3700:                          	;
 3701:      0E85 F1 43          	ACALL	EXPRB
 3702:      0E87 7F 2C          	MOV	R7,#','         ;WASTE THE COMMA
 3703:      0E89 F1 41          	ACALL	WE
 3704:      0E8B 02 14 A1       	JMP	TWOL		;EXIT
 3705:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 68



 Line    I  Addr Code           Source

 3706:                          	;**************************************
 3707:                          	;
 3708:                          ONE:	; Evaluate an expression and get an
 3709:                          	;
 3710:                          	;**************************************
 3711:                          	;
 3712:      0E8E F1 43          	ACALL	EXPRB		;EVALUATE EXPERSSION
 3713:                          	;
 3714:      0E90 12 12 23       IFIXL:	CALL	IFIX		;INTEGERS IN R3:R1
 3715:      0E93 E9             	MOV	A,R1
 3716:      0E94 22             	RET
 3717:                          	;
 3718:                          	;
 3719:                          	;**************************************
 3720:                          	;
 3721:                          I_PI:	; Increment text pointer then get 
 3722:                          	;
 3723:                          	;**************************************
 3724:                          	;
 3725:      0E95 D1 D7          	ACALL	GCI1		;BUMP TEXT, THEN GET INTEGE
 3726:                          	;
 3727:                          PAREN_INT:; Get an integer in parens ( )
 3728:                          	;
 3729:      0E97 91 DF          	ACALL	P_E
 3730:      0E99 80 F5          	SJMP	IFIXL
 3731:                          	;
 3732:      0E9B 85 13 83       DP_B:	MOV	DPH,BOFAH
 3733:      0E9E 85 14 82       	MOV	DPL,BOFAL
 3734:      0EA1 22             	RET
 3735:                          	;
 3736:      0EA2 85 0A 83       DP_T:	MOV	DPH,TXAH
 3737:      0EA5 85 08 82       	MOV	DPL,TXAL
 3738:      0EA8 22             	RET
 3739:                          	;
 3740:      0EA9 D1 CD          CPS:	ACALL	GC		;GET THE CHARACTER
 3741:      0EAB B4 22 73       	CJNE	A,#'"',NOPASS   ;EXIT IF NO STRING
 3742:      0EAE D1 A2          	ACALL	DP_T		;GET TEXT POINTER
 3743:      0EB0 A3             	INC	DPTR		;BUMP PAST "
 3744:      0EB1 7C 22          	MOV	R4,#'"'
 3745:      0EB3 12 06 C3       	CALL	PN0		;DO THE PRINT
 3746:      0EB6 A3             	INC	DPTR		;GO PAST QUOTE
 3747:      0EB7 C3             	CLR	C		;PASSED TEST
 3748:                          	;
 3749:      0EB8 85 83 0A       T_DP:	MOV	TXAH,DPH	;TEXT POINTER GETS DP
 3750:      0EBB 85 82 08       	MOV	TXAL,DPL
 3751:      0EBE 22             	RET
 3752:                          	;
 3753:                          	;**************************************
 3754:                          	;
 3755:                          S_C:	; Check for a string
 3756:                          	;
 3757:                          	;**************************************
 3758:                          	;
 3759:      0EBF D1 CD          	ACALL	GC		;GET THE CHARACTER
 3760:      0EC1 B4 24 5D       	CJNE	A,#'$',NOPASS   ;SET CARRY IF NOT 
 3761:      0EC4 21 E7          	AJMP	IST_CAL 	;CLEAR CARRY, CALCULATE O

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 69



 Line    I  Addr Code           Source

 3762:                          	;
 3763:                          	;
 3764:                          	;
 3765:                          	;**************************************
 3766:                          	;
 3767:      0EC6 D1 CD          C_TST:	ACALL	GC		;GET A CHARACTER
 3768:      0EC8 B4 2C 56       	CJNE	A,#',',NOPASS   ;SEE IF A COMMA
 3769:                          	;
 3770:                          	;**************************************
 3771:                          	;
 3772:                          	;GC AND GCI - GET A CHARACTER FROM TEXT
 3773:                          	;	      PUT CHARACTER IN THE ACC
 3774:                          	;
 3775:                          	;**************************************
 3776:                          	;
 3777:      0ECB D1 D7          IGC:	ACALL	GCI1		;BUMP POINTER, THEN GET
 3778:                          	;
 3779:      0ECD D2 D3          GC:	SETB	RS0		;USE BANK 1
 3780:      0ECF 8A A0          	MOV	P2,R2		;SET UP PORT 2
 3781:      0ED1 E2             	MOVX	A,@R0		;GET EXTERNAL BYTE
 3782:      0ED2 C2 D3          	CLR	RS0		;BACK TO BANK 0
 3783:      0ED4 22             	RET			;EXIT
 3784:                          	;
 3785:      0ED5 D1 CD          GCI:	ACALL	GC
 3786:                          	;
 3787:                          	; This routine bumps txa by one and alw
 3788:                          	;
 3789:      0ED7 D2 D3          GCI1:	SETB	RS0		;BANK 1
 3790:      0ED9 08             	INC	R0		;BUMP TXA
 3791:      0EDA B8 00 01       	CJNE	R0,#0,GCI11
 3792:      0EDD 0A             	INC	R2
 3793:      0EDE C2 D3          GCI11:	CLR	RS0
 3794:      0EE0 22             	RET			;EXIT
 3795:                          	;
 3796:                          	;**************************************
 3797:                          	;
 3798:                          	; Check delimiters
 3799:                          	;
 3800:                          	;**************************************
 3801:                          	;
 3802:      0EE1 D1 CD          DELTST: ACALL	GC		;GET A CHARACTER
 3803:      0EE3 B4 0D 02       DELTST1:CJNE	A,#CR,DT1	;SEE IF A CR
 3804:      0EE6 E4             	CLR	A
 3805:      0EE7 22             	RET
 3806:                          	;
 3807:      0EE8 B4 3A 36       DT1:	CJNE	A,#':',NOPASS   ;SET CARRY IF 
 3808:                          	;
 3809:      0EEB 22             L_RET:	RET
 3810:                          	;
 3811:                          	;
 3812:                          	;**************************************
 3813:                          	;
 3814:                          	; FINDC - Find the character in R7, upd
 3815:                          	;
 3816:                          	;**************************************
 3817:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 70



 Line    I  Addr Code           Source

 3818:      0EEC 7F 0D          FINDCR: MOV	R7,#CR		;KILL A STATEMENT LI
 3819:                          	;
 3820:      0EEE D1 E1          FINDC:	ACALL	DELTST
 3821:      0EF0 50 F9          	JNC	L_RET
 3822:                          	;
 3823:      0EF2 B5 07 01       	CJNE	A,R7B0,FNDCL2	;MATCH?
 3824:      0EF5 22             	RET
 3825:                          	;
 3826:      0EF6 D1 D7          FNDCL2: ACALL	GCI1
 3827:      0EF8 80 F4          	SJMP	FINDC		;LOOP
 3828:                          	;
 3829:      0EFA D1 D7          FNDCL3: ACALL	GCI1
 3830:                          	;
 3831:      0EFC D1 E1          WCR:	ACALL	DELTST		;WASTE UNTIL A "REAL"
 3832:      0EFE 70 FA          	JNZ	FNDCL3
 3833:      0F00 22             	RET
 3834:                          	;
 3835:                          	;**************************************
 3836:                          	;
 3837:                          	; VAR_ER - Check for a variable, exit i
 3838:                          	;
 3839:                          	;**************************************
 3840:                          	;
 3841:      0F01 B1 65          VAR_ER: ACALL	VAR
 3842:      0F03 80 2D          	SJMP	INTERR1
 3843:                          	;
 3844:                          	;
 3845:                          	;**************************************
 3846:                          	;
 3847:                          	; S_D0 - The Statement Action Routine D
 3848:                          	;
 3849:                          	;**************************************
 3850:                          	;
 3851:      0F05 71 BD          S_DO:	ACALL	CSC		;FINISH UP THE LINE
 3852:      0F07 7C 03          	MOV	R4,#DTYPE	;TYPE FOR STACK
 3853:      0F09 71 35          	ACALL	SGS1		;SAVE ON STACK
 3854:      0F0B 01 13          	AJMP	ILOOP		;EXIT
 3855:                          	;
 3856:                          	;**************************************
 3857:                          	;
 3858:                          	; CLN_UP - Clean up the end of a statem
 3859:                          	;	   file, eat character and line count
 3860:                          	;
 3861:                          	;**************************************
 3862:                          	;
 3863:      0F0D B4 3A 02       C_2:	CJNE	A,#':',C_1      ;SEE IF A TERM
 3864:      0F10 C1 D7          	AJMP	GCI1		;BUMP POINTER AND EXIT, IF S
 3865:                          	;
 3866:      0F12 B4 A8 6D       C_1:	CJNE	A,#T_ELSE,EP5
 3867:      0F15 D1 FC          	ACALL	WCR		;WASTE UNTIL A CR
 3868:                          	;
 3869:      0F17 D1 CD          CLN_UP: ACALL	GC		;GET THE CHARACTER
 3870:      0F19 B4 0D F1       	CJNE	A,#CR,C_2	;SEE IF A CR
 3871:      0F1C D1 CB          	ACALL	IGC		;GET THE NEXT CHARACTER
 3872:      0F1E B4 01 02       	CJNE	A,#EOF,B_TXA	;SEE IF TERMINATOR
 3873:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 71



 Line    I  Addr Code           Source

 3874:      0F21 D3             NOPASS: SETB	C
 3875:      0F22 22             	RET
 3876:                          	;
 3877:      0F23 C5 08          B_TXA:	XCH	A,TXAL		;BUMP TXA BY THREE
 3878:      0F25 24 03          	ADD	A,#3
 3879:      0F27 C5 08          	XCH	A,TXAL
 3880:      0F29 10 D7 01       	JBC	CY,B_TXA1
 3881:      0F2C 22             	RET
 3882:      0F2D 05 0A          B_TXA1: INC	TXAH
 3883:      0F2F 22             	RET
 3884:                          	;
 3885:                          	;**************************************
 3886:                          	;
 3887:                          	;	  Get an INTEGER from the text
 3888:                          	;	  sets CARRY if not found
 3889:                          	;	  returns the INTGER value in DPTR an
 3890:                          	;	  returns the terminator in ACC
 3891:                          	;
 3892:                          	;**************************************
 3893:                          	;
 3894:      0F30 F1 35          INTERR: ACALL	INTGER		;GET THE INTEGER
 3895:      0F32 40 4E          INTERR1:JC	EP5		;ERROR IF NOT FOUND
 3896:      0F34 22             	RET			;EXIT IF FOUND
 3897:                          	;
 3898:      0F35 D1 A2          INTGER: ACALL	DP_T
 3899:      0F37 12 19 81       	CALL	FP_BASE9	;CONVERT THE INTEGER
 3900:      0F3A D1 B8          	ACALL	T_DP
 3901:      0F3C 8A 83          	MOV	DPH,R2		;PUT THE RETURNED VALUE IN 
 3902:      0F3E 88 82          	MOV	DPL,R0
 3903:                          	;
 3904:      0F40 22             ITRET:	RET			;EXIT
 3905:                          	;
 3906:                          	;
 3907:      0F41 91 E5          WE:	ACALL	EATC		;WASTE THE CHARACTER
 3908:                          	;
 3909:                          	; Fall thru to evaluate the expression
 3910:                          	;
 3911:                          	;**************************************
 3912:                          	;
 3913:                          	; EXPRB - Evaluate an expression
 3914:                          	;
 3915:                          	;**************************************
 3916:                          	;
 3917:      0F43 7A CF          EXPRB:	MOV	R2,#LOW OPBOL	;BASE PRECEDENC
 3918:                          	;
 3919:      0F45 C0 02          EP1:	PUSH	R2B0		;SAVE OPERATOR PRECEDENC
 3920:      0F47 C2 24          	CLR	ARGF		;RESET STACK DESIGNATOR
 3921:                          	;
 3922:      0F49 E5 81          EP2:	MOV	A,SP		;GET THE STACK POINTER
 3923:      0F4B 24 0C          	ADD	A,#12		;NEED AT LEAST 12 BYTES
 3924:      0F4D 50 03          	JNC	EP21
 3925:      0F4F 02 18 8C       	LJMP	E1XX2
 3926:      0F52 E5 09          EP21:	MOV	A,ASTKA 	;GET THE ARG STACK
 3927:      0F54 94 38          	SUBB	A,#LOW TM_TOP+12;NEED 12 BYTES ALS
 3928:      0F56 50 03          	JNC	EP22
 3929:      0F58 02 12 1A       	LJMP	E4YY

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 72



 Line    I  Addr Code           Source

 3930:      0F5B 20 24 13       EP22:	JB	ARGF,EP4	;MUST BE AN OPERATOR, 
 3931:      0F5E B1 65          	ACALL	VAR		;IS THE VALUE A VARIABLE?
 3932:      0F60 50 0D          	JNC	EP3		;PUT VARIABLE ON STACK
 3933:                          	;
 3934:      0F62 F1 EF          	ACALL	CONST		;IS THE VALUE A NUMERIC CO
 3935:      0F64 50 0B          	JNC	EP4		;IF SO, CONTINUE, IF NOT, SEE 
 3936:      0F66 D1 CD          	CALL	GC		;GET THE CHARACTER
 3937:      0F68 B4 E0 06       	CJNE	A,#T_LPAR,EP4	;SEE IF A LEFT PAREN
 3938:      0F6B 74 D0          	MOV	A,#(LOW OPBOL+1)
 3939:      0F6D 80 55          	SJMP	XLPAR		;PROCESS THE LEFT PAREN
 3940:                          	;
 3941:      0F6F F1 DD          EP3:	ACALL	PUSHAS		;SAVE VAR ON STACK
 3942:                          	;
 3943:      0F71 D1 CD          EP4:	ACALL	GC		;GET THE OPERATOR
 3944:                          	;
 3945:      0F73 B4 E0 00       	CJNE	A,#T_LPAR,EP41	;IS IT AN OPERATOR
 3946:      0F76 50 0E          EP41:	JNC	XOP		;PROCESS OPERATOR
 3947:      0F78 B4 B0 00       	CJNE	A,#T_UOP,EP42	;IS IT A UNARY OPERA
 3948:      0F7B 50 3B          EP42:	JNC	XBILT		;PROCESS UNARY (BUILT I
 3949:      0F7D D0 02          	POP	R2B0		;GET BACK PREVIOUS OPERATOR P
 3950:      0F7F 20 24 BE       	JB	ARGF,ITRET	;OK IF ARG FLAG IS SET
 3951:                          	;
 3952:      0F82 C3             EP5:	CLR	C		;NO RECOVERY
 3953:      0F83 02 18 87       	LJMP	E1XX1
 3954:                          	;
 3955:                          	; Process the operator
 3956:                          	;
 3957:      0F86 54 1F          XOP:	ANL	A,#1FH		;STRIP OFF THE TOKE BIT
 3958:      0F88 20 24 05       	JB	ARGF,XOP1	;IF ARG FLAG IS SET, PROCE
 3959:      0F8B B4 05 3C       	CJNE	A,#T_SUB-T_LPAR,XOP3
 3960:      0F8E 74 09          	MOV	A,#T_NEG-T_LPAR
 3961:                          	;
 3962:      0F90 24 D0          XOP1:	ADD	A,#LOW OPBOL+1	;BIAS THE TABLE
 3963:      0F92 FA             	MOV	R2,A
 3964:      0F93 90 00 00       	MOV	DPTR,#00H
 3965:      0F96 93             	MOVC	A,@A+DPTR	;GET THE CURRENT PRECEDE
 3966:      0F97 FC             	MOV	R4,A
 3967:      0F98 D0 E0          	POP	ACC		;GET THE PREVIOUS PRECEDENCE
 3968:      0F9A FD             	MOV	R5,A		;SAVE THE PREVIOUS PRECEDENCE
 3969:      0F9B 93             	MOVC	A,@A+DPTR	;GET IT
 3970:      0F9C B5 04 04       	CJNE	A,R4B0,XOP11	;SEE WHICH HAS HIGHER
 3971:      0F9F B4 0C 9E       	CJNE	A,#12,ITRET	;SEE IF ANEG
 3972:      0FA2 D3             	SETB	C
 3973:      0FA3 50 9B          XOP11:	JNC	ITRET		;PROCESS NON-INCREASIN
 3974:                          	;
 3975:                          	; Save increasing precedence
 3976:                          	;
 3977:      0FA5 C0 05          	PUSH	R5B0		;SAVE OLD PRECEDENCE ADDRESS
 3978:      0FA7 C0 02          	PUSH	R2B0		;SAVE NEW PRECEDENCE ADDRESS
 3979:      0FA9 D1 D7          	ACALL	GCI1		;EAT THE OPERATOR
 3980:      0FAB F1 45          	ACALL	EP1		;EVALUATE REMAINING EXPRESSI
 3981:      0FAD D0 E0          XOP12:	POP	ACC
 3982:                          	;
 3983:                          	; R2 has the action address, now setup 
 3984:                          	;
 3985:      0FAF 90 00 57       XOP2:	MOV	DPTR,#OPTAB

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 73



 Line    I  Addr Code           Source

 3986:      0FB2 24 30          	ADD	A,#LOW (NOT OPBOL)
 3987:      0FB4 31 5C          	CALL	ISTA1		;SET UP TO RETURN TO EP2
 3988:      0FB6 E1 49          	AJMP	EP2		;JUMP TO EVALUATE EXPRESSION
 3989:                          	;
 3990:                          	; Built-in operator processing
 3991:                          	;
 3992:      0FB8 D1 D7          XBILT:	ACALL	GCI1		;EAT THE TOKEN
 3993:      0FBA 24 30          	ADD	A,#LOW (50H+LOW UOPBOL)
 3994:      0FBC 20 24 C3       	JB	ARGF,EP5	;XBILT MUST COME AFTER AN O
 3995:      0FBF B4 EE 00       	CJNE	A,#STP,XBILT1
 3996:      0FC2 50 EB          XBILT1: JNC	XOP2
 3997:                          	;
 3998:      0FC4 C0 E0          XLPAR:	PUSH	ACC		;PUT ADDRESS ON THE STA
 3999:      0FC6 91 DF          	ACALL	P_E
 4000:      0FC8 80 E3          	SJMP	XOP12		;PERFORM OPERATION
 4001:                          	;
 4002:      0FCA B4 03 B5       XOP3:	CJNE	A,#T_ADD-T_LPAR,EP5
 4003:      0FCD D1 D7          	ACALL	GCI1
 4004:      0FCF E1 49          	AJMP	EP2		;WASTE + SIGN
 4005:                          	;
 4006:      0FD1 B1 AD          XPOP:	ACALL	X3120		;FLIP ARGS THEN POP
 4007:                          	;
 4008:                          	;**************************************
 4009:                          	;
 4010:                          	; POPAS - Pop arg stack and copy variab
 4011:                          	;
 4012:                          	;**************************************
 4013:                          	;
 4014:      0FD3 12 12 4F       POPAS:	LCALL	INC_ASTKA
 4015:      0FD6 02 14 72       	JMP	VARCOP		;COPY THE VARIABLE
 4016:                          	;
 4017:      0FD9 7A 01          AXTAL:	MOV	R2,#HIGH CXTAL
 4018:      0FDB 78 13          	MOV	R0,#LOW CXTAL
 4019:                          	;
 4020:                          	; fall thru
 4021:                          	;
 4022:                          	;**************************************
 4023:                          	;
 4024:                          PUSHAS: ; Push the Value addressed by R2
 4025:                          	;
 4026:                          	;**************************************
 4027:                          	;
 4028:      0FDD 12 12 0B       	CALL	DEC_ASTKA
 4029:      0FE0 D2 24          	SETB	ARGF		;SAYS THAT SOMTHING IS ON TH
 4030:      0FE2 02 14 72       	LJMP	VARCOP
 4031:                          	;
 4032:                          	;
 4033:                          	;**************************************
 4034:                          	;
 4035:                          ST_A:	; Store at expression
 4036:                          	;
 4037:                          	;**************************************
 4038:                          	;
 4039:      0FE5 D1 8E          	ACALL	ONE		;GET THE EXPRESSION
 4040:      0FE7 80 EA          	SJMP	POPAS		;SAVE IT
 4041:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 74



 Line    I  Addr Code           Source

 4042:                          	;
 4043:                          	;**************************************
 4044:                          	;
 4045:                          LD_A:	; Load at expression
 4046:                          	;
 4047:                          	;**************************************
 4048:                          	;
 4049:      0FE9 D1 8E          	ACALL	ONE		;GET THE EXPRESSION
 4050:      0FEB B1 AD          	ACALL	X3120		;FLIP ARGS
 4051:      0FED 80 EE          	SJMP	PUSHAS
 4052:                          	;
 4053:                          	;**************************************
 4054:                          	;
 4055:                          CONST:	; Get a constant fron the text
 4056:                          	;
 4057:                          	;**************************************
 4058:                          	;
 4059:      0FEF D1 CD          	CALL	GC		;FIRST SEE IF LITERAL
 4060:      0FF1 B4 D1 31       	CJNE	A,#T_ASC,C0C	;SEE IF ASCII TOKEN
 4061:      0FF4 D1 CB          	CALL	IGC		;GET THE CHARACTER AFTER TOKE
 4062:      0FF6 B4 24 05       	CJNE	A,#'$',CN0      ;SEE IF A STRING
 4063:                          	;
 4064:      0FF9 51 1E          CNX:	CALL	CSY		;CALCULATE IT
 4065:      0FFB 02 13 C0       	JMP	AXBYTE1 	;SAVE IT ON THE STACK
 4066:                          ;
 4067:                          ;***************************************
 4068:                          ;****** Correct ASC(x) bug *************
 4069:                          ;****** Wulf 5 *************************
 4070:                          ;
 4071:                          ;
 4072:      0FFE 30 E7 1B       CN0:	jnb	acc.7,cn0t	;jump if possibly as
 4073:      1001 90 01 75       	mov	dptr,#toktab
 4074:      1004 FE             	mov	r6,a		;save search token
 4075:      1005 F4             cn0t1:	cpl	a
 4076:      1006 60 13          	jz	cn0t4		;jump if EOT
 4077:      1008 E4             	clr	a
 4078:      1009 93             	movc	a,@a+dptr	;read token from token t
 4079:      100A A3             	inc	dptr
 4080:      100B B5 06 F7       	cjne	a,r6b0,cn0t1	;jump if wrong entry
 4081:                          	;
 4082:      100E FD             	mov	r5,a		;save search token
 4083:      100F E4             	clr	a
 4084:      1010 93             cn0t2:	movc	a,@a+dptr
 4085:      1011 FE             	mov	r6,a		;save first ascii of token te
 4086:                          	;
 4087:      1012 E4             cn0t3:	clr	a
 4088:      1013 93             	movc	a,@a+dptr
 4089:      1014 A3             	inc	dptr
 4090:      1015 30 E7 FA       	jnb	acc.7,cn0t3	;jump if possibly ascii
 4091:                          	;
 4092:      1018 6D             	xrl	a,r5
 4093:      1019 60 F5          	jz	cn0t2		;jump if same search token ag
 4094:                          	;
 4095:      101B EE             cn0t4:	mov	a,r6		;get saved ascii
 4096:      101C 12 14 B1       CN0t:	CALL	TWO_R2		;PUT IT ON THE STACK
 4097:                          ;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 75



 Line    I  Addr Code           Source

 4098:                          ;****** continue with original code: ***
 4099:                          ;
 4100:      101F 12 0E D7       	CALL	GCI1		;BUMP THE POINTER
 4101:      1022 02 0C E3       	JMP	ERPAR		;WASTE THE RIGHT PAREN
 4102:                          	;
 4103:      1025 12 0E A2       C0C:	CALL	DP_T		;GET THE TEXT POINTER
 4104:      1028 12 19 57       	CALL	GET_NUM 	;GET THE NUMBER
 4105:      102B B4 FF 02       	CJNE	A,#0FFH,C1C	;SEE IF NO NUMBER
 4106:      102E D3             	SETB	C
 4107:      102F 22             C2C:	RET
 4108:                          	;
 4109:      1030 70 06          C1C:	JNZ	FPTST
 4110:      1032 C3             	CLR	C
 4111:      1033 D2 24          	SETB	ARGF
 4112:                          	;
 4113:      1035 02 0E B8       C3C:	JMP	T_DP
 4114:                          	;
 4115:      1038 54 0B          FPTST:	ANL	A,#00001011B	;CHECK FOR ERROR
 4116:      103A 60 F3          	JZ	C2C		;EXIT IF ZERO
 4117:                          	;
 4118:                          	; Handle the error condition
 4119:                          	;
 4120:      103C 90 17 51       	MOV	DPTR,#E2X	;DIVIDE BY ZERO
 4121:      103F 30 E0 03       	JNB	ACC.0,FPTST1	;UNDERFLOW
 4122:      1042 90 18 04       	MOV	DPTR,#E7X
 4123:      1045 30 E1 03       FPTST1: JNB	ACC.1,FPTS	;OVERFLOW
 4124:      1048 90 1F 89       	MOV	DPTR,#E11X
 4125:                          	;
 4126:      104B 02 18 8F       FPTS:	JMP	ERROR
 4127:                          	;
 4128:                          	;**************************************
 4129:                          	;
 4130:                          	; The Command action routine - LIST
 4131:                          	;
 4132:                          	;**************************************
 4133:                          	;
 4134:      104E 12 0C 19       CLIST:	CALL	NUMC		;SEE IF TO LINE PORT
 4135:      1051 71 CB          	ACALL	FSTK		;PUT 0FFFFH ON THE STACK
 4136:      1053 12 0F 35       	CALL	INTGER		;SEE IF USER SUPPLIES LN
 4137:      1056 E4             	CLR	A		;LN = 0 TO START
 4138:      1057 FB             	MOV	R3,A
 4139:      1058 F9             	MOV	R1,A
 4140:      1059 40 14          	JC	CL1		;START FROM ZERO
 4141:                          	;
 4142:      105B 12 18 54       	CALL	TEMPD		;SAVE THE START ADDTESS
 4143:      105E 12 0E D5       	CALL	GCI		;GET THE CHARACTER AFTER LIST
 4144:      1061 B4 E5 07       	CJNE	A,#T_SUB,CLIST1 ;CHECK FOR TERMINA
 4145:      1064 51 4F          	ACALL	INC_ASTKA	;WASTE 0FFFFH
 4146:      1066 12 0F 30       	LCALL	INTERR		;GET TERMINATION ADDRESS
 4147:      1069 91 B4          	ACALL	TWO_EY		;PUT TERMINATION ON THE A
 4148:      106B AB 0F          CLIST1: MOV	R3,TEMP5	;GET THE START ADDT
 4149:      106D A9 0E          	MOV	R1,TEMP4
 4150:                          	;
 4151:      106F 12 05 8C       CL1:	CALL	GETLIN		;GET THE LINE NO IN R3
 4152:      1072 60 1E          	JZ	CL3		;RET IF AT END
 4153:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 76



 Line    I  Addr Code           Source

 4154:      1074 11 35          CL2:	ACALL	C3C		;SAVE THE ADDRESS
 4155:      1076 A3             	INC	DPTR		;POINT TO LINE NUMBER
 4156:      1077 D1 52          	ACALL	PMTOP1		;PUT LINE NUMBER ON THE S
 4157:      1079 51 08          	ACALL	CMPLK		;COMPARE LN TO END ADDRESS
 4158:      107B 40 15          	JC	CL3		;EXIT IF GREATER
 4159:      107D 12 07 8D       	CALL	BCK		;CHECK FOR A CONTROL C
 4160:      1080 51 0B          	ACALL	DEC_ASTKA	;SAVE THE COMPARE ADDRE
 4161:      1082 12 0E A2       	CALL	DP_T		;RESTORE ADDRESS
 4162:      1085 11 A3          	ACALL	UPPL		;UN-PROCESS THE LINE
 4163:      1087 11 35          	ACALL	C3C		;SAVE THE CR ADDRESS
 4164:      1089 11 94          	ACALL	CL6		;PRINT IT
 4165:      108B A3             	INC	DPTR		;BUMP POINTER TO NEXT LINE
 4166:      108C E0             	MOVX	A,@DPTR 	;GET LIN LENGTH
 4167:      108D D5 E0 E4       	DJNZ	ACC,CL2 	;LOOP
 4168:      1090 51 4F          	ACALL	INC_ASTKA	;WASTE THE COMPARE BYTE
 4169:                          	;
 4170:      1092 E1 87          CL3:	AJMP	CMND1		;BACK TO COMMAND PROCES
 4171:                          	;
 4172:      1094 90 00 07       CL6:	MOV	DPTR,#IBUF	;PRINT IBUF
 4173:      1097 12 06 C1       	CALL	PRNTCR		;PRINT IT
 4174:      109A 12 0E A2       	CALL	DP_T
 4175:                          	;
 4176:      109D 02 06 A5       CL7:	JMP	CRLF
 4177:                          	;
 4178:      10A0 12 05 79       UPPL0:	LCALL	X31DP
 4179:                          	;
 4180:                          	;**************************************
 4181:                          	;
 4182:                          	;UPPL - UN PREPROCESS A LINE ADDRESSED 
 4183:                          	;	RETURN SOURCE ADDRESS OF CR IN DPTR O
 4184:                          	;
 4185:                          	;**************************************
 4186:                          	;
 4187:      10A3 7B 00          UPPL:	MOV	R3,#HIGH IBUF	;POINT R3 AT HIG
 4188:      10A5 79 07          	MOV	R1,#LOW IBUF	;POINT R1 AT IBUF
 4189:      10A7 A3             	INC	DPTR		;SKIP OVER LINE LENGTH
 4190:                          ;
 4191:                          ;***************************************
 4192:                          ;****** Elektor 1 Patch ****************
 4193:                          ;
 4194:                          ;	ACALL	C3C		;SAVE THE DPTR (DP_T)
 4195:                          ;	CALL	L20DPI		;PUT LINE NUMBER IN R2:R0
 4196:                          ;	CALL	FP_BASE8	;CONVERT R2:R0 TO INTEGE
 4197:                          ;	CALL	DP_T
 4198:                          ;	INC	DPTR		;BUMP DPTR PAST THE LINE NUM
 4199:                          ;
 4200:                          ;****** Proper code starts here: *******
 4201:                          ;
 4202:      10A8 12 05 73       	lcall	L20DPI		;PUT LINE NUMBER IN R2:R0
 4203:      10AB 12 19 7F       	lcall	FP_BASE8	;CONVERT R2:R0 TO INTEGE
 4204:                          ;
 4205:                          ;****** continue with original code: ***
 4206:                          ;
 4207:      10AE B9 0D 00       UPP0:	CJNE	R1,#LOW IBUF+6,UPP01
 4208:      10B1 40 22          UPP01:	JC	UPP91		;PUT SPACES IN TEXT
 4209:      10B3 A3             	INC	DPTR		;BUMP PAST LN HIGH

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 77



 Line    I  Addr Code           Source

 4210:      10B4 E0             	MOVX	A,@DPTR 	;GET USER TEXT
 4211:      10B5 FE             	MOV	R6,A		;SAVE A IN R6 FOR TOKE COMPAR
 4212:      10B6 20 E7 24       	JB	ACC.7,UPP1	;IF TOKEN, PROCESS
 4213:      10B9 B4 20 00       	CJNE	A,#20H,UPP02	;TRAP THE USER TOKENS
 4214:      10BC 50 03          UPP02:	JNC	UPP03
 4215:      10BE B4 0D 1C       	CJNE	A,#CR,UPP1	;DO IT IF NOT A CR
 4216:      10C1 B4 22 09       UPP03:	CJNE	A,#'"',UPP9     ;SEE IF STRI
 4217:      10C4 31 21          	ACALL	UPP7		;SAVE IT
 4218:      10C6 31 23          UPP04:	ACALL	UPP8		;GET THE NEXT CHARACT
 4219:      10C8 B4 22 FB       	CJNE	A,#'"',UPP04    ;LOOP ON QUOTES
 4220:      10CB 80 E1          	SJMP	UPP0
 4221:                          	;
 4222:      10CD B4 3A 09       UPP9:	CJNE	A,#':',UPP1A    ;PUT A SPACE 
 4223:      10D0 31 1F          	ACALL	UPP7A
 4224:      10D2 EE             	MOV	A,R6
 4225:      10D3 31 21          	ACALL	UPP7
 4226:      10D5 31 1F          UPP91:	ACALL	UPP7A
 4227:      10D7 80 D5          	SJMP	UPP0
 4228:                          	;
 4229:      10D9 31 25          UPP1A:	ACALL	UPP81		;SAVE THE CHARACTER,
 4230:      10DB 80 D1          	SJMP	UPP0		;EXIT IF A CR, ELSE LOOP
 4231:                          	;
 4232:      10DD 11 35          UPP1:	ACALL	C3C		;SAVE THE TEXT POINTER
 4233:      10DF A2 2D          	MOV	C,XBIT
 4234:      10E1 92 D5          	MOV	F0,C		;SAVE XBIT IN F0
 4235:      10E3 90 01 75       UPP11:	MOV	DPTR,#TOKTAB	;POINT AT TOKEN 
 4236:      10E6 30 D5 03       	JNB	F0,UPP2
 4237:      10E9 12 20 78       	LCALL	2078H		;SET UP DPTR FOR LOOKUP
 4238:                          	;
 4239:      10EC E4             UPP2:	CLR	A		;ZERO A FOR LOOKUP
 4240:      10ED 93             	MOVC	A,@A+DPTR	;GET TOKEN
 4241:      10EE A3             	INC	DPTR		;ADVANCE THE TOKEN POINTER
 4242:      10EF B4 FF 05       	CJNE	A,#0FFH,UP_2	;SEE IF DONE
 4243:      10F2 10 D5 EE       	JBC	F0,UPP11	;NOW DO NORMAL TABLE
 4244:      10F5 E1 87          	AJMP	CMND1		;EXIT IF NOT FOUND
 4245:                          	;
 4246:      10F7 B5 06 F2       UP_2:	CJNE	A,R6B0,UPP2	;LOOP UNTIL THE S
 4247:                          	;
 4248:      10FA B4 B0 00       UP_3:	CJNE	A,#T_UOP,UP_4
 4249:      10FD 50 02          UP_4:	JNC	UPP3
 4250:      10FF 31 1F          	ACALL	UPP7A		;PRINT THE SPACE IF OK
 4251:                          	;
 4252:      1101 E4             UPP3:	CLR	A		;DO LOOKUP
 4253:      1102 93             	MOVC	A,@A+DPTR
 4254:      1103 20 E7 07       	JB	ACC.7,UPP4	;EXIT IF DONE, ELSE SAVE
 4255:      1106 60 05          	JZ	UPP4		;DONE IF ZERO
 4256:      1108 31 21          	ACALL	UPP7		;SAVE THE CHARACTER
 4257:      110A A3             	INC	DPTR
 4258:      110B 80 F4          	SJMP	UPP3		;LOOP
 4259:                          	;
 4260:      110D 12 0E A2       UPP4:	CALL	DP_T		;GET IT BACK
 4261:      1110 EE             	MOV	A,R6		;SEE IF A REM TOKEN
 4262:      1111 64 96          	XRL	A,#T_REM
 4263:      1113 70 04          	JNZ	UPP42
 4264:      1115 31 23          UPP41:	ACALL	UPP8
 4265:      1117 80 FC          	SJMP	UPP41

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 78



 Line    I  Addr Code           Source

 4266:      1119 50 93          UPP42:	JNC	UPP0		;START OVER AGAIN IF NO
 4267:      111B 31 1F          	ACALL	UPP7A		;PRINT THE SPACE IF OK
 4268:      111D 80 8F          	SJMP	UPP0		;DONE
 4269:                          	;
 4270:      111F 74 20          UPP7A:	MOV	A,#' '          ;OUTPUT A SPA
 4271:                          	;
 4272:      1121 C1 44          UPP7:	AJMP	PPL91		;SAVE A
 4273:                          	;
 4274:      1123 A3             UPP8:	INC	DPTR
 4275:      1124 E0             	MOVX	A,@DPTR
 4276:      1125 B4 0D F9       UPP81:	CJNE	A,#CR,UPP7
 4277:      1128 C1 30          	AJMP	PPL71
 4278:                          	;
 4279:                          	;**************************************
 4280:                          	;
 4281:                          	; This table contains all of the floati
 4282:                          	;
 4283:                          	; The constants in ROM are stored "back
 4284:                          	; basic normally treats floating point 
 4285:                          	; loading from the exponent and decreme
 4286:                          	; ROM constants pointers load from the 
 4287:                          	; digits and increment the pointers. Th
 4288:                          	; arg stack loading faster and 2) compe
 4289:                          	; no decrement data pointer instruction
 4290:                          	;
 4291:                          	; The numbers are stored as follows:
 4292:                          	;
 4293:                          	; BYTE X+5    = MOST SIGNIFICANT DIGITS
 4294:                          	; BYTE X+4    = NEXT MOST SIGNIFICANT D
 4295:                          	; BYTE X+3    = NEXT LEAST SIGNIFICANT 
 4296:                          	; BYTE X+2    = LEAST SIGNIFICANT DIGIT
 4297:                          	; BYTE X+1    = SIGN OF THE ABOVE MANTI
 4298:                          	; BYTE X      = EXPONENT IN TWO'S COMPL
 4299:                          	;		ZERO EXPONENT = THE NUMBER ZERO
 4300:                          	;
 4301:                          	;**************************************
 4302:                          	;
 4303:      112A 7E             ATTAB:	DB	128-2		; ARCTAN LOOKUP
 4304:      112B 00             	DB	00H
 4305:      112C 57             	DB	57H
 4306:      112D 22             	DB	22H
 4307:      112E 66             	DB	66H
 4308:      112F 28             	DB	28H
 4309:                          	;
 4310:      1130 7F             	DB	128-1
 4311:      1131 01             	DB	01H
 4312:      1132 37             	DB	37H
 4313:      1133 57             	DB	57H
 4314:      1134 16             	DB	16H
 4315:      1135 16             	DB	16H
 4316:                          	;
 4317:      1136 7F             	DB	128-1
 4318:      1137 00             	DB	00H
 4319:      1138 14             	DB	14H
 4320:      1139 96             	DB	96H
 4321:      113A 90             	DB	90H

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 79



 Line    I  Addr Code           Source

 4322:      113B 42             	DB	42H
 4323:                          	;
 4324:      113C 7F             	DB	128-1
 4325:      113D 01             	DB	01H
 4326:      113E 40             	DB	40H
 4327:      113F 96             	DB	96H
 4328:      1140 28             	DB	28H
 4329:      1141 75             	DB	75H
 4330:                          	;
 4331:      1142 80             	DB	128
 4332:      1143 00             	DB	00H
 4333:      1144 64             	DB	64H
 4334:      1145 62             	DB	62H
 4335:      1146 65             	DB	65H
 4336:      1147 10             	DB	10H
 4337:                          	;
 4338:      1148 80             	DB	128
 4339:      1149 01             	DB	01H
 4340:      114A 99             	DB	99H
 4341:      114B 88             	DB	88H
 4342:      114C 20             	DB	20H
 4343:      114D 14             	DB	14H
 4344:                          	;
 4345:      114E 80             	DB	128
 4346:      114F 00             	DB	00H
 4347:      1150 51             	DB	51H
 4348:      1151 35             	DB	35H
 4349:      1152 99             	DB	99H
 4350:      1153 19             	DB	19H
 4351:                          	;
 4352:      1154 80             	DB	128
 4353:      1155 01             	DB	01H
 4354:      1156 45             	DB	45H
 4355:      1157 31             	DB	31H
 4356:      1158 33             	DB	33H
 4357:      1159 33             	DB	33H
 4358:                          	;
 4359:      115A 81             	DB	129
 4360:      115B 00             	DB	00H
 4361:      115C 00             	DB	00H
 4362:      115D 00             	DB	00H
 4363:      115E 00             	DB	00H
 4364:      115F 10             	DB	10H
 4365:                          	;
 4366:      1160 FF             	DB	0FFH		;END OF TABLE
 4367:                          	;
 4368:      1161 81             NTWO:	DB	129
 4369:      1162 00             	DB	0
 4370:      1163 00             	DB	0
 4371:      1164 00             	DB	0
 4372:      1165 00             	DB	0
 4373:      1166 20             	DB	20H
 4374:                          ;
 4375:                          ;***************************************
 4376:                          ;****** Use XTAL up to 47 MHz **********
 4377:                          ;****** Wulf 2 *************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 80



 Line    I  Addr Code           Source

 4378:                          ;
 4379:                          ;TTIME: DB	128-4		; CLOCK CALCULATION
 4380:                          ;	DB	00H
 4381:                          ;	DB	00H
 4382:                          ;	DB	00H
 4383:                          ;	DB	04H
 4384:                          ;	DB	13H
 4385:                          ;
 4386:      1167 7B             ttime:	db	128-5		;New clock calculation 
 4387:      1168 00             	db	00H		;16 bit mode
 4388:      1169 42             	db	42H
 4389:      116A 60             	db	60H
 4390:      116B 27             	db	27H
 4391:      116C 16             	db	16H
 4392:                          ;
 4393:                          ;***************************************
 4394:                          ;
 4395:                          	;**************************************
 4396:                          	;
 4397:                          	; COSINE - Add pi/2 to stack, then fall
 4398:                          	;
 4399:                          	;**************************************
 4400:                          	;
 4401:      116D 31 92          ACOS:	ACALL	POTWO		;PUT PI/2 ON THE STAC
 4402:      116F F1 41          	ACALL	AADD		;TOS = TOS+PI/2
 4403:                          	;
 4404:                          	;**************************************
 4405:                          	;
 4406:                          	; SINE - use taylor series to calculate
 4407:                          	;
 4408:                          	;**************************************
 4409:                          	;
 4410:      1171 91 7F          ASIN:	ACALL	PIPI		;PUT PI ON THE STACK
 4411:      1173 31 B5          	ACALL	RV		;REDUCE THE VALUE
 4412:      1175 E5 46          	MOV	A,MT2		;CALCULATE THE SIGN
 4413:      1177 54 01          	ANL	A,#01H		;SAVE LSB
 4414:      1179 62 45          	XRL	MT1,A		;SAVE SIGN IN MT1
 4415:      117B 91 2C          	ACALL	CSTAKA		;NOW CONVERT TO ONE QUADR
 4416:      117D 31 92          	ACALL	POTWO
 4417:      117F 51 08          	ACALL	CMPLK		;DO COMPARE
 4418:      1181 40 04          	JC	ASIN1
 4419:      1183 91 7F          	ACALL	PIPI
 4420:      1185 F1 1C          	ACALL	ASUB
 4421:      1187 71 8F          ASIN1:	ACALL	AABS
 4422:      1189 90 16 CE       	MOV	DPTR,#SINTAB	;SET UP LOOKUP TABLE
 4423:      118C 31 9B          	ACALL	POLYC		;CALCULATE THE POLY
 4424:      118E 31 DA          	ACALL	STRIP
 4425:      1190 21 FC          	AJMP	SIN0
 4426:                          	;
 4427:                          	; Put PI/2 on the stack
 4428:                          	;
 4429:      1192 91 7F          POTWO:	ACALL	PIPI		;PUT PI ON THE STACK,
 4430:                          	;
 4431:      1194 90 11 61       DBTWO:	MOV	DPTR,#NTWO
 4432:      1197 91 33          	ACALL	PUSHC
 4433:                          	;MOV	A,#2		;BY TWO

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 81



 Line    I  Addr Code           Source

 4434:                          	;ACALL	TWO_R2
 4435:      1199 81 0A          	AJMP	ADIV
 4436:                          	;
 4437:                          	;**************************************
 4438:                          	;
 4439:                          POLYC:	; Expand a power series to calcul
 4440:                          	;
 4441:                          	;**************************************
 4442:                          	;
 4443:      119B 91 2A          	ACALL	CSTAKA2 	;COPY THE STACK
 4444:      119D 31 B0          	ACALL	AMUL		;SQUARE THE STACK
 4445:      119F 91 48          	ACALL	POP_T1		;SAVE X*X
 4446:      11A1 91 33          	ACALL	PUSHC		;PUT CONSTANT ON STACK
 4447:                          	;
 4448:      11A3 91 4F          POLY1:	ACALL	PUSH_T1 	;PUT COMPUTED VALU
 4449:      11A5 31 B0          	ACALL	AMUL		;MULTIPLY CONSTANT AND COMP
 4450:      11A7 91 33          	ACALL	PUSHC		;PUT NEXT CONSTANT ON STAC
 4451:      11A9 F1 41          	ACALL	AADD		;ADD IT TO THE OLD VALUE
 4452:      11AB E4             	CLR	A		;CHECK TO SEE IF DONE
 4453:      11AC 93             	MOVC	A,@A+DPTR
 4454:      11AD B4 FF F3       	CJNE	A,#0FFH,POLY1	;LOOP UNTIL DONE
 4455:                          	;
 4456:      11B0 12 19 75       AMUL:	LCALL	FP_BASE3
 4457:      11B3 01 38          	AJMP	FPTST
 4458:                          	;
 4459:                          	;**************************************
 4460:                          	;
 4461:                          RV:	; Reduce a value for Trig and A**X f
 4462:                          	;
 4463:                          	; value = (value/x - INT(value/x)) * x
 4464:                          	;
 4465:                          	;**************************************
 4466:                          	;
 4467:      11B5 91 6C          	ACALL	C2_T2		;COPY TOS TO T2
 4468:      11B7 91 0A          	ACALL	ADIV		;TOS = TOS/TEMP2
 4469:      11B9 71 8F          	ACALL	AABS		;MAKE THE TOS A POSITIVE NU
 4470:      11BB F5 45          	MOV	MT1,A		;SAVE THE SIGN
 4471:      11BD 91 2A          	ACALL	CSTAKA2 	;COPY THE STACK TWICE
 4472:      11BF 51 23          	ACALL	IFIX		;PUT THE NUMBER IN R3:R1
 4473:      11C1 C0 03          	PUSH	R3B0		;SAVE R3
 4474:      11C3 89 46          	MOV	MT2,R1		;SAVE THE LS BYTE IN MT2
 4475:      11C5 71 6D          	ACALL	AINT		;MAKE THE TOS AN INTEGER
 4476:      11C7 F1 1C          	ACALL	ASUB		;TOS = TOS/T2 - INT(TOS/T2)
 4477:      11C9 91 56          	ACALL	P_T2		;TOS = T2
 4478:      11CB 31 B0          	ACALL	AMUL		;TOS = T2*(TOS/T2 - INT(TOS
 4479:      11CD D0 03          	POP	R3B0		;RESTORE R3
 4480:      11CF 22             	RET			;EXIT
 4481:                          	;
 4482:                          	;**************************************
 4483:                          	;
 4484:                          	; TAN
 4485:                          	;
 4486:                          	;**************************************
 4487:                          	;
 4488:      11D0 91 2C          ATAN:	ACALL	CSTAKA		;DUPLACATE STACK
 4489:      11D2 31 71          	ACALL	ASIN		;TOS = SIN(X)

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 82



 Line    I  Addr Code           Source

 4490:      11D4 91 5A          	ACALL	SWAP_ASTKA	;TOS = X
 4491:      11D6 31 6D          	ACALL	ACOS		;TOS = COS(X)
 4492:      11D8 81 0A          	AJMP	ADIV		;TOS = SIN(X)/COS(X)
 4493:                          	;
 4494:      11DA 51 53          STRIP:	ACALL	SETREG		;SETUP R0
 4495:      11DC 7B 01          	MOV	R3,#1		;LOOP COUNT
 4496:      11DE 61 81          	AJMP	AI11		;WASTE THE LSB
 4497:                          	;
 4498:                          	;**************************************
 4499:                          	;
 4500:                          	; ARC TAN
 4501:                          	;
 4502:                          	;**************************************
 4503:                          	;
 4504:      11E0 71 8F          AATAN:	ACALL	AABS
 4505:      11E2 F5 45          	MOV	MT1,A		;SAVE THE SIGN
 4506:      11E4 51 53          	ACALL	SETREG		;GET THE EXPONENT
 4507:      11E6 24 7F          	ADD	A,#7FH		;BIAS THE EXPONENT
 4508:      11E8 92 2A          	MOV	UBIT,C		;SAVE CARRY STATUS
 4509:      11EA 50 02          	JNC	AATAN1		;SEE IF > 1
 4510:      11EC 51 7C          	ACALL	RECIP		;IF > 1, TAKE RECIP
 4511:      11EE 90 11 2A       AATAN1: MOV	DPTR,#ATTAB	;SET UP TO CALCU
 4512:      11F1 31 9B          	ACALL	POLYC		;CALCULATE THE POLY
 4513:      11F3 30 2A 06       	JNB	UBIT,SIN0	;JUMP IF NOT SET
 4514:      11F6 71 A1          	ACALL	ANEG		;MAKE X POLY NEGATIVE
 4515:      11F8 31 92          	ACALL	POTWO		;SUBTRACT PI/2
 4516:      11FA F1 41          	ACALL	AADD
 4517:                          	;
 4518:      11FC E5 45          SIN0:	MOV	A,MT1		;GET THE SIGN
 4519:      11FE 60 19          	JZ	SRT
 4520:      1200 61 A1          	AJMP	ANEG
 4521:                          	;
 4522:                          	;**************************************
 4523:                          	;
 4524:                          	; FCOMP - COMPARE 0FFFFH TO TOS
 4525:                          	;
 4526:                          	;**************************************
 4527:                          	;
 4528:      1202 91 2C          FCMP:	ACALL	CSTAKA		;COPY THE STACK
 4529:      1204 71 CB          	ACALL	FSTK		;MAKE THE TOS = 0FFFFH
 4530:      1206 91 5A          	ACALL	SWAP_ASTKA	;NOW COMPARE IS 0FFFFH
 4531:                          	;
 4532:      1208 02 19 73       CMPLK:	JMP	FP_BASE2	;DO THE COMPARE
 4533:                          	;
 4534:                          	;**************************************
 4535:                          	;
 4536:                          DEC_ASTKA:	;Push ARG STACK and check for
 4537:                          	;
 4538:                          	;**************************************
 4539:                          	;
 4540:      120B 74 FA          	MOV	A,#-FPSIZ
 4541:      120D 25 09          	ADD	A,ASTKA
 4542:      120F B4 32 00       	CJNE	A,#LOW TM_TOP+6,DEC_ASTKA1
 4543:                          DEC_ASTKA1:
 4544:      1212 40 06          	JC	E4YY
 4545:      1214 F5 09          	MOV	ASTKA,A

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 83



 Line    I  Addr Code           Source

 4546:      1216 F9             	MOV	R1,A
 4547:      1217 7B 01          	MOV	R3,#ASTKAH
 4548:                          	;
 4549:      1219 22             SRT:	RET
 4550:                          	;
 4551:      121A 90 03 7B       E4YY:	MOV	DPTR,#EXA
 4552:      121D 01 4B          	AJMP	FPTS		;ARG STACK ERROR
 4553:                          	;
 4554:                          	;
 4555:      121F 91 33          AXTAL3: ACALL	PUSHC		;PUSH CONSTANT, THE
 4556:      1221 31 B0          	ACALL	AMUL
 4557:                          	;
 4558:                          	; Fall thru to IFIX
 4559:                          	;
 4560:                          	;**************************************
 4561:                          	;
 4562:                          IFIX:	; Convert a floating point number 
 4563:                          	;
 4564:                          	;**************************************
 4565:                          	;
 4566:      1223 E4             	CLR	A		;RESET THE START
 4567:      1224 FB             	MOV	R3,A
 4568:      1225 F9             	MOV	R1,A
 4569:      1226 A8 09          	MOV	R0,ASTKA	;GET THE ARG STACK
 4570:      1228 75 A0 01       	MOV	P2,#ASTKAH
 4571:      122B E2             	MOVX	A,@R0		;READ EXPONENT
 4572:      122C C3             	CLR	C
 4573:      122D 94 81          	SUBB	A,#81H		;BASE EXPONENT
 4574:      122F FC             	MOV	R4,A		;SAVE IT
 4575:      1230 18             	DEC	R0		;POINT AT SIGN
 4576:      1231 E2             	MOVX	A,@R0		;GET THE SIGN
 4577:      1232 70 56          	JNZ	SQ_ERR		;ERROR IF NEGATIVE
 4578:      1234 40 19          	JC	INC_ASTKA	;EXIT IF EXPONENT IS < 81H
 4579:      1236 0C             	INC	R4		;ADJUST LOOP COUNTER
 4580:      1237 E8             	MOV	A,R0		;BUMP THE POINTER REGISTER
 4581:      1238 94 05          	SUBB	A,#FPSIZ-1
 4582:      123A F8             	MOV	R0,A
 4583:                          	;
 4584:      123B 08             I2:	INC	R0		;POINT AT DIGIT
 4585:      123C E2             	MOVX	A,@R0		;GET DIGIT
 4586:      123D C4             	SWAP	A		;FLIP
 4587:      123E 12 19 83       	CALL	FP_BASE10	;ACCUMULATE
 4588:      1241 40 47          	JC	SQ_ERR
 4589:      1243 DC 02          	DJNZ	R4,I21
 4590:      1245 80 08          	SJMP	INC_ASTKA
 4591:      1247 E2             I21:	MOVX	A,@R0		;GET DIGIT
 4592:      1248 12 19 83       	CALL	FP_BASE10
 4593:      124B 40 3D          	JC	SQ_ERR
 4594:      124D DC EC          	DJNZ	R4,I2
 4595:                          	;
 4596:                          	;**************************************
 4597:                          	;
 4598:                          INC_ASTKA:	; Pop the ARG STACK and check
 4599:                          	;
 4600:                          	;**************************************
 4601:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 84



 Line    I  Addr Code           Source

 4602:      124F 74 06          	MOV	A,#FPSIZ	;NUMBER TO POP
 4603:      1251 80 01          	SJMP	SETREG1
 4604:                          	;
 4605:      1253 E4             SETREG: CLR	A		;DON'T POP ANYTHING
 4606:      1254 A8 09          SETREG1:MOV	R0,ASTKA
 4607:      1256 7A 01          	MOV	R2,#ASTKAH
 4608:      1258 8A A0          	MOV	P2,R2
 4609:      125A 28             	ADD	A,R0
 4610:      125B 40 BD          	JC	E4YY
 4611:      125D F5 09          	MOV	ASTKA,A
 4612:      125F E2             	MOVX	A,@R0
 4613:      1260 22             A_D:	RET
 4614:                          	;
 4615:                          	;**************************************
 4616:                          	;
 4617:                          	; EBIAS - Bias a number for E to the X 
 4618:                          	;
 4619:                          	;**************************************
 4620:                          	;
 4621:      1261 91 43          EBIAS:	ACALL	PUSH_ONE
 4622:      1263 31 B5          	ACALL	RV
 4623:      1265 BB 00 22       	CJNE	R3,#00H,SQ_ERR	;ERROR IF R3 <> 0
 4624:      1268 91 6C          	ACALL	C2_T2		;TEMP 2 GETS FRACTIONS
 4625:      126A 51 4F          	ACALL	INC_ASTKA
 4626:      126C 91 48          	ACALL	POP_T1
 4627:      126E 91 43          	ACALL	PUSH_ONE
 4628:                          	;
 4629:      1270 E5 46          AELP:	MOV	A,MT2
 4630:      1272 70 0E          	JNZ	AEL1
 4631:                          	;
 4632:      1274 E5 45          	MOV	A,MT1
 4633:      1276 60 E8          	JZ	A_D
 4634:      1278 90 01 1E       	MOV	DPTR,#FPT2-1
 4635:      127B F0             	MOVX	@DPTR,A 	;MAKE THE FRACTIONS NEGAT
 4636:                          	;
 4637:      127C 91 43          RECIP:	ACALL	PUSH_ONE
 4638:      127E 91 5A          	ACALL	SWAP_ASTKA
 4639:      1280 81 0A          	AJMP	ADIV
 4640:                          	;
 4641:      1282 15 46          AEL1:	DEC	MT2
 4642:      1284 91 4F          	ACALL	PUSH_T1
 4643:      1286 31 B0          	ACALL	AMUL
 4644:      1288 80 E6          	SJMP	AELP
 4645:                          	;
 4646:      128A 02 09 BD       SQ_ERR: LJMP	E3XX		;LINK TO BAD ARG
 4647:                          	;
 4648:                          	;**************************************
 4649:                          	;
 4650:                          	; SQUARE ROOT
 4651:                          	;
 4652:                          	;**************************************
 4653:                          	;
 4654:      128D 71 8F          ASQR:	ACALL	AABS		;GET THE SIGN
 4655:      128F 70 F9          	JNZ	SQ_ERR		;ERROR IF NEGATIVE
 4656:      1291 91 6C          	ACALL	C2_T2		;COPY VARIABLE TO T2
 4657:      1293 91 48          	ACALL	POP_T1		;SAVE IT IN T1

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 85



 Line    I  Addr Code           Source

 4658:      1295 78 19          	MOV	R0,#LOW FPT1
 4659:      1297 E2             	MOVX	A,@R0		;GET EXPONENT
 4660:      1298 60 24          	JZ	SQR41		;EXIT IF ZERO
 4661:      129A 24 80          	ADD	A,#128		;BIAS THE EXPONENT
 4662:      129C 50 05          	JNC	SQR1		;SEE IF < 80H
 4663:      129E 03             	RR	A
 4664:      129F 54 7F          	ANL	A,#127
 4665:      12A1 80 07          	SJMP	SQR2
 4666:                          	;
 4667:      12A3 F4             SQR1:	CPL	A		;FLIP BITS
 4668:      12A4 04             	INC	A
 4669:      12A5 03             	RR	A
 4670:      12A6 54 7F          	ANL	A,#127		;STRIP MSB
 4671:      12A8 F4             	CPL	A
 4672:      12A9 04             	INC	A
 4673:                          	;
 4674:      12AA 24 80          SQR2:	ADD	A,#128		;BIAS EXPONENT
 4675:      12AC F2             	MOVX	@R0,A		;SAVE IT
 4676:                          	;
 4677:                          	; NEWGUESS = ( X/OLDGUESS + OLDGUESS) /
 4678:                          	;
 4679:      12AD 91 56          SQR4:	ACALL	P_T2		;TOS = X
 4680:      12AF 91 4F          	ACALL	PUSH_T1 	;PUT NUMBER ON STACK
 4681:      12B1 91 0A          	ACALL	ADIV		;TOS = X/GUESS
 4682:      12B3 91 4F          	ACALL	PUSH_T1 	;PUT ON AGAIN
 4683:      12B5 F1 41          	ACALL	AADD		;TOS = X/GUESS + GUESS
 4684:      12B7 31 94          	ACALL	DBTWO		;TOS = ( X/GUESS + GUESS )
 4685:      12B9 71 1C          	ACALL	TEMP_COMP	;SEE IF DONE
 4686:      12BB 30 D5 EF       	JNB	F0,SQR4
 4687:                          	;
 4688:      12BE 81 4F          SQR41:	AJMP	PUSH_T1 	;PUT THE ANSWER ON 
 4689:                          	;
 4690:                          	;**************************************
 4691:                          	;
 4692:                          	; NATURAL LOG
 4693:                          	;
 4694:                          	;**************************************
 4695:                          	;
 4696:      12C0 71 8F          ALN:	ACALL	AABS		;MAKE SURE THAT NUM IS 
 4697:      12C2 70 C6          	JNZ	SQ_ERR		;ERROR IF NOT
 4698:      12C4 F5 46          	MOV	MT2,A		;CLEAR FOR LOOP
 4699:      12C6 08             	INC	R0		;POINT AT EXPONENT
 4700:      12C7 E2             	MOVX	A,@R0		;READ THE EXPONENT
 4701:      12C8 60 C0          	JZ	SQ_ERR		;ERROR IF EXPONENT IS ZERO
 4702:      12CA B4 81 00       	CJNE	A,#81H,ALN1	;SEE IF NUM >= 1
 4703:      12CD 92 2A          ALN1:	MOV	UBIT,C		;SAVE CARRY STATUS
 4704:      12CF 40 02          	JC	ALNL		;TAKE RECIP IF >= 1
 4705:      12D1 51 7C          	ACALL	RECIP
 4706:                          	;
 4707:                          	; Loop to reduce
 4708:                          	;
 4709:      12D3 91 2C          ALNL:	ACALL	CSTAKA		;COPY THE STACK FOR 
 4710:      12D5 91 43          	ACALL	PUSH_ONE	;COMPARE NUM TO ONE
 4711:      12D7 51 08          	ACALL	CMPLK
 4712:      12D9 50 1D          	JNC	ALNO		;EXIT IF DONE
 4713:      12DB 51 53          	ACALL	SETREG		;GET THE EXPONENT

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 86



 Line    I  Addr Code           Source

 4714:      12DD 24 85          	ADD	A,#85H		;SEE HOW BIG IT IS
 4715:      12DF 50 0E          	JNC	ALN11		;BUMP BY EXP(11) IF TOO SMAL
 4716:      12E1 91 30          	ACALL	PLNEXP		;PUT EXP(1) ON STACK
 4717:      12E3 74 01          	MOV	A,#1		;BUMP COUNT
 4718:                          	;
 4719:      12E5 25 46          ALNE:	ADD	A,MT2
 4720:      12E7 40 A1          	JC	SQ_ERR
 4721:      12E9 F5 46          	MOV	MT2,A
 4722:      12EB 31 B0          	ACALL	AMUL		;BIAS THE NUMBER
 4723:      12ED 80 E4          	SJMP	ALNL
 4724:                          	;
 4725:      12EF 90 17 F2       ALN11:	MOV	DPTR,#EXP11	;PUT EXP(11) ON S
 4726:      12F2 91 33          	ACALL	PUSHC
 4727:      12F4 74 0B          	MOV	A,#11
 4728:      12F6 80 ED          	SJMP	ALNE
 4729:                          	;
 4730:      12F8 91 6C          ALNO:	ACALL	C2_T2		;PUT NUM IN TEMP 2
 4731:      12FA 91 43          	ACALL	PUSH_ONE	;TOS = 1
 4732:      12FC F1 1C          	ACALL	ASUB		;TOS = X - 1
 4733:      12FE 91 56          	ACALL	P_T2		;TOS = X
 4734:      1300 91 43          	ACALL	PUSH_ONE	;TOS = 1
 4735:      1302 F1 41          	ACALL	AADD		;TOS = X + 1
 4736:      1304 91 0A          	ACALL	ADIV		;TOS = (X-1)/(X+1)
 4737:      1306 90 16 A9       	MOV	DPTR,#LNTAB	;LOG TABLE
 4738:      1309 31 9B          	ACALL	POLYC
 4739:      130B A3             	INC	DPTR		;POINT AT LN(10)
 4740:      130C 91 33          	ACALL	PUSHC
 4741:      130E 31 B0          	ACALL	AMUL
 4742:      1310 E5 46          	MOV	A,MT2		;GET THE COUNT
 4743:      1312 91 B1          	ACALL	TWO_R2		;PUT IT ON THE STACK
 4744:      1314 F1 1C          	ACALL	ASUB		;INT - POLY
 4745:      1316 31 DA          	ACALL	STRIP
 4746:      1318 30 2A 74       	JNB	UBIT,AABS
 4747:                          	;
 4748:      131B 22             LN_D:	RET
 4749:                          	;
 4750:                          	;**************************************
 4751:                          	;
 4752:                          TEMP_COMP:	; Compare FPTEMP1 to TOS, FPT
 4753:                          	;
 4754:                          	;**************************************
 4755:                          	;
 4756:      131C 91 4F          	ACALL	PUSH_T1 	;SAVE THE TEMP
 4757:      131E 91 5A          	ACALL	SWAP_ASTKA	;TRADE WITH THE NEXT N
 4758:      1320 91 2C          	ACALL	CSTAKA		;COPY THE STACK
 4759:      1322 91 48          	ACALL	POP_T1		;SAVE THE NEW NUMBER
 4760:      1324 02 19 73       	JMP	FP_BASE2	;DO THE COMPARE
 4761:                          	;
 4762:      1327 91 30          AETOX:	ACALL	PLNEXP		;EXP(1) ON TOS
 4763:      1329 91 5A          	ACALL	SWAP_ASTKA	;X ON TOS
 4764:                          	;
 4765:                          AEXP:	;EXPONENTIATION
 4766:                          	;
 4767:      132B 51 61          	ACALL	EBIAS		;T1=BASE,T2=FRACTIONS,TOS=
 4768:      132D 90 01 1F       	MOV	DPTR,#FPT2	;POINT AT FRACTIONS
 4769:      1330 E0             	MOVX	A,@DPTR 	;READ THE EXP OF THE FRAC

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 87



 Line    I  Addr Code           Source

 4770:      1331 60 E8          	JZ	LN_D		;EXIT IF ZERO
 4771:      1333 91 56          	ACALL	P_T2		;TOS = FRACTIONS
 4772:      1335 91 4F          	ACALL	PUSH_T1 	;TOS = BASE
 4773:      1337 51 53          	ACALL	SETREG		;SEE IF BASE IS ZERO
 4774:      1339 60 02          	JZ	AEXP1
 4775:      133B 51 C0          	ACALL	ALN		;TOS = LN(BASE)
 4776:      133D 31 B0          AEXP1:	ACALL	AMUL		;TOS = FRACTIONS * LN
 4777:      133F 91 30          	ACALL	PLNEXP		;TOS = EXP(1)
 4778:      1341 91 5A          	ACALL	SWAP_ASTKA	;TOS = FRACTIONS * LN(
 4779:      1343 51 61          	ACALL	EBIAS		;T2 = FRACTIONS, TOS = INT
 4780:      1345 75 46 00       	MOV	MT2,#00H	;NOW CALCULATE E**X
 4781:      1348 91 43          	ACALL	PUSH_ONE
 4782:      134A 91 2C          	ACALL	CSTAKA
 4783:      134C 91 48          	ACALL	POP_T1		;T1 = 1
 4784:                          	;
 4785:      134E 91 56          AEXL:	ACALL	P_T2		;TOS = FRACTIONS
 4786:      1350 31 B0          	ACALL	AMUL		;TOS = FRACTIONS * ACCUMLAT
 4787:      1352 05 46          	INC	MT2		;DO THE DEMONIATOR
 4788:      1354 E5 46          	MOV	A,MT2
 4789:      1356 91 B1          	ACALL	TWO_R2
 4790:      1358 91 0A          	ACALL	ADIV
 4791:      135A 91 2C          	ACALL	CSTAKA		;SAVE THE ITERATION
 4792:      135C 91 4F          	ACALL	PUSH_T1 	;NOW ACCUMLATE
 4793:      135E F1 41          	ACALL	AADD		;ADD ACCUMLATION
 4794:      1360 71 1C          	ACALL	TEMP_COMP
 4795:      1362 30 D5 E9       	JNB	F0,AEXL 	;LOOP UNTIL DONE
 4796:                          	;
 4797:      1365 51 4F          	ACALL	INC_ASTKA
 4798:      1367 91 4F          	ACALL	PUSH_T1
 4799:      1369 31 B0          	ACALL	AMUL		;LAST INT MULTIPLIED
 4800:                          	;
 4801:      136B 21 B0          MU1:	AJMP	AMUL		;FIRST INT MULTIPLIED
 4802:                          	;
 4803:                          	;**************************************
 4804:                          	;
 4805:                          	; integer operator - INT
 4806:                          	;
 4807:                          	;**************************************
 4808:                          	;
 4809:      136D 51 53          AINT:	ACALL	SETREG		;SET UP THE REGISTER
 4810:      136F 94 81          	SUBB	A,#129		;SUBTRACT EXPONENT BIAS
 4811:      1371 50 07          	JNC	AI1		;JUMP IF ACC > 81H
 4812:                          	;
 4813:                          	; Force the number to be a zero
 4814:                          	;
 4815:      1373 51 4F          	ACALL	INC_ASTKA	;BUMP THE STACK
 4816:                          	;
 4817:      1375 90 04 E0       P_Z:	MOV	DPTR,#ZRO	;PUT ZERO ON THE STAC
 4818:      1378 81 33          	AJMP	PUSHC
 4819:                          	;
 4820:      137A 94 07          AI1:	SUBB	A,#7
 4821:      137C 50 10          	JNC	AI3
 4822:      137E F4             	CPL	A
 4823:      137F 04             	INC	A
 4824:      1380 FB             	MOV	R3,A
 4825:      1381 18             AI11:	DEC	R0		;POINT AT SIGN

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 88



 Line    I  Addr Code           Source

 4826:                          	;
 4827:      1382 18             AI2:	DEC	R0		;NOW AT LSB'S
 4828:      1383 E2             	MOVX	A,@R0		;READ BYTE
 4829:      1384 54 F0          	ANL	A,#0F0H 	;STRIP NIBBLE
 4830:      1386 F2             	MOVX	@R0,A		;WRITE BYTE
 4831:      1387 DB 01          	DJNZ	R3,AI21
 4832:      1389 22             	RET
 4833:      138A E4             AI21:	CLR	A
 4834:      138B F2             	MOVX	@R0,A		;CLEAR THE LOCATION
 4835:      138C DB F4          	DJNZ	R3,AI2
 4836:                          	;
 4837:      138E 22             AI3:	RET			;EXIT
 4838:                          	;
 4839:                          	;**************************************
 4840:                          	;
 4841:                          AABS:	; Absolute value - Make sign of nu
 4842:                          	;		   return sign in ACC
 4843:                          	;
 4844:                          	;**************************************
 4845:                          	;
 4846:      138F 71 A1          	ACALL	ANEG		;CHECK TO SEE IF + OR -
 4847:      1391 70 19          	JNZ	ALPAR		;EXIT IF NON ZERO, BECAUSE T
 4848:      1393 F2             	MOVX	@R0,A		;MAKE A POSITIVE SIGN
 4849:      1394 22             	RET
 4850:                          	;
 4851:                          	;**************************************
 4852:                          	;
 4853:                          ASGN:	; Returns the sign of the number 1
 4854:                          	;
 4855:                          	;**************************************
 4856:                          	;
 4857:      1395 51 4F          	ACALL	INC_ASTKA	;POP STACK, GET EXPONEN
 4858:      1397 60 DC          	JZ	P_Z		;EXIT IF ZERO
 4859:      1399 18             	DEC	R0		;BUMP TO SIGN
 4860:      139A E2             	MOVX	A,@R0		;GET THE SIGN
 4861:      139B FF             	MOV	R7,A		;SAVE THE SIGN
 4862:      139C 91 43          	ACALL	PUSH_ONE	;PUT A ONE ON THE STACK
 4863:      139E EF             	MOV	A,R7		;GET THE SIGN
 4864:      139F 60 0B          	JZ	ALPAR		;EXIT IF ZERO
 4865:                          	;
 4866:                          	; Fall thru to ANEG
 4867:                          	;
 4868:                          	;**************************************
 4869:                          	;
 4870:                          ANEG:	; Flip the sign of the number on t
 4871:                          	;
 4872:                          	;**************************************
 4873:                          	;
 4874:      13A1 51 53          	ACALL	SETREG
 4875:      13A3 18             	DEC	R0		;POINT AT THE SIGN OF THE NUMBE
 4876:      13A4 60 06          	JZ	ALPAR		;EXIT IF ZERO
 4877:      13A6 E2             	MOVX	A,@R0
 4878:      13A7 64 01          	XRL	A,#01H		;FLIP THE SIGN
 4879:      13A9 F2             	MOVX	@R0,A
 4880:      13AA 64 01          	XRL	A,#01H		;RESTORE THE SIGN
 4881:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 89



 Line    I  Addr Code           Source

 4882:      13AC 22             ALPAR:	RET
 4883:                          	;
 4884:                          	;**************************************
 4885:                          	;
 4886:                          ACBYTE: ; Read the ROM
 4887:                          	;
 4888:                          	;**************************************
 4889:                          	;
 4890:      13AD 51 23          	ACALL	IFIX		;GET EXPRESSION
 4891:      13AF 12 05 79       	CALL	X31DP		;PUT R3:R1 INTO THE DP
 4892:      13B2 E4             	CLR	A
 4893:      13B3 93             	MOVC	A,@A+DPTR
 4894:      13B4 81 B1          	AJMP	TWO_R2
 4895:                          	;
 4896:                          	;**************************************
 4897:                          	;
 4898:                          ADBYTE: ; Read internal memory
 4899:                          	;
 4900:                          	;**************************************
 4901:                          	;
 4902:      13B6 51 23          	ACALL	IFIX		;GET THE EXPRESSION
 4903:      13B8 12 09 D5       	CALL	R3CK		;MAKE SURE R3 = 0
 4904:      13BB E7             	MOV	A,@R1
 4905:      13BC 81 B1          	AJMP	TWO_R2
 4906:                          	;
 4907:                          	;**************************************
 4908:                          	;
 4909:                          AXBYTE: ; Read external memory
 4910:                          	;
 4911:                          	;**************************************
 4912:                          	;
 4913:      13BE 51 23          	ACALL	IFIX		;GET THE EXPRESSION
 4914:      13C0 8B A0          AXBYTE1:MOV	P2,R3
 4915:      13C2 E3             	MOVX	A,@R1
 4916:      13C3 81 B1          	AJMP	TWO_R2
 4917:                          	;
 4918:                          	;**************************************
 4919:                          	;
 4920:                          	; The relational operators - EQUAL			  
 4921:                          	;			     GREATER THAN		  (>)
 4922:                          	;			     LESS THAN			  (<)
 4923:                          	;			     GREATER THAN OR EQUAL	  (>=)
 4924:                          	;			     LESS THAN OR EQUAL 	  (<=)
 4925:                          	;			     NOT EQUAL			  (<>)
 4926:                          	;
 4927:                          	;**************************************
 4928:                          	;
 4929:      13C5 51 08          AGT:	ACALL	CMPLK
 4930:      13C7 72 D5          	ORL	C,F0		;SEE IF EITHER IS A ONE
 4931:      13C9 40 AA          AGT1:	JC	P_Z
 4932:                          	;
 4933:      13CB 90 13 D0       FSTK:	MOV	DPTR,#FS
 4934:      13CE 81 33          	AJMP	PUSHC
 4935:                          	;
 4936:      13D0 85             FS:	DB	85H
 4937:      13D1 00             	DB	00H

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 90



 Line    I  Addr Code           Source

 4938:      13D2 00             	DB	00H
 4939:      13D3 50             	DB	50H
 4940:      13D4 53             	DB	53H
 4941:      13D5 65             	DB	65H
 4942:                          	;
 4943:      13D6 51 08          ALT:	ACALL	CMPLK
 4944:      13D8 B3             ALT1:	CPL	C
 4945:      13D9 80 EE          	SJMP	AGT1
 4946:                          	;
 4947:      13DB 51 08          AEQ:	ACALL	CMPLK
 4948:      13DD A2 D5          AEQ1:	MOV	C,F0
 4949:      13DF 80 F7          	SJMP	ALT1
 4950:                          	;
 4951:      13E1 51 08          ANE:	ACALL	CMPLK
 4952:      13E3 B2 D5          	CPL	F0
 4953:      13E5 80 F6          	SJMP	AEQ1
 4954:                          	;
 4955:      13E7 51 08          AGE:	ACALL	CMPLK
 4956:      13E9 80 DE          	SJMP	AGT1
 4957:                          	;
 4958:      13EB 51 08          ALE:	ACALL	CMPLK
 4959:      13ED 72 D5          	ORL	C,F0
 4960:      13EF 80 E7          	SJMP	ALT1
 4961:                          	;
 4962:                          	;**************************************
 4963:                          	;
 4964:                          ARND:	; Generate a random number
 4965:                          	;
 4966:                          	;**************************************
 4967:                          	;
 4968:      13F1 90 01 0C       	MOV	DPTR,#RCELL	;GET THE BINARY SEED
 4969:      13F4 12 05 BA       	CALL	L31DPI
 4970:      13F7 E9             	MOV	A,R1
 4971:      13F8 C3             	CLR	C
 4972:      13F9 13             	RRC	A
 4973:      13FA F8             	MOV	R0,A
 4974:      13FB 74 06          	MOV	A,#6
 4975:      13FD 13             	RRC	A
 4976:      13FE 29             	ADD	A,R1
 4977:      13FF C8             	XCH	A,R0
 4978:      1400 3B             	ADDC	A,R3
 4979:      1401 FA             	MOV	R2,A
 4980:      1402 15 82          	DEC	DPL		;SAVE THE NEW SEED
 4981:      1404 91 24          	ACALL	S20DP
 4982:      1406 91 B4          	ACALL	TWO_EY
 4983:      1408 71 CB          	ACALL	FSTK
 4984:                          	;
 4985:      140A 12 19 77       ADIV:	LCALL	FP_BASE4
 4986:      140D 01 38          	AJMP	FPTST
 4987:                          	;
 4988:                          	;**************************************
 4989:                          	;
 4990:                          SONERR: ; ON ERROR Statement
 4991:                          	;
 4992:                          	;**************************************
 4993:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 91



 Line    I  Addr Code           Source

 4994:      140F 12 0F 30       	LCALL	INTERR		;GET THE LINE NUMBER
 4995:      1412 D2 13          	SETB	ON_ERR
 4996:      1414 90 01 02       	MOV	DPTR,#ERRNUM	;POINT AT THR ERROR LO
 4997:      1417 80 0B          	SJMP	S20DP
 4998:                          	;
 4999:                          	;
 5000:                          	;**************************************
 5001:                          	;
 5002:                          SONEXT: ; ON EXT1 Statement
 5003:                          	;
 5004:                          	;**************************************
 5005:                          	;
 5006:      1419 12 0F 30       	LCALL	INTERR
 5007:      141C D2 12          	SETB	INTBIT
 5008:      141E 43 A8 84       	ORL	IE,#10000100B	;ENABLE INTERRUPTS
 5009:      1421 90 01 20       	MOV	DPTR,#INTLOC
 5010:                          	;
 5011:      1424 EA             S20DP:	MOV	A,R2		;SAVE R2:R0 @DPTR
 5012:      1425 F0             	MOVX	@DPTR,A
 5013:      1426 A3             	INC	DPTR
 5014:      1427 E8             	MOV	A,R0
 5015:      1428 F0             	MOVX	@DPTR,A
 5016:      1429 22             	RET
 5017:                          	;
 5018:                          	;**************************************
 5019:                          	;
 5020:                          	; CASTAK - Copy and push another top of
 5021:                          	;
 5022:                          	;**************************************
 5023:                          	;
 5024:      142A 91 2C          CSTAKA2:ACALL	CSTAKA		;COPY STACK TWICE
 5025:                          	;
 5026:      142C 51 53          CSTAKA: ACALL	SETREG		;SET UP R2:R0
 5027:      142E 80 23          	SJMP	PUSH_T12
 5028:                          	;
 5029:      1430 90 17 F8       PLNEXP: MOV	DPTR,#EXP1
 5030:                          	;
 5031:                          	;**************************************
 5032:                          	;
 5033:                          	; PUSHC - Push constant on to the arg s
 5034:                          	;
 5035:                          	;**************************************
 5036:                          	;
 5037:      1433 51 0B          PUSHC:	ACALL	DEC_ASTKA
 5038:      1435 8B A0          	MOV	P2,R3
 5039:      1437 7B 06          	MOV	R3,#FPSIZ	;LOOP COUNTER
 5040:                          	;
 5041:      1439 E4             PCL:	CLR	A		;SET UP A
 5042:      143A 93             	MOVC	A,@A+DPTR	;LOAD IT
 5043:      143B F3             	MOVX	@R1,A		;SAVE IT
 5044:      143C A3             	INC	DPTR		;BUMP POINTERS
 5045:      143D 19             	DEC	R1
 5046:      143E DB F9          	DJNZ	R3,PCL		;LOOP
 5047:                          	;
 5048:      1440 D2 24          	SETB	ARGF
 5049:      1442 22             	RET			;EXIT

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 92



 Line    I  Addr Code           Source

 5050:                          	;
 5051:                          PUSH_ONE:;
 5052:                          	;
 5053:      1443 90 16 F2       	MOV	DPTR,#FPONE
 5054:      1446 81 33          	AJMP	PUSHC
 5055:                          	;
 5056:                          POP_T1:
 5057:                          	;
 5058:      1448 7B 01          	MOV	R3,#HIGH FPT1
 5059:      144A 79 19          	MOV	R1,#LOW FPT1
 5060:      144C 02 0F D3       	JMP	POPAS
 5061:                          	;
 5062:                          PUSH_T1:
 5063:                          	;
 5064:      144F 78 19          	MOV	R0,#LOW FPT1
 5065:                          PUSH_T11:
 5066:      1451 7A 01          	MOV	R2,#HIGH FPT1
 5067:                          PUSH_T12:
 5068:      1453 02 0F DD       	LJMP	PUSHAS
 5069:                          	;
 5070:      1456 78 1F          P_T2:	MOV	R0,#LOW FPT2
 5071:      1458 80 F7          	SJMP	PUSH_T11		;JUMP TO PUSHAS
 5072:                          	;
 5073:                          	;**************************************
 5074:                          	;
 5075:                          SWAP_ASTKA:	; SWAP TOS<>TOS-1
 5076:                          	;
 5077:                          	;**************************************
 5078:                          	;
 5079:      145A 51 53          	ACALL	SETREG		;SET UP R2:R0 AND P2
 5080:      145C 74 06          	MOV	A,#FPSIZ	;PUT TOS+1 IN R1
 5081:      145E FA             	MOV	R2,A
 5082:      145F 28             	ADD	A,R0
 5083:      1460 F9             	MOV	R1,A
 5084:                          	;
 5085:      1461 E2             S_L:	MOVX	A,@R0
 5086:      1462 FB             	MOV	R3,A
 5087:      1463 E3             	MOVX	A,@R1
 5088:      1464 F2             	MOVX	@R0,A
 5089:      1465 EB             	MOV	A,R3
 5090:      1466 F3             	MOVX	@R1,A
 5091:      1467 19             	DEC	R1
 5092:      1468 18             	DEC	R0
 5093:      1469 DA F6          	DJNZ	R2,S_L
 5094:      146B 22             	RET
 5095:                          	;
 5096:      146C 51 53          C2_T2:	ACALL	SETREG		;SET UP R2:R0
 5097:      146E 7B 01          	MOV	R3,#HIGH FPT2
 5098:      1470 79 1F          	MOV	R1,#LOW FPT2	;TEMP VALUE
 5099:                          	;
 5100:                          	; Fall thru
 5101:                          	;
 5102:                          	;**************************************
 5103:                          	;
 5104:                          	; VARCOP - Copy a variable from R2:R0 t
 5105:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 93



 Line    I  Addr Code           Source

 5106:                          	;**************************************
 5107:                          	;
 5108:      1472 7C 06          VARCOP: MOV	R4,#FPSIZ	;LOAD THE LOOP COU
 5109:                          	;
 5110:      1474 8A A0          V_C:	MOV	P2,R2		;SET UP THE PORTS
 5111:      1476 E2             	MOVX	A,@R0		;READ THE VALUE
 5112:      1477 8B A0          	MOV	P2,R3		;PORT TIME AGAIN
 5113:      1479 F3             	MOVX	@R1,A		;SAVE IT
 5114:      147A B1 8B          	ACALL	DEC3210 	;BUMP POINTERS
 5115:      147C DC F6          	DJNZ	R4,V_C		;LOOP
 5116:      147E 22             	RET			;EXIT
 5117:                          	;
 5118:      147F 90 17 FE       PIPI:	MOV	DPTR,#PIE
 5119:      1482 81 33          	AJMP	PUSHC
 5120:                          	;
 5121:                          	;**************************************
 5122:                          	;
 5123:                          	; The logical operators ANL, ORL, XRL, 
 5124:                          	;
 5125:                          	;**************************************
 5126:                          	;
 5127:      1484 91 A1          AANL:	ACALL	TWOL		;GET THE EXPRESSIONS
 5128:      1486 EB             	MOV	A,R3		;DO THE AND
 5129:      1487 5F             	ANL	A,R7
 5130:      1488 FA             	MOV	R2,A
 5131:      1489 E9             	MOV	A,R1
 5132:      148A 5E             	ANL	A,R6
 5133:      148B 80 26          	SJMP	TWO_EX
 5134:                          	;
 5135:      148D 91 A1          AORL:	ACALL	TWOL		;SAME THING FOR OR
 5136:      148F EB             	MOV	A,R3
 5137:      1490 4F             	ORL	A,R7
 5138:      1491 FA             	MOV	R2,A
 5139:      1492 E9             	MOV	A,R1
 5140:      1493 4E             	ORL	A,R6
 5141:      1494 80 1D          	SJMP	TWO_EX
 5142:                          	;
 5143:      1496 71 CB          ANOT:	ACALL	FSTK		;PUT 0FFFFH ON THE STA
 5144:                          	;
 5145:      1498 91 A1          AXRL:	ACALL	TWOL
 5146:      149A EB             	MOV	A,R3
 5147:      149B 6F             	XRL	A,R7
 5148:      149C FA             	MOV	R2,A
 5149:      149D E9             	MOV	A,R1
 5150:      149E 6E             	XRL	A,R6
 5151:      149F 80 12          	SJMP	TWO_EX
 5152:                          	;
 5153:      14A1 51 23          TWOL:	ACALL	IFIX
 5154:      14A3 AF 03          	MOV	R7,R3B0
 5155:      14A5 AE 01          	MOV	R6,R1B0
 5156:      14A7 41 23          	AJMP	IFIX
 5157:                          	;
 5158:                          	;**************************************
 5159:                          	;
 5160:                          AGET:	; READ THE BREAK BYTE AND PUT IT O
 5161:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 94



 Line    I  Addr Code           Source

 5162:                          	;**************************************
 5163:                          	;
 5164:      14A9 90 01 00       	MOV	DPTR,#GTB	;GET THE BREAK BYTE
 5165:      14AC E0             	MOVX	A,@DPTR
 5166:      14AD 10 18 01       	JBC	GTRD,TWO_R2
 5167:      14B0 E4             	CLR	A
 5168:                          	;
 5169:      14B1 7A 00          TWO_R2: MOV	R2,#00H 	;ACC GOES TO STACK
 5170:                          	;
 5171:                          	;
 5172:      14B3 F8             TWO_EX: MOV	R0,A		;R2:ACC GOES TO STACK
 5173:                          	;
 5174:                          	;
 5175:      14B4 D2 24          TWO_EY: SETB	ARGF		;R2:R0 GETS PUT ON TH
 5176:      14B6 02 19 87       	JMP	FP_BASE12	;DO IT
 5177:                          	;
 5178:                          	;**************************************
 5179:                          	;
 5180:                          	; Put directs onto the stack
 5181:                          	;
 5182:                          	;**************************************
 5183:                          	;
 5184:      14B9 E5 A8          A_IE:	MOV	A,IE		;IE
 5185:      14BB 80 F4          	SJMP	TWO_R2
 5186:                          	;
 5187:      14BD E5 B8          A_IP:	MOV	A,IP		;IP
 5188:      14BF 80 F0          	SJMP	TWO_R2
 5189:                          	;
 5190:      14C1 AA 8C          ATIM0:	MOV	R2,TH0		;TIMER 0
 5191:      14C3 A8 8A          	MOV	R0,TL0
 5192:      14C5 80 ED          	SJMP	TWO_EY
 5193:                          	;
 5194:      14C7 AA 8D          ATIM1:	MOV	R2,TH1		;TIMER 1
 5195:      14C9 A8 8B          	MOV	R0,TL1
 5196:      14CB 80 E7          	SJMP	TWO_EY
 5197:                          	;
 5198:      14CD AA CD          ATIM2:	MOV	R2,TH2
 5199:      14CF A8 CC          	MOV	R0,TL2
 5200:                          ;	DB	0AAH		;MOV R2 DIRECT OP CODE
 5201:                          ;	DB	0CDH		;T2 HIGH
 5202:                          ;	DB	0A8H		;MOV R0 DIRECT OP CODE
 5203:                          ;	DB	0CCH		;T2 LOW
 5204:      14D1 80 E1          	SJMP	TWO_EY		;TIMER 2
 5205:                          	;
 5206:      14D3 E5 C8          AT2CON: MOV	A,T2CON
 5207:                          ;	DB	0E5H		;MOV A,DIRECT OPCODE
 5208:                          ;	DB	0C8H		;T2CON LOCATION
 5209:      14D5 80 DA          	SJMP	TWO_R2
 5210:                          	;
 5211:      14D7 E5 88          ATCON:	MOV	A,TCON		;TCON
 5212:      14D9 80 D6          	SJMP	TWO_R2
 5213:                          	;
 5214:      14DB E5 89          ATMOD:	MOV	A,TMOD		;TMOD
 5215:      14DD 80 D2          	SJMP	TWO_R2
 5216:                          	;
 5217:      14DF AA CB          ARCAP2: MOV	R2,RCAPH2

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 95



 Line    I  Addr Code           Source

 5218:      14E1 A8 CA          	MOV	R0,RCAPL2
 5219:                          ;	DB	0AAH		;MOV R2, DIRECT OP CODE
 5220:                          ;	DB	0CBH		;RCAP2H LOCATION
 5221:                          ;	DB	0A8H		;MOV R0, DIRECT OP CODE
 5222:                          ;	DB	0CAH		;R2CAPL LOCATION
 5223:      14E3 80 CF          	SJMP	TWO_EY
 5224:                          	;
 5225:      14E5 E5 90          AP1:	MOV	A,P1		;GET P1
 5226:      14E7 80 C8          	SJMP	TWO_R2		;PUT IT ON THE STACK
 5227:                          	;
 5228:      14E9 E5 87          APCON:	MOV	A,PCON
 5229:                          ;	DB	0E5H		;MOV A, DIRECT OP CODE
 5230:                          ;	DB	87H		;ADDRESS OF PCON
 5231:      14EB 80 C4          	SJMP	TWO_R2		;PUT PCON ON THE STACK
 5232:                          	;
 5233:                          	;**************************************
 5234:                          	;
 5235:                          	;THIS IS THE LINE EDITOR
 5236:                          	;
 5237:                          	;TAKE THE PROCESSED LINE IN IBUF AND IN
 5238:                          	;BASIC TEXT FILE.
 5239:                          	;
 5240:                          	;**************************************
 5241:                          	;
 5242:      14ED 02 05 6E       LINE0:	LJMP	NOGO		;CAN'T EDIT A ROM
 5243:                          	;
 5244:      14F0 E5 13          LINE:	MOV	A,BOFAH
 5245:      14F2 B4 02 F8       	CJNE	A,#HIGH PSTART,LINE0
 5246:      14F5 12 05 A9       	CALL	G4		;GET END ADDRESS FOR EDITING
 5247:      14F8 AC 82          	MOV	R4,DPL
 5248:      14FA AD 83          	MOV	R5,DPH
 5249:      14FC AB 0F          	MOV	R3,TEMP5	;GET HIGH ORDER IBLN
 5250:      14FE A9 0E          	MOV	R1,TEMP4	;LOW ORDER IBLN
 5251:                          	;
 5252:      1500 12 05 8C       	CALL	GETLIN		;FIND THE LINE
 5253:      1503 70 12          	JNZ	INSR		;INSERT IF NOT ZERO, ELSE APP
 5254:                          	;
 5255:                          	;APPEND THE LINE AT THE END
 5256:                          	;
 5257:      1505 E5 0D          	MOV	A,TEMP3 	;PUT IBCNT IN THE ACC
 5258:      1507 B4 04 01       	CJNE	A,#4H,LINE1	;SEE IF NO ENTRY
 5259:      150A 22             	RET			;RET IF NO ENTRY
 5260:                          	;
 5261:      150B B1 A8          LINE1:	ACALL	FULL		;SEE IF ENOUGH SPACE 
 5262:      150D AA 05          	MOV	R2,R5B0 	;PUT END ADDRESS A INTO TR
 5263:      150F A8 04          	MOV	R0,R4B0 	;REGISTERS
 5264:      1511 B1 66          	ACALL	IMOV		;DO THE BLOCK MOVE
 5265:                          	;
 5266:      1513 74 01          UE:	MOV	A,#EOF		;SAVE EOF CHARACTER
 5267:      1515 A1 99          	AJMP	TBR
 5268:                          	;
 5269:                          	;INSERT A LINE INTO THE FILE
 5270:                          	;
 5271:      1517 FF             INSR:	MOV	R7,A		;SAVE IT IN R7
 5272:      1518 12 18 54       	CALL	TEMPD		;SAVE INSERATION ADDRESS
 5273:      151B E5 0D          	MOV	A,TEMP3 	;PUT THE COUNT LENGTH IN T

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 96



 Line    I  Addr Code           Source

 5274:      151D 40 09          	JC	LTX		;JUMP IF NEW LINE # NOT = OLD L
 5275:      151F B4 04 01       	CJNE	A,#04H,INSR1	;SEE IF NULL
 5276:      1522 E4             	CLR	A
 5277:                          	;
 5278:      1523 9F             INSR1:	SUBB	A,R7		;SUBTRACT LINE COUNT F
 5279:      1524 60 36          	JZ	LIN1		;LINE LENGTHS EQUAL
 5280:      1526 40 1F          	JC	GTX		;SMALLER LINE
 5281:                          	;
 5282:                          	;EXPAND FOR A NEW LINE OR A LARGER LINE
 5283:                          	;
 5284:      1528 FF             LTX:	MOV	R7,A		;SAVE A IN R7
 5285:      1529 E5 0D          	MOV	A,TEMP3 	;GET THE COUNT IN THE ACC
 5286:      152B B4 04 01       	CJNE	A,#04H,LTX1	;DO NO INSERTATION IF 
 5287:      152E 22             	RET			;EXIT IF IT IS
 5288:                          	;
 5289:      152F EF             LTX1:	MOV	A,R7		;GET THE COUNT BACK - DE
 5290:      1530 B1 A8          	ACALL	FULL		;SEE IF ENOUGH MEMORY NEW E
 5291:      1532 12 18 4D       	CALL	DTEMP		;GET INSERATION ADDRESS
 5292:      1535 B1 9D          	ACALL	NMOV		;R7:R6 GETS (EOFA)-DPTR
 5293:      1537 12 0D AD       	CALL	X3120
 5294:      153A A9 04          	MOV	R1,R4B0 	;EOFA LOW
 5295:      153C AB 05          	MOV	R3,R5B0 	;EOFA HIGH
 5296:      153E 0E             	INC	R6		;INCREMENT BYTE COUNT
 5297:      153F BE 00 01       	CJNE	R6,#00,LTX2	;NEED TO BUMP HIGH BYT
 5298:      1542 0F             	INC	R7
 5299:                          	;
 5300:      1543 B1 81          LTX2:	ACALL	RMOV		;GO DO THE INSERTION
 5301:      1545 80 15          	SJMP	LIN1		;INSERT THE CURRENT LINE
 5302:                          	;
 5303:      1547 F4             GTX:	CPL	A		;FLIP ACC
 5304:      1548 04             	INC	A		;TWOS COMPLEMENT
 5305:      1549 12 05 DE       	CALL	ADDPTR		;DO THE ADDITION
 5306:      154C B1 9D          	ACALL	NMOV		;R7:R6 GETS (EOFA)-DPTR
 5307:      154E A9 82          	MOV	R1,DPL		;SET UP THE REGISTERS
 5308:      1550 AB 83          	MOV	R3,DPH
 5309:      1552 AA 0F          	MOV	R2,TEMP5	;PUT INSERTATION ADDRESS I
 5310:      1554 A8 0E          	MOV	R0,TEMP4
 5311:      1556 60 02          	JZ	GTX1		;IF ACC WAS ZERO FROM NMOV, JU
 5312:      1558 B1 6D          	ACALL	LMOV		;IF NO ZERO DO A LMOV
 5313:                          	;
 5314:      155A B1 13          GTX1:	ACALL	UE		;SAVE NEW END ADDRESS
 5315:                          	;
 5316:      155C AA 0F          LIN1:	MOV	R2,TEMP5	;GET THE INSERTATION 
 5317:      155E A8 0E          	MOV	R0,TEMP4
 5318:      1560 E5 0D          	MOV	A,TEMP3 	;PUT THE COUNT LENGTH IN A
 5319:      1562 B4 04 01       	CJNE	A,#04H,IMOV	;SEE IF NULL
 5320:      1565 22             	RET			;EXIT IF NULL
 5321:                          	;
 5322:                          	;**************************************
 5323:                          	;
 5324:                          	;INSERT A LINE AT ADDRESS R2:R0
 5325:                          	;
 5326:                          	;**************************************
 5327:                          	;
 5328:      1566 E4             IMOV:	CLR	A		;TO SET UP
 5329:      1567 79 04          	MOV	R1,#LOW IBCNT	;INITIALIZE THE REGIS

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 97



 Line    I  Addr Code           Source

 5330:      1569 FB             	MOV	R3,A
 5331:      156A AE 0D          	MOV	R6,TEMP3	;PUT THE BYTE COUNT IN R6 
 5332:      156C FF             	MOV	R7,A		;PUT A 0 IN R7 FOR LMOV
 5333:                          	;
 5334:                          	;**************************************
 5335:                          	;
 5336:                          	;COPY A BLOCK FROM THE BEGINNING
 5337:                          	;
 5338:                          	;R2:R0 IS THE DESTINATION ADDRESS
 5339:                          	;R3:R1 IS THE SOURCE ADDRESS
 5340:                          	;R7:R6 IS THE COUNT REGISTER
 5341:                          	;
 5342:                          	;**************************************
 5343:                          	;
 5344:      156D B1 96          LMOV:	ACALL	TBYTE		;TRANSFER THE BYTE
 5345:      156F B1 76          	ACALL	INC3210 	;BUMP THE POINTER
 5346:      1571 D1 47          	ACALL	DEC76		;BUMP R7:R6
 5347:      1573 70 F8          	JNZ	LMOV		;LOOP
 5348:      1575 22             	RET			;GO BACK TO CALLING ROUTINE
 5349:                          	;
 5350:      1576 08             INC3210:INC	R0
 5351:      1577 B8 00 01       	CJNE	R0,#00H,INC3211
 5352:      157A 0A             	INC	R2
 5353:                          	;
 5354:      157B 09             INC3211:INC	R1
 5355:      157C B9 00 01       	CJNE	R1,#00H,INC3212
 5356:      157F 0B             	INC	R3
 5357:      1580 22             INC3212:RET
 5358:                          	;
 5359:                          	;**************************************
 5360:                          	;
 5361:                          	;COPY A BLOCK STARTING AT THE END
 5362:                          	;
 5363:                          	;R2:R0 IS THE DESTINATION ADDRESS
 5364:                          	;R3:R1 IS THE SOURCE ADDRESS
 5365:                          	;R6:R7 IS THE COUNT REGISTER
 5366:                          	;
 5367:                          	;**************************************
 5368:                          	;
 5369:      1581 B1 96          RMOV:	ACALL	TBYTE		;TRANSFER THE BYTE
 5370:      1583 B1 8B          	ACALL	DEC3210 	;DEC THE LOCATIONS
 5371:      1585 D1 47          	ACALL	DEC76		;BUMP THE COUNTER
 5372:      1587 70 F8          	JNZ	RMOV		;LOOP
 5373:                          	;
 5374:      1589 00             DEC_R:	NOP			;CREATE EQUAL TIMING
 5375:      158A 22             	RET			;EXIT
 5376:                          	;
 5377:      158B 18             DEC3210:DEC	R0		;BUMP THE POINTER
 5378:      158C B8 FF 01       	CJNE	R0,#0FFH,DEC3212;SEE IF OVERFLOWED
 5379:      158F 1A             DEC3211:DEC	R2		;BUMP THE HIGH BYTE
 5380:      1590 19             DEC3212:DEC	R1		;BUMP THE POINTER
 5381:      1591 B9 FF F5       	CJNE	R1,#0FFH,DEC_R	;SEE IF OVERFLOWED
 5382:      1594 1B             	DEC	R3		;CHANGE THE HIGH BYTE
 5383:      1595 22             	RET			;EXIT
 5384:                          	;
 5385:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 98



 Line    I  Addr Code           Source

 5386:                          	;
 5387:                          	;TBYTE - TRANSFER A BYTE
 5388:                          	;
 5389:                          	;**************************************
 5390:                          	;
 5391:      1596 8B A0          TBYTE:	MOV	P2,R3		;OUTPUT SOURCE REGISTE
 5392:      1598 E3             	MOVX	A,@R1		;PUT BYTE IN ACC
 5393:                          	;
 5394:      1599 8A A0          TBR:	MOV	P2,R2		;OUTPUT DESTINATION TO P
 5395:      159B F2             	MOVX	@R0,A		;SAVE THE BYTE
 5396:      159C 22             	RET			;EXIT
 5397:                          	;
 5398:                          	;**************************************
 5399:                          	;
 5400:                          	;NMOV - R7:R6 = END ADDRESS - DPTR
 5401:                          	;
 5402:                          	;ACC GETS CLOBBERED
 5403:                          	;
 5404:                          	;**************************************
 5405:                          	;
 5406:      159D EC             NMOV:	MOV	A,R4		;THE LOW BYTE OF EOFA
 5407:      159E C3             	CLR	C		;CLEAR THE CARRY FOR SUBB
 5408:      159F 95 82          	SUBB	A,DPL		;SUBTRACT DATA POINTER LOW
 5409:      15A1 FE             	MOV	R6,A		;PUT RESULT IN R6
 5410:      15A2 ED             	MOV	A,R5		;HIGH BYTE OF EOFA
 5411:      15A3 95 83          	SUBB	A,DPH		;SUBTRACT DATA POINTER HIGH
 5412:      15A5 FF             	MOV	R7,A		;PUT RESULT IN R7
 5413:      15A6 4E             	ORL	A,R6		;SEE IF ZERO
 5414:      15A7 22             NMOV1:	RET			;EXIT
 5415:                          	;
 5416:                          	;**************************************
 5417:                          	;
 5418:                          	;CHECK FOR A FILE OVERFLOW
 5419:                          	;LEAVES THE NEW END ADDRESS IN R3:R1
 5420:                          	;A HAS THE INCREASE IN SIZE
 5421:                          	;
 5422:                          	;**************************************
 5423:                          	;
 5424:      15A8 2C             FULL:	ADD	A,R4		;ADD A TO END ADDRESS
 5425:      15A9 F9             	MOV	R1,A		;SAVE IT
 5426:      15AA E4             	CLR	A
 5427:      15AB 3D             	ADDC	A,R5		;ADD THE CARRY
 5428:      15AC FB             	MOV	R3,A
 5429:      15AD 90 01 04       	MOV	DPTR,#VARTOP	;POINT AT VARTOP
 5430:                          	;
 5431:      15B0 12 05 CC       FUL1:	CALL	DCMPX		;COMPARE THE TWO
 5432:      15B3 40 F2          	JC	NMOV1		;OUT OF ROOM
 5433:                          	;
 5434:      15B5 90 18 16       TB:	MOV	DPTR,#E5X	;OUT OF MEMORY
 5435:      15B8 01 4B          	AJMP	FPTS
 5436:                          	;
 5437:                          	;**************************************
 5438:                          	;
 5439:                          	; PP - Preprocesses the line in IBUF ba
 5440:                          	;      sets F0 if no line number
 5441:                          	;      leaves the correct length of pro

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.            PAGE 99



 Line    I  Addr Code           Source

 5442:                          	;      puts the line number in IBLN
 5443:                          	;      wastes the text address TXAL and
 5444:                          	;
 5445:                          	;**************************************
 5446:                          	;
 5447:      15BA F1 6C          PP:	ACALL	T_BUF		;TXA GETS IBUF
 5448:      15BC 12 0F 35       	CALL	INTGER		;SEE IF A NUMBER PRESENT
 5449:      15BF 12 18 54       	CALL	TEMPD		;SAVE THE INTEGER IN TEMP5:
 5450:      15C2 92 D5          	MOV	F0,C		;SAVE INTEGER IF PRESENT
 5451:      15C4 90 00 05       	MOV	DPTR,#IBLN	;SAVE THE LINE NUMBER, E
 5452:      15C7 91 24          	ACALL	S20DP
 5453:      15C9 A8 08          	MOV	R0,TXAL 	;TEXT POINTER
 5454:      15CB 79 07          	MOV	R1,#LOW IBUF	;STORE POINTER
 5455:                          	;
 5456:                          	; Now process the line back into IBUF
 5457:                          	;
 5458:      15CD C2 24          PPL:	CLR	ARGF		;FIRST PASS DESIGNATOR
 5459:      15CF 90 01 75       	MOV	DPTR,#TOKTAB	;POINT DPTR AT LOOK UP
 5460:                          	;
 5461:      15D2 88 05          PPL1:	MOV	R5B0,R0 	;SAVE THE READ POINTE
 5462:      15D4 E4             	CLR	A		;ZERO A FOR LOOKUP
 5463:      15D5 93             	MOVC	A,@A+DPTR	;GET THE TOKEN
 5464:      15D6 FF             	MOV	R7,A		;SAVE TOKEN IN CASE OF MATCH
 5465:                          	;
 5466:      15D7 E2             PPL2:	MOVX	A,@R0		;GET THE USER CHARACTE
 5467:      15D8 FB             	MOV	R3,A		;SAVE FOR REM
 5468:      15D9 B4 61 00       	CJNE	A,#'a',PPL21
 5469:      15DC 40 07          PPL21:	JC	PPX		;CONVERT LOWER TO UPPER C
 5470:      15DE B4 7B 00       	CJNE	A,#('z'+1),PPL22
 5471:      15E1 50 02          PPL22:	JNC	PPX
 5472:      15E3 C2 E5          	CLR	ACC.5
 5473:                          	;
 5474:      15E5 FA             PPX:	MOV	R2,A
 5475:      15E6 F2             	MOVX	@R0,A		;SAVE UPPER CASE
 5476:      15E7 A3             	INC	DPTR		;BUMP THE LOOKUP POINTER
 5477:      15E8 E4             	CLR	A
 5478:      15E9 93             	MOVC	A,@A+DPTR
 5479:      15EA B5 02 03       	CJNE	A,R2B0,PPL3	;LEAVE IF NOT THE SAME
 5480:      15ED 08             	INC	R0		;BUMP THE USER POINTER
 5481:      15EE 80 E7          	SJMP	PPL2		;CONTINUE TO LOOP
 5482:                          	;
 5483:      15F0 20 E7 2F       PPL3:	JB	ACC.7,PPL6	;JUMP IF FOUND MATCH
 5484:      15F3 60 2D          	JZ	PPL6		;USER MATCH
 5485:                          	;
 5486:                          	;
 5487:                          	; Scan to the next TOKTAB entry
 5488:                          	;
 5489:      15F5 A3             PPL4:	INC	DPTR		;ADVANCE THE POINTER
 5490:      15F6 E4             	CLR	A		;ZERO A FOR LOOKUP
 5491:      15F7 93             	MOVC	A,@A+DPTR	;LOAD A WITH TABLE
 5492:      15F8 20 E7 03       	JB	ACC.7,PPL41	;KEEP SCANNING IF NOT A 
 5493:      15FB 70 F8          	JNZ	PPL4
 5494:      15FD A3             	INC	DPTR
 5495:                          	;
 5496:                          	; See if at the end of TOKTAB
 5497:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 100



 Line    I  Addr Code           Source

 5498:      15FE A8 05          PPL41:	MOV	R0,R5B0 	;RESTORE THE POINTER
 5499:      1600 B4 FF CF       	CJNE	A,#0FFH,PPL1	;SEE IF END OF TABLE
 5500:                          	;
 5501:                          	; Character not in TOKTAB, so see what 
 5502:                          	;
 5503:      1603 BA 20 03       	CJNE	R2,#' ',PPLX    ;SEE IF A SPACE
 5504:      1606 08             	INC	R0		;BUMP USER POINTER
 5505:      1607 80 C4          	SJMP	PPL		;TRY AGAIN
 5506:                          	;
 5507:      1609 30 2D 0A       PPLX:	JNB	XBIT,PPLY	;EXTERNAL TRAP
 5508:      160C 20 24 07       	JB	ARGF,PPLY
 5509:      160F D2 24          	SETB	ARGF		;SAYS THAT THE USER HAS TABL
 5510:      1611 12 20 78       	LCALL	2078H		;SET UP POINTER
 5511:      1614 A1 D2          	AJMP	PPL1
 5512:                          	;
 5513:      1616 D1 2F          PPLY:	ACALL	PPL7		;SAVE CHARACTER, EXIT 
 5514:      1618 B4 22 B2       	CJNE	A,#'"',PPL      ;SEE IF QUOTED STR
 5515:                          	;
 5516:                          	; Just copy a quoted string
 5517:                          	;
 5518:      161B D1 2F          PPLY1:	ACALL	PPL7		;SAVE THE CHARACTER, 
 5519:      161D B4 22 FB       	CJNE	A,#'"',PPLY1    ;IS THERE AN ENDQU
 5520:      1620 80 AB          	SJMP	PPL		;DO IT AGAIN IF ENDQUOTE
 5521:                          	;
 5522:      1622 EF             PPL6:	MOV	A,R7		;GET THE TOKEN
 5523:      1623 D1 44          	ACALL	PPL91		;SAVE THE TOKEN
 5524:      1625 B4 96 A5       	CJNE	A,#T_REM,PPL	;SEE IF A REM TOKEN
 5525:      1628 EB             	MOV	A,R3
 5526:      1629 D1 30          	ACALL	PPL71		;WASTE THE REM STATEMENT
 5527:      162B D1 2F          PPL61:	ACALL	PPL7		;LOOP UNTIL A CR
 5528:      162D 80 FC          	SJMP	PPL61
 5529:                          	;
 5530:      162F E2             PPL7:	MOVX	A,@R0		;GET THE CHARACTER
 5531:      1630 B4 0D 10       PPL71:	CJNE	A,#CR,PPL9	;FINISH IF A CR
 5532:      1633 D0 00          	POP	R0B0		;WASTE THE CALLING STACK
 5533:      1635 D0 00          	POP	R0B0
 5534:      1637 F3             	MOVX	@R1,A		;SAVE CR IN MEMORY
 5535:      1638 09             	INC	R1		;SAVE A TERMINATOR
 5536:      1639 74 01          	MOV	A,#EOF
 5537:      163B F3             	MOVX	@R1,A
 5538:      163C E9             	MOV	A,R1		;SUBTRACT FOR LENGTH
 5539:      163D 94 04          	SUBB	A,#4
 5540:      163F F5 0D          	MOV	TEMP3,A 	;SAVE LENGTH
 5541:      1641 79 04          	MOV	R1,#LOW IBCNT	;POINT AT BUFFER COUN
 5542:                          	;
 5543:      1643 08             PPL9:	INC	R0
 5544:      1644 F3             PPL91:	MOVX	@R1,A		;SAVE THE CHARACTER
 5545:      1645 09             	INC	R1		;BUMP THE POINTERS
 5546:      1646 22             	RET			;EXIT TO CALLING ROUTINE
 5547:                          	;
 5548:                          	;
 5549:                          	;**************************************
 5550:                          	;
 5551:                          	;DEC76 - DECREMENT THE REGISTER PAIR R7
 5552:                          	;
 5553:                          	;ACC = ZERO IF R7:R6 = ZERO ; ELSE ACC 

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 101



 Line    I  Addr Code           Source

 5554:                          	;
 5555:                          	;**************************************
 5556:                          	;
 5557:      1647 1E             DEC76:	DEC	R6		;BUMP R6
 5558:      1648 BE FF 01       	CJNE	R6,#0FFH,DEC77	;SEE IF RAPPED AROU
 5559:      164B 1F             	DEC	R7
 5560:      164C EF             DEC77:	MOV	A,R7		;SEE IF ZERO
 5561:      164D 4E             	ORL	A,R6
 5562:      164E 22             	RET			;EXIT
 5563:                          	;
 5564:                          	;**************************************
 5565:                          	;
 5566:                          	; MTOP - Get or Put the top of assigned
 5567:                          	;
 5568:                          	;**************************************
 5569:                          	;
 5570:      164F 90 01 0A       PMTOP:	MOV	DPTR,#MEMTOP
 5571:      1652 12 05 73       PMTOP1: CALL	L20DPI
 5572:      1655 81 B4          	AJMP	TWO_EY		;PUT R2:R0 ON THE STACK
 5573:                          	;
 5574:                          	;**************************************
 5575:                          	;
 5576:                          	; AXTAL - Crystal value calculations
 5577:                          	;
 5578:                          	;**************************************
 5579:                          	;
 5580:      1657 90 17 EC       AXTAL0: MOV	DPTR,#XTALV	;CRYSTAL VALUE
 5581:      165A 91 33          	ACALL	PUSHC
 5582:                          	;
 5583:      165C 91 2A          AXTAL1: ACALL	CSTAKA2 	;COPY CRYSTAL VAL
 5584:                          ;
 5585:                          ;***************************************
 5586:                          ;****** Disable Intel programming for to
 5587:                          ;
 5588:                          ;	ACALL	CSTAKA		;Copy crystal value the 
 5589:                          ;
 5590:                          ;***************************************
 5591:                          ;
 5592:      165E 90 07 09       	MOV	DPTR,#PTIME	;PROM TIMER
 5593:      1661 D1 79          	ACALL	AXTAL2
 5594:      1663 90 01 28       	MOV	DPTR,#PROGS
 5595:      1666 F1 0E          	ACALL	S31L
 5596:                          ;
 5597:                          ;***************************************
 5598:                          ;****** Disable Intel programming for to
 5599:                          ;
 5600:                          ;	MOV	DPTR,#IPTIME	;IPROM TIMER
 5601:                          ;	ACALL	AXTAL2
 5602:                          ;	MOV	DPTR,#IPROGS
 5603:                          ;	ACALL	S31L
 5604:                          ;
 5605:                          ;***************************************
 5606:                          ;
 5607:      1668 90 11 67       	MOV	DPTR,#TTIME	;CLOCK CALCULATION
 5608:      166B 51 1F          	ACALL	AXTAL3
 5609:      166D E9             	MOV	A,R1

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 102



 Line    I  Addr Code           Source

 5610:      166E F4             	CPL	A
 5611:      166F 04             	INC	A
 5612:      1670 F5 4A          	MOV	SAVE_T,A
 5613:      1672 7B 01          	MOV	R3,#HIGH CXTAL
 5614:      1674 79 13          	MOV	R1,#LOW CXTAL
 5615:      1676 02 0F D3       	JMP	POPAS
 5616:                          	;
 5617:      1679 51 1F          AXTAL2: ACALL	AXTAL3
 5618:                          	;
 5619:                          CBIAS:	;Bias the crystal calculations
 5620:                          	;
 5621:      167B E9             	MOV	A,R1		;GET THE LOW COUNT
 5622:      167C F4             	CPL	A		;FLIP IT FOR TIMER LOAD
 5623:      167D 24 0F          	ADD	A,#15		;BIAS FOR CALL AND LOAD TIME
 5624:      167F F9             	MOV	R1,A		;RESTORE IT
 5625:      1680 EB             	MOV	A,R3		;GET THE HIGH COUNT
 5626:      1681 F4             	CPL	A		;FLIP IT
 5627:      1682 34 00          	ADDC	A,#00H		;ADD THE CARRY
 5628:      1684 FB             	MOV	R3,A		;RESTORE IT
 5629:      1685 22             	RET
 5630:                          	;
 5631:                          	;**************************************
 5632:                          	;
 5633:                          STONE:	; Toggle the I/O port
 5634:                          	;
 5635:                          	;**************************************
 5636:                          	;
 5637:      1686 12 0E 78       	CALL	THREE		;GET THE NUMBERS
 5638:      1689 D1 7B          	ACALL	CBIAS		;BIAS R3:R1 FOR COUNT LOOP
 5639:                          	;
 5640:      168B C2 92          STONE1: CLR	T_BIT		;TOGGLE THE BIT
 5641:      168D C2 8E          	CLR	TR1		;STOP THE TIMER
 5642:      168F 8B 8D          	MOV	TH1,R3		;LOAD THE TIMER
 5643:      1691 89 8B          	MOV	TL1,R1
 5644:      1693 C2 8F          	CLR	TF1		;CLEAR THE OVERFLOW FLAG
 5645:      1695 D2 8E          	SETB	TR1		;TURN IT ON
 5646:      1697 D1 47          	ACALL	DEC76
 5647:      1699 30 8F FD       	JNB	TF1,$		;WAIT
 5648:      169C 71 AC          	ACALL	ALPAR
 5649:      169E D2 92          	SETB	T_BIT		;BACK TO A ONE
 5650:      16A0 12 05 2F       	CALL	TIMER_LOAD1	;LOAD THE HIGH VALUE
 5651:      16A3 30 8F FD       	JNB	TF1,$		;WAIT
 5652:      16A6 70 E3          	JNZ	STONE1		;LOOP
 5653:      16A8 22             	RET
 5654:                          	;
 5655:                          	;LNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLN
 5656:                          	;
 5657:                          LNTAB:	; Natural log lookup table
 5658:                          	;
 5659:                          	;LNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLNLN
 5660:                          	;
 5661:      16A9 80             	DB	80H
 5662:      16AA 00             	DB	00H
 5663:      16AB 71             	DB	71H
 5664:      16AC 37             	DB	37H
 5665:      16AD 13             	DB	13H

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 103



 Line    I  Addr Code           Source

 5666:      16AE 19             	DB	19H
 5667:                          	;
 5668:      16AF 7F             	DB	7FH
 5669:      16B0 00             	DB	00H
 5670:      16B1 76             	DB	76H
 5671:      16B2 64             	DB	64H
 5672:      16B3 37             	DB	37H
 5673:      16B4 94             	DB	94H
 5674:                          	;
 5675:      16B5 80             	DB	80H
 5676:      16B6 00             	DB	00H
 5677:      16B7 07             	DB	07H
 5678:      16B8 22             	DB	22H
 5679:      16B9 75             	DB	75H
 5680:      16BA 17             	DB	17H
 5681:                          	;
 5682:      16BB 80             	DB	80H
 5683:      16BC 00             	DB	00H
 5684:      16BD 52             	DB	52H
 5685:      16BE 35             	DB	35H
 5686:      16BF 93             	DB	93H
 5687:      16C0 28             	DB	28H
 5688:                          	;
 5689:      16C1 80             	DB	80H
 5690:      16C2 00             	DB	00H
 5691:      16C3 71             	DB	71H
 5692:      16C4 91             	DB	91H
 5693:      16C5 85             	DB	85H
 5694:      16C6 86             	DB	86H
 5695:                          	;
 5696:      16C7 FF             	DB	0FFH
 5697:                          	;
 5698:      16C8 81             	DB	81H
 5699:      16C9 00             	DB	00H
 5700:      16CA 51             	DB	51H
 5701:      16CB 58             	DB	58H
 5702:      16CC 02             	DB	02H
 5703:      16CD 23             	DB	23H
 5704:                          	;
 5705:                          	;SINSINSINSINSINSINSINSINSINSINSINSINSI
 5706:                          	;
 5707:                          SINTAB: ; Sin lookup table
 5708:                          	;
 5709:                          	;SINSINSINSINSINSINSINSINSINSINSINSINSI
 5710:                          	;
 5711:      16CE 77             	DB	128-9
 5712:      16CF 00             	DB	00H
 5713:      16D0 44             	DB	44H
 5714:      16D1 90             	DB	90H
 5715:      16D2 05             	DB	05H
 5716:      16D3 16             	DB	16H
 5717:                          	;
 5718:      16D4 79             	DB	128-7
 5719:      16D5 01             	DB	01H
 5720:      16D6 08             	DB	08H
 5721:      16D7 21             	DB	21H

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 104



 Line    I  Addr Code           Source

 5722:      16D8 05             	DB	05H
 5723:      16D9 25             	DB	25H
 5724:                          	;
 5725:      16DA 7B             	DB	128-5
 5726:      16DB 00             	DB	00H
 5727:      16DC 19             	DB	19H
 5728:      16DD 73             	DB	73H
 5729:      16DE 55             	DB	55H
 5730:      16DF 27             	DB	27H
 5731:      16E0 7D             	DB	128-3
 5732:      16E1 01             	DB	01H
 5733:      16E2 70             	DB	70H
 5734:      16E3 12             	DB	12H
 5735:      16E4 84             	DB	84H
 5736:      16E5 19             	DB	19H
 5737:                          	;
 5738:      16E6 7E             	DB	128-2
 5739:      16E7 00             	DB	00H
 5740:      16E8 33             	DB	33H
 5741:      16E9 33             	DB	33H
 5742:      16EA 33             	DB	33H
 5743:      16EB 83             	DB	83H
 5744:                          	;
 5745:      16EC 80             	DB	128
 5746:      16ED 01             	DB	01H
 5747:      16EE 67             	DB	67H
 5748:      16EF 66             	DB	66H
 5749:      16F0 66             	DB	66H
 5750:      16F1 16             	DB	16H
 5751:                          	;
 5752:      16F2 81             FPONE:	DB	128+1
 5753:      16F3 00             	DB	00H
 5754:      16F4 00             	DB	00H
 5755:      16F5 00             	DB	00H
 5756:      16F6 00             	DB	00H
 5757:      16F7 10             	DB	10H
 5758:                          	;
 5759:      16F8 FF             	DB	0FFH		;END OF TABLE
 5760:                          	;
 5761:      16F9 12 0F D9       SBAUD:	CALL	AXTAL		;PUT CRYSTAL ON THE S
 5762:      16FC 12 0F 43       	CALL	EXPRB		;PUT THE NUMBER AFTER BAUD 
 5763:      16FF 74 0C          	MOV	A,#12
 5764:      1701 91 B1          	ACALL	TWO_R2		;TOS = 12
 5765:      1703 31 B0          	ACALL	AMUL		;TOS = 12*BAUD
 5766:      1705 91 0A          	ACALL	ADIV		;TOS = XTAL/(12*BAUD)
 5767:      1707 51 23          	ACALL	IFIX
 5768:      1709 D1 7B          	ACALL	CBIAS
 5769:      170B 90 01 24       	MOV	DPTR,#SPV
 5770:                          	;
 5771:      170E 02 06 05       S31L:	JMP	S31DP
 5772:                          	;
 5773:      1711 D1 4F          AFREE:	CALL	PMTOP		;PUT MTOP ON STACK
 5774:      1713 12 05 A9       	CALL	G4		;GET END ADDRESS
 5775:      1716 A8 82          	MOV	R0,DPL
 5776:      1718 AA 83          	MOV	R2,DPH
 5777:      171A 91 B4          	ACALL	TWO_EY

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 105



 Line    I  Addr Code           Source

 5778:                          	;
 5779:      171C 12 19 71       ASUB:	LCALL	FP_BASE1	;DO FP SUB
 5780:      171F 01 38          	AJMP	FPTST
 5781:                          	;
 5782:      1721 12 05 1C       ALEN:	CALL	CCAL		;CALCULATE THE LEN OF T
 5783:      1724 AA 07          	MOV	R2,R7B0 	;SAVE THE HIGH BYTE
 5784:      1726 EE             	MOV	A,R6		;SAVE THE LOW BYTE
 5785:      1727 81 B3          	AJMP	TWO_EX		;PUT IT ON THE STACK
 5786:                          	;
 5787:      1729 A2 AF          ATIME:	MOV	C,EA		;SAVE INTERRUTS
 5788:      172B C2 AF          	CLR	EA
 5789:      172D C0 47          	PUSH	MILLIV		;SAVE MILLI VALUE
 5790:      172F AA 48          	MOV	R2,TVH		;GET THE TIMER
 5791:      1731 E5 49          	MOV	A,TVL
 5792:      1733 92 AF          	MOV	EA,C		;SAVE INTERRUPTS
 5793:      1735 91 B3          	ACALL	TWO_EX		;PUT TIMER ON THE STACK
 5794:      1737 D0 E0          	POP	ACC		;GET MILLI
 5795:      1739 91 B1          	ACALL	TWO_R2		;PUT MILLI ON STACK
 5796:      173B 74 C8          	MOV	A,#200
 5797:      173D 91 B1          	ACALL	TWO_R2		;DIVIDE MILLI BY 200
 5798:      173F 91 0A          	ACALL	ADIV
 5799:                          	;
 5800:      1741 12 19 6F       AADD:	LCALL	FP_BASE 	;DO FP ADDITION
 5801:      1744 01 38          	AJMP	FPTST		;CHECK FOR ERRORS
 5802:                          	;
 5803:                          	;**************************************
 5804:                          	;
 5805:                          	; Here are some error messages that wer
 5806:                          	;
 5807:                          	;**************************************
 5808:                          	;
 5809:                          	;
 5810:      1746 42 41 44 20    E1X:	DB	'BAD SYNTAX"'
            174A 53 59 4E 54
            174E 41 58 22
 5811:      1751 8A             E2X:	DB	128+10
 5812:      1752 44 49 56 49    	DB	'DIVIDE BY ZERO"'
            1756 44 45 20 42
            175A 59 20 5A 45
            175E 52 4F 22
 5813:                          	;
 5814:      1761 41 52 52 41    E6X:	DB	'ARRAY SIZE"'
            1765 59 20 53 49
            1769 5A 45 22
 5815:                          	;
 5816:                          	;**************************************
 5817:                          	;
 5818:                          T_BUF:	; TXA gets IBUF
 5819:                          	;
 5820:                          	;**************************************
 5821:                          	;
 5822:      176C 75 0A 00       	MOV	TXAH,#HIGH IBUF
 5823:      176F 75 08 07       	MOV	TXAL,#LOW IBUF
 5824:      1772 22             	RET
 5825:                          	;
 5826:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 106



 Line    I  Addr Code           Source

 5827:                          	;**************************************
 5828:                          	;
 5829:                          CXFER:	; Transfer a program from rom to 
 5830:                          	;
 5831:                          	;**************************************
 5832:                          	;
 5833:      1773 12 05 1C       	CALL	CCAL		;GET EVERYTHING SET UP
 5834:      1776 7A 02          	MOV	R2,#HIGH PSTART
 5835:      1778 78 00          	MOV	R0,#LOW PSTART
 5836:      177A B1 6D          	ACALL	LMOV		;DO THE TRANSFER
 5837:      177C 12 06 64       	CALL	RCLEAR		;CLEAR THE MEMORY
 5838:                          	;
 5839:                          	; Fall thru to CRAM
 5840:                          	;
 5841:                          	;**************************************
 5842:                          	;
 5843:                          CRAM:	; The command action routine - RAM
 5844:                          	;
 5845:                          	;**************************************
 5846:                          	;
 5847:      177F C2 17          	CLR	CONB		;CAN'T CONTINUE IF MODE CHANG
 5848:      1781 75 13 02       	MOV	BOFAH,#HIGH PSTART
 5849:      1784 75 14 00       	MOV	BOFAL,#LOW PSTART
 5850:                          	;
 5851:                          	; Fall thru to Command Processor
 5852:                          	;
 5853:                          	;**************************************
 5854:                          	;
 5855:                          CMND1:	; The entry point for the command
 5856:                          	;
 5857:                          	;**************************************
 5858:                          	;
 5859:      1787 12 0C 31       	LCALL	SPRINT1 	;WASTE AT AND HEX
 5860:      178A C2 2D          	CLR	XBIT		;TO RESET IF NEEDED
 5861:                          ;
 5862:                          ;***************************************
 5863:                          ;****** Karmann 1 Bugfix ***************
 5864:                          ;
 5865:      178C F1 E0          	acall	TEST_USER	;check for user command
 5866:                          ;
 5867:                          ;****** continue with original code: ***
 5868:                          ;
 5869:      178E 90 00 FD       	MOV	DPTR,#RDYS	;PRINT THE READY MESSAGE
 5870:      1791 12 06 AD       	CALL	CRP		;DO A CR, THEN, PRINT FROM TH
 5871:                          	;
 5872:      1794 D2 2F          CMNDR:	SETB	DIRF		;SET THE DIRECT INPUT 
 5873:      1796 85 3E 81       	MOV	SP,SPSAV	;LOAD THE STACK
 5874:      1799 11 9D          	ACALL	CL7		;DO A CRLF
 5875:                          	;
 5876:      179B C2 18          CMNX:	CLR	GTRD		;CLEAR BREAK
 5877:      179D 90 00 5E       	MOV	DPTR,#5EH	;DO RUN TRAP
 5878:      17A0 E0             	MOVX	A,@DPTR
 5879:      17A1 64 34          	XRL	A,#52
 5880:      17A3 70 03          	JNZ	CMNX1
 5881:      17A5 02 08 02       	LJMP	CRUN
 5882:      17A8 7D 3E          CMNX1:	MOV	R5,#'>'         ;OUTPUT A PRO

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 107



 Line    I  Addr Code           Source

 5883:      17AA 12 07 11       	LCALL	TEROT
 5884:      17AD 12 06 D8       	CALL	INLINE		;INPUT A LINE INTO IBUF
 5885:      17B0 B1 BA          	CALL	PP		;PRE-PROCESS THE LINE
 5886:      17B2 20 D5 0F       	JB	F0,CMND3	;NO LINE NUMBER
 5887:      17B5 91 F0          	CALL	LINE		;PROCESS THE LINE
 5888:      17B7 12 05 E7       	LCALL	LCLR
 5889:      17BA 20 15 DE       	JB	LINEB,CMNX	;DON'T CLEAR MEMORY IF NO
 5890:      17BD D2 15          	SETB	LINEB
 5891:      17BF 12 06 64       	LCALL	RCLEAR		;CLEAR THE MEMORY
 5892:      17C2 80 D7          	SJMP	CMNX		;LOOP BACK
 5893:                          	;
 5894:      17C4 F1 6C          CMND3:	CALL	T_BUF		;SET UP THE TEXT POIN
 5895:      17C6 12 0E E1       	CALL	DELTST		;GET THE CHARACTER
 5896:      17C9 60 C9          	JZ	CMNDR		;IF CR, EXIT
 5897:      17CB 90 01 0F       	MOV	DPTR,#CMNDD	;POINT AT THE COMMAND L
 5898:      17CE B4 F0 00       	CJNE	A,#T_CMND,CMND31;PROCESS STATEMENT
 5899:      17D1 40 0A          CMND31: JC	CMND5
 5900:      17D3 12 0E D7       	CALL	GCI1		;BUMP TXA
 5901:      17D6 54 0F          	ANL	A,#0FH		;STRIP MSB'S FOR LOOKUP
 5902:      17D8 12 09 5C       	LCALL	ISTA1		;PROCESS COMMAND
 5903:      17DB 80 B7          	SJMP	CMNDR
 5904:                          	;
 5905:      17DD 02 08 13       CMND5:	LJMP	ILOOP		;CHECK FOR A POSSIBLE
 5906:                          ;
 5907:                          ;***************************************
 5908:                          ;****** Karmann 1 Bugfix ***************
 5909:                          ;
 5910:                          TEST_USER:			;check for user command ext
 5911:      17E0 E4             	CLR	A
 5912:      17E1 90 20 02       	MOV	DPTR,#2002H	;CHECK FOR EXTERNAL TRA
 5913:      17E4 93             	MOVC	A,@A+DPTR
 5914:      17E5 B4 5A 03       	CJNE	A,#5AH,CMND11	;test for user comma
 5915:      17E8 12 20 48       	LCALL	2048H		;IF PRESENT JUMP TO LOCATI
 5916:      17EB 22             CMND11: ret
 5917:                          ;
 5918:                          ;****** continue with original code: ***
 5919:                          ;
 5920:                          	;CONSTANTS
 5921:                          	;
 5922:      17EC 88             XTALV:	DB	128+8		; DEFAULT CRYSTAL VALUE
 5923:      17ED 00             	DB	00H
 5924:      17EE 00             	DB	00H
 5925:      17EF 92             	DB	92H
 5926:      17F0 05             	DB	05H
 5927:      17F1 11             	DB	11H
 5928:                          	;
 5929:      17F2 85             EXP11:	DB	85H
 5930:      17F3 00             	DB	00H
 5931:      17F4 42             	DB	42H
 5932:      17F5 41             	DB	41H
 5933:      17F6 87             	DB	87H
 5934:      17F7 59             	DB	59H
 5935:                          	;
 5936:      17F8 81             EXP1:	DB	128+1		; EXP(1)
 5937:      17F9 00             	DB	00H
 5938:      17FA 18             	DB	18H

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 108



 Line    I  Addr Code           Source

 5939:      17FB 28             	DB	28H
 5940:      17FC 18             	DB	18H
 5941:      17FD 27             	DB	27H
 5942:                          ;
 5943:                          ;***************************************
 5944:                          ;****** Disable Intel programming for to
 5945:                          ;
 5946:                          ;IPTIME: DB	128-4		;FPROG TIMING
 5947:                          ;	DB	00H
 5948:                          ;	DB	00H
 5949:                          ;	DB	00H
 5950:                          ;	DB	75H
 5951:                          ;	DB	83H
 5952:                          ;
 5953:                          ;***************************************
 5954:                          ;
 5955:      17FE 81             PIE:	DB	128+1		;PI
 5956:      17FF 00             	DB	00H
 5957:      1800 26             	DB	26H
 5958:      1801 59             	DB	59H
 5959:      1802 41             	DB	41H
 5960:      1803 31             	DB	31H		; 3.1415926
 5961:                          	;
 5962:                          	;**************************************
 5963:                          	;
 5964:                          	; The error messages, some have been mo
 5965:                          	;
 5966:                          	;**************************************
 5967:                          	;
 5968:      1804 9E             E7X:	DB	128+30
 5969:      1805 41 52 49 54    	DB	'ARITH. UNDERFLOW"'
            1809 48 2E 20 55
            180D 4E 44 45 52
            1811 46 4C 4F 57
            1815 22
 5970:                          	;
 5971:      1816 4D 45 4D 4F    E5X:	DB	'MEMORY ALLOCATION"'
            181A 52 59 20 41
            181E 4C 4C 4F 43
            1822 41 54 49 4F
            1826 4E 22
 5972:                          	;
 5973:      1828 A8             E3X:	DB	128+40
 5974:      1829 42 41 44 20    	DB	'BAD ARGUMENT"'
            182D 41 52 47 55
            1831 4D 45 4E 54
            1835 22
 5975:                          	;
 5976:      1836 49 2D 53 54    EXI:	DB	'I-STACK"'
            183A 41 43 4B 22
 5977:                          	;
 5978:                          	;**************************************
 5979:                          	;
 5980:                          	; The command action routine - CONTINUE
 5981:                          	;
 5982:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 109



 Line    I  Addr Code           Source

 5983:                          	;
 5984:      183E 90 1F A6       CCONT:	MOV	DPTR,#E15X
 5985:      1841 30 17 4B       	JNB	CONB,ERROR	;ERROR IF CONTINUE IS NO
 5986:                          	;
 5987:                          CC1:	;used for input statement entry
 5988:                          	;
 5989:      1844 85 42 0A       	MOV	TXAH,INTXAH	;RESTORE TXA
 5990:      1847 85 43 08       	MOV	TXAL,INTXAL
 5991:      184A 02 08 0F       	JMP	CILOOP		;EXECUTE
 5992:                          	;
 5993:      184D 85 0F 83       DTEMP:	MOV	DPH,TEMP5	;RESTORE DPTR
 5994:      1850 85 0E 82       	MOV	DPL,TEMP4
 5995:      1853 22             	RET
 5996:                          	;
 5997:      1854 85 83 0F       TEMPD:	MOV	TEMP5,DPH
 5998:      1857 85 82 0E       	MOV	TEMP4,DPL
 5999:      185A 22             	RET
 6000:                          	;
 6001:                          	;**************************************
 6002:                          	;
 6003:                          I_DL:	; IDLE
 6004:                          	;
 6005:                          	;**************************************
 6006:                          	;
 6007:      185B 20 2F 27       	JB	DIRF,E1XX	;SYNTAX ERROR IN DIRECT IN
 6008:      185E C2 96          	CLR	DACK		;ACK IDLE
 6009:                          	;
 6010:      1860 43 87 01       U_ID1:	ORL	PCON,#01H
 6011:                          ;	DB	01000011B	;ORL DIRECT OP CODE
 6012:                          ;	DB	87H		;PCON ADDRESS
 6013:                          ;	DB	01H		;SET IDLE BIT
 6014:      1863 20 16 0B       	JB	INTPEN,I_RET	;EXIT IF EXTERNAL INTER
 6015:      1866 10 21 08       	JBC	U_IDL,I_RET	;EXIT IF USER WANTS TO
 6016:      1869 30 10 F4       	JNB	OTS,U_ID1	;LOOP IF TIMER NOT ENABLE
 6017:      186C 12 07 E3       	LCALL	T_CMP		;CHECK THE TIMER
 6018:      186F 40 EF          	JC	U_ID1		;LOOP IF TIME NOT BIG ENOUGH
 6019:                          	;
 6020:      1871 D2 96          I_RET:	SETB	DACK		;RESTORE EXECUTION
 6021:      1873 22             	RET			;EXIT IF IT IS
 6022:                          	;
 6023:                          	;
 6024:                          	;
 6025:      1874 A3             ER0:	INC	DPTR		;BUMP TO TEXT
 6026:      1875 20 2F 23       	JB	DIRF,ERROR0	;CAN'T GET OUT OF DIRECT
 6027:      1878 30 13 20       	JNB	ON_ERR,ERROR0	;IF ON ERROR ISN'T SE
 6028:      187B 90 01 01       	MOV	DPTR,#ERRLOC	;SAVE THE ERROR CODE
 6029:      187E 12 06 73       	CALL	RC2		;SAVE ERROR AND SET UP THE ST
 6030:      1881 A3             	INC	DPTR		;POINT AT ERRNUM
 6031:      1882 02 08 44       	JMP	ERL4		;LOAD ERR NUM AND EXIT
 6032:                          	;
 6033:                          	; Syntax error
 6034:                          	;
 6035:      1885 A2 2F          E1XX:	MOV	C,DIRF		;SEE IF IN DIRECT MODE
 6036:      1887 90 17 46       E1XX1:	MOV	DPTR,#E1X	;ERROR MESSAGE
 6037:      188A 80 04          	SJMP	ERROR1		;TRAP ON SET DIRF
 6038:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 110



 Line    I  Addr Code           Source

 6039:      188C 90 18 36       E1XX2:	MOV	DPTR,#EXI	;STACK ERROR
 6040:                          	;
 6041:                          	; Falls through
 6042:                          	;
 6043:                          	;**************************************
 6044:                          	;
 6045:                          	;ERROR PROCESSOR - PRINT OUT THE ERROR 
 6046:                          	;		   RUN OR COMMAND MODE, FIND AND PRI
 6047:                          	;		   LINE NUMBER IF IN RUN MODE
 6048:                          	;
 6049:                          	;**************************************
 6050:                          	;
 6051:      188F C3             ERROR:	CLR	C		;RESET STACK
 6052:      1890 85 3E 81       ERROR1: MOV	SP,SPSAV	;RESET THE STACK
 6053:      1893 12 0C 31       	LCALL	SPRINT1 	;CLEAR LINE AND AT MODE
 6054:      1896 E4             	CLR	A		;SET UP TO GET ERROR CODE
 6055:      1897 93             	MOVC	A,@A+DPTR
 6056:      1898 10 E7 D9       	JBC	ACC.7,ER0	;PROCESS ERROR
 6057:                          	;
 6058:      189B 11 54          ERROR0: ACALL	TEMPD		;SAVE THE DATA POIN
 6059:      189D 40 03          	JC	ERROR01 	;NO RESET IF CARRY IS SET
 6060:      189F 12 06 6F       	LCALL	RC1		;RESET THE STACKS
 6061:      18A2 12 06 A3       ERROR01:CALL	CRLF2		;DO TWO CARRIAGE RET
 6062:      18A5 90 1F F8       	MOV	DPTR,#ERS	;OUTPUT ERROR MESSAGE
 6063:      18A8 12 06 AF       	CALL	ROM_P
 6064:      18AB 11 4D          	CALL	DTEMP		;GET THE ERROR MESSAGE BACK
 6065:                          	;
 6066:      18AD 12 06 AF       ERRS:	CALL	ROM_P		;PRINT ERROR TYPE
 6067:      18B0 30 2F 05       	JNB	DIRF,ER1	;DO NOT PRINT IN LINE IF D
 6068:                          	;
 6069:      18B3 C2 20          SERR1:	CLR	STOPBIT 	;PRINT STOP THEN EXI
 6070:      18B5 02 17 87       	JMP	CMND1
 6071:                          	;
 6072:      18B8 90 01 03       ER1:	MOV	DPTR,#INS	;OUTPUT IN LINE
 6073:      18BB 12 06 AF       	CALL	ROM_P
 6074:                          	;
 6075:                          	;NOW, FIND THE LINE NUMBER
 6076:                          	;
 6077:                          	;
 6078:      18BE 12 0E 9B       	CALL	DP_B		;GET THE FIRST ADDRESS OF TH
 6079:      18C1 E4             	CLR	A		;FOR INITIALIZATION
 6080:                          	;
 6081:      18C2 11 54          ER2:	ACALL	TEMPD		;SAVE THE DPTR
 6082:      18C4 12 05 DE       	CALL	ADDPTR		;ADD ACC TO DPTR
 6083:      18C7 11 FB          	ACALL	ER4		;R3:R1 = TXA-DPTR
 6084:      18C9 40 06          	JC	ER3		;EXIT IF DPTR>TXA
 6085:      18CB 60 04          	JZ	ER3		;EXIT IF DPTR=TXA
 6086:      18CD E0             	MOVX	A,@DPTR 	;GET LENGTH
 6087:      18CE B4 01 F1       	CJNE	A,#EOF,ER2	;SEE IF AT THE END
 6088:                          	;
 6089:      18D1 11 4D          ER3:	ACALL	DTEMP		;PUT THE LINE IN THE D
 6090:      18D3 11 FB          	ACALL	ER4		;R3:R1 = TXA - BEGINNING OF 
 6091:      18D5 E9             	MOV	A,R1		;GET LENGTH
 6092:      18D6 24 0A          	ADD	A,#10		;ADD 10 TO LENGTH, DPTR STIL
 6093:      18D8 F5 45          	MOV	MT1,A		;SAVE THE COUNT
 6094:      18DA A3             	INC	DPTR		;POINT AT LINE NUMBER HIGH BY

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 111



 Line    I  Addr Code           Source

 6095:      18DB 12 16 52       	CALL	PMTOP1		;LOAD R2:R0, PUT IT ON THE
 6096:      18DE 31 7D          	ACALL	FP_BASE7	;OUTPUT IT
 6097:      18E0 20 20 D0       	JB	STOPBIT,SERR1	;EXIT IF STOP BIT SET
 6098:      18E3 12 06 A3       	CALL	CRLF2		;DO SOME CRLF'S
 6099:      18E6 11 4D          	CALL	DTEMP
 6100:      18E8 12 10 A3       	CALL	UPPL		;UNPROCESS THE LINE
 6101:      18EB 12 10 94       	CALL	CL6		;PRINT IT
 6102:      18EE 7D 2D          ER31:	MOV	R5,#'-'         ;OUTPUT DASHES
 6103:      18F0 31 6C          	ACALL	T_L		;PRINT AN X IF ERROR CHARACT
 6104:      18F2 D5 45 F9       	DJNZ	MT1,ER31	;LOOP UNTIL DONE
 6105:      18F5 7D 58          	MOV	R5,#'X'
 6106:      18F7 31 6C          	ACALL	T_L
 6107:      18F9 01 B3          	AJMP	SERR1
 6108:                          	;
 6109:      18FB AB 0A          ER4:	MOV	R3,TXAH 	;GET TEXT POINTER AND 
 6110:      18FD A9 08          	MOV	R1,TXAL
 6111:      18FF 02 0A 02       	JMP	DUBSUB
 6112:                          	;
 6113:                          	;**************************************
 6114:                          	;
 6115:                          	; Interrupt driven timer
 6116:                          	;
 6117:                          	;**************************************
 6118:                          	;
 6119:      1902 85 4A 8C       I_DR:	MOV	TH0,SAVE_T	;LOAD THE TIMER
 6120:      1905 C5 47          	XCH	A,MILLIV	;SAVE A, GET MILLI COUNTER
 6121:      1907 04             	INC	A		;BUMP COUNTER
 6122:      1908 B4 C8 08       	CJNE	A,#200,TR	;CHECK OUT TIMER VALUE
 6123:      190B E4             	CLR	A		;FORCE ACC TO BE ZERO
 6124:      190C 05 49          	INC	TVL		;INCREMENT LOW TIMER
 6125:      190E B5 49 02       	CJNE	A,TVL,TR	;CHECK LOW VALUE
 6126:      1911 05 48          	INC	TVH		;BUMP TIMER HIGH
 6127:                          	;
 6128:      1913 C5 47          TR:	XCH	A,MILLIV
 6129:      1915 D0 D0          	POP	PSW
 6130:      1917 32             	RETI
 6131:                          	;
 6132:                          	;**************************************
 6133:                          	;
 6134:                          	; The statement action routine - CLOCK
 6135:                          	;
 6136:                          	;**************************************
 6137:                          	;
 6138:      1918 31 38          SCLOCK: ACALL	OTST		;GET CHARACTER AFTER
 6139:      191A C2 A9          	CLR	ET0
 6140:      191C C2 2E          	CLR	C_BIT
 6141:      191E 50 0D          	JNC	SC_R		;EXIT IF A ZERO
 6142:                          ;
 6143:                          ;***************************************
 6144:                          ;****** Use XTAL up to 47 MHz **********
 6145:                          ;****** Wulf 2 *************************
 6146:                          ;
 6147:                          ;	ANL	TMOD,#0F0H	;SET UP THE MODE
 6148:                          ;
 6149:      1920 53 89 F1       	anl	TMOD,#0F1H	;Set up 16 bit mode for 
 6150:      1923 43 89 01       	orl	TMOD,#01H

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 112



 Line    I  Addr Code           Source

 6151:                          ;
 6152:                          ;***************************************
 6153:                          ;
 6154:      1926 D2 2E          	SETB	C_BIT		;USER INTERRUPTS
 6155:      1928 43 A8 82       	ORL	IE,#82H 	;ENABLE ET0 AND EA
 6156:      192B D2 8C          	SETB	TR0		;TURN ON THE TIMER
 6157:                          	;
 6158:      192D 22             SC_R:	RET
 6159:                          	;
 6160:                          	;**************************************
 6161:                          	;
 6162:                          SUI:	; Statement USER IN action routine
 6163:                          	;
 6164:                          	;**************************************
 6165:                          	;
 6166:      192E 31 38          	ACALL	OTST
 6167:      1930 92 1E          	MOV	CIUB,C		;SET OR CLEAR CIUB
 6168:      1932 22             	RET
 6169:                          	;
 6170:                          	;**************************************
 6171:                          	;
 6172:                          SUO:	; Statement USER OUT action routine
 6173:                          	;
 6174:                          	;**************************************
 6175:                          	;
 6176:      1933 31 38          	ACALL	OTST
 6177:      1935 92 1C          	MOV	COUB,C
 6178:      1937 22             	RET
 6179:                          	;
 6180:                          OTST:	; Check for a one
 6181:                          	;
 6182:      1938 12 0E D5       	LCALL	GCI		;GET THE CHARACTER, CLEARS C
 6183:      193B 94 31          	SUBB	A,#'1'          ;SEE IF A ONE
 6184:      193D B3             	CPL	C		;SETS CARRY IF ONE, CLEARS IT IF
 6185:      193E 22             OTST1:	RET
 6186:                          	;
 6187:                          	;**************************************
 6188:                          	;
 6189:                          	; IBLK - EXECUTE USER SUPPLIED TOKEN
 6190:                          	;
 6191:                          	;**************************************
 6192:                          	;
 6193:      193F 20 D4 FC       IBLK:	JB	PSW.4,OTST1	;EXIT IF REGISTER B
 6194:      1942 20 D3 F9       	JB	PSW.3,OTST1
 6195:      1945 10 E7 06       	JBC	ACC.7,IBLK1	;SEE IF BIT SEVEN IS SE
 6196:      1948 90 00 47       	MOV	DPTR,#USENT	;USER ENTRY LOCATION
 6197:      194B 02 09 5C       	LJMP	ISTA1
 6198:                          	;
 6199:      194E 20 E0 2A       IBLK1:	JB	ACC.0,FP_BASE6	;FLOATING POINT
 6200:      1951 60 19          	JZ	T_L		;DO OUTPUT ON 80H
 6201:      1953 90 19 6D       	MOV	DPTR,#FP_BASE-2
 6202:      1956 73             	JMP	@A+DPTR
 6203:                          	;
 6204:                          	;
 6205:                          	;**************************************
 6206:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 113



 Line    I  Addr Code           Source

 6207:                          	; GET_NUM - GET A NUMBER, EITHER HEX OR
 6208:                          	;
 6209:                          	;**************************************
 6210:                          	;
 6211:      1957 31 79          GET_NUM:ACALL	FP_BASE5	;SCAN FOR HEX
 6212:      1959 50 20          	JNC	FP_BASE6	;DO FP INPUT
 6213:                          	;
 6214:      195B 31 81          	ACALL	FP_BASE9	;ASCII STRING TO R2:R0
 6215:      195D 70 0C          	JNZ	H_RET
 6216:      195F C0 83          	PUSH	DPH		;SAVE THE DATA_POINTER
 6217:      1961 C0 82          	PUSH	DPL
 6218:      1963 31 87          	ACALL	FP_BASE12	;PUT R2:R0 ON THE STACK
 6219:      1965 D0 82          	POP	DPL		;RESTORE THE DATA_POINTER
 6220:      1967 D0 83          	POP	DPH
 6221:      1969 E4             	CLR	A		;NO ERRORS
 6222:      196A 22             	RET			;EXIT
 6223:                          	;
 6224:                          	;**************************************
 6225:                          	;
 6226:                          	; WB - THE EGO MESSAGE
 6227:                          	;
 6228:                          	;**************************************
 6229:                          ;
 6230:                          ;***************************************
 6231:                          ;****** Sorry - but the ego message had 
 6232:                          ;
 6233:                          ;WB:
 6234:                          ;
 6235:                          ;	DB	'W'+80H,'R'+80H
 6236:                          ;	DB	'I'+80H,'T'+80H,'T','E'+80H,'N'+80H
 6237:                          ;	DB	' ','B'+80H,'Y'+80H,' '
 6238:                          ;	DB	'J'+80H,'O'+80H,'H'+80H,'N'+80H,' '
 6239:                          ;	DB	'K','A'+80H,'T'+80H,'A'+80H,'U'+80H
 6240:                          ;	DB	'S','K'+80H,'Y'+80H
 6241:                          ;	DB	', I','N'+80H,'T'+80H,'E'+80H,'L'+8
 6242:                          ;	DB	' '+80H,'C'+80H,'O'+80H,'R'+80H,'P'
 6243:                          ;	DB	'. 1','9'+80H,'85'
 6244:                          ;
 6245:                          ;***************************************
 6246:                          	;
 6247:      196B 22             H_RET:	RET
 6248:                          	;
 6249:                          ;***************************************
 6250:                          ;
 6251:                          ; This is a complete BCD floating point 
 6252:                          ; controller. It provides 8 digits of ac
 6253:                          ; range from +127 to -127. The mantissa 
 6254:                          ; exponent is expressed in pseudo-twos c
 6255:                          ; is used to express the number ZERO. An
 6256:                          ; greater than means the exponent is pos
 6257:                          ; 81H = E+1, 82H = E+2 and so on. If the
 6258:                          ; the exponent is negative, 7FH = E-1, 7
 6259:                          ; ALL NUMBERS ARE ASSUMED TO BE NORMALIZ
 6260:                          ; normalized after calculation. A normal
 6261:                          ; <=.99999999.
 6262:                          ;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 114



 Line    I  Addr Code           Source

 6263:                          ; The numbers in memory assumed to be st
 6264:                          ;
 6265:                          ; EXPONENT OF ARGUMENT 2   =   VALUE OF 
 6266:                          ; SIGN OF ARGUMENT 2	   =   VALUE OF ARG
 6267:                          ; DIGIT 78 OF ARGUMENT 2   =   VALUE OF 
 6268:                          ; DIGIT 56 OF ARGUMENT 2   =   VALUE OF 
 6269:                          ; DIGIT 34 OF ARGUMENT 2   =   VALUE OF 
 6270:                          ; DIGIT 12 OF ARGUMENT 2   =   VALUE OF 
 6271:                          ;
 6272:                          ; EXPONENT OF ARGUMENT 1   =   VALUE OF 
 6273:                          ; SIGN OF ARGUMENT 1	   =   VALUE OF ARG
 6274:                          ; DIGIT 78 OF ARGUMENT 1   =   VALUE OF 
 6275:                          ; DIGIT 56 OF ARGUMENT 1   =   VALUE OF 
 6276:                          ; DIGIT 34 OF ARGUMENT 1   =   VALUE OF 
 6277:                          ; DIGIT 12 OF ARGUMENT 1   =   VALUE OF 
 6278:                          ;
 6279:                          ; The operations are performed thusly:
 6280:                          ;
 6281:                          ; ARG_STACK+FP_NUMBER_SIZE = ARG_STACK+F
 6282:                          ;
 6283:                          ; Which is ARGUMENT 2 = ARGUMENT 2 # ARG
 6284:                          ;
 6285:                          ; Where # can be ADD, SUBTRACT, MULTIPLY
 6286:                          ;
 6287:                          ; Note that the stack gets popped after 
 6288:                          ;
 6289:                          ; The FP_COMP instruction POPS the ARG_S
 6290:                          ;
 6291:                          ;***************************************
 6292:                          ;
 6293:                          ;***************************************
 6294:                          ;
 6295:                          ; STATUS ON RETURN - After performing an
 6296:                          ;		     the accumulator contains the fol
 6297:                          ;
 6298:                          ; ACCUMULATOR - BIT 0 - FLOATING POINT U
 6299:                          ;
 6300:                          ;	      - BIT 1 - FLOATING POINT OVERFLO
 6301:                          ;
 6302:                          ;	      - BIT 2 - RESULT WAS ZER0
 6303:                          ;
 6304:                          ;	      - BIT 3 - DIVIDE BY ZERO ATTEMPT
 6305:                          ;
 6306:                          ;	      - BIT 4 - NOT USED, 0 RETURNED
 6307:                          ;
 6308:                          ;	      - BIT 5 - NOT USED, 0 RETURNED
 6309:                          ;
 6310:                          ;	      - BIT 6 - NOT USED, 0 RETURNED
 6311:                          ;
 6312:                          ;	      - BIT 7 - NOT USED, 0 RETURNED
 6313:                          ;
 6314:                          ; NOTE: When underflow occures, a ZERO r
 6315:                          ;	When overflow or divide by zero occure
 6316:                          ;	.99999999 E+127 is returned and it is 
 6317:                          ;	to handle these conditions as needed i
 6318:                          ;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 115



 Line    I  Addr Code           Source

 6319:                          ; NOTE: The Compare instruction returns 
 6320:                          ;	and returns a CARRY FLAG = 1 if ARG 1 
 6321:                          ;
 6322:                          ;***************************************
 6323:                          ;
 6324:                          ;***************************************
 6325:                          ;
 6326:                          ; The following values MUST be provided 
 6327:                          ;
 6328:                          ;***************************************
 6329:                          ;
 6330:           N      0009    ARG_STACK	EQU	9	;ARGUMENT STACK POINTER
 6331:           N      0001    ARG_STACK_PAGE	EQU	1
 6332:                          ;OUTPUT 	 EQU	 1990H	 ;CALL LOCATION TO 
 6333:           N      0058    CONVERT 	EQU	58H	;LOCATION TO CONVERT NU
 6334:           B        19    INTGRC		BIT	25	;BIT SET IF INTGER ERROR
 6335:                          ;
 6336:                          ;***************************************
 6337:                          ;
 6338:                          ; The following equates are used interna
 6339:                          ;
 6340:                          ;***************************************
 6341:                          ;
 6342:           N      0006    FP_NUMBER_SIZE	EQU	6
 6343:           N      0000    UNDERFLOW	EQU	0
 6344:           N      0001    OVERFLOW	EQU	1
 6345:           N      0002    ZERO		EQU	2
 6346:           N      0003    ZERO_DIVIDE	EQU	3
 6347:                          ;
 6348:                          ;***************************************
 6349:                          ;
 6350:                          	;**************************************
 6351:                          	;
 6352:                          	; The following internal locations are 
 6353:                          	; ordering is important and the FP_DIGI
 6354:                          	; addressable
 6355:                          	;
 6356:                          	;**************************************
 6357:                          	;
 6358:           N      0028    FP_STATUS	EQU	28H		;NOT USED
 6359:           N      0029    FP_TEMP 	EQU	FP_STATUS+1	;NOT USED
 6360:           N      002A    FP_CARRY	EQU	FP_STATUS+2	;USED FOR BITS
 6361:           B        23    ADD_IN		BIT	35		;DCMPXZ IN BASIC BACKAGE
 6362:           B        50    XSIGN		BIT	FP_CARRY.0
 6363:           B        51    FOUND_RADIX	BIT	FP_CARRY.1
 6364:           B        52    FIRST_RADIX	BIT	FP_CARRY.2
 6365:           B        53    DONE_LOAD	BIT	FP_CARRY.3
 6366:           N      002B    FP_DIG12	EQU	FP_CARRY+1
 6367:           N      002C    FP_DIG34	EQU	FP_CARRY+2
 6368:           N      002D    FP_DIG56	EQU	FP_CARRY+3
 6369:           N      002E    FP_DIG78	EQU	FP_CARRY+4
 6370:           N      002F    FP_SIGN 	EQU	FP_CARRY+5
 6371:           B        78    MSIGN		BIT	FP_SIGN.0
 6372:           N      0030    FP_EXP		EQU	FP_CARRY+6
 6373:           N      002B    FP_NIB1 	EQU	FP_DIG12
 6374:           N      002C    FP_NIB2 	EQU	FP_NIB1+1

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 116



 Line    I  Addr Code           Source

 6375:           N      002D    FP_NIB3 	EQU	FP_NIB1+2
 6376:           N      002E    FP_NIB4 	EQU	FP_NIB1+3
 6377:           N      002F    FP_NIB5 	EQU	FP_NIB1+4
 6378:           N      0030    FP_NIB6 	EQU	FP_NIB1+5
 6379:           N      0031    FP_NIB7 	EQU	FP_NIB1+6
 6380:           N      0032    FP_NIB8 	EQU	FP_NIB1+7
 6381:           N      0033    FP_ACCX 	EQU	FP_NIB1+8
 6382:           N      0034    FP_ACCC 	EQU	FP_NIB1+9
 6383:           N      0035    FP_ACC1 	EQU	FP_NIB1+10
 6384:           N      0036    FP_ACC2 	EQU	FP_NIB1+11
 6385:           N      0037    FP_ACC3 	EQU	FP_NIB1+12
 6386:           N      0038    FP_ACC4 	EQU	FP_NIB1+13
 6387:           N      0039    FP_ACC5 	EQU	FP_NIB1+14
 6388:           N      003A    FP_ACC6 	EQU	FP_NIB1+15
 6389:           N      003B    FP_ACC7 	EQU	FP_NIB1+16
 6390:           N      003C    FP_ACC8 	EQU	FP_NIB1+17
 6391:           N      003D    FP_ACCS 	EQU	FP_NIB1+18
 6392:                          	;
 6393:                          ;	 ORG	 1990H
 6394:                          	;
 6395:                          OUTPUT:
 6396:      196C 02 07 11       T_L:	LJMP	TEROT
 6397:                          	;
 6398:                          	;
 6399:                          	;**************************************
 6400:                          	;
 6401:                          	; The floating point entry points and j
 6402:                          	;
 6403:                          	;**************************************
 6404:                          	;
 6405:      196F 21 93          FP_BASE:	AJMP	FLOATING_ADD
 6406:      1971 21 89          FP_BASE1:	AJMP	FLOATING_SUB
 6407:      1973 41 43          FP_BASE2:	AJMP	FLOATING_COMP
 6408:      1975 41 73          FP_BASE3:	AJMP	FLOATING_MUL
 6409:      1977 41 B0          FP_BASE4:	AJMP	FLOATING_DIV
 6410:      1979 81 89          FP_BASE5:	AJMP	HEXSCAN
 6411:      197B 81 C2          FP_BASE6:	AJMP	FLOATING_POINT_INPUT
 6412:      197D A1 7A          FP_BASE7:	AJMP	FLOATING_POINT_OUTPUT
 6413:      197F C1 F7          FP_BASE8:	AJMP	CONVERT_BINARY_TO_ASCII_S
 6414:      1981 C1 9E          FP_BASE9:	AJMP	CONVERT_ASCII_STRING_TO_B
 6415:      1983 C1 D3          FP_BASE10:	AJMP	MULNUM10
 6416:      1985 E1 30          FP_BASE11:	AJMP	HEXOUT
 6417:      1987 81 B6          FP_BASE12:	AJMP	PUSHR2R0
 6418:                          	;
 6419:                          	;
 6420:                          FLOATING_SUB:
 6421:                          	;
 6422:      1989 75 A0 01       	MOV	P2,#ARG_STACK_PAGE
 6423:      198C A8 09          	MOV	R0,ARG_STACK
 6424:      198E 18             	DEC	R0		;POINT TO SIGN
 6425:      198F E2             	MOVX	A,@R0		;READ SIGN
 6426:      1990 B2 E0          	CPL	ACC.0
 6427:      1992 F2             	MOVX	@R0,A
 6428:                          	;
 6429:                          	;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
 6430:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 117



 Line    I  Addr Code           Source

 6431:                          FLOATING_ADD:
 6432:                          	;
 6433:                          	;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
 6434:                          	;
 6435:                          	;
 6436:      1993 91 6A          	ACALL	MDES1		;R7=TOS EXP, R6=TOS-1 EXP,
 6437:                          				;R3=TOS-1 SIGN, OPERATION IS R1 # R0
 6438:                          	;
 6439:      1995 EF             	MOV	A,R7		;GET TOS EXPONENT
 6440:      1996 60 0D          	JZ	POP_AND_EXIT	;IF TOS=0 THEN POP AND 
 6441:      1998 BE 00 12       	CJNE	R6,#0,LOAD1	;CLEAR CARRY EXIT IF Z
 6442:                          	;
 6443:                          	;**************************************
 6444:                          	;
 6445:                          SWAP_AND_EXIT:	; Swap external args and 
 6446:                          	;
 6447:                          	;**************************************
 6448:                          	;
 6449:      199B 91 5E          	ACALL	LOAD_POINTERS
 6450:      199D 7F 06          	MOV	R7,#FP_NUMBER_SIZE
 6451:                          	;
 6452:      199F E2             SE1:	MOVX	A,@R0		;SWAP THE ARGUMENTS
 6453:      19A0 F3             	MOVX	@R1,A
 6454:      19A1 18             	DEC	R0
 6455:      19A2 19             	DEC	R1
 6456:      19A3 DF FA          	DJNZ	R7,SE1
 6457:                          	;
 6458:                          POP_AND_EXIT:
 6459:                          	;
 6460:      19A5 E5 09          	MOV	A,ARG_STACK	;POP THE STACK
 6461:      19A7 24 06          	ADD	A,#FP_NUMBER_SIZE
 6462:      19A9 F5 09          	MOV	ARG_STACK,A
 6463:      19AB E4             	CLR	A
 6464:      19AC 22             	RET
 6465:                          	;
 6466:                          	;
 6467:      19AD 9E             LOAD1:	SUBB	A,R6		;A = ARG 1 EXP - ARG 2
 6468:      19AE 8F 30          	MOV	FP_EXP,R7	;SAVE EXPONENT AND SIGN
 6469:      19B0 8C 2F          	MOV	FP_SIGN,R4
 6470:      19B2 50 09          	JNC	LOAD2		;ARG1 EXPONENT IS LARGER OR 
 6471:      19B4 8E 30          	MOV	FP_EXP,R6
 6472:      19B6 8B 2F          	MOV	FP_SIGN,R3
 6473:      19B8 F4             	CPL	A
 6474:      19B9 04             	INC	A		;COMPENSATE FOR EXP DELTA
 6475:      19BA C8             	XCH	A,R0		;FORCE R0 TO POINT AT THE LAR
 6476:      19BB C9             	XCH	A,R1		;EXPONENT
 6477:      19BC C8             	XCH	A,R0
 6478:                          	;
 6479:      19BD FF             LOAD2:	MOV	R7,A		;SAVE THE EXPONENT DELT
 6480:      19BE C2 23          	CLR	ADD_IN
 6481:      19C0 BD 00 02       	CJNE	R5,#0,LOAD21
 6482:      19C3 D2 23          	SETB	ADD_IN
 6483:                          	;
 6484:                          	; Load the R1 mantissa
 6485:                          	;
 6486:      19C5 91 7B          LOAD21: ACALL	LOADR1_MANTISSA ;LOAD THE 

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 118



 Line    I  Addr Code           Source

 6487:                          	;
 6488:                          	; Now align the number to the delta exp
 6489:                          	; R4 points to the string of the last d
 6490:                          	;
 6491:      19C7 BF 0B 00       	CJNE	R7,#DIGIT+DIGIT+3,LOAD22
 6492:      19CA 40 02          LOAD22: JC	LOAD23
 6493:      19CC 7F 0A          	MOV	R7,#DIGIT+DIGIT+2
 6494:                          	;
 6495:      19CE 75 2A 00       LOAD23: MOV	FP_CARRY,#00	;CLEAR THE CARR
 6496:      19D1 71 BB          	ACALL	RIGHT		;SHIFT THE NUMBER
 6497:                          	;
 6498:                          	; Set up for addition and subtraction
 6499:                          	;
 6500:      19D3 7F 04          	MOV	R7,#DIGIT	;LOOP COUNT
 6501:      19D5 79 2E          	MOV	R1,#FP_DIG78
 6502:                          ;
 6503:                          ;***************************************
 6504:                          ;****** Elektor 2 Patch ****************
 6505:                          ;****** Floting Point Error, found by D.
 6506:                          ;
 6507:                          ;	MOV	A,#9EH
 6508:                          ;****** Error Number 1
 6509:                          ;
 6510:                          ;****** Value in R4 must be complemented
 6511:                          ;****** first complement
 6512:                          ;
 6513:                          ;	CLR	C
 6514:                          ;	SUBB	A,R4
 6515:                          ;	DA	A
 6516:                          ;	XCH	A,R4
 6517:                          ;	JNZ	LOAD24
 6518:                          ;	MOV	R4,A
 6519:                          ;****** Error Number 2
 6520:                          ;
 6521:                          ;****** With substraction, after reducin
 6522:                          ;****** subtrahend to the same exponents
 6523:                          ;****** that one always has to make a bo
 6524:                          ;****** position of the minuend, not as 
 6525:                          ;****** were it is made only when R4 = 5
 6526:                          ;
 6527:                          ;LOAD24: CJNE	 A,#50H,LOAD25	 ;TEST FOR 
 6528:                          ;LOAD25: JNB	 ADD_IN,SUBLP	 ;DO SUBTRACT
 6529:                          ;
 6530:                          ;***************************************
 6531:                          ;****** Proper code starts here: *******
 6532:                          ;
 6533:      19D7 74 9A          	mov	A,#9AH
 6534:      19D9 C3             	clr	C
 6535:      19DA 9C             	subb	A,R4
 6536:      19DB D4             	da	A
 6537:      19DC CC             	xch	A,R4
 6538:      19DD 30 23 1B       	jnb	ADD_IN,SUBLP
 6539:      19E0 B4 50 00       	cjne	A,#50H,LOAD25
 6540:                          ;
 6541:                          ;****** continue with original code: ***
 6542:                          ;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 119



 Line    I  Addr Code           Source

 6543:      19E3 B3             LOAD25: CPL	C		;FLIP CARRY FOR ADDITION
 6544:      19E4 31 F2          	ACALL	ADDLP		;DO ADDITION
 6545:                          	;
 6546:      19E6 50 08          	JNC	ADD_R
 6547:      19E8 05 2A          	INC	FP_CARRY
 6548:      19EA 7F 01          	MOV	R7,#1
 6549:      19EC 71 BB          	ACALL	RIGHT
 6550:      19EE 71 72          	ACALL	INC_FP_EXP	;SHIFT AND BUMP EXPONE
 6551:                          	;
 6552:      19F0 61 63          ADD_R:	AJMP	STORE_ALIGN_TEST_AND_EXIT
 6553:                          	;
 6554:      19F2 E2             ADDLP:	MOVX	A,@R0
 6555:      19F3 37             	ADDC	A,@R1
 6556:      19F4 D4             	DA	A
 6557:      19F5 F7             	MOV	@R1,A
 6558:      19F6 18             	DEC	R0
 6559:      19F7 19             	DEC	R1
 6560:      19F8 DF F8          	DJNZ	R7,ADDLP	;LOOP UNTIL DONE
 6561:      19FA 22             	RET
 6562:                          	;
 6563:      19FB E2             SUBLP:	MOVX	A,@R0		;NOW DO SUBTRACTION
 6564:      19FC FE             	MOV	R6,A
 6565:      19FD E4             	CLR	A
 6566:      19FE 34 99          	ADDC	A,#99H
 6567:      1A00 97             	SUBB	A,@R1
 6568:      1A01 2E             	ADD	A,R6
 6569:      1A02 D4             	DA	A
 6570:      1A03 F7             	MOV	@R1,A
 6571:      1A04 18             	DEC	R0
 6572:      1A05 19             	DEC	R1
 6573:      1A06 DF F3          	DJNZ	R7,SUBLP
 6574:      1A08 40 11          	JC	FSUB6
 6575:                          	;
 6576:                          	; Need to complement the result and sig
 6577:                          	; point accumulator mantissa was larger
 6578:                          	; memory and their signs were equal.
 6579:                          	;
 6580:      1A0A B2 78          	CPL	FP_SIGN.0
 6581:      1A0C 79 2E          	MOV	R1,#FP_DIG78
 6582:      1A0E 7F 04          	MOV	R7,#DIGIT	;LOOP COUNT
 6583:                          	;
 6584:      1A10 74 9A          FSUB5:	MOV	A,#9AH
 6585:      1A12 97             	SUBB	A,@R1
 6586:      1A13 24 00          	ADD	A,#0
 6587:      1A15 D4             	DA	A
 6588:      1A16 F7             	MOV	@R1,A
 6589:      1A17 19             	DEC	R1
 6590:      1A18 B3             	CPL	C
 6591:      1A19 DF F5          	DJNZ	R7,FSUB5	;LOOP
 6592:                          	;
 6593:                          	; Now see how many zeros their are
 6594:                          	;
 6595:      1A1B 78 2B          FSUB6:	MOV	R0,#FP_DIG12
 6596:      1A1D 7F 00          	MOV	R7,#0
 6597:                          	;
 6598:      1A1F E6             FSUB7:	MOV	A,@R0

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 120



 Line    I  Addr Code           Source

 6599:      1A20 70 08          	JNZ	FSUB8
 6600:      1A22 0F             	INC	R7
 6601:      1A23 0F             	INC	R7
 6602:      1A24 08             	INC	R0
 6603:      1A25 B8 2F F7       	CJNE	R0,#FP_SIGN,FSUB7
 6604:      1A28 61 AB          	AJMP	ZERO_AND_EXIT
 6605:                          	;
 6606:      1A2A B4 10 00       FSUB8:	CJNE	A,#10H,FSUB81
 6607:      1A2D 50 01          FSUB81: JNC	FSUB9
 6608:      1A2F 0F             	INC	R7
 6609:                          	;
 6610:                          	; Now R7 has the number of leading zero
 6611:                          	;
 6612:      1A30 E5 30          FSUB9:	MOV	A,FP_EXP	;GET THE OLD EXPONEN
 6613:      1A32 C3             	CLR	C
 6614:      1A33 9F             	SUBB	A,R7		;SUBTRACT FROM THE NUMBER OF
 6615:      1A34 60 0B          	JZ	FSUB10
 6616:      1A36 40 09          	JC	FSUB10
 6617:                          	;
 6618:      1A38 F5 30          	MOV	FP_EXP,A	;SAVE THE NEW EXPONENT
 6619:                          	;
 6620:      1A3A 71 F5          	ACALL	LEFT1		;SHIFT THE FP ACC
 6621:      1A3C 75 2A 00       	MOV	FP_CARRY,#0
 6622:      1A3F 61 63          	AJMP	STORE_ALIGN_TEST_AND_EXIT
 6623:                          	;
 6624:      1A41 61 A5          FSUB10: AJMP	UNDERFLOW_AND_EXIT
 6625:                          	;
 6626:                          	;**************************************
 6627:                          	;
 6628:                          FLOATING_COMP:	; Compare two floating po
 6629:                          		; used for relational operations and i
 6630:                          		; than subtraction. ON RETURN, The car
 6631:                          		; if ARG1 is > ARG2, else carry is not
 6632:                          		; if ARG1 = ARG2, F0 gets set
 6633:                          	;
 6634:                          	;**************************************
 6635:                          	;
 6636:      1A43 91 6A          	ACALL	MDES1		;SET UP THE REGISTERS
 6637:      1A45 E5 09          	MOV	A,ARG_STACK
 6638:      1A47 24 0C          	ADD	A,#FP_NUMBER_SIZE+FP_NUMBER_SIZE
 6639:      1A49 F5 09          	MOV	ARG_STACK,A	;POP THE STACK TWICE, C
 6640:      1A4B EE             	MOV	A,R6		;CHECK OUT EXPONENTS
 6641:      1A4C C2 D5          	CLR	F0
 6642:      1A4E 9F             	SUBB	A,R7
 6643:      1A4F 60 0A          	JZ	EXPONENTS_EQUAL
 6644:      1A51 40 03          	JC	ARG1_EXP_IS_LARGER
 6645:                          	;
 6646:                          	; Now the ARG2 EXPONENT is > ARG1 EXPON
 6647:                          	;
 6648:                          SIGNS_DIFFERENT:
 6649:                          	;
 6650:      1A53 EB             	MOV	A,R3		;SEE IF SIGN OF ARG2 IS POSIT
 6651:      1A54 80 01          	SJMP	ARG1_EXP_IS_LARGER1
 6652:                          	;
 6653:                          ARG1_EXP_IS_LARGER:
 6654:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 121



 Line    I  Addr Code           Source

 6655:      1A56 EC             	MOV	A,R4		;GET THE SIGN OF ARG1 EXPONEN
 6656:                          ARG1_EXP_IS_LARGER1:
 6657:      1A57 60 01          	JZ	ARG1_EXP_IS_LARGER2
 6658:      1A59 B3             	CPL	C
 6659:                          ARG1_EXP_IS_LARGER2:
 6660:      1A5A 22             	RET
 6661:                          	;
 6662:                          EXPONENTS_EQUAL:
 6663:                          	;
 6664:                          	; First, test the sign, then the mantis
 6665:                          	;
 6666:      1A5B BD 00 F5       	CJNE	R5,#0,SIGNS_DIFFERENT
 6667:                          	;
 6668:                          BOTH_PLUS:
 6669:                          	;
 6670:      1A5E 7F 04          	MOV	R7,#DIGIT	;POINT AT MS DIGIT
 6671:      1A60 18             	DEC	R0
 6672:      1A61 18             	DEC	R0
 6673:      1A62 18             	DEC	R0
 6674:      1A63 19             	DEC	R1
 6675:      1A64 19             	DEC	R1
 6676:      1A65 19             	DEC	R1
 6677:                          	;
 6678:                          	; Now do the compare
 6679:                          	;
 6680:      1A66 E2             CLOOP:	MOVX	A,@R0
 6681:      1A67 FE             	MOV	R6,A
 6682:      1A68 E3             	MOVX	A,@R1
 6683:      1A69 9E             	SUBB	A,R6
 6684:      1A6A 70 EA          	JNZ	ARG1_EXP_IS_LARGER
 6685:      1A6C 08             	INC	R0
 6686:      1A6D 09             	INC	R1
 6687:      1A6E DF F6          	DJNZ	R7,CLOOP
 6688:                          	;
 6689:                          	; If here, the numbers are the same, th
 6690:                          	;
 6691:      1A70 D2 D5          	SETB	F0
 6692:      1A72 22             	RET			;EXIT WITH EQUAL
 6693:                          	;
 6694:                          ;MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
 6695:                          ;
 6696:                          FLOATING_MUL:	; Floating point multiply
 6697:                          ;
 6698:                          ;MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
 6699:                          ;
 6700:      1A73 91 68          	ACALL	MUL_DIV_EXP_AND_SIGN
 6701:                          	;
 6702:                          	; check for zero exponents
 6703:                          	;
 6704:      1A75 BE 00 02       	CJNE	R6,#00,FMUL1	;ARG 2 EXP ZERO?
 6705:      1A78 61 AB          FMUL0:	AJMP	ZERO_AND_EXIT
 6706:                          	;
 6707:                          	; calculate the exponent
 6708:                          	;
 6709:      1A7A 8D 2F          FMUL1:	MOV	FP_SIGN,R5	;SAVE THE SIGN, IN
 6710:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 122



 Line    I  Addr Code           Source

 6711:      1A7C EF             	MOV	A,R7
 6712:      1A7D 60 F9          	JZ	FMUL0
 6713:      1A7F 2E             	ADD	A,R6		;ADD THE EXPONENTS
 6714:      1A80 20 E7 05       	JB	ACC.7,FMUL_OVER
 6715:      1A83 10 D7 08       	JBC	CY,FMUL21	;SEE IF CARRY IS SET
 6716:                          	;
 6717:      1A86 61 A5          	AJMP	UNDERFLOW_AND_EXIT
 6718:                          	;
 6719:                          FMUL_OVER:
 6720:                          	;
 6721:      1A88 50 02          	JNC	FMUL2		;OK IF SET
 6722:                          	;
 6723:      1A8A 61 94          FOV:	AJMP	OVERFLOW_AND_EXIT
 6724:                          ;***************************************
 6725:                          ;****** Wulf 1 Bugfix 1 ****************
 6726:                          ;****** Multiplication Error, found by D
 6727:                          ;
 6728:                          ; FMUL2: SUBB	 A,#129 	 ;SUBTRACT THE EX
 6729:                          ;
 6730:                          ;***************************************
 6731:                          ;****** Proper code starts here: *******
 6732:                          ;
 6733:      1A8C D2 28          FMUL2:	setb	mul_underflow	;Flag of multi
 6734:      1A8E 94 83          FMUL21: subb	A,#83H		;exp. multipl. resu
 6735:      1A90 04             	inc	A		;Correct SUBB 83H
 6736:      1A91 04             	inc	A		;to original SUBB 81H
 6737:      1A92 40 02          	jc     NMARK_L		;Limit case
 6738:      1A94 C2 28          	clr	mul_underflow	;No limit case
 6739:                          NMARK_L:
 6740:                          ;
 6741:                          ;****** continue with original code: ***
 6742:                          ;
 6743:      1A96 FE             	MOV	R6,A		;SAVE IT FOR LATER
 6744:                          	;
 6745:                          	; Unpack and load R0
 6746:                          	;
 6747:      1A97 71 7E          	ACALL	UNPACK_R0
 6748:                          	;
 6749:                          	; Now set up for loop multiply
 6750:                          	;
 6751:      1A99 7B 04          	MOV	R3,#DIGIT
 6752:      1A9B AC 01          	MOV	R4,R1B0
 6753:                          	;
 6754:                          	; Now, do the multiply and accumulate t
 6755:                          	;
 6756:      1A9D 8C 01          FMUL3:	MOV	R1B0,R4
 6757:      1A9F E3             	MOVX	A,@R1
 6758:      1AA0 FA             	MOV	R2,A
 6759:      1AA1 91 2B          	ACALL	MUL_NIBBLE
 6760:                          	;
 6761:      1AA3 EA             	MOV	A,R2
 6762:      1AA4 C4             	SWAP	A
 6763:      1AA5 91 2B          	ACALL	MUL_NIBBLE
 6764:      1AA7 1C             	DEC	R4
 6765:      1AA8 DB F3          	DJNZ	R3,FMUL3
 6766:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 123



 Line    I  Addr Code           Source

 6767:                          	; Now, pack and restore the sign
 6768:                          	;
 6769:      1AAA 8E 30          	MOV	FP_EXP,R6
 6770:      1AAC 8D 2F          	MOV	FP_SIGN,R5
 6771:      1AAE 61 11          	AJMP	PACK		;FINISH IT OFF
 6772:                          	;
 6773:                          	;DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD
 6774:                          	;
 6775:                          FLOATING_DIV:
 6776:                          	;
 6777:                          	;DDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDD
 6778:                          	;
 6779:      1AB0 91 6A          	ACALL	MDES1
 6780:                          	;
 6781:                          	; Check the exponents
 6782:                          	;
 6783:      1AB2 8D 2F          	MOV	FP_SIGN,R5	;SAVE THE SIGN
 6784:      1AB4 BF 00 06       	CJNE	R7,#0,DIV0	;CLEARS THE CARRY
 6785:      1AB7 71 94          	ACALL	OVERFLOW_AND_EXIT
 6786:      1AB9 E4             	CLR	A
 6787:      1ABA D2 E3          	SETB	ACC.ZERO_DIVIDE
 6788:      1ABC 22             	RET
 6789:                          	;
 6790:      1ABD EE             DIV0:	MOV	A,R6		;GET EXPONENT
 6791:      1ABE 60 B8          	JZ	FMUL0		;EXIT IF ZERO
 6792:      1AC0 9F             	SUBB	A,R7		;DELTA EXPONENT
 6793:      1AC1 20 E7 04       	JB	ACC.7,D_UNDER
 6794:      1AC4 50 04          	JNC	DIV3
 6795:      1AC6 61 A5          	AJMP	UNDERFLOW_AND_EXIT
 6796:                          	;
 6797:      1AC8 50 C0          D_UNDER:JNC	FOV
 6798:                          	;
 6799:      1ACA 24 81          DIV3:	ADD	A,#129		;CORRECTLY BIAS THE EX
 6800:      1ACC F5 30          	MOV	FP_EXP,A	;SAVE THE EXPONENT
 6801:      1ACE 91 7B          	ACALL	LOADR1_MANTISSA ;LOAD THE DIVIDED
 6802:                          	;
 6803:      1AD0 7A 34          	MOV	R2,#FP_ACCC	;SAVE LOCATION
 6804:      1AD2 AB 00          	MOV	R3,R0B0 	;SAVE POINTER IN R3
 6805:      1AD4 75 2A 00       	MOV	FP_CARRY,#0	;ZERO CARRY BYTE
 6806:                          	;
 6807:      1AD7 7D FF          DIV4:	MOV	R5,#0FFH	;LOOP COUNT
 6808:      1AD9 D3             	SETB	C
 6809:                          	;
 6810:      1ADA 8B 00          DIV5:	MOV	R0B0,R3 	;RESTORE THE EXTERNAL
 6811:      1ADC 79 2E          	MOV	R1,#FP_DIG78	;SET UP INTERNAL POINT
 6812:      1ADE 7F 04          	MOV	R7,#DIGIT	;LOOP COUNT
 6813:      1AE0 50 17          	JNC	DIV7		;EXIT IF NO CARRY
 6814:                          	;
 6815:      1AE2 E2             DIV6:	MOVX	A,@R0		;DO ACCUMLATION
 6816:      1AE3 FE             	MOV	R6,A
 6817:      1AE4 E4             	CLR	A
 6818:      1AE5 34 99          	ADDC	A,#99H
 6819:      1AE7 9E             	SUBB	A,R6
 6820:      1AE8 27             	ADD	A,@R1
 6821:      1AE9 D4             	DA	A
 6822:      1AEA F7             	MOV	@R1,A

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 124



 Line    I  Addr Code           Source

 6823:      1AEB 18             	DEC	R0
 6824:      1AEC 19             	DEC	R1
 6825:      1AED DF F3          	DJNZ	R7,DIV6 	;LOOP
 6826:                          	;
 6827:      1AEF 0D             	INC	R5		;SUBTRACT COUNTER
 6828:      1AF0 40 E8          	JC	DIV5		;KEEP LOOPING IF CARRY
 6829:      1AF2 E7             	MOV	A,@R1		;GET CARRY
 6830:      1AF3 94 01          	SUBB	A,#1		;CARRY IS CLEARED
 6831:      1AF5 F7             	MOV	@R1,A		;SAVE CARRY DIGIT
 6832:      1AF6 B3             	CPL	C
 6833:      1AF7 80 E1          	SJMP	DIV5		;LOOP
 6834:                          	;
 6835:                          	; Restore the result if carry was found
 6836:                          	;
 6837:      1AF9 31 F2          DIV7:	ACALL	ADDLP		;ADD NUMBER BACK
 6838:      1AFB 77 00          	MOV	@R1,#0		;CLEAR CARRY
 6839:      1AFD 8A 00          	MOV	R0B0,R2 	;GET SAVE COUNTER
 6840:      1AFF A6 05          	MOV	@R0,5		;SAVE COUNT BYTE
 6841:                          	;
 6842:      1B01 0A             	INC	R2		;ADJUST SAVE COUNTER
 6843:      1B02 7F 01          	MOV	R7,#1		;BUMP DIVIDEND
 6844:      1B04 71 F3          	ACALL	LEFT
 6845:      1B06 BA 3E CE       	CJNE	R2,#FP_ACC8+2,DIV4
 6846:                          	;
 6847:      1B09 D5 30 02       	DJNZ	FP_EXP,DIV8
 6848:      1B0C 61 A5          	AJMP	UNDERFLOW_AND_EXIT
 6849:                          	;
 6850:      1B0E 75 2A 00       DIV8:	MOV	FP_CARRY,#0
 6851:                          	;
 6852:                          	;**************************************
 6853:                          	;
 6854:                          PACK:	; Pack the mantissa
 6855:                          	;
 6856:                          	;**************************************
 6857:                          	;
 6858:                          	; First, set up the pointers
 6859:                          	;
 6860:      1B11 78 34          	MOV	R0,#FP_ACCC
 6861:      1B13 E6             	MOV	A,@R0		;GET FP_ACCC
 6862:      1B14 FE             	MOV	R6,A		;SAVE FOR ZERO COUNT
 6863:      1B15 60 03          	JZ	PACK0		;JUMP OVER IF ZERO
 6864:      1B17 71 72          	ACALL	INC_FP_EXP	;BUMP THE EXPONENT
 6865:      1B19 18             	DEC	R0
 6866:                          	;
 6867:      1B1A 08             PACK0:	INC	R0		;POINT AT FP_ACC1
 6868:                          	;
 6869:      1B1B 74 08          PACK1:	MOV	A,#8		;ADJUST NIBBLE POINTER
 6870:      1B1D F9             	MOV	R1,A
 6871:      1B1E 28             	ADD	A,R0
 6872:      1B1F F8             	MOV	R0,A
 6873:      1B20 B6 05 00       	CJNE	@R0,#5,PACK11	;SEE IF ADJUSTING NE
 6874:      1B23 40 13          PACK11: JC	PACK31
 6875:                          	;
 6876:      1B25 D3             PACK2:	SETB	C
 6877:      1B26 E4             	CLR	A
 6878:      1B27 18             	DEC	R0

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 125



 Line    I  Addr Code           Source

 6879:      1B28 36             	ADDC	A,@R0
 6880:      1B29 D4             	DA	A
 6881:      1B2A D6             	XCHD	A,@R0		;SAVE THE VALUE
 6882:      1B2B 30 E4 09       	JNB	ACC.4,PACK3
 6883:      1B2E D9 F5          	DJNZ	R1,PACK2
 6884:                          	;
 6885:      1B30 18             	DEC	R0
 6886:      1B31 76 01          	MOV	@R0,#1
 6887:      1B33 71 72          	ACALL	INC_FP_EXP
 6888:      1B35 80 18          	SJMP	PACK4
 6889:                          	;
 6890:      1B37 19             PACK3:	DEC	R1
 6891:      1B38 E9             PACK31: MOV	A,R1
 6892:      1B39 C3             	CLR	C
 6893:      1B3A C8             	XCH	A,R0
 6894:      1B3B 98             	SUBB	A,R0
 6895:      1B3C F8             	MOV	R0,A
 6896:                          ;
 6897:                          ;***************************************
 6898:                          ;****** Wulf 1 Bugfix 2 ****************
 6899:                          ;****** Multiplication Error, found by D
 6900:                          ;
 6901:      1B3D 30 28 0F       	jnb	mul_underflow,PACK4
 6902:      1B40 C2 28          	clr	mul_underflow
 6903:      1B42 E5 30          	mov	A,FP_EXP	;test of exceeding in limi
 6904:      1B44 60 07          	jz	UNDER_MD	;message about underflow
 6905:      1B46 F4             	cpl	a		;test of exceeding in limit case
 6906:      1B47 60 04          	jz	UNDER_MD	;message about underflow
 6907:      1B49 F4             	cpl	a		;restore original exp
 6908:      1B4A B4 01 02       	cjne	a,#1,pack4	;jump if not outer limi
 6909:                          UNDER_MD:
 6910:      1B4D 61 A5          	ajmp	UNDERFLOW_AND_EXIT
 6911:                          ;
 6912:                          ;****** continue with original code: ***
 6913:                          ;
 6914:      1B4F 79 2B          PACK4:	MOV	R1,#FP_DIG12
 6915:                          	;
 6916:                          	; Now, pack
 6917:                          	;
 6918:      1B51 E6             PLOOP:	MOV	A,@R0
 6919:      1B52 C4             	SWAP	A		;FLIP THE DIGITS
 6920:      1B53 08             	INC	R0
 6921:      1B54 D6             	XCHD	A,@R0
 6922:      1B55 42 06          	ORL	6,A		;ACCUMULATE THE OR'ED DIGITS
 6923:      1B57 F7             	MOV	@R1,A
 6924:      1B58 08             	INC	R0
 6925:      1B59 09             	INC	R1
 6926:      1B5A B9 2F F4       	CJNE	R1,#FP_SIGN,PLOOP
 6927:      1B5D EE             	MOV	A,R6
 6928:      1B5E 70 03          	JNZ	STORE_ALIGN_TEST_AND_EXIT
 6929:      1B60 75 30 00       	MOV	FP_EXP,#0	;ZERO EXPONENT
 6930:                          	;
 6931:                          	;**************************************
 6932:                          	;
 6933:                          STORE_ALIGN_TEST_AND_EXIT:	;Save the num
 6934:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 126



 Line    I  Addr Code           Source

 6935:                          	;**************************************
 6936:                          	;
 6937:      1B63 91 5E          	ACALL	LOAD_POINTERS
 6938:      1B65 89 09          	MOV	ARG_STACK,R1	;SET UP THE NEW STACK
 6939:      1B67 78 30          	MOV	R0,#FP_EXP
 6940:                          	;
 6941:                          	; Now load the numbers
 6942:                          	;
 6943:      1B69 E6             STORE2: MOV	A,@R0
 6944:      1B6A F3             	MOVX	@R1,A		;SAVE THE NUMBER
 6945:      1B6B 18             	DEC	R0
 6946:      1B6C 19             	DEC	R1
 6947:      1B6D B8 2A F9       	CJNE	R0,#FP_CARRY,STORE2
 6948:                          	;
 6949:      1B70 E4             	CLR	A		;NO ERRORS
 6950:                          	;
 6951:      1B71 22             PRET:	RET			;EXIT
 6952:                          	;
 6953:                          INC_FP_EXP:
 6954:                          	;
 6955:      1B72 05 30          	INC	FP_EXP
 6956:      1B74 E5 30          	MOV	A,FP_EXP
 6957:      1B76 70 F9          	JNZ	PRET		;EXIT IF NOT ZERO
 6958:      1B78 D0 E0          	POP	ACC		;WASTE THE CALLING STACK
 6959:      1B7A D0 E0          	POP	ACC
 6960:      1B7C 61 94          	AJMP	OVERFLOW_AND_EXIT
 6961:                          ;
 6962:                          ;***************************************
 6963:                          ;
 6964:                          UNPACK_R0:	; Unpack BCD digits and load 
 6965:                          ;
 6966:                          ;***************************************
 6967:                          	;
 6968:      1B7E C0 01          	PUSH	R1B0
 6969:      1B80 79 32          	MOV	R1,#FP_NIB8
 6970:                          	;
 6971:      1B82 E2             ULOOP:	MOVX	A,@R0
 6972:      1B83 54 0F          	ANL	A,#0FH
 6973:      1B85 F7             	MOV	@R1,A		;SAVE THE NIBBLE
 6974:      1B86 E2             	MOVX	A,@R0
 6975:      1B87 C4             	SWAP	A
 6976:      1B88 54 0F          	ANL	A,#0FH
 6977:      1B8A 19             	DEC	R1
 6978:      1B8B F7             	MOV	@R1,A		;SAVE THE NIBBLE AGAIN
 6979:      1B8C 18             	DEC	R0
 6980:      1B8D 19             	DEC	R1
 6981:      1B8E B9 2A F1       	CJNE	R1,#FP_NIB1-1,ULOOP
 6982:                          	;
 6983:      1B91 D0 01          	POP	R1B0
 6984:                          	;
 6985:      1B93 22             LOAD7:	RET
 6986:                          	;
 6987:                          	;**************************************
 6988:                          	;
 6989:                          OVERFLOW_AND_EXIT:	;LOAD 99999999 E+127,
 6990:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 127



 Line    I  Addr Code           Source

 6991:                          	;**************************************
 6992:                          	;
 6993:      1B94 78 2E          	MOV	R0,#FP_DIG78
 6994:      1B96 74 99          	MOV	A,#99H
 6995:                          	;
 6996:      1B98 F6             OVE1:	MOV	@R0,A
 6997:      1B99 18             	DEC	R0
 6998:      1B9A B8 2A FB       	CJNE	R0,#FP_CARRY,OVE1
 6999:                          	;
 7000:      1B9D 75 30 FF       	MOV	FP_EXP,#0FFH
 7001:      1BA0 71 63          	ACALL	STORE_ALIGN_TEST_AND_EXIT
 7002:                          	;
 7003:      1BA2 D2 E1          	SETB	ACC.OVERFLOW
 7004:      1BA4 22             	RET
 7005:                          	;
 7006:                          	;**************************************
 7007:                          	;
 7008:                          UNDERFLOW_AND_EXIT:	;LOAD 0, SET UF BIT,
 7009:                          	;
 7010:                          	;**************************************
 7011:                          	;
 7012:      1BA5 71 AB          	ACALL	ZERO_AND_EXIT
 7013:      1BA7 E4             	CLR	A
 7014:      1BA8 D2 E0          	SETB	ACC.UNDERFLOW
 7015:      1BAA 22             	RET
 7016:                          	;
 7017:                          	;**************************************
 7018:                          	;
 7019:                          ZERO_AND_EXIT:		;LOAD 0, SET ZERO BIT, A
 7020:                          	;
 7021:                          	;**************************************
 7022:                          	;
 7023:      1BAB 71 B2          	ACALL	FP_CLEAR
 7024:      1BAD 71 63          	ACALL	STORE_ALIGN_TEST_AND_EXIT
 7025:      1BAF D2 E2          	SETB	ACC.ZERO
 7026:      1BB1 22             	RET			;EXIT
 7027:                          	;
 7028:                          	;**************************************
 7029:                          	;
 7030:                          FP_CLEAR:
 7031:                          	;
 7032:                          	; Clear internal storage
 7033:                          	;
 7034:                          	;**************************************
 7035:                          	;
 7036:      1BB2 E4             	CLR	A
 7037:      1BB3 78 3D          	MOV	R0,#FP_ACC8+1
 7038:                          	;
 7039:      1BB5 F6             FPC1:	MOV	@R0,A
 7040:      1BB6 18             	DEC	R0
 7041:      1BB7 B8 29 FB       	CJNE	R0,#FP_TEMP,FPC1
 7042:      1BBA 22             	RET
 7043:                          	;
 7044:                          	;**************************************
 7045:                          	;
 7046:                          RIGHT:	; Shift ACCUMULATOR RIGHT the num

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 128



 Line    I  Addr Code           Source

 7047:                          	; Save the shifted values in R4 if SAVE
 7048:                          	;
 7049:                          	;**************************************
 7050:                          	;
 7051:      1BBB 7C 00          	MOV	R4,#0		;IN CASE OF NO SHIFT
 7052:                          	;
 7053:      1BBD C3             RIGHT1: CLR	C
 7054:      1BBE EF             RIGHT2: MOV	A,R7		;GET THE DIGITS TO SHI
 7055:      1BBF 60 22          	JZ	RIGHTL1 	;EXIT IF ZERO
 7056:      1BC1 94 02          	SUBB	A,#2		;TWO TO DO?
 7057:      1BC3 50 1F          	JNC	RIGHT5		;SHIFT TWO NIBBLES
 7058:                          	;
 7059:                          	; Swap one nibble then exit
 7060:                          	;
 7061:      1BC5 C0 00          RIGHT3: PUSH	R0B0		;SAVE POINTER REGISTE
 7062:      1BC7 C0 01          	PUSH	R1B0
 7063:                          	;
 7064:      1BC9 79 2E          	MOV	R1,#FP_DIG78	;LOAD THE POINTERS
 7065:      1BCB 78 2D          	MOV	R0,#FP_DIG56
 7066:      1BCD EC             	MOV	A,R4		;GET THE OVERFLOW REGISTER
 7067:      1BCE D7             	XCHD	A,@R1		;GET DIGIT 8
 7068:      1BCF C4             	SWAP	A		;FLIP FOR LOAD
 7069:      1BD0 FC             	MOV	R4,A
 7070:                          	;
 7071:      1BD1 E7             RIGHTL: MOV	A,@R1		;GET THE LOW ORDER BY
 7072:      1BD2 D6             	XCHD	A,@R0		;SWAP NIBBLES
 7073:      1BD3 C4             	SWAP	A		;FLIP FOR STORE
 7074:      1BD4 F7             	MOV	@R1,A		;SAVE THE DIGITS
 7075:      1BD5 18             	DEC	R0		;BUMP THE POINTERS
 7076:      1BD6 19             	DEC	R1
 7077:      1BD7 B9 2A F7       	CJNE	R1,#FP_DIG12-1,RIGHTL	;LOOP
 7078:                          	;
 7079:      1BDA E7             	MOV	A,@R1		;ACC = CH8
 7080:      1BDB C4             	SWAP	A		;ACC = 8CH
 7081:      1BDC 54 0F          	ANL	A,#0FH		;ACC = 0CH
 7082:      1BDE F7             	MOV	@R1,A		;CARRY DONE
 7083:      1BDF D0 01          	POP	R1B0		;EXIT
 7084:      1BE1 D0 00          	POP	R0B0		;RESTORE REGISTER
 7085:      1BE3 22             RIGHTL1:RET
 7086:                          	;
 7087:      1BE4 FF             RIGHT5: MOV	R7,A		;SAVE THE NEW SHIFT NU
 7088:      1BE5 E4             	CLR	A
 7089:      1BE6 C5 2A          	XCH	A,FP_CARRY	;SWAP THE NIBBLES
 7090:      1BE8 C5 2B          	XCH	A,FP_DIG12
 7091:      1BEA C5 2C          	XCH	A,FP_DIG34
 7092:      1BEC C5 2D          	XCH	A,FP_DIG56
 7093:      1BEE C5 2E          	XCH	A,FP_DIG78
 7094:      1BF0 FC             	MOV	R4,A		;SAVE THE LAST DIGIT SHIFTED
 7095:      1BF1 80 CB          	SJMP	RIGHT2
 7096:                          	;
 7097:                          	;**************************************
 7098:                          	;
 7099:                          LEFT:	; Shift ACCUMULATOR LEFT the numbe
 7100:                          	;
 7101:                          	;**************************************
 7102:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 129



 Line    I  Addr Code           Source

 7103:      1BF3 7C 00          	MOV	R4,#00H 	;CLEAR FOR SOME ENTRYS
 7104:                          	;
 7105:      1BF5 C3             LEFT1:	CLR	C
 7106:      1BF6 EF             LEFT2:	MOV	A,R7		;GET SHIFT VALUE
 7107:      1BF7 60 22          	JZ	LEFTL1		;EXIT IF ZERO
 7108:      1BF9 94 02          	SUBB	A,#2		;SEE HOW MANY BYTES TO SHIFT
 7109:      1BFB 50 1F          	JNC	LEFT5
 7110:                          	;
 7111:      1BFD C0 00          LEFT3:	PUSH	R0B0		;SAVE POINTER
 7112:      1BFF C0 01          	PUSH	R1B0
 7113:      1C01 78 2A          	MOV	R0,#FP_CARRY
 7114:      1C03 79 2B          	MOV	R1,#FP_DIG12
 7115:                          	;
 7116:      1C05 E6             	MOV	A,@R0		;ACC=CHCL
 7117:      1C06 C4             	SWAP	A		;ACC = CLCH
 7118:      1C07 F6             	MOV	@R0,A		;ACC = CLCH, @R0 = CLCH
 7119:                          	;
 7120:      1C08 E7             LEFTL:	MOV	A,@R1		;DIG 12
 7121:      1C09 C4             	SWAP	A		;DIG 21
 7122:      1C0A D6             	XCHD	A,@R0
 7123:      1C0B F7             	MOV	@R1,A		;SAVE IT
 7124:      1C0C 08             	INC	R0		;BUMP POINTERS
 7125:      1C0D 09             	INC	R1
 7126:      1C0E B8 2E F7       	CJNE	R0,#FP_DIG78,LEFTL
 7127:                          	;
 7128:      1C11 EC             	MOV	A,R4
 7129:      1C12 C4             	SWAP	A
 7130:      1C13 D6             	XCHD	A,@R0
 7131:      1C14 54 F0          	ANL	A,#0F0H
 7132:      1C16 FC             	MOV	R4,A
 7133:                          	;
 7134:      1C17 D0 01          	POP	R1B0
 7135:      1C19 D0 00          	POP	R0B0		;RESTORE
 7136:      1C1B 22             LEFTL1: RET			;DONE
 7137:                          	;
 7138:      1C1C FF             LEFT5:	MOV	R7,A		;RESTORE COUNT
 7139:      1C1D E4             	CLR	A
 7140:      1C1E CC             	XCH	A,R4		;GET THE RESTORATION BYTE
 7141:      1C1F C5 2E          	XCH	A,FP_DIG78	;DO THE SWAP
 7142:      1C21 C5 2D          	XCH	A,FP_DIG56
 7143:      1C23 C5 2C          	XCH	A,FP_DIG34
 7144:      1C25 C5 2B          	XCH	A,FP_DIG12
 7145:      1C27 C5 2A          	XCH	A,FP_CARRY
 7146:      1C29 80 CB          	SJMP	LEFT2
 7147:                          	;
 7148:                          MUL_NIBBLE:
 7149:                          	;
 7150:                          	; Multiply the nibble in R7 by the FP_N
 7151:                          	; accumulate the product in FP_ACC
 7152:                          	;
 7153:                          	; Set up the pointers for multiplicatio
 7154:                          	;
 7155:      1C2B 54 0F          	ANL	A,#0FH		;STRIP OFF MS NIBBLE
 7156:      1C2D FF             	MOV	R7,A
 7157:      1C2E 78 3C          	MOV	R0,#FP_ACC8
 7158:      1C30 79 32          	MOV	R1,#FP_NIB8

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 130



 Line    I  Addr Code           Source

 7159:      1C32 E4             	CLR	A
 7160:      1C33 F5 33          	MOV	FP_ACCX,A
 7161:                          	;
 7162:      1C35 18             MNLOOP: DEC	R0		;BUMP POINTER TO PROPAGA
 7163:      1C36 26             	ADD	A,@R0		;ATTEMPT TO FORCE CARRY
 7164:      1C37 D4             	DA	A		;BCD ADJUST
 7165:      1C38 30 E4 03       	JNB	ACC.4,MNL0	;DON'T ADJUST IF NO NEED
 7166:      1C3B 18             	DEC	R0		;PROPAGATE CARRY TO THE NEXT DI
 7167:      1C3C 06             	INC	@R0		;DO THE ADJUSTING
 7168:      1C3D 08             	INC	R0		;RESTORE R0
 7169:                          	;
 7170:      1C3E D6             MNL0:	XCHD	A,@R0		;RESTORE INITIAL NUMBE
 7171:      1C3F 8F F0          	MOV	B,R7		;GET THE NUBBLE TO MULTIPLY
 7172:      1C41 E7             	MOV	A,@R1		;GET THE OTHER NIBBLE
 7173:      1C42 A4             	MUL	AB		;DO THE MULTIPLY
 7174:      1C43 75 F0 0A       	MOV	B,#10		;NOW BCD ADJUST
 7175:      1C46 84             	DIV	AB
 7176:      1C47 C5 F0          	XCH	A,B		;GET THE REMAINDER
 7177:      1C49 26             	ADD	A,@R0		;PROPAGATE THE PARTIAL PRODU
 7178:      1C4A D4             	DA	A		;BCD ADJUST
 7179:      1C4B 30 E4 02       	JNB	ACC.4,MNL1	;PROPAGATE PARTIAL PRODU
 7180:      1C4E 05 F0          	INC	B
 7181:                          	;
 7182:      1C50 08             MNL1:	INC	R0
 7183:      1C51 D6             	XCHD	A,@R0		;SAVE THE NEW PRODUCT
 7184:      1C52 18             	DEC	R0
 7185:      1C53 E5 F0          	MOV	A,B		;GET BACK THE QUOTIENT
 7186:      1C55 19             	DEC	R1
 7187:      1C56 B9 2A DC       	CJNE	R1,#FP_NIB1-1,MNLOOP
 7188:                          	;
 7189:      1C59 25 33          	ADD	A,FP_ACCX	;GET THE OVERFLOW
 7190:      1C5B D4             	DA	A		;ADJUST
 7191:      1C5C F6             	MOV	@R0,A		;SAVE IT
 7192:      1C5D 22             	RET			;EXIT
 7193:                          	;
 7194:                          	;**************************************
 7195:                          	;
 7196:                          LOAD_POINTERS:	; Load the ARG_STACK into
 7197:                          	;
 7198:                          	;**************************************
 7199:                          	;
 7200:      1C5E 75 A0 01       	MOV	P2,#ARG_STACK_PAGE
 7201:      1C61 A8 09          	MOV	R0,ARG_STACK
 7202:      1C63 74 06          	MOV	A,#FP_NUMBER_SIZE
 7203:      1C65 28             	ADD	A,R0
 7204:      1C66 F9             	MOV	R1,A
 7205:      1C67 22             	RET
 7206:                          	;
 7207:                          	;**************************************
 7208:                          	;
 7209:                          MUL_DIV_EXP_AND_SIGN:
 7210:                          	;
 7211:                          	; Load the sign into R7, R6. R5 gets th
 7212:                          	; multiply and divide.
 7213:                          	;
 7214:                          	;**************************************

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 131



 Line    I  Addr Code           Source

 7215:                          	;
 7216:      1C68 71 B2          	ACALL	FP_CLEAR	;CLEAR INTERNAL MEMORY
 7217:                          	;
 7218:      1C6A 91 5E          MDES1:	ACALL	LOAD_POINTERS	;LOAD REGISTE
 7219:      1C6C E2             	MOVX	A,@R0		;ARG 1 EXP
 7220:      1C6D FF             	MOV	R7,A		;SAVED IN R7
 7221:      1C6E E3             	MOVX	A,@R1		;ARG 2 EXP
 7222:      1C6F FE             	MOV	R6,A		;SAVED IN R6
 7223:      1C70 18             	DEC	R0		;BUMP POINTERS TO SIGN
 7224:      1C71 19             	DEC	R1
 7225:      1C72 E2             	MOVX	A,@R0		;GET THE SIGN
 7226:      1C73 FC             	MOV	R4,A		;SIGN OF ARG1
 7227:      1C74 E3             	MOVX	A,@R1		;GET SIGN OF NEXT ARG
 7228:      1C75 FB             	MOV	R3,A		;SIGN OF ARG2
 7229:      1C76 6C             	XRL	A,R4		;ACC GETS THE NEW SIGN
 7230:      1C77 FD             	MOV	R5,A		;R5 GETS THE NEW SIGN
 7231:                          	;
 7232:                          	; Bump the pointers to point at the LS 
 7233:                          	;
 7234:      1C78 18             	DEC	R0
 7235:      1C79 19             	DEC	R1
 7236:                          	;
 7237:      1C7A 22             	RET
 7238:                          	;
 7239:                          	;**************************************
 7240:                          	;
 7241:                          LOADR1_MANTISSA:
 7242:                          	;
 7243:                          	; Load the mantissa of R0 into FP_Digit
 7244:                          	;
 7245:                          	;**************************************
 7246:                          	;
 7247:      1C7B C0 00          	PUSH	R0B0		;SAVE REGISTER 1
 7248:      1C7D 78 2E          	MOV	R0,#FP_DIG78	;SET UP THE POINTER
 7249:                          	;
 7250:      1C7F E3             LOADR1: MOVX	A,@R1
 7251:      1C80 F6             	MOV	@R0,A
 7252:      1C81 19             	DEC	R1
 7253:      1C82 18             	DEC	R0
 7254:      1C83 B8 2A F9       	CJNE	R0,#FP_CARRY,LOADR1
 7255:                          	;
 7256:      1C86 D0 00          	POP	R0B0
 7257:      1C88 22             	RET
 7258:                          	;
 7259:                          	;**************************************
 7260:                          	;
 7261:                          HEXSCAN:	; Scan a string to determine if
 7262:                          		; set carry if hex, else carry = 0
 7263:                          	;
 7264:                          	;**************************************
 7265:                          	;
 7266:      1C89 B1 5F          	ACALL	GET_DPTR_CHARACTER
 7267:      1C8B C0 83          	PUSH	DPH
 7268:      1C8D C0 82          	PUSH	DPL		;SAVE THE POINTER
 7269:                          	;
 7270:      1C8F E0             HEXSC1: MOVX	A,@DPTR 	;GET THE CHARACTER

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 132



 Line    I  Addr Code           Source

 7271:      1C90 F1 ED          	ACALL	DIGIT_CHECK	;SEE IF A DIGIT
 7272:      1C92 40 12          	JC	HS1		;CONTINUE IF A DIGIT
 7273:      1C94 91 A9          	ACALL	HEX_CHECK	;SEE IF HEX
 7274:      1C96 40 0E          	JC	HS1
 7275:                          	;
 7276:      1C98 C2 E5          	CLR	ACC.5		;NO LOWER CASE
 7277:      1C9A B4 48 03       	CJNE	A,#'H',HEXDON
 7278:      1C9D D3             	SETB	C
 7279:      1C9E 80 01          	SJMP	HEXDO1		;NUMBER IS VALID HEX, MAYB
 7280:                          	;
 7281:      1CA0 C3             HEXDON: CLR	C
 7282:                          	;
 7283:      1CA1 D0 82          HEXDO1: POP	DPL		;RESTORE POINTER
 7284:      1CA3 D0 83          	POP	DPH
 7285:      1CA5 22             	RET
 7286:                          	;
 7287:      1CA6 A3             HS1:	INC	DPTR		;BUMP TO NEXT CHARACTER
 7288:      1CA7 80 E6          	SJMP	HEXSC1		;LOOP
 7289:                          	;
 7290:                          HEX_CHECK:	;CHECK FOR A VALID ASCII HEX,
 7291:                          	;
 7292:      1CA9 C2 E5          	CLR	ACC.5		;WASTE LOWER CASE
 7293:      1CAB B4 47 00       	CJNE	A,#'F'+1,HEX_CHECK1     ;SEE IF F 
 7294:                          HEX_CHECK1:
 7295:      1CAE 40 01          	JC	HC1
 7296:      1CB0 22             	RET
 7297:                          	;
 7298:      1CB1 B4 41 00       HC1:	CJNE	A,#'A',HC11     ;SEE IF A OR G
 7299:      1CB4 B3             HC11:	CPL	C
 7300:      1CB5 22             	RET
 7301:                          	;
 7302:                          PUSHR2R0:
 7303:                          	;
 7304:      1CB6 7B 00          	MOV	R3,#HIGH CONVERT;CONVERSION LOCATIO
 7305:      1CB8 79 58          	MOV	R1,#LOW CONVERT
 7306:      1CBA D1 F7          	ACALL	CONVERT_BINARY_TO_ASCII_STRING
 7307:      1CBC 74 0D          	MOV	A,#0DH		;A CR TO TERMINATE
 7308:      1CBE F3             	MOVX	@R1,A		;SAVE THE CR
 7309:      1CBF 90 00 58       	MOV	DPTR,#CONVERT
 7310:                          	;
 7311:                          	; Falls thru to FLOATING INPUT
 7312:                          	;
 7313:                          	;**************************************
 7314:                          	;
 7315:                          FLOATING_POINT_INPUT:	; Input a floating
 7316:                          			; the DPTR
 7317:                          	;
 7318:                          	;**************************************
 7319:                          	;
 7320:      1CC2 71 B2          	ACALL	FP_CLEAR	;CLEAR EVERYTHING
 7321:      1CC4 B1 5F          	ACALL	GET_DPTR_CHARACTER
 7322:      1CC6 B1 65          	ACALL	PLUS_MINUS_TEST
 7323:      1CC8 92 78          	MOV	MSIGN,C 	;SAVE THE MANTISSA SIGN
 7324:                          	;
 7325:                          	; Now, set up for input loop
 7326:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 133



 Line    I  Addr Code           Source

 7327:      1CCA 78 34          	MOV	R0,#FP_ACCC
 7328:      1CCC 7E 7F          	MOV	R6,#7FH 	;BASE EXPONENT
 7329:      1CCE D2 D5          	SETB	F0		;SET INITIAL FLAG
 7330:                          	;
 7331:      1CD0 F1 EB          INLOOP: ACALL	GET_DIGIT_CHECK
 7332:      1CD2 50 07          	JNC	GTEST		;IF NOT A CHARACTER, WHAT IS
 7333:      1CD4 54 0F          	ANL	A,#0FH		;STRIP ASCII
 7334:      1CD6 B1 38          	ACALL	STDIG		;STORE THE DIGITS
 7335:                          	;
 7336:      1CD8 A3             INLPIK: INC	DPTR		;BUMP POINTER FOR LOOP
 7337:      1CD9 80 F5          	SJMP	INLOOP		;LOOP FOR INPUT
 7338:                          	;
 7339:      1CDB B4 2E 0C       GTEST:	CJNE	A,#'.',GT1      ;SEE IF A RA
 7340:      1CDE 20 51 63       	JB	FOUND_RADIX,INERR
 7341:      1CE1 D2 51          	SETB	FOUND_RADIX
 7342:      1CE3 B8 34 F2       	CJNE	R0,#FP_ACCC,INLPIK
 7343:      1CE6 D2 52          	SETB	FIRST_RADIX	;SET IF FIRST RADIX
 7344:      1CE8 80 EE          	SJMP	INLPIK		;GET ADDITIONAL DIGITS
 7345:                          	;
 7346:      1CEA 20 D5 57       GT1:	JB	F0,INERR	;ERROR IF NOT CLEARED
 7347:      1CED B4 65 02       	CJNE	A,#'e',GT11     ;CHECK FOR LOWER C
 7348:      1CF0 80 03          	SJMP	GT12
 7349:      1CF2 B4 45 33       GT11:	CJNE	A,#'E',FINISH_UP
 7350:      1CF5 B1 5E          GT12:	ACALL	INC_AND_GET_DPTR_CHARACTER
 7351:      1CF7 B1 65          	ACALL	PLUS_MINUS_TEST
 7352:      1CF9 92 50          	MOV	XSIGN,C 	;SAVE SIGN STATUS
 7353:      1CFB F1 EB          	ACALL	GET_DIGIT_CHECK
 7354:      1CFD 50 45          	JNC	INERR
 7355:                          	;
 7356:      1CFF 54 0F          	ANL	A,#0FH		;STRIP ASCII BIAS OFF THE C
 7357:      1D01 FD             	MOV	R5,A		;SAVE THE CHARACTER IN R5
 7358:                          	;
 7359:      1D02 A3             GT2:	INC	DPTR
 7360:      1D03 F1 EB          	ACALL	GET_DIGIT_CHECK
 7361:      1D05 50 0D          	JNC	FINISH1
 7362:      1D07 54 0F          	ANL	A,#0FH		;STRIP OFF BIAS
 7363:      1D09 CD             	XCH	A,R5		;GET THE LAST DIGIT
 7364:      1D0A 75 F0 0A       	MOV	B,#10		;MULTIPLY BY TEN
 7365:      1D0D A4             	MUL	AB
 7366:      1D0E 2D             	ADD	A,R5		;ADD TO ORIGINAL VALUE
 7367:      1D0F FD             	MOV	R5,A		;SAVE IN R5
 7368:      1D10 50 F0          	JNC	GT2		;LOOP IF NO CARRY
 7369:      1D12 7D FF          	MOV	R5,#0FFH	;FORCE AN ERROR
 7370:                          	;
 7371:      1D14 ED             FINISH1:MOV	A,R5		;GET THE SIGN
 7372:      1D15 30 50 09       	JNB	XSIGN,POSNUM	;SEE IF EXPONENT IS PO
 7373:      1D18 C3             	CLR	C
 7374:      1D19 9E             	SUBB	A,R6
 7375:      1D1A F4             	CPL	A
 7376:      1D1B 04             	INC	A
 7377:      1D1C 40 09          	JC	FINISH2
 7378:      1D1E 74 01          	MOV	A,#01H
 7379:      1D20 22             	RET
 7380:                          	;
 7381:      1D21 2E             POSNUM: ADD	A,R6		;ADD TO EXPONENT
 7382:      1D22 50 03          	JNC	FINISH2

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 134



 Line    I  Addr Code           Source

 7383:                          	;
 7384:      1D24 74 02          POSNM1: MOV	A,#02H
 7385:      1D26 22             	RET
 7386:                          	;
 7387:      1D27 CE             FINISH2:XCH	A,R6		;SAVE THE EXPONENT
 7388:                          	;
 7389:                          FINISH_UP:
 7390:                          	;
 7391:      1D28 8E 30          	MOV	FP_EXP,R6	;SAVE EXPONENT
 7392:      1D2A B8 34 02       	CJNE	R0,#FP_ACCC,FINISH_UP1
 7393:      1D2D 71 B2          	ACALL	FP_CLEAR	;CLEAR THE MEMORY IF 0
 7394:                          FINISH_UP1:
 7395:      1D2F E5 09          	MOV	A,ARG_STACK	;GET THE ARG STACK
 7396:      1D31 C3             	CLR	C
 7397:      1D32 94 0C          	SUBB	A,#FP_NUMBER_SIZE+FP_NUMBER_SIZE
 7398:      1D34 F5 09          	MOV	ARG_STACK,A	;ADJUST FOR STORE
 7399:      1D36 61 11          	AJMP	PACK
 7400:                          	;
 7401:      1D38 C2 D5          STDIG:	CLR	F0		;CLEAR INITIAL DESIGNATOR
 7402:      1D3A 70 0B          	JNZ	STDIG1		;CONTINUE IF NOT ZERO
 7403:      1D3C B8 34 08       	CJNE	R0,#FP_ACCC,STDIG1
 7404:      1D3F 30 52 04       	JNB	FIRST_RADIX,RET_X
 7405:                          	;
 7406:      1D42 DE 02          DECX:	DJNZ	R6,RET_X
 7407:                          	;
 7408:      1D44 74 FF          INERR:	MOV	A,#0FFH
 7409:                          	;
 7410:      1D46 22             RET_X:	RET
 7411:                          	;
 7412:      1D47 20 53 02       STDIG1: JB	DONE_LOAD,FRTEST
 7413:      1D4A C2 52          	CLR	FIRST_RADIX
 7414:                          	;
 7415:      1D4C 20 52 F3       FRTEST: JB	FIRST_RADIX,DECX
 7416:                          	;
 7417:      1D4F 20 51 01       FDTEST: JB	FOUND_RADIX,FDT1
 7418:      1D52 0E             	INC	R6
 7419:                          	;
 7420:      1D53 20 53 F0       FDT1:	JB	DONE_LOAD,RET_X
 7421:      1D56 B8 3D 02       	CJNE	R0,#FP_ACC8+1,FDT2
 7422:      1D59 D2 53          	SETB	DONE_LOAD
 7423:                          	;
 7424:      1D5B F6             FDT2:	MOV	@R0,A		;SAVE THE STRIPPED ACCU
 7425:      1D5C 08             	INC	R0		;BUMP THE POINTER
 7426:      1D5D 22             	RET			;EXIT
 7427:                          	;
 7428:                          	;**************************************
 7429:                          	;
 7430:                          	; I/O utilities
 7431:                          	;
 7432:                          	;**************************************
 7433:                          	;
 7434:                          INC_AND_GET_DPTR_CHARACTER:
 7435:                          	;
 7436:      1D5E A3             	INC	DPTR
 7437:                          	;
 7438:                          GET_DPTR_CHARACTER:

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 135



 Line    I  Addr Code           Source

 7439:                          	;
 7440:      1D5F E0             	MOVX	A,@DPTR 	;GET THE CHARACTER
 7441:      1D60 B4 20 16       	CJNE	A,#' ',PMT1     ;SEE IF A SPACE
 7442:                          	;
 7443:                          	; Kill spaces
 7444:                          	;
 7445:      1D63 80 F9          	SJMP	INC_AND_GET_DPTR_CHARACTER
 7446:                          	;
 7447:                          PLUS_MINUS_TEST:
 7448:                          	;
 7449:      1D65 B4 E3 02       	CJNE	A,#0E3H,PMT11	;SEE IF A PLUS, PLUS
 7450:      1D68 80 0E          	SJMP	PMT3
 7451:      1D6A B4 2B 02       PMT11:	CJNE	A,#'+',PMT12
 7452:      1D6D 80 09          	SJMP	PMT3
 7453:      1D6F B4 E5 02       PMT12:	CJNE	A,#0E5H,PMT13	;SEE IF MINUS,
 7454:      1D72 80 03          	SJMP	PMT2
 7455:      1D74 B4 2D 02       PMT13:	CJNE	A,#'-',PMT1
 7456:                          	;
 7457:      1D77 D3             PMT2:	SETB	C
 7458:                          	;
 7459:      1D78 A3             PMT3:	INC	DPTR
 7460:                          	;
 7461:      1D79 22             PMT1:	RET
 7462:                          	;
 7463:                          	;**************************************
 7464:                          	;
 7465:                          FLOATING_POINT_OUTPUT:	; Output the numb
 7466:                          	;
 7467:                          	; IF FORMAT = 00 - FREE FLOATING
 7468:                          	;	    = FX - EXPONENTIAL (X IS THE NUMB
 7469:                          	;	    = NX - N = NUM BEFORE RADIX, X = 
 7470:                          	;		   N + X = 8 MAX
 7471:                          	;
 7472:                          	;**************************************
 7473:                          	;
 7474:      1D7A 91 6A          	ACALL	MDES1		;GET THE NUMBER TO OUTPUT,
 7475:      1D7C 31 A5          	ACALL	POP_AND_EXIT	;OUTPUT POPS THE STA
 7476:      1D7E EF             	MOV	A,R7
 7477:      1D7F FE             	MOV	R6,A		;PUT THE EXPONENT IN R6
 7478:      1D80 71 7E          	ACALL	UNPACK_R0	;UNPACK THE NUMBER
 7479:      1D82 78 2B          	MOV	R0,#FP_NIB1	;POINT AT THE NUMBER
 7480:      1D84 E5 17          	MOV	A,FORMAT	;GET THE FORMAT
 7481:      1D86 FB             	MOV	R3,A		;SAVE IN CASE OF EXP FORMAT
 7482:      1D87 60 49          	JZ	FREE		;FREE FLOATING?
 7483:      1D89 B4 F0 00       	CJNE	A,#0F0H,FPO1	;SEE IF EXPONENTIAL
 7484:      1D8C 50 73          FPO1:	JNC	EXPOUT
 7485:                          	;
 7486:                          	; If here, must be integer USING format
 7487:                          	;
 7488:      1D8E EE             	MOV	A,R6		;GET THE EXPONENT
 7489:      1D8F 70 02          	JNZ	FPO2
 7490:      1D91 7E 80          	MOV	R6,#80H
 7491:      1D93 EB             FPO2:	MOV	A,R3		;GET THE FORMAT
 7492:      1D94 C4             	SWAP	A		;SPLIT INTEGER AND FRACTION
 7493:      1D95 54 0F          	ANL	A,#0FH
 7494:      1D97 FA             	MOV	R2,A		;SAVE INTEGER

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 136



 Line    I  Addr Code           Source

 7495:      1D98 D1 67          	ACALL	NUM_LT		;GET THE NUMBER OF INTEGE
 7496:      1D9A CA             	XCH	A,R2		;FLIP FOR SUBB
 7497:      1D9B C3             	CLR	C
 7498:      1D9C 9A             	SUBB	A,R2
 7499:      1D9D FF             	MOV	R7,A
 7500:      1D9E 50 06          	JNC	FPO3
 7501:      1DA0 7D 3F          	MOV	R5,#'?'         ;OUTPUT A QUESTION 
 7502:      1DA2 D1 9C          	ACALL	SOUT1		;NUMBER IS TOO LARGE FOR F
 7503:      1DA4 A1 D2          	AJMP	FREE
 7504:      1DA6 BA 00 07       FPO3:	CJNE	R2,#00,USING0	;SEE IF ZERO
 7505:      1DA9 1F             	DEC	R7
 7506:      1DAA D1 89          	ACALL	SS7
 7507:      1DAC D1 96          	ACALL	ZOUT		;OUTPUT A ZERO
 7508:      1DAE 80 06          	SJMP	USING1
 7509:                          	;
 7510:      1DB0 D1 89          USING0: ACALL	SS7		;OUTPUT SPACES, IF NE
 7511:      1DB2 EA             	MOV	A,R2		;OUTPUT DIGITS
 7512:      1DB3 FF             	MOV	R7,A
 7513:      1DB4 D1 4B          	ACALL	OUTR0
 7514:                          	;
 7515:      1DB6 EB             USING1: MOV	A,R3
 7516:      1DB7 54 0F          	ANL	A,#0FH		;GET THE NUMBER RIGHT OF DP
 7517:      1DB9 FA             	MOV	R2,A		;SAVE IT
 7518:      1DBA 60 BD          	JZ	PMT1		;EXIT IF ZERO
 7519:      1DBC D1 92          	ACALL	ROUT		;OUTPUT DP
 7520:      1DBE D1 70          	ACALL	NUM_RT
 7521:      1DC0 B5 02 03       	CJNE	A,2,USINGX	;COMPARE A TO R2
 7522:                          	;
 7523:      1DC3 EA             USINGY: MOV	A,R2
 7524:      1DC4 C1 80          	AJMP	Z7R7
 7525:                          	;
 7526:      1DC6 50 FB          USINGX: JNC	USINGY
 7527:                          	;
 7528:      1DC8 CA             USING2: XCH	A,R2
 7529:      1DC9 C3             	CLR	C
 7530:      1DCA 9A             	SUBB	A,R2
 7531:      1DCB CA             	XCH	A,R2
 7532:      1DCC D1 80          	ACALL	Z7R7		;OUTPUT ZEROS IF NEED TO
 7533:      1DCE EA             	MOV	A,R2
 7534:      1DCF FF             	MOV	R7,A
 7535:      1DD0 C1 4B          	AJMP	OUTR0
 7536:                          	;
 7537:                          	; First, force exponential output, if n
 7538:                          	;
 7539:      1DD2 EE             FREE:	MOV	A,R6		;GET THE EXPONENT
 7540:      1DD3 70 04          	JNZ	FREE1		;IF ZERO, PRINT IT
 7541:      1DD5 D1 9A          	ACALL	SOUT
 7542:      1DD7 C1 96          	AJMP	ZOUT
 7543:                          	;
 7544:      1DD9 7B F0          FREE1:	MOV	R3,#0F0H	;IN CASE EXP NEEDED
 7545:      1DDB 74 77          	MOV	A,#80H-DIGIT-DIGIT-1
 7546:      1DDD 2E             	ADD	A,R6
 7547:      1DDE 40 21          	JC	EXPOUT
 7548:      1DE0 94 F7          	SUBB	A,#0F7H
 7549:      1DE2 40 1D          	JC	EXPOUT
 7550:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 137



 Line    I  Addr Code           Source

 7551:                          	; Now, just print the number
 7552:                          	;
 7553:      1DE4 D1 8B          	ACALL	SINOUT		;PRINT THE SIGN OF THE NU
 7554:      1DE6 D1 67          	ACALL	NUM_LT		;GET THE NUMBER LEFT OF D
 7555:      1DE8 B4 08 02       	CJNE	A,#8,FREE4
 7556:      1DEB C1 4B          	AJMP	OUTR0
 7557:                          	;
 7558:      1DED D1 4B          FREE4:	ACALL	OUTR0
 7559:      1DEF D1 5D          	ACALL	ZTEST		;TEST FOR TRAILING ZEROS
 7560:      1DF1 60 57          	JZ	U_RET		;DONE IF ALL TRAILING ZEROS
 7561:      1DF3 D1 92          	ACALL	ROUT		;OUTPUT RADIX
 7562:                          	;
 7563:      1DF5 7F 01          FREE2:	MOV	R7,#1		;OUTPUT ONE DIGIT
 7564:      1DF7 D1 4B          	ACALL	OUTR0
 7565:      1DF9 70 4F          	JNZ	U_RET
 7566:      1DFB D1 5D          	ACALL	ZTEST
 7567:      1DFD 60 4B          	JZ	U_RET
 7568:      1DFF 80 F4          	SJMP	FREE2		;LOOP
 7569:                          	;
 7570:      1E01 D1 8B          EXPOUT: ACALL	SINOUT		;PRINT THE SIGN
 7571:      1E03 7F 01          	MOV	R7,#1		;OUTPUT ONE CHARACTER
 7572:      1E05 D1 4B          	ACALL	OUTR0
 7573:      1E07 D1 92          	ACALL	ROUT		;OUTPUT RADIX
 7574:      1E09 EB             	MOV	A,R3		;GET FORMAT
 7575:      1E0A 54 0F          	ANL	A,#0FH		;STRIP INDICATOR
 7576:      1E0C 60 06          	JZ	EXPOTX
 7577:                          	;
 7578:      1E0E FF             	MOV	R7,A		;OUTPUT THE NUMBER OF DIGITS
 7579:      1E0F 1F             	DEC	R7		;ADJUST BECAUSE ONE CHAR ALREAD
 7580:      1E10 D1 4B          	ACALL	OUTR0
 7581:      1E12 80 02          	SJMP	EXPOT4
 7582:                          	;
 7583:      1E14 B1 F5          EXPOTX: ACALL	FREE2		;OUTPUT UNTIL TRAIL
 7584:                          	;
 7585:      1E16 D1 9A          EXPOT4: ACALL	SOUT		;OUTPUT A SPACE
 7586:      1E18 7D 45          	MOV	R5,#'E'
 7587:      1E1A D1 9C          	ACALL	SOUT1		;OUTPUT AN E
 7588:      1E1C EE             	MOV	A,R6		;GET THE EXPONENT
 7589:      1E1D 60 04          	JZ	XOUT0		;EXIT IF ZERO
 7590:      1E1F 14             	DEC	A		;ADJUST FOR THE DIGIT ALREADY OU
 7591:      1E20 B4 80 05       	CJNE	A,#80H,XOUT2	;SEE WHAT IT IS
 7592:                          	;
 7593:      1E23 D1 9A          XOUT0:	ACALL	SOUT
 7594:      1E25 E4             	CLR	A
 7595:      1E26 80 0C          	SJMP	XOUT4
 7596:                          	;
 7597:      1E28 40 06          XOUT2:	JC	XOUT3		;NEGATIVE EXPONENT
 7598:      1E2A 7D 2B          	MOV	R5,#'+'         ;OUTPUT A PLUS SIGN
 7599:      1E2C D1 9C          	ACALL	SOUT1
 7600:      1E2E 80 04          	SJMP	XOUT4
 7601:                          	;
 7602:      1E30 D1 8E          XOUT3:	ACALL	MOUT
 7603:      1E32 F4             	CPL	A		;FLIP BITS
 7604:      1E33 04             	INC	A		;BUMP
 7605:                          	;
 7606:      1E34 C2 E7          XOUT4:	CLR	ACC.7

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 138



 Line    I  Addr Code           Source

 7607:      1E36 F8             	MOV	R0,A
 7608:      1E37 7A 00          	MOV	R2,#0
 7609:      1E39 79 58          	MOV	R1,#LOW CONVERT ;CONVERSION LOCATIO
 7610:      1E3B 7B 00          	MOV	R3,#HIGH CONVERT
 7611:      1E3D D1 F7          	ACALL	CONVERT_BINARY_TO_ASCII_STRING
 7612:      1E3F 78 58          	MOV	R0,#LOW CONVERT ;NOW, OUTPUT EXPONE
 7613:                          	;
 7614:      1E41 E2             EXPOT5: MOVX	A,@R0		;GET THE CHARACTER
 7615:      1E42 FD             	MOV	R5,A		;OUTPUT IT
 7616:      1E43 D1 9C          	ACALL	SOUT1
 7617:      1E45 08             	INC	R0		;BUMP THE POINTER
 7618:      1E46 E8             	MOV	A,R0		;GET THE POINTER
 7619:      1E47 B5 01 F7       	CJNE	A,R1B0,EXPOT5	;LOOP
 7620:                          	;
 7621:      1E4A 22             U_RET:	RET			;EXIT
 7622:                          	;
 7623:                          OUTR0:	; Output the characters pointed t
 7624:                          	;
 7625:      1E4B EF             	MOV	A,R7		;GET THE COUNTER
 7626:      1E4C 60 0E          	JZ	OUTR		;EXIT IF DONE
 7627:      1E4E E6             	MOV	A,@R0		;GET THE NUMBER
 7628:      1E4F 44 30          	ORL	A,#30H		;ASCII BIAS
 7629:      1E51 08             	INC	R0		;BUMP POINTER AND COUNTER
 7630:      1E52 1F             	DEC	R7
 7631:      1E53 FD             	MOV	R5,A		;PUT CHARACTER IN OUTPUT REGI
 7632:      1E54 D1 9C          	ACALL	SOUT1		;OUTPUT THE CHARACTER
 7633:      1E56 E4             	CLR	A		;JUST FOR TEST
 7634:      1E57 B8 33 F1       	CJNE	R0,#FP_NIB8+1,OUTR0
 7635:      1E5A 74 55          	MOV	A,#55H		;KNOW WHERE EXIT OCCURED
 7636:                          	;
 7637:      1E5C 22             OUTR:	RET
 7638:                          	;
 7639:      1E5D A9 00          ZTEST:	MOV	R1,R0B0 	;GET POINTER REGISTE
 7640:                          	;
 7641:      1E5F E7             ZT0:	MOV	A,@R1		;GET THE VALUE
 7642:      1E60 70 04          	JNZ	ZT1
 7643:      1E62 09             	INC	R1		;BUMP POINTER
 7644:      1E63 B9 33 F9       	CJNE	R1,#FP_NIB8+1,ZT0
 7645:                          	;
 7646:      1E66 22             ZT1:	RET
 7647:                          	;
 7648:      1E67 EE             NUM_LT: MOV	A,R6		;GET EXPONENT
 7649:      1E68 C3             	CLR	C		;GET READY FOR SUBB
 7650:      1E69 94 80          	SUBB	A,#80H		;SUB EXPONENT BIAS
 7651:      1E6B 50 01          	JNC	NL1		;OK IF NO CARRY
 7652:      1E6D E4             	CLR	A		;NO DIGITS LEFT
 7653:                          	;
 7654:      1E6E FF             NL1:	MOV	R7,A		;SAVE THE COUNT
 7655:      1E6F 22             	RET
 7656:                          	;
 7657:      1E70 C3             NUM_RT: CLR	C		;SUBB AGAIN
 7658:      1E71 74 80          	MOV	A,#80H		;EXPONENT BIAS
 7659:      1E73 9E             	SUBB	A,R6		;GET THE BIASED EXPONENT
 7660:      1E74 50 01          	JNC	NR1
 7661:      1E76 E4             	CLR	A
 7662:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 139



 Line    I  Addr Code           Source

 7663:      1E77 22             NR1:	RET			;EXIT
 7664:                          	;
 7665:      1E78 EF             SPACE7: MOV	A,R7		;GET THE NUMBER OF SPA
 7666:      1E79 60 FC          	JZ	NR1		;EXIT IF ZERO
 7667:      1E7B D1 9A          	ACALL	SOUT		;OUTPUT A SPACE
 7668:      1E7D 1F             	DEC	R7		;BUMP COUNTER
 7669:      1E7E 80 F8          	SJMP	SPACE7		;LOOP
 7670:                          	;
 7671:      1E80 FF             Z7R7:	MOV	R7,A
 7672:                          	;
 7673:      1E81 EF             ZERO7:	MOV	A,R7		;GET COUNTER
 7674:      1E82 60 F3          	JZ	NR1		;EXIT IF ZERO
 7675:      1E84 D1 96          	ACALL	ZOUT		;OUTPUT A ZERO
 7676:      1E86 1F             	DEC	R7		;BUMP COUNTER
 7677:      1E87 80 F8          	SJMP	ZERO7		;LOOP
 7678:                          	;
 7679:      1E89 D1 78          SS7:	ACALL	SPACE7
 7680:                          	;
 7681:      1E8B EC             SINOUT: MOV	A,R4		;GET THE SIGN
 7682:      1E8C 60 0C          	JZ	SOUT		;OUTPUT A SPACE IF ZERO
 7683:                          	;
 7684:      1E8E 7D 2D          MOUT:	MOV	R5,#'-'
 7685:      1E90 80 0A          	SJMP	SOUT1		;OUTPUT A MINUS IF NOT
 7686:                          	;
 7687:      1E92 7D 2E          ROUT:	MOV	R5,#'.'         ;OUTPUT A RADI
 7688:      1E94 80 06          	SJMP	SOUT1
 7689:                          	;
 7690:      1E96 7D 30          ZOUT:	MOV	R5,#'0'         ;OUTPUT A ZERO
 7691:      1E98 80 02          	SJMP	SOUT1
 7692:                          	;
 7693:      1E9A 7D 20          SOUT:	MOV	R5,#' '         ;OUTPUT A SPAC
 7694:                          	;
 7695:      1E9C 21 6C          SOUT1:	AJMP	OUTPUT
 7696:                          	;
 7697:                          	;**************************************
 7698:                          	;
 7699:                          CONVERT_ASCII_STRING_TO_BINARY:
 7700:                          	;
 7701:                          	;DPTR POINTS TO ASCII STRING
 7702:                          	;PUT THE BINARY NUMBER IN R2:R0, ERROR 
 7703:                          	;
 7704:                          	;**************************************
 7705:                          	;
 7706:      1E9E 91 89          CASB:	ACALL	HEXSCAN 	;SEE IF HEX NUMBER
 7707:      1EA0 92 23          	MOV	ADD_IN,C	;IF ADD_IN IS SET, THE NUM
 7708:      1EA2 F1 EB          	ACALL	GET_DIGIT_CHECK
 7709:      1EA4 B3             	CPL	C		;FLIP FOR EXIT
 7710:      1EA5 40 28          	JC	RCASB
 7711:      1EA7 7B 00          	MOV	R3,#00H 	;ZERO R3:R1 FOR LOOP
 7712:      1EA9 79 00          	MOV	R1,#00H
 7713:      1EAB 80 15          	SJMP	CASB5
 7714:                          	;
 7715:      1EAD A3             CASB2:	INC	DPTR
 7716:      1EAE 89 00          	MOV	R0B0,R1 	;SAVE THE PRESENT CONVERTE
 7717:      1EB0 8B 02          	MOV	R2B0,R3 	;IN R2:R0
 7718:      1EB2 F1 EB          	ACALL	GET_DIGIT_CHECK

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 140



 Line    I  Addr Code           Source

 7719:      1EB4 40 0C          	JC	CASB5
 7720:      1EB6 30 23 16       	JNB	ADD_IN,RCASB	;CONVERSION COMPLETE
 7721:      1EB9 91 A9          	ACALL	HEX_CHECK	;SEE IF HEX NUMBER
 7722:      1EBB 40 03          	JC	CASB4		;PROCEED IF GOOD
 7723:      1EBD A3             	INC	DPTR		;BUMP PAST H
 7724:      1EBE 80 0F          	SJMP	RCASB
 7725:                          	;
 7726:      1EC0 24 09          CASB4:	ADD	A,#9		;ADJUST HEX ASCII BIAS
 7727:                          	;
 7728:      1EC2 75 F0 0A       CASB5:	MOV	B,#10
 7729:      1EC5 30 23 03       	JNB	ADD_IN,CASB6
 7730:      1EC8 75 F0 10       	MOV	B,#16		;HEX MODE
 7731:                          	;
 7732:      1ECB D1 D6          CASB6:	ACALL	MULNUM		;ACCUMULATE THE DIG
 7733:      1ECD 50 DE          	JNC	CASB2		;LOOP IF NO CARRY
 7734:                          	;
 7735:      1ECF E4             RCASB:	CLR	A		;RESET ACC
 7736:      1ED0 92 E1          	MOV	ACC.OVERFLOW,C	;IF OVERFLOW, SAY SO
 7737:      1ED2 22             	RET			;EXIT
 7738:                          	;
 7739:      1ED3 75 F0 0A       MULNUM10:MOV	B,#10
 7740:                          	;
 7741:                          	;**************************************
 7742:                          	;
 7743:                          MULNUM: ; Take the next digit in the acc
 7744:                          	; accumulate in R3:R1
 7745:                          	;
 7746:                          	;**************************************
 7747:                          	;
 7748:      1ED6 C0 E0          	PUSH	ACC		;SAVE ACC
 7749:      1ED8 C0 F0          	PUSH	B		;SAVE MULTIPLIER
 7750:      1EDA E9             	MOV	A,R1		;PUT LOW ORDER BITS IN ACC
 7751:      1EDB A4             	MUL	AB		;DO THE MULTIPLY
 7752:      1EDC F9             	MOV	R1,A		;PUT THE RESULT BACK
 7753:      1EDD EB             	MOV	A,R3		;GET THE HIGH ORDER BYTE
 7754:      1EDE AB F0          	MOV	R3,B		;SAVE THE OVERFLOW
 7755:      1EE0 D0 F0          	POP	B		;GET THE MULTIPLIER
 7756:      1EE2 A4             	MUL	AB		;DO IT
 7757:      1EE3 A2 D2          	MOV	C,OV		;SAVE OVERFLOW IN F0
 7758:      1EE5 92 D5          	MOV	F0,C
 7759:      1EE7 2B             	ADD	A,R3		;ADD OVERFLOW TO HIGH RESULT
 7760:      1EE8 FB             	MOV	R3,A		;PUT IT BACK
 7761:      1EE9 D0 E0          	POP	ACC		;GET THE ORIGINAL ACC BACK
 7762:      1EEB 72 D5          	ORL	C,F0		;OR CARRY AND OVERFLOW
 7763:      1EED 40 07          	JC	MULX		;NO GOOD IF THE CARRY IS SET
 7764:                          	;
 7765:      1EEF 54 0F          MUL11:	ANL	A,#0FH		;MASK OFF HIGH ORDER 
 7766:      1EF1 29             	ADD	A,R1		;NOW ADD THE ACC
 7767:      1EF2 F9             	MOV	R1,A		;PUT IT BACK
 7768:      1EF3 E4             	CLR	A		;PROPAGATE THE CARRY
 7769:      1EF4 3B             	ADDC	A,R3
 7770:      1EF5 FB             	MOV	R3,A		;PUT IT BACK
 7771:                          	;
 7772:      1EF6 22             MULX:	RET			;EXIT WITH OR WITHOUT CARRY
 7773:                          	;
 7774:                          CONVERT_BINARY_TO_ASCII_STRING:

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 141



 Line    I  Addr Code           Source

 7775:                          ;
 7776:                          ;***************************************
 7777:                          ;****** Elektor 3 Patch ****************
 7778:                          ;****** Performance improvements *******
 7779:                          ;
 7780:                          ;
 7781:                          ;R3:R1 contains the address of the strin
 7782:                          ;R2:R0 contains the value to convert
 7783:                          ;DPTR, R7, R6, and ACC gets clobbered
 7784:                          ;
 7785:                          ;***************************************
 7786:                          ;
 7787:                          ;	CLR	A		;NO LEADING ZEROS
 7788:                          ;	MOV	DPTR,#10000	;SUBTRACT 10000
 7789:                          ;	ACALL	RSUB		;DO THE SUBTRACTION
 7790:                          ;	MOV	DPTR,#1000	;NOW 1000
 7791:                          ;	ACALL	RSUB
 7792:                          ;	MOV	DPTR,#100	;NOW 100
 7793:                          ;	ACALL	RSUB
 7794:                          ;	MOV	DPTR,#10	;NOW 10
 7795:                          ;	ACALL	RSUB
 7796:                          ;	MOV	DPTR,#1 	;NOW 1
 7797:                          ;	ACALL	RSUB
 7798:                          ;	JZ	RSUB2		;JUMP OVER RET
 7799:                          ;
 7800:                          ;RSUB_R:	RET
 7801:                          ;
 7802:                          ;RSUB:	MOV	R6,#-1		;SET UP THE COUNTER
 7803:                          ;
 7804:                          ;RSUB1: INC	R6		;BUMP THE COUNTER
 7805:                          ;	XCH	A,R2		;DO A FAST COMPARE
 7806:                          ;	CJNE	A,DPH,RSUB11
 7807:                          ;RSUB11: XCH	 A,R2
 7808:                          ;	JC	FAST_DONE
 7809:                          ;	XCH	A,R0		;GET LOW BYTE
 7810:                          ;	SUBB	A,DPL		;SUBTRACT, CARRY IS CLEARE
 7811:                          ;	XCH	A,R0		;PUT IT BACK
 7812:                          ;	XCH	A,R2		;GET THE HIGH BYTE
 7813:                          ;	SUBB	A,DPH		;ADD THE HIGH BYTE
 7814:                          ;	XCH	A,R2		;PUT IT BACK
 7815:                          ;	JNC	RSUB1		;LOOP UNTIL CARRY
 7816:                          ;
 7817:                          ;	XCH	A,R0
 7818:                          ;	ADD	A,DPL		;RESTORE R2:R0
 7819:                          ;	XCH	A,R0
 7820:                          ;	XCH	A,R2
 7821:                          ;	ADDC	A,DPH
 7822:                          ;	XCH	A,R2
 7823:                          ;
 7824:                          ;FAST_DONE:
 7825:                          ;
 7826:                          ;	ORL	A,R6		;OR THE COUNT VALUE
 7827:                          ;	JZ	RSUB_R		;RETURN IF ZERO
 7828:                          ;
 7829:                          ;RSUB2: MOV	A,#'0'          ;GET THE ASC
 7830:                          ;	ADD	A,R6		;ADD THE COUNT

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 142



 Line    I  Addr Code           Source

 7831:                          ;
 7832:                          ;RSUB4: MOV	P2,R3		;SET UP P2
 7833:                          ;	MOVX	@R1,A		;PLACE THE VALUE IN MEMORY
 7834:                          ;	INC	R1
 7835:                          ;	CJNE	R1,#00H,RSUB3	;SEE IF RAPPED AROU
 7836:                          ;	INC	R3		;BUMP HIGH BYTE
 7837:                          ;
 7838:                          ;RSUB3: RET			;EXIT
 7839:                          ;
 7840:                          ;****** Faster code starts here: *******
 7841:                          ;
 7842:      1EF7 7D 00          	mov	R5,#0
 7843:                          ;
 7844:      1EF9 EA             RSUB1:	mov	A, R2
 7845:      1EFA 75 F0 0A       	mov	B,#0AH
 7846:      1EFD 84             	div	AB
 7847:      1EFE FA             	mov	R2,A
 7848:      1EFF E8             	mov	A,R0
 7849:      1F00 54 F0          	anl	A,#0F0H
 7850:      1F02 45 F0          	orl	A,B
 7851:      1F04 C4             	swap	A
 7852:      1F05 75 F0 0A       	mov	B,#0AH
 7853:      1F08 84             	div	AB
 7854:      1F09 C4             	swap	A
 7855:      1F0A FE             	mov	R6,A
 7856:      1F0B E8             	mov	A,R0
 7857:      1F0C 54 0F          	anl	A,#0FH
 7858:      1F0E C4             	swap	A
 7859:      1F0F 45 F0          	orl	A,B
 7860:      1F11 C4             	swap	A
 7861:      1F12 75 F0 0A       	mov	B,#0AH
 7862:      1F15 84             	div	AB
 7863:      1F16 4E             	orl	A,R6
 7864:      1F17 F8             	mov	R0,A
 7865:      1F18 E5 F0          	mov	A,B
 7866:      1F1A 24 30          	add	A,#30H
 7867:      1F1C 0D             	inc	R5
 7868:      1F1D C0 E0          	push	ACC
 7869:      1F1F EA             	mov	A,R2
 7870:      1F20 48             	orl	A,R0
 7871:      1F21 70 D6          	jnz	RSUB1
 7872:                          ;
 7873:      1F23 D0 E0          RSUB2:	pop	ACC
 7874:      1F25 8B A0          	mov	P2,R3
 7875:      1F27 F3             	movx	@R1,A
 7876:      1F28 09             	inc	R1
 7877:      1F29 B9 00 01       	cjne	R1,#0,RSUB3
 7878:      1F2C 0B             	inc	R3
 7879:                          ;
 7880:      1F2D DD F4          RSUB3:	djnz	R5,RSUB2
 7881:      1F2F 22             	ret
 7882:                          ;
 7883:                          ;****** continue with original code: ***
 7884:                          ;
 7885:                          	;**************************************
 7886:                          	;

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 143



 Line    I  Addr Code           Source

 7887:                          HEXOUT: ; Output the hex number in R3:R1
 7888:                          	;
 7889:                          	;**************************************
 7890:                          	;
 7891:      1F30 D1 9A          	ACALL	SOUT		;OUTPUT A SPACE
 7892:      1F32 A2 36          	MOV	C,ZSURP 	;GET ZERO SUPPRESSION BIT
 7893:      1F34 92 23          	MOV	ADD_IN,C
 7894:      1F36 EB             	MOV	A,R3		;GET HIGH NIBBLE AND PRINT IT
 7895:      1F37 F1 53          	ACALL	HOUTHI
 7896:      1F39 EB             	MOV	A,R3
 7897:      1F3A F1 54          	ACALL	HOUTLO
 7898:                          	;
 7899:      1F3C C2 23          HEX2X:	CLR	ADD_IN		;DON'T SUPPRESS ZEROS
 7900:      1F3E E9             	MOV	A,R1		;GET LOW NIBBLE AND PRINT IT
 7901:      1F3F F1 53          	ACALL	HOUTHI
 7902:      1F41 E9             	MOV	A,R1
 7903:      1F42 F1 54          	ACALL	HOUTLO
 7904:      1F44 7D 48          	MOV	R5,#'H'         ;OUTPUT H TO INDICA
 7905:                          	;
 7906:      1F46 C1 9C          SOUT_1: AJMP	SOUT1
 7907:                          	;
 7908:      1F48 C2 23          HOUT1:	CLR	ADD_IN		;PRINTED SOMETHING, S
 7909:      1F4A 24 90          	ADD	A,#90H		;CONVERT TO ASCII
 7910:      1F4C D4             	DA	A
 7911:      1F4D 34 40          	ADDC	A,#40H
 7912:      1F4F D4             	DA	A		;GOT IT HERE
 7913:      1F50 FD             	MOV	R5,A		;OUTPUT THE BYTE
 7914:      1F51 80 F3          	SJMP	SOUT_1
 7915:                          	;
 7916:      1F53 C4             HOUTHI: SWAP	A		;SWAP TO OUTPUT HIGH NIB
 7917:                          	;
 7918:      1F54 54 0F          HOUTLO: ANL	A,#0FH		;STRIP
 7919:      1F56 70 F0          	JNZ	HOUT1		;PRINT IF NOT ZERO
 7920:      1F58 30 23 ED       	JNB	ADD_IN,HOUT1	;OUTPUT A ZERO IF NOT 
 7921:      1F5B 22             	RET
 7922:                          ;
 7923:                          ;***************************************
 7924:                          ;******* New baudrate detection ********
 7925:                          ;******* calculate r3:r1=-(Timer2 DIV 16
 7926:                          ;******* Wulf 3 alteration 2 ***********
 7927:                          ;
 7928:                          ;-- comment out for AT98LP52 -----------
 7929:                          ;
 7930:                          ;SERCALC:mov	a,#0F0h
 7931:                          ;	mov	r3,a
 7932:                          ;	mov	r1,TH2
 7933:                          ;	anl	a,r1
 7934:                          ;	swap	a
 7935:                          ;	cpl	a
 7936:                          ;	xch	a,r3
 7937:                          ;	anl	a,TL2
 7938:                          ;	xch	a,r1
 7939:                          ;	anl	a,#00Fh
 7940:                          ;	orl	a,r1
 7941:                          ;	swap	a
 7942:                          ;	cpl	a

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 144



 Line    I  Addr Code           Source

 7943:                          ;	mov	r1,ADCON	;save BSY bit
 7944:                          ;	mov	DAPR,#0 	;start A/D for 805xx test
 7945:                          ;	xch	a,r1
 7946:                          ;	ret
 7947:                          ;
 7948:                          ;-- insert for AT98LP52 ----------------
 7949:                          ;TEST_MSG: db	'Speed OK?'
 7950:                          ;	db	00h		; Stop Code
 7951:                          ;-- insert end -------------------------
 7952:                          ;***************************************
 7953:                          ;
 7954:           N      1F78    	ORG	1F78H
 7955:                          	;
 7956:      1F78 20 1A 03       CKS_I:	JB	CKS_B,CS_I
 7957:      1F7B 02 40 1B       	LJMP	401BH
 7958:                          	;
 7959:      1F7E 02 20 88       CS_I:	LJMP	2088H
 7960:                          	;
 7961:      1F81 4E 4F 20 44    E14X:	DB	'NO DATA"'
            1F85 41 54 41 22
 7962:                          	;
 7963:      1F89 94             E11X:	DB	128+20
 7964:      1F8A 41 52 49 54    	DB	'ARITH. OVERFLOW"'
            1F8E 48 2E 20 4F
            1F92 56 45 52 46
            1F96 4C 4F 57 22
 7965:                          	;
 7966:      1F9A 50 52 4F 47    E16X:	DB	'PROGRAMMING"'
            1F9E 52 41 4D 4D
            1FA2 49 4E 47 22
 7967:                          	;
 7968:      1FA6 43 41 4E       E15X:	DB	'CAN'
 7969:      1FA9 27             	DB	27H
 7970:      1FAA 54 20 43 4F    	DB	'T CONTINUE"'
            1FAE 4E 54 49 4E
            1FB2 55 45 22
 7971:                          	;
 7972:      1FB5 49 4E 56 41    E10X:	DB	'INVALID LINE NUMBER"'
            1FB9 4C 49 44 20
            1FBD 4C 49 4E 45
            1FC1 20 4E 55 4D
            1FC5 42 45 52 22
 7973:                          	;
 7974:      1FC9 50 52 4F 4D    NOROM:	DB	'PROM MODE"'
            1FCD 20 4D 4F 44
            1FD1 45 22
 7975:                          	;
 7976:                          ;***************************************
 7977:                          ;****** Set a new version message ******
 7978:                          ;
 7979:                          ;S_N:	DB	'*MCS-51(tm) BASIC V1.1*'
 7980:                          ;
 7981:      1FD3 2A 4D 43 53    S_N:	DB	'*MCS-BASIC-52 V1.31*"'
            1FD7 2D 42 41 53
            1FDB 49 43 2D 35
            1FDF 32 20 56 31

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 145



 Line    I  Addr Code           Source

            1FE3 2E 33 31 2A
            1FE7 22
 7982:                          ;
 7983:                          ;***************************************
 7984:                          ;
 7985:           N      1FEB    	ORG	1FEBH		;FOR LINK COMPATABILITY
 7986:                          	;
 7987:                          GET_DIGIT_CHECK:	; Get a character, then
 7988:                          	;
 7989:      1FEB B1 5F          	ACALL	GET_DPTR_CHARACTER
 7990:                          	;
 7991:                          DIGIT_CHECK:	;CHECK FOR A VALID ASCII DI
 7992:                          	;
 7993:      1FED B4 3A 00       	CJNE	A,#'9'+1,DC10   ;SEE IF ASCII 9 OR
 7994:      1FF0 40 01          DC10:	JC	DC1
 7995:      1FF2 22             	RET
 7996:                          	;
 7997:      1FF3 B4 30 00       DC1:	CJNE	A,#'0',DC11     ;SEE IF ASCII 
 7998:      1FF6 B3             DC11:	CPL	C
 7999:      1FF7 22             	RET
 8000:                          	;
 8001:           N      1FF8    	ORG	1FF8H
 8002:                          	;
 8003:      1FF8 45 52 52 4F    ERS:	DB	'ERROR: "'
            1FFC 52 3A 20 22
 8004:                          	;
 8005:                          	;**************************************
 8006:                          	;
 8007:                          	XSEG	;External Ram
 8008:                          	;
 8009:                          	;**************************************
 8010:                          	;
 8011:      0000 N      0004    	DS	4
 8012:      0004 N      0001    IBCNT:	DS	1		;LENGTH OF A LINE
 8013:      0005 N      0002    IBLN:	DS	2		;THE LINE NUMBER
 8014:      0007 N      0049    IBUF:	DS	LINLEN		;THE INPUT BUFFER
 8015:      0050 N      000F    CONVT:	DS	15		;CONVERSION LOCATION FOR F
 8016:                          	;
 8017:           N      0100    	ORG	100H
 8018:                          	;
 8019:      0100 N      0001    GTB:	DS	1		;GET LOCATION
 8020:      0101 N      0001    ERRLOC: DS	1		;ERROR TYPE
 8021:      0102 N      0002    ERRNUM: DS	2		;WHERE TO GO ON AN ERROR
 8022:      0104 N      0002    VARTOP: DS	2		;TOP OF VARIABLE STORAGE
 8023:      0106 N      0002    ST_ALL: DS	2		;STORAGE ALLOCATION
 8024:      0108 N      0002    MT_ALL: DS	2		;MATRIX ALLOCATION
 8025:      010A N      0002    MEMTOP: DS	2		;TOP OF MEMORY
 8026:      010C N      0002    RCELL:	DS	2		;RANDOM NUMBER CELL
 8027:      010E N      0005    	DS	FPSIZ-1
 8028:      0113 N      0001    CXTAL:	DS	1		;CRYSTAL
 8029:      0114 N      0005    	DS	FPSIZ-1
 8030:      0119 N      0001    FPT1:	DS	1		;FLOATINP POINT TEMP 1
 8031:      011A N      0005    	DS	FPSIZ-1
 8032:      011F N      0001    FPT2:	DS	1		;FLOATING POINT TEMP 2
 8033:      0120 N      0002    INTLOC: DS	2		;LOCATION TO GO TO ON INTE
 8034:      0122 N      0002    STR_AL: DS	2		;STRING ALLOCATION

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 146



 Line    I  Addr Code           Source

 8035:      0124 N      0002    SPV:	DS	2		;SERIAL PORT BAUD RATE
 8036:      0126 N      0002    TIV:	DS	2		;TIMER INTERRUPT NUM AND LOC
 8037:      0128 N      0002    PROGS:	DS	2		;PROGRAM A PROM TIME OUT
 8038:                          ;
 8039:                          ;***************************************
 8040:                          ;****** Disable Intel programming for to
 8041:                          ;****** We don't need this, but don't re
 8042:                          ;
 8043:      012A N      0002    IPROGS: DS	2		;INTELLIGENT PROM PROGRAMM
 8044:                          ;
 8045:                          ;***************************************
 8046:                          ;
 8047:      012C N      0001    TM_TOP: DS	1
 8048:                          ;
 8049:                          ; ---- BASIC-52 Mainroutine End ----
 8050:                          
 8051:                          	CSEG	; Directive is used to select the 
 8052:                          
 8053:                          ;***************************************
 8054:                          ;*                        BASIC-52 V1.31
 8055:                          ;*          The following code enhanced 
 8056:                          ;*               for I2C communicatin an
 8057:                          ;*--------------------------------------
 8058:                          ;* (C) H.-J. Boehling & D. Wulf 14.11.01
 8059:                          ;*     http://home.arcor.de/h.boehling  
 8060:                          ;*     H-Boehling@gmx.de                
 8061:                          ;***************************************
 8062:                          ;*
 8063:                          ;* Four new I2C communication commands a
 8064:                          ;*
 8065:                          ;* The syntax to use is:
 8066:                          ;*
 8067:                          ;*     I2CSTART           Sends a start 
 8068:                          ;*                        - Returns with
 8069:                          ;*     I2CSTOP            Sends a stop c
 8070:                          ;*                        - Returns with
 8071:                          ;*     I2CPUT [byte]      Sends a byte t
 8072:                          ;*                        - Returns with
 8073:                          ;*     I2CGET [variable]  Reads a byte f
 8074:                          ;*                        - Set 18H (sta
 8075:                          ;*                           DBY(18H) = 
 8076:                          ;*                        - Returns with
 8077:                          ;*   
 8078:                          ;* Register 18H is the I2C communication
 8079:                          ;*
 8080:                          ;*     STATUS=DBY(18H)
 8081:                          ;*      IF STATUS.AND.2=2 PRINT "Time ou
 8082:                          ;*      IF STATUS.AND.4=4 PRINT "Busy er
 8083:                          ;*      IF STATUS.AND.8=8 PRINT "No ackn
 8084:                          ;*
 8085:                          ;*--------------------------------------
 8086:                          ;*
 8087:                          ;* Two new commands to read from or writ
 8088:                          ;*
 8089:                          ;*     WRSFR ([address]) [byte]      Wri
 8090:                          ;*

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 147



 Line    I  Addr Code           Source

 8091:                          ;*     RDSFR ([address]) [variable]  Rea
 8092:                          ;*
 8093:                          ;* [address] is the address of the SFR a
 8094:                          ;* 128 (080H) and 255 (0FFH).
 8095:                          ;*
 8096:                          ;***************************************
 8097:                          
 8098:                          ;----- Definitions ---------------------
 8099:                          
 8100:           B        96    SDA		bit	P1.6                    ;I2C se
 8101:           B        95    SCL		bit	P1.5                    ;I2C se
 8102:                          
 8103:           N      0018    status		equ	018H			;Communication status
 8104:                          
 8105:                          ;temp1		equ	11			;Temp. storage. ; *** a
 8106:                          
 8107:                          ;xbit		bit	45			;Command extension prese
 8108:                           
 8109:                          ; the following bits will be set in the 
 8110:                          
 8111:           N      0002    tout		equ	00000010B		;I2C time out statu
 8112:           N      0004    busy		equ	00000100B		;I2C bus busy statu
 8113:           N      0008    nack		equ	00001000B		;Slave sends no ack
 8114:                          						
 8115:                          ;---------------------------------------
 8116:                          ; The following code is necessary to not
 8117:                          
 8118:           N      2002    		org	2002H			;5Ah at 2002h tells BASIC-
 8119:      2002 5A             		db	5AH			;to call 2048h (see below).
 8120:           N      2048    		org	2048H			;Set bit 45 to tell BASIC-
 8121:                          						;that custom commands or
 8122:      2048 D2 2D          		setb	xbit			;instructions have been
 8123:      204A 22             		ret				;added.
 8124:           N      2070    		org	2070H			;Store starting address of
 8125:      2070 90 24 00       		mov	dptr,#vectortable	;vector table.
 8126:      2073 22             		ret
 8127:           N      2078    		org	2078H			;Store starting address of
 8128:      2078 90 24 0C       		mov	dptr,#tokentable	;token table.
 8129:      207B 22             		ret
 8130:                          
 8131:                          ; The old code for BASIC-52 V1.3 overwri
 8132:                          ; used for a user reset routine! So the 
 8133:                          
 8134:                          ;===== Here starts the code for the new 
 8135:                          
 8136:           N      2400    		org	2400h			;use any available address
 8137:                          
 8138:                          vectortable:					;Vector table starts he
 8139:                          						;Label to branch on:
 8140:      2400 24 40          		dw	i2cstart		;I2CSTART command
 8141:      2402 24 56          		dw	i2cstop			;I2CSTOP command
 8142:      2404 24 62          		dw	i2cput			;I2CPUT command
 8143:      2406 24 92          		dw	i2cget			;I2CGET command
 8144:      2408 25 41          		dw	wrsfr			;WRSFR command
 8145:      240A 25 19          		dw	rdsfr			;RDSFR command
 8146:                          

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 148



 Line    I  Addr Code           Source

 8147:                          tokentable:					;Token table starts here
 8148:      240C 10             		db	10H			;1. user defined token for
 8149:      240D 49 32 43 53                    db      'I2CSTART'          
            2411 54 41 52 54
 8150:      2415 00             		db	0			;End of token indicator
 8151:      2416 11             		db	11H			;2.
 8152:      2417 49 32 43 53                    db      'I2CSTOP'
            241B 54 4F 50
 8153:      241E 00             		db	0
 8154:      241F 12             		db	12H			;3.
 8155:      2420 49 32 43 50                    db      'I2CPUT'
            2424 55 54
 8156:      2426 00             		db	0
 8157:      2427 13             		db	13H			;4.
 8158:      2428 49 32 43 47                    db      'I2CGET'
            242C 45 54
 8159:      242E 00             		db	0
 8160:      242F 14                             db      14H             
 8161:      2430 57 52 53 46                    db      'WRSFR'
            2434 52
 8162:      2435 00             		db	0
 8163:      2436 15                             db      15H             
 8164:      2437 52 44 53 46                    db      'RDSFR'
            243B 52
 8165:      243C 00             		db	0
 8166:                          
 8167:                          ;----- The following is necessary to get
 8168:                          
 8169:      243D DF             		db	0DFH			;Dummy token.
 8170:      243E 7F             		db	07FH			;Unused dummy char.
 8171:                          
 8172:                          ;---------------------------------------
 8173:                          
 8174:      243F FF             		db	0FFH			;End of tokenlist indicator.
 8175:                          
 8176:                          ;---------------------------------------
 8177:                          
 8178:                          ;===== i2cstart - sends an I2C start con
 8179:                          
 8180:      2440 12 24 BA       i2cstart:	call	SCLhigh			;Set SCL to hig
 8181:      2443 7F 04          		mov	R7,#4			;Load time out counter.
 8182:      2445 D2 96          setSDA:		setb	SDA			;Set SDA to high.
 8183:      2447 20 96 06       		jb	SDA,ishigh		;If not high bus is bus
 8184:      244A DF F9          		djnz	R7,setSDA		;If not try until R7 i
 8185:      244C 43 18 04       		orl	status,#busy		;Set busy status.
 8186:      244F 22             		ret				;return to BASIC.
 8187:                          
 8188:      2450 C2 96          ishigh:		clr	SDA			;Set start condition.
 8189:      2452 53 18 00       		anl     status,#0		;Clear I2C status.
 8190:      2455 22              		ret				;return to BASIC.
 8191:                          
 8192:                          ;===== i2cstop - sends an I2C stop condi
 8193:                          
 8194:      2456 53 18 00       i2cstop:	anl 	status,#0		;Clear I2C stat
 8195:      2459 C2 96          		clr	SDA			;Get SDA ready for stop.
 8196:      245B 91 BA          		acall 	SCLhigh			;Set clock for stop.

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 149



 Line    I  Addr Code           Source

 8197:      245D 91 B9                     	acall	delay			;Delay 4 machi
 8198:      245F D2 96          		setb	SDA			;Set stop condition.
 8199:      2461 22             		ret				;Return to BASIC.
 8200:                          
 8201:                          ;===== i2cput - sends a byte from a BASI
 8202:                          
 8203:                          ;----- Get value and test for 8 bit only
 8204:                          
 8205:      2462 74 39          i2cput:		mov	A,#39H			;Put value to send
 8206:      2464 12 00 30       		lcall	30H			;argument stack.
 8207:      2467 74 01          		mov	A,#1			;change value to 16 bit
 8208:      2469 12 00 30       		lcall	30H			;integer and write to R3:R
 8209:      246C BB 00 58       		cjne	R3,#0,i2cerror		;If R3 not zero	t
 8210:                          						;value bigger than 0FFH.
 8211:                          						;8 bit integer only error.
 8212:                          
 8213:                          ;----- Send byte to I2C bus ------------
 8214:                          
 8215:      246F E9             		mov	A,R1			;Load byte to send.
 8216:      2470 7E 08          		mov	R6,#8			;Load bit counter
 8217:      2472 C2 95          send:		clr	SCL			;Make clock low
 8218:      2474 91 B9                     	acall	delay			;Delay 4 machi
 8219:      2476 33             		rlc	A			;Rotate data bit to C.
 8220:      2477 92 96          		mov	SDA,C			;Put data bit on pin.
 8221:      2479 91 BA          		acall	SCLhigh		        ;Send clock.
 8222:      247B 91 B9                     	acall	delay			;Delay 4 machi
 8223:      247D DE F3          		djnz	R6,send			;Repeat until all bits 
 8224:                          
 8225:                          ;----- Read acknowledge from slave -----
 8226:                          	
 8227:      247F C2 95          		clr	SCL			;Make clock low.
 8228:      2481 91 B9                     	acall	delay			;Delay 4 machi
 8229:      2483 D2 96          		setb	SDA			;Release line for acknowled
 8230:      2485 91 BA          		acall	SCLhigh		        ;Send clock for
 8231:      2487 91 B9          	     	acall	delay			;Delay 4 machine cy
 8232:      2489 30 96 03       		jnb	SDA,ackok		;Check for valid acknow
 8233:      248C 43 18 08       		orl	status,#nack		;Set no acknowledge 
 8234:      248F C2 95          ackok:		clr	SCL			;Finish acknowledge bi
 8235:      2491 22             		ret				;Return to BASIC.
 8236:                          
 8237:                          ;===== i2cget - Reads one byte from I2C 
 8238:                          
 8239:      2492 7E 08          i2cget:		mov	R6,#8			;Load bit counter
 8240:      2494 C2 95          read:		clr	SCL			;Make clock low.
 8241:      2496 91 B9                        	acall	delay			;Delay 4 ma
 8242:      2498 91 BA          		acall	SCLhigh		        ;Send clock.
 8243:      249A 91 B9          	   	acall	delay			;Delay 4 machine cycl
 8244:      249C A2 96          		mov	C,SDA			;Get data bit from pin.
 8245:      249E 33             		rlc	A			;Rotate bit into result byte.
 8246:      249F DE F3          		djnz	R6,read			;Repeat until all recei
 8247:                          
 8248:                          ;----- Put received byte on argument sta
 8249:                          
 8250:      24A1 F8             		mov	R0,A			;Load R0 with reseived byte
 8251:      24A2 7A 00          		mov	R2,#0			;Set high byte to zero.
 8252:      24A4 74 9A          		mov	A,#9AH			;Put byte on argument sta

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 150



 Line    I  Addr Code           Source

 8253:      24A6 12 00 30       		lcall	30H			;with BASIC funktion.
 8254:                          
 8255:                          ;----- Send acknowledge to slave -------
 8256:                          
 8257:      24A9 C2 95          		clr	SCL			;Set clock low.
 8258:      24AB 91 B9                     	acall	delay			;Delay 4 machi
 8259:      24AD E5 18          		mov	A,status		;Load acknowledge bit
 8260:      24AF 13             		rrc	A			;into C and
 8261:      24B0 92 96          		mov	SDA,C			;send acknowledge bit.
 8262:      24B2 91 BA          		acall	SCLhigh		        ;Send acknowled
 8263:                          
 8264:                          ;----- Set variable to received byte ---
 8265:                          
 8266:      24B4 74 43          		mov	A,#43H			;Set next variable to val
 8267:      24B6 02 00 30       		ljmp	30H			;on argument stack and
 8268:                          						;return to BASIC.
 8269:                          
 8270:                          ;----- delay - generates a delay of 4 ma
 8271:                          
 8272:      24B9 22             delay:		ret				;4 cycles for CALL and RE
 8273:                          
 8274:                          ;----- SCLhigh - sends SCL pin high and 
 8275:                          
 8276:      24BA 7F 04          SCLhigh:	mov	R7,#4			;Load time out coun
 8277:      24BC D2 95          setSCL:	   	setb	SCL			;Set SCL to high.
 8278:      24BE 20 95 05       	       	jb	SCL,quit		;If SCL actually h
 8279:      24C1 DF F9          		djnz	R7,setSCL		;If not try until R7 i
 8280:      24C3 43 18 02       		orl	status,#tout		;Set status time out
 8281:      24C6 22             quit:		ret
 8282:                          
 8283:                          ;----- error - sends an error message to
 8284:                          
 8285:      24C7 74 07          i2cerror:	mov	A,#7			;Send CR/LF
 8286:      24C9 12 00 30       		lcall	30H
 8287:      24CC 7B 24          		mov	R3,#high i2cerrmsg	;Set string add
 8288:      24CE 79 DB          		mov	R1,#low i2cerrmsg
 8289:                          ;error:		setb	34H			;Read string from co
 8290:      24D0 D2 34          error9:		setb	34H			;Read string from co
 8291:      24D2 74 06          		mov	A,#6			;Send String to
 8292:      24D4 12 00 30       		lcall	30H			;terminal.
 8293:      24D7 E4             		clr	A
 8294:      24D8 02 00 30       		ljmp	30H			;Back to command mode.
 8295:                          
 8296:      24DB 45 52 52 4F    i2cerrmsg:      db 'ERROR: BAD I2CPUT ARGUME
            24DF 52 3A 20 42
            24E3 41 44 20 49
            24E7 32 43 50 55
            24EB 54 20 41 52
            24EF 47 55 4D 45
            24F3 4E 54
 8297:      24F5 22             		db	22H			;End of text.  	
 8298:                          
 8299:      24F6 45 52 52 4F    sfrerrmsg:      db 'ERROR: BAD SFR ARGUMENT'
            24FA 52 3A 20 42
            24FE 41 44 20 53
            2502 46 52 20 41

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 151



 Line    I  Addr Code           Source

            2506 52 47 55 4D
            250A 45 4E 54
 8300:      250D 22             		db	22H			;End of text.
 8301:                          
 8302:      250E 74 07          sfrerror:	mov	A,#7			;Send CR/LF
 8303:      2510 12 00 30       		lcall	30H
 8304:      2513 7B 24          		mov	R3,#high sfrerrmsg	;Set string add
 8305:      2515 79 F6          		mov	R1,#low sfrerrmsg
 8306:                          ;		sjmp	error  ; *** error -> error9
 8307:      2517 80 B7          		sjmp	error9
 8308:                          
 8309:                          ;===== rdsfr - read from special funtion
 8310:                          
 8311:      2519 74 39          rdsfr:		mov     A,#39H                  
 8312:      251B 12 00 30       		lcall	30H			;argument stack.
 8313:                          
 8314:      251E 74 01          		mov	A,#1			;change value to 16 bit
 8315:      2520 12 00 30       		lcall	30H			;integer and write to R3:R
 8316:                          
 8317:      2523 BB 00 E8       		cjne	R3,#0,sfrerror		;If R3 not zero	t
 8318:      2526 E9             		mov	A,R1			;Address to Acc.
 8319:      2527 30 E7 E4       		jnb	Acc.7,sfrerror		;If address less t
 8320:      252A FC             		mov	R4,A			;Address to R4.
 8321:                          
 8322:      252B 75 82 88       		mov	DPL,#low sfrgettab	;Set DPTR to ju
 8323:      252E 75 83 25       		mov	DPH,#high sfrgettab	;table.
 8324:      2531 12 25 69       		call	do_sfr			;Read SFR.
 8325:                          
 8326:      2534 F8             		mov	R0,A			;Load R0 with SFR byte.
 8327:      2535 7A 00          		mov	R2,#0			;Set high byte to zero.
 8328:      2537 74 9A          		mov	A,#9AH			;Put byte on argument sta
 8329:      2539 12 00 30       		lcall	30H
 8330:                          
 8331:                          ;----- Set variable to SFR byte --------
 8332:                          
 8333:      253C 74 43          		mov	A,#43H			;Set next variable to val
 8334:      253E 02 00 30       		ljmp	30H			;on argument stack and
 8335:                          						;return to BASIC.
 8336:                          
 8337:                          ;===== wrsfr - write to special funtion 
 8338:                          
 8339:      2541 74 39          wrsfr:		mov     A,#39H                  
 8340:      2543 12 00 30       		lcall	30H			;argument stack.
 8341:                          
 8342:      2546 74 01          		mov	A,#1			;change value to 16 bit
 8343:      2548 12 00 30       		lcall	30H			;integer and write to R3:R
 8344:      254B BB 00 C0       		cjne	R3,#0,sfrerror		;If R3 not zero	t
 8345:      254E E9             		mov	A,R1			;or
 8346:      254F 30 E7 BC       		jnb	Acc.7,sfrerror		;if address less t
 8347:      2552 89 0B          		mov	temp1,R1		;Save address.
 8348:                          
 8349:      2554 74 39          		mov	A,#39H			;Put value to write on
 8350:      2556 12 00 30       		lcall	30H			;argument stack.
 8351:                          
 8352:      2559 74 01          		mov	A,#1			;change value to 16 bit
 8353:      255B 12 00 30       		lcall	30H			;integer and write to R3:R

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 152



 Line    I  Addr Code           Source

 8354:      255E BB 00 AD       		cjne	R3,#0,sfrerror		;If R3 not zero	t
 8355:                          						;8 bit integer only error.
 8356:      2561 75 82 86       		mov	DPL,#low sfrputtab	;Set DPTR to ju
 8357:      2564 75 83 25       		mov	DPH,#high sfrputtab	;table.
 8358:      2567 AC 0B          		mov	R4,temp1		;Address to write to R4.
 8359:                          
 8360:                          ;----- do_sfr - read from or wright to S
 8361:                          
 8362:                          ;----- Calculate the jump --------------
 8363:                          
 8364:      2569 EC             do_sfr:		mov	A,R4			;Address to Acc
 8365:      256A 24 80          		add	A,#80H
 8366:      256C FC             		mov	R4,A
 8367:      256D 78 00          		mov	R0,#0
 8368:      256F 25 E0          		add	A,ACC			;*2
 8369:      2571 C8             		xch	A,R0
 8370:      2572 35 E0          		addc	A,ACC			;carry
 8371:      2574 C8             		xch	A,R0
 8372:      2575 25 E0          		add	A,ACC			;*4
 8373:      2577 C8             		xch	A,R0
 8374:      2578 35 E0          		addc	A,ACC			;carry
 8375:      257A C8                             xch     A,R0
 8376:                          
 8377:                          ;----- Load DPTR with offset and jump --
 8378:                          
 8379:      257B 25 82                          add     A,DPL
 8380:      257D F5 82          		mov	DPL,A
 8381:      257F E8             		mov	A,R0
 8382:      2580 35 83          		addc	A,DPH
 8383:      2582 F5 83          		mov	DPH,A
 8384:      2584 EC             		mov	A,R4
 8385:      2585 73             		jmp	@A+DPTR			;Jump into table.
 8386:                          
 8387:                          ;----- The direct addressing table -----
 8388:                          
 8389:      2586 89 80          sfrputtab:	mov	128,R1
 8390:      2588 E5 80          sfrgettab:	mov	A,128
 8391:      258A 22             		ret
 8392:      258B 89 81          		mov	129,R1
 8393:      258D E5 81          		mov	A,129
 8394:      258F 22             		ret
 8395:      2590 89 82          		mov	130,R1
 8396:      2592 E5 82          		mov	A,130
 8397:      2594 22             		ret
 8398:      2595 89 83          		mov	131,R1
 8399:      2597 E5 83          		mov	A,131
 8400:      2599 22             		ret
 8401:      259A 89 84          		mov	132,R1
 8402:      259C E5 84          		mov	A,132
 8403:      259E 22             		ret
 8404:      259F 89 85          		mov	133,R1
 8405:      25A1 E5 85          		mov	A,133
 8406:      25A3 22             		ret
 8407:      25A4 89 86          		mov	134,R1
 8408:      25A6 E5 86          		mov	A,134
 8409:      25A8 22             		ret

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 153



 Line    I  Addr Code           Source

 8410:      25A9 89 87          		mov	135,R1
 8411:      25AB E5 87          		mov	A,135
 8412:      25AD 22             		ret
 8413:      25AE 89 88          		mov	136,R1
 8414:      25B0 E5 88          		mov	A,136
 8415:      25B2 22             		ret
 8416:      25B3 89 89          		mov	137,R1
 8417:      25B5 E5 89          		mov	A,137
 8418:      25B7 22             		ret
 8419:      25B8 89 8A          		mov	138,R1
 8420:      25BA E5 8A          		mov	A,138
 8421:      25BC 22             		ret
 8422:      25BD 89 8B          		mov	139,R1
 8423:      25BF E5 8B          		mov	A,139
 8424:      25C1 22             		ret
 8425:      25C2 89 8C          		mov	140,R1
 8426:      25C4 E5 8C          		mov	A,140
 8427:      25C6 22             		ret
 8428:      25C7 89 8D          		mov	141,R1
 8429:      25C9 E5 8D          		mov	A,141
 8430:      25CB 22             		ret
 8431:      25CC 89 8E          		mov	142,R1
 8432:      25CE E5 8E          		mov	A,142
 8433:      25D0 22             		ret
 8434:      25D1 89 8F          		mov	143,R1
 8435:      25D3 E5 8F          		mov	A,143
 8436:      25D5 22             		ret
 8437:      25D6 89 90          		mov	144,R1
 8438:      25D8 E5 90          		mov	A,144
 8439:      25DA 22             		ret
 8440:      25DB 89 91          		mov	145,R1
 8441:      25DD E5 91          		mov	A,145
 8442:      25DF 22             		ret
 8443:      25E0 89 92          		mov	146,R1
 8444:      25E2 E5 92          		mov	A,146
 8445:      25E4 22             		ret
 8446:      25E5 89 93          		mov	147,R1
 8447:      25E7 E5 93          		mov	A,147
 8448:      25E9 22             		ret
 8449:      25EA 89 94          		mov	148,R1
 8450:      25EC E5 94          		mov	A,148
 8451:      25EE 22             		ret
 8452:      25EF 89 95          		mov	149,R1
 8453:      25F1 E5 95          		mov	A,149
 8454:      25F3 22             		ret
 8455:      25F4 89 96          		mov	150,R1
 8456:      25F6 E5 96          		mov	A,150
 8457:      25F8 22             		ret
 8458:      25F9 89 97          		mov	151,R1
 8459:      25FB E5 97          		mov	A,151
 8460:      25FD 22             		ret
 8461:      25FE 89 98          		mov	152,R1
 8462:      2600 E5 98          		mov	A,152
 8463:      2602 22             		ret
 8464:      2603 89 99          		mov	153,R1
 8465:      2605 E5 99          		mov	A,153

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 154



 Line    I  Addr Code           Source

 8466:      2607 22             		ret
 8467:      2608 89 9A          		mov	154,R1
 8468:      260A E5 9A          		mov	A,154
 8469:      260C 22             		ret
 8470:      260D 89 9B          		mov	155,R1
 8471:      260F E5 9B          		mov	A,155
 8472:      2611 22             		ret
 8473:      2612 89 9C          		mov	156,R1
 8474:      2614 E5 9C          		mov	A,156
 8475:      2616 22             		ret
 8476:      2617 89 9D          		mov	157,R1
 8477:      2619 E5 9D          		mov	A,157
 8478:      261B 22             		ret
 8479:      261C 89 9E          		mov	158,R1
 8480:      261E E5 9E          		mov	A,158
 8481:      2620 22             		ret
 8482:      2621 89 9F          		mov	159,R1
 8483:      2623 E5 9F          		mov	A,159
 8484:      2625 22             		ret
 8485:      2626 89 A0          		mov	160,R1
 8486:      2628 E5 A0          		mov	A,160
 8487:      262A 22             		ret
 8488:      262B 89 A1          		mov	161,R1
 8489:      262D E5 A1          		mov	A,161
 8490:      262F 22             		ret
 8491:      2630 89 A2          		mov	162,R1
 8492:      2632 E5 A2          		mov	A,162
 8493:      2634 22             		ret
 8494:      2635 89 A3          		mov	163,R1
 8495:      2637 E5 A3          		mov	A,163
 8496:      2639 22             		ret
 8497:      263A 89 A4          		mov	164,R1
 8498:      263C E5 A4          		mov	A,164
 8499:      263E 22             		ret
 8500:      263F 89 A5          		mov	165,R1
 8501:      2641 E5 A5          		mov	A,165
 8502:      2643 22             		ret
 8503:      2644 89 A6          		mov	166,R1
 8504:      2646 E5 A6          		mov	A,166
 8505:      2648 22             		ret
 8506:      2649 89 A7          		mov	167,R1
 8507:      264B E5 A7          		mov	A,167
 8508:      264D 22             		ret
 8509:      264E 89 A8          		mov	168,R1
 8510:      2650 E5 A8          		mov	A,168
 8511:      2652 22             		ret
 8512:      2653 89 A9          		mov	169,R1
 8513:      2655 E5 A9          		mov	A,169
 8514:      2657 22             		ret
 8515:      2658 89 AA          		mov	170,R1
 8516:      265A E5 AA          		mov	A,170
 8517:      265C 22             		ret
 8518:      265D 89 AB          		mov	171,R1
 8519:      265F E5 AB          		mov	A,171
 8520:      2661 22             		ret
 8521:      2662 89 AC          		mov	172,R1

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 155



 Line    I  Addr Code           Source

 8522:      2664 E5 AC          		mov	A,172
 8523:      2666 22             		ret
 8524:      2667 89 AD          		mov	173,R1
 8525:      2669 E5 AD          		mov	A,173
 8526:      266B 22             		ret
 8527:      266C 89 AE          		mov	174,R1
 8528:      266E E5 AE          		mov	A,174
 8529:      2670 22             		ret
 8530:      2671 89 AF          		mov	175,R1
 8531:      2673 E5 AF          		mov	A,175
 8532:      2675 22             		ret
 8533:      2676 89 B0          		mov	176,R1
 8534:      2678 E5 B0          		mov	A,176
 8535:      267A 22             		ret
 8536:      267B 89 B1          		mov	177,R1
 8537:      267D E5 B1          		mov	A,177
 8538:      267F 22             		ret
 8539:      2680 89 B2          		mov	178,R1
 8540:      2682 E5 B2          		mov	A,178
 8541:      2684 22             		ret
 8542:      2685 89 B3          		mov	179,R1
 8543:      2687 E5 B3          		mov	A,179
 8544:      2689 22             		ret
 8545:      268A 89 B4          		mov	180,R1
 8546:      268C E5 B4          		mov	A,180
 8547:      268E 22             		ret
 8548:      268F 89 B5          		mov	181,R1
 8549:      2691 E5 B5          		mov	A,181
 8550:      2693 22             		ret
 8551:      2694 89 B6          		mov	182,R1
 8552:      2696 E5 B6          		mov	A,182
 8553:      2698 22             		ret
 8554:      2699 89 B7          		mov	183,R1
 8555:      269B E5 B7          		mov	A,183
 8556:      269D 22             		ret
 8557:      269E 89 B8          		mov	184,R1
 8558:      26A0 E5 B8          		mov	A,184
 8559:      26A2 22             		ret
 8560:      26A3 89 B9          		mov	185,R1
 8561:      26A5 E5 B9          		mov	A,185
 8562:      26A7 22             		ret
 8563:      26A8 89 BA          		mov	186,R1
 8564:      26AA E5 BA          		mov	A,186
 8565:      26AC 22             		ret
 8566:      26AD 89 BB          		mov	187,R1
 8567:      26AF E5 BB          		mov	A,187
 8568:      26B1 22             		ret
 8569:      26B2 89 BC          		mov	188,R1
 8570:      26B4 E5 BC          		mov	A,188
 8571:      26B6 22             		ret
 8572:      26B7 89 BD          		mov	189,R1
 8573:      26B9 E5 BD          		mov	A,189
 8574:      26BB 22             		ret
 8575:      26BC 89 BE          		mov	190,R1
 8576:      26BE E5 BE          		mov	A,190
 8577:      26C0 22             		ret

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 156



 Line    I  Addr Code           Source

 8578:      26C1 89 BF          		mov	191,R1
 8579:      26C3 E5 BF          		mov	A,191
 8580:      26C5 22             		ret
 8581:      26C6 89 C0          		mov	192,R1
 8582:      26C8 E5 C0          		mov	A,192
 8583:      26CA 22             		ret
 8584:      26CB 89 C1          		mov	193,R1
 8585:      26CD E5 C1          		mov	A,193
 8586:      26CF 22             		ret
 8587:      26D0 89 C2          		mov	194,R1
 8588:      26D2 E5 C2          		mov	A,194
 8589:      26D4 22             		ret
 8590:      26D5 89 C3          		mov	195,R1
 8591:      26D7 E5 C3          		mov	A,195
 8592:      26D9 22             		ret
 8593:      26DA 89 C4          		mov	196,R1
 8594:      26DC E5 C4          		mov	A,196
 8595:      26DE 22             		ret
 8596:      26DF 89 C5          		mov	197,R1
 8597:      26E1 E5 C5          		mov	A,197
 8598:      26E3 22             		ret
 8599:      26E4 89 C6          		mov	198,R1
 8600:      26E6 E5 C6          		mov	A,198
 8601:      26E8 22             		ret
 8602:      26E9 89 C7          		mov	199,R1
 8603:      26EB E5 C7          		mov	A,199
 8604:      26ED 22             		ret
 8605:      26EE 89 C8          		mov	200,R1
 8606:      26F0 E5 C8          		mov	A,200
 8607:      26F2 22             		ret
 8608:      26F3 89 C9          		mov	201,R1
 8609:      26F5 E5 C9          		mov	A,201
 8610:      26F7 22             		ret
 8611:      26F8 89 CA          		mov	202,R1
 8612:      26FA E5 CA          		mov	A,202
 8613:      26FC 22             		ret
 8614:      26FD 89 CB          		mov	203,R1
 8615:      26FF E5 CB          		mov	A,203
 8616:      2701 22             		ret
 8617:      2702 89 CC          		mov	204,R1
 8618:      2704 E5 CC          		mov	A,204
 8619:      2706 22             		ret
 8620:      2707 89 CD          		mov	205,R1
 8621:      2709 E5 CD          		mov	A,205
 8622:      270B 22             		ret
 8623:      270C 89 CE          		mov	206,R1
 8624:      270E E5 CE          		mov	A,206
 8625:      2710 22             		ret
 8626:      2711 89 CF          		mov	207,R1
 8627:      2713 E5 CF          		mov	A,207
 8628:      2715 22             		ret
 8629:      2716 89 D0          		mov	208,R1
 8630:      2718 E5 D0          		mov	A,208
 8631:      271A 22             		ret
 8632:      271B 89 D1          		mov	209,R1
 8633:      271D E5 D1          		mov	A,209

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 157



 Line    I  Addr Code           Source

 8634:      271F 22             		ret
 8635:      2720 89 D2          		mov	210,R1
 8636:      2722 E5 D2          		mov	A,210
 8637:      2724 22             		ret
 8638:      2725 89 D3          		mov	211,R1
 8639:      2727 E5 D3          		mov	A,211
 8640:      2729 22             		ret
 8641:      272A 89 D4          		mov	212,R1
 8642:      272C E5 D4          		mov	A,212
 8643:      272E 22             		ret
 8644:      272F 89 D5          		mov	213,R1
 8645:      2731 E5 D5          		mov	A,213
 8646:      2733 22             		ret
 8647:      2734 89 D6          		mov	214,R1
 8648:      2736 E5 D6          		mov	A,214
 8649:      2738 22             		ret
 8650:      2739 89 D7          		mov	215,R1
 8651:      273B E5 D7          		mov	A,215
 8652:      273D 22             		ret
 8653:      273E 89 D8          		mov	216,R1
 8654:      2740 E5 D8          		mov	A,216
 8655:      2742 22             		ret
 8656:      2743 89 D9          		mov	217,R1
 8657:      2745 E5 D9          		mov	A,217
 8658:      2747 22             		ret
 8659:      2748 89 DA          		mov	218,R1
 8660:      274A E5 DA          		mov	A,218
 8661:      274C 22             		ret
 8662:      274D 89 DB          		mov	219,R1
 8663:      274F E5 DB          		mov	A,219
 8664:      2751 22             		ret
 8665:      2752 89 DC          		mov	220,R1
 8666:      2754 E5 DC          		mov	A,220
 8667:      2756 22             		ret
 8668:      2757 89 DD          		mov	221,R1
 8669:      2759 E5 DD          		mov	A,221
 8670:      275B 22             		ret
 8671:      275C 89 DE          		mov	222,R1
 8672:      275E E5 DE          		mov	A,222
 8673:      2760 22             		ret
 8674:      2761 89 DF          		mov	223,R1
 8675:      2763 E5 DF          		mov	A,223
 8676:      2765 22             		ret
 8677:      2766 89 E0          		mov	224,R1
 8678:      2768 E5 E0          		mov	A,224
 8679:      276A 22             		ret
 8680:      276B 89 E1          		mov	225,R1
 8681:      276D E5 E1          		mov	A,225
 8682:      276F 22             		ret
 8683:      2770 89 E2          		mov	226,R1
 8684:      2772 E5 E2          		mov	A,226
 8685:      2774 22             		ret
 8686:      2775 89 E3          		mov	227,R1
 8687:      2777 E5 E3          		mov	A,227
 8688:      2779 22             		ret
 8689:      277A 89 E4          		mov	228,R1

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 158



 Line    I  Addr Code           Source

 8690:      277C E5 E4          		mov	A,228
 8691:      277E 22             		ret
 8692:      277F 89 E5          		mov	229,R1
 8693:      2781 E5 E5          		mov	A,229
 8694:      2783 22             		ret
 8695:      2784 89 E6          		mov	230,R1
 8696:      2786 E5 E6          		mov	A,230
 8697:      2788 22             		ret
 8698:      2789 89 E7          		mov	231,R1
 8699:      278B E5 E7          		mov	A,231
 8700:      278D 22             		ret
 8701:      278E 89 E8          		mov	232,R1
 8702:      2790 E5 E8          		mov	A,232
 8703:      2792 22             		ret
 8704:      2793 89 E9          		mov	233,R1
 8705:      2795 E5 E9          		mov	A,233
 8706:      2797 22             		ret
 8707:      2798 89 EA          		mov	234,R1
 8708:      279A E5 EA          		mov	A,234
 8709:      279C 22             		ret
 8710:      279D 89 EB          		mov	235,R1
 8711:      279F E5 EB          		mov	A,235
 8712:      27A1 22             		ret
 8713:      27A2 89 EC          		mov	236,R1
 8714:      27A4 E5 EC          		mov	A,236
 8715:      27A6 22             		ret
 8716:      27A7 89 ED          		mov	237,R1
 8717:      27A9 E5 ED          		mov	A,237
 8718:      27AB 22             		ret
 8719:      27AC 89 EE          		mov	238,R1
 8720:      27AE E5 EE          		mov	A,238
 8721:      27B0 22             		ret
 8722:      27B1 89 EF          		mov	239,R1
 8723:      27B3 E5 EF          		mov	A,239
 8724:      27B5 22             		ret
 8725:      27B6 89 F0          		mov	240,R1
 8726:      27B8 E5 F0          		mov	A,240
 8727:      27BA 22             		ret
 8728:      27BB 89 F1          		mov	241,R1
 8729:      27BD E5 F1          		mov	A,241
 8730:      27BF 22             		ret
 8731:      27C0 89 F2          		mov	242,R1
 8732:      27C2 E5 F2          		mov	A,242
 8733:      27C4 22             		ret
 8734:      27C5 89 F3          		mov	243,R1
 8735:      27C7 E5 F3          		mov	A,243
 8736:      27C9 22             		ret
 8737:      27CA 89 F4          		mov	244,R1
 8738:      27CC E5 F4          		mov	A,244
 8739:      27CE 22             		ret
 8740:      27CF 89 F5          		mov	245,R1
 8741:      27D1 E5 F5          		mov	A,245
 8742:      27D3 22             		ret
 8743:      27D4 89 F6          		mov	246,R1
 8744:      27D6 E5 F6          		mov	A,246
 8745:      27D8 22             		ret

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 159



 Line    I  Addr Code           Source

 8746:      27D9 89 F7          		mov	247,R1
 8747:      27DB E5 F7          		mov	A,247
 8748:      27DD 22             		ret
 8749:      27DE 89 F8          		mov	248,R1
 8750:      27E0 E5 F8          		mov	A,248
 8751:      27E2 22             		ret
 8752:      27E3 89 F9          		mov	249,R1
 8753:      27E5 E5 F9          		mov	A,249
 8754:      27E7 22             		ret
 8755:      27E8 89 FA          		mov	250,R1
 8756:      27EA E5 FA          		mov	A,250
 8757:      27EC 22             		ret
 8758:      27ED 89 FB          		mov	251,R1
 8759:      27EF E5 FB          		mov	A,251
 8760:      27F1 22             		ret
 8761:      27F2 89 FC          		mov	252,R1
 8762:      27F4 E5 FC          		mov	A,252
 8763:      27F6 22             		ret
 8764:      27F7 89 FD          		mov	253,R1
 8765:      27F9 E5 FD          		mov	A,253
 8766:      27FB 22             		ret
 8767:      27FC 89 FE          		mov	254,R1
 8768:      27FE E5 FE          		mov	A,254
 8769:      2800 22             		ret
 8770:      2801 89 FF          		mov	255,R1
 8771:      2803 E5 FF          		mov	A,255
 8772:      2805 22             		ret
 8773:                          
 8774:                          ;---------------------------------------
 8775:                          
 8776:                          		end
 8777:                          

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 160




Segment usage:
   Code      :   9173 bytes
   Data      :      0 bytes
   Idata     :      0 bytes
   Edata     :      0 bytes
   Fdata     :      0 bytes
   Xdata     :    140 bytes
   Bit       :      0 bits

   Register banks used: ---

   Warnings: 0
   Errors:   0


C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 161



              L I S T   O F   S Y M B O L S
              =============================


SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
??C51ASM                         NUMBER   8051
??CODE_SIZE                      NUMBER   0000
??DEVICE                         NUMBER   0000
??ERAM_SIZE                      NUMBER   0000
??FDATA_SIZE                     NUMBER   0000
??RAM_SIZE                       NUMBER   0100
??VERSION                        NUMBER   0120
??_AT89C2051_                    NUMBER   001B
??_AT89C4051_                    NUMBER   001C
??_AT89C51ED2_                   NUMBER   0026
??_AT89C51IC2_                   NUMBER   0024
??_AT89C51ID2_                   NUMBER   0025
??_AT89C51RB2_                   NUMBER   0021
??_AT89C51RC2_                   NUMBER   0022
??_AT89C51RC_                    NUMBER   0020
??_AT89C51RD2_                   NUMBER   0023
??_AT89C51_                      NUMBER   001D
??_AT89C52_                      NUMBER   001E
??_AT89C55WD_                    NUMBER   001F
??_AT89LP2052_                   NUMBER   0001
??_AT89LP213_                    NUMBER   0003
??_AT89LP214_                    NUMBER   0004
??_AT89LP216_                    NUMBER   0005
??_AT89LP3240_                   NUMBER   000A
??_AT89LP4052_                   NUMBER   0002
??_AT89LP428_                    NUMBER   0006
??_AT89LP51ED2_                  NUMBER   0011
??_AT89LP51IC2_                  NUMBER   000E
??_AT89LP51ID2_                  NUMBER   0010
??_AT89LP51RB2_                  NUMBER   000C
??_AT89LP51RC2_                  NUMBER   000D
??_AT89LP51RD2_                  NUMBER   000F
??_AT89LP51_                     NUMBER   0007
??_AT89LP52_                     NUMBER   0008
??_AT89LP6440_                   NUMBER   000B
??_AT89LP828_                    NUMBER   0009
??_AT89LS51_                     NUMBER   0019
??_AT89LS52_                     NUMBER   001A
??_AT89S2051_                    NUMBER   0012
??_AT89S4051_                    NUMBER   0013
??_AT89S51_                      NUMBER   0014
??_AT89S52_                      NUMBER   0015
??_AT89S53_                      NUMBER   0016
??_AT89S8252_                    NUMBER   0017
??_AT89S8253_                    NUMBER   0018
??_DEFAULT_                      NUMBER   0000
AABS                             CODE     138F      4841
AADD                             CODE     1741      5800
AANL                             CODE     1484      5127
AATAN                            CODE     11E0      4504
AATAN1                           CODE     11EE      4511
AC                               BIT        D6
AC1                              CODE     096C      2705
ACBYTE                           CODE     13AD      4886
ACC                              DATA       E0

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 162



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
ACKOK                            CODE     248F      8234
ACOS                             CODE     116D      4401
ADBYTE                           CODE     13B6      4898
ADCON                            NUMBER   00D8       515
ADDLP                            CODE     19F2      6554
ADDPTR                           CODE     05DE      1959
ADDPTR1                          CODE     05E6      1963
ADD_IN                           BIT        23      6361
ADD_R                            CODE     19F0      6552
ADIV                             CODE     140A      4985
AEL1                             CODE     1282      4641
AELP                             CODE     1270      4629
AEQ                              CODE     13DB      4947
AEQ1                             CODE     13DD      4948
AETOX                            CODE     1327      4762
AEXL                             CODE     134E      4785
AEXP                             CODE     132B      4765
AEXP1                            CODE     133D      4776
AFREE                            CODE     1711      5773
AGE                              CODE     13E7      4955
AGET                             CODE     14A9      5160
AGT                              CODE     13C5      4929
AGT1                             CODE     13C9      4931
AI1                              CODE     137A      4820
AI11                             CODE     1381      4825
AI2                              CODE     1382      4827
AI21                             CODE     138A      4833
AI3                              CODE     138E      4837
AINT                             CODE     136D      4809
AL                               CODE     0D4F      3486
AL1                              CODE     0D52      3487
AL2                              CODE     0D57      3489
AL3                              CODE     0D58      3490
ALE                              CODE     13EB      4958
ALEN                             CODE     1721      5782
ALN                              CODE     12C0      4696
ALN1                             CODE     12CD      4703
ALN11                            CODE     12EF      4725
ALNE                             CODE     12E5      4719
ALNL                             CODE     12D3      4709
ALNO                             CODE     12F8      4730
ALPAR                            CODE     13AC      4882
ALT                              CODE     13D6      4943
ALT1                             CODE     13D8      4944
AMUL                             CODE     11B0      4456
ANE                              CODE     13E1      4951
ANEG                             CODE     13A1      4870
ANOT                             CODE     1496      5143
ANU                              CODE     0D44      3480
AORL                             CODE     148D      5135
AP1                              CODE     14E5      5225
APCON                            CODE     14E9      5228
ARCAP2                           CODE     14DF      5217
ARG1_EXP_IS_LARGER               CODE     1A56      6653
ARG1_EXP_IS_LARGER1              CODE     1A57      6656
ARG1_EXP_IS_LARGER2              CODE     1A5A      6659
ARGF                             BIT        24       435
ARG_STACK                        NUMBER   0009      6330
ARG_STACK_PAGE                   NUMBER   0001      6331

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 163



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
ARND                             CODE     13F1      4964
ASGN                             CODE     1395      4853
ASIN                             CODE     1171      4410
ASIN1                            CODE     1187      4421
ASQR                             CODE     128D      4654
ASTKA                            NUMBER   0009       375
ASTKAH                           NUMBER   0001       540
ASUB                             CODE     171C      5779
AT2CON                           CODE     14D3      5206
ATAN                             CODE     11D0      4488
ATCON                            CODE     14D7      5211
ATIM0                            CODE     14C1      5190
ATIM1                            CODE     14C7      5194
ATIM2                            CODE     14CD      5198
ATIME                            CODE     1729      5787
ATMOD                            CODE     14DB      5214
ATTAB                            CODE     112A      4303
AXBYTE                           CODE     13BE      4909
AXBYTE1                          CODE     13C0      4914
AXRL                             CODE     1498      5145
AXTAL                            CODE     0FD9      4017
AXTAL0                           CODE     1657      5580
AXTAL1                           CODE     165C      5583
AXTAL2                           CODE     1679      5617
AXTAL3                           CODE     121F      4555
A_D                              CODE     1260      4613
A_IE                             CODE     14B9      5184
A_IP                             CODE     14BD      5187
B                                DATA       F0
B4800                            NUMBER   00B2       532
B9600                            NUMBER   00D9       533
BABC                             NUMBER   0027       487
BAUD19K                          NUMBER   FFB2      1427
BCHR                             CODE     082F      2487
BCHR1                            CODE     0835      2489
BCK                              CODE     078D      2338
BD                               BIT        DF       482
BELL                             NUMBER   0007       524
BG1                              CODE     0428      1429
BG3                              CODE     0467      1461
BI                               BIT        32       459
BO                               BIT        2C       453
BOFAH                            NUMBER   0013       395
BOFAL                            NUMBER   0014       396
BOTH_PLUS                        CODE     1A5E      6668
BR0                              CODE     07F1      2440
BR2                              CODE     083E      2493
BS                               NUMBER   0008       525
BUSY                             NUMBER   0004      8112
B_C                              CODE     0AA4      2944
B_TXA                            CODE     0F23      3877
B_TXA1                           CODE     0F2D      3882
C0                               CODE     0CF6      3432
C0C                              CODE     1025      4103
C0ORX1                           BIT        34       468
C1                               CODE     0CFD      3436
C1C                              CODE     1030      4109
C2                               CODE     0D06      3441
C2C                              CODE     102F      4107

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 164



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
C2_T2                            CODE     146C      5096
C3C                              CODE     1035      4113
CASB                             CODE     1E9E      7706
CASB2                            CODE     1EAD      7715
CASB4                            CODE     1EC0      7726
CASB5                            CODE     1EC2      7728
CASB6                            CODE     1ECB      7732
CBIAS                            CODE     167B      5619
CC1                              CODE     1844      5987
CCAL                             CODE     051C      1719
CCAL1                            CODE     052C      1736
CCLR3                            CODE     068C      2139
CCONT                            CODE     183E      5984
CERASE                           CODE     0500      1698
CILOOP                           CODE     080F      2467
CILOOP1                          CODE     0811      2468
CIUB                             BIT        1E       427
CI_RET                           CODE     07BE      2377
CI_RET1                          CODE     07BF      2378
CKS_B                            BIT        1A       419
CKS_I                            CODE     1F78      7956
CL1                              CODE     106F      4151
CL2                              CODE     1074      4154
CL3                              CODE     1092      4170
CL6                              CODE     1094      4172
CL7                              CODE     109D      4176
CLIST                            CODE     104E      4134
CLIST1                           CODE     106B      4148
CLN_UP                           CODE     0F17      3869
CLOCK_CFG                        NUMBER   00B9       202
CLOOP                            CODE     1A66      6680
CL_1                             CODE     067D      2127
CL_2                             CODE     068B      2137
CMND1                            CODE     1787      5855
CMND11                           CODE     17EB      5916
CMND3                            CODE     17C4      5894
CMND31                           CODE     17D1      5899
CMND5                            CODE     17DD      5905
CMNDD                            CODE     010F       711
CMNDLK                           CODE     0855      2506
CMNDR                            CODE     1794      5872
CMNDSP                           NUMBER   004D       509
CMNX                             CODE     179B      5876
CMNX1                            CODE     17A8      5882
CMPLK                            CODE     1208      4532
CN0                              CODE     0FFE      4072
CN0T                             CODE     101C      4096
CN0T1                            CODE     1005      4075
CN0T2                            CODE     1010      4084
CN0T3                            CODE     1012      4087
CN0T4                            CODE     101B      4095
CNEW                             CODE     065C      2092
CNEW1                            CODE     0662      2104
CNTRLC                           NUMBER   0003       526
CNTRLD                           NUMBER   0004       527
CNT_S                            BIT        35       469
CNULL                            CODE     0B08      3051
CNX                              CODE     0FF9      4064
COB                              BIT        1B       420

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 165



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
CONB                             BIT        17       416
CONST                            CODE     0FEF      4055
CONVERT                          NUMBER   0058      6333
CONVERT_ASCII_STRING_TO_BINARY   CODE     1E9E      7699
CONVERT_BINARY_TO_ASCII_STRING   CODE     1EF7      7774
CONVT                            XDATA    0050      8015
COUB                             BIT        1C       423
CPROG                            CODE     048A      1614
CPROG1                           CODE     048D      1616
CPROG2                           CODE     04B1      1634
CPS                              CODE     0EA9      3740
CR                               NUMBER   000D       522
CR0                              CODE     03EC      1283
CR1                              CODE     0400      1308
CR11                             CODE     0403      1309
CR2                              CODE     040C      1314
CR20                             CODE     0419      1320
CRAM                             CODE     177F      5843
CRLF                             CODE     06A5      2171
CRLF2                            CODE     06A3      2169
CROM                             CODE     053C      1755
CRP                              CODE     06AD      2180
CRS                              CODE     03E0      1277
CRS1                             CODE     03E5      1279
CRS2                             CODE     03E8      1280
CRST                             CODE     038B      1201
CRST1                            CODE     03A4      1236
CRST2                            CODE     03A7      1239
CRUN                             CODE     0802      2459
CS1                              CODE     0B47      3120
CSC                              CODE     0BBD      3204
CSETUP                           CODE     0B4B      3123
CSETUP1                          CODE     0B56      3129
CSTAKA                           CODE     142C      5026
CSTAKA2                          CODE     142A      5024
CSTKA                            NUMBER   0011       390
CSTKAH                           NUMBER   0000       541
CSTS                             CODE     07C8      2393
CSTS1                            CODE     07CE      2401
CSTS2                            CODE     07D4      2403
CSY                              CODE     0A1E      2842
CSY1                             CODE     0A2E      2854
CSY2                             CODE     0A3A      2862
CS_I                             CODE     1F7E      7959
CXFER                            CODE     1773      5829
CXTAL                            XDATA    0113      8028
CY                               BIT        D7
C_1                              CODE     0F12      3866
C_2                              CODE     0F0D      3863
C_BIT                            BIT        2E       455
C_EX                             CODE     07D7      2415
C_K                              CODE     0540      1762
C_TST                            CODE     0EC6      3767
D1                               CODE     05DC      1948
DACK                             BIT        96       473
DAPR                             NUMBER   00DA       516
DBTWO                            CODE     1194      4431
DC1                              CODE     1FF3      7997
DC10                             CODE     1FF0      7994

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 166



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
DC11                             CODE     1FF6      7998
DCMPX                            CODE     05CC      1936
DEC3210                          CODE     158B      5377
DEC3211                          CODE     158F      5379
DEC3212                          CODE     1590      5380
DEC76                            CODE     1647      5557
DEC77                            CODE     164C      5560
DECDP                            CODE     05C2      1918
DECDP1                           CODE     05C8      1921
DECDP2                           CODE     05C0      1916
DECX                             CODE     1D42      7406
DEC_ASTKA                        CODE     120B      4536
DEC_ASTKA1                       CODE     1212      4543
DEC_R                            CODE     1589      5374
DELAY                            CODE     24B9      8272
DELTST                           CODE     0EE1      3802
DELTST1                          CODE     0EE3      3803
DIGIT                            NUMBER   0004       550
DIGIT_CHECK                      CODE     1FED      7991
DIRF                             BIT        2F       456
DIV0                             CODE     1ABD      6790
DIV3                             CODE     1ACA      6799
DIV4                             CODE     1AD7      6807
DIV5                             CODE     1ADA      6810
DIV6                             CODE     1AE2      6815
DIV7                             CODE     1AF9      6837
DIV8                             CODE     1B0E      6850
DLD                              CODE     062B      2040
DONE_LOAD                        BIT        53      6365
DO_SFR                           CODE     2569      8364
DPH                              DATA       83
DPL                              DATA       82
DP_B                             CODE     0E9B      3732
DP_T                             CODE     0EA2      3736
DRQ                              BIT        31       458
DT1                              CODE     0EE8      3807
DTEMP                            CODE     184D      5993
DTYPE                            NUMBER   0003       544
DUBSUB                           CODE     0A02      2812
D_CHK                            CODE     0DCC      3567
D_L1                             CODE     0AF8      3029
D_UNDER                          CODE     1AC8      6797
E10X                             CODE     1FB5      7972
E11X                             CODE     1F89      7963
E14X                             CODE     1F81      7961
E15X                             CODE     1FA6      7968
E16X                             CODE     1F9A      7966
E1X                              CODE     1746      5810
E1XX                             CODE     1885      6035
E1XX1                            CODE     1887      6036
E1XX2                            CODE     188C      6039
E2X                              CODE     1751      5811
E3X                              CODE     1828      5973
E3XX                             CODE     09BD      2763
E4XX                             CODE     0BC1      3207
E4YY                             CODE     121A      4551
E5X                              CODE     1816      5971
E6X                              CODE     1761      5814
E7X                              CODE     1804      5968

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 167



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
EA                               BIT        AF
EATC                             CODE     0CE5      3416
EBIAS                            CODE     1261      4621
EIG                              CODE     036D      1193
EIGP                             CODE     0E4E      3646
EK                               CODE     0C0E      3270
ENDBIT                           BIT        29       450
EOF                              NUMBER   0001       539
EP1                              CODE     0F45      3919
EP2                              CODE     0F49      3922
EP21                             CODE     0F52      3926
EP22                             CODE     0F5B      3930
EP3                              CODE     0F6F      3941
EP4                              CODE     0F71      3943
EP41                             CODE     0F76      3946
EP42                             CODE     0F7B      3948
EP5                              CODE     0F82      3952
ER0                              CODE     1874      6025
ER1                              CODE     18B8      6072
ER2                              CODE     18C2      6081
ER3                              CODE     18D1      6089
ER31                             CODE     18EE      6102
ER4                              CODE     18FB      6109
ERA1                             CODE     050D      1705
ERAMEND                          NUMBER   03FF       557
ERL4                             CODE     0844      2497
ERPAR                            CODE     0CE3      3414
ERRLK                            CODE     04D6      1659
ERRLOC                           XDATA    0101      8020
ERRNUM                           XDATA    0102      8021
ERROR                            CODE     188F      6051
ERROR0                           CODE     189B      6058
ERROR01                          CODE     18A2      6061
ERROR1                           CODE     1890      6052
ERROR9                           CODE     24D0      8290
ERRS                             CODE     18AD      6066
ERS                              CODE     1FF8      8003
ES                               BIT        AC
ET0                              BIT        A9
ET1                              BIT        AB
EX0                              BIT        A8
EX1                              BIT        AA
EXA                              CODE     037B      1195
EXC                              CODE     0383      1197
EXI                              CODE     1836      5976
EXP1                             CODE     17F8      5936
EXP11                            CODE     17F2      5929
EXPONENTS_EQUAL                  CODE     1A5B      6662
EXPOT4                           CODE     1E16      7585
EXPOT5                           CODE     1E41      7614
EXPOTX                           CODE     1E14      7583
EXPOUT                           CODE     1E01      7570
EXPRB                            CODE     0F43      3917
E_FIND                           CODE     0A93      2934
F0                               BIT        D5
FCMP                             CODE     1202      4528
FDT1                             CODE     1D53      7420
FDT2                             CODE     1D5B      7424
FDTEST                           CODE     1D4F      7417

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 168



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
FINDC                            CODE     0EEE      3820
FINDCR                           CODE     0EEC      3818
FINISH1                          CODE     1D14      7371
FINISH2                          CODE     1D27      7387
FINISH_UP                        CODE     1D28      7389
FINISH_UP1                       CODE     1D2F      7394
FIRST_RADIX                      BIT        52      6364
FL1                              CODE     0AD3      2994
FL11                             CODE     0AD7      2998
FL2                              CODE     0AEC      3012
FL3                              CODE     0ADC      3001
FLOATING_ADD                     CODE     1993      6431
FLOATING_COMP                    CODE     1A43      6628
FLOATING_DIV                     CODE     1AB0      6775
FLOATING_MUL                     CODE     1A73      6696
FLOATING_POINT_INPUT             CODE     1CC2      7315
FLOATING_POINT_OUTPUT            CODE     1D7A      7465
FLOATING_SUB                     CODE     1989      6420
FMUL0                            CODE     1A78      6705
FMUL1                            CODE     1A7A      6709
FMUL2                            CODE     1A8C      6733
FMUL21                           CODE     1A8E      6734
FMUL3                            CODE     1A9D      6756
FMUL_OVER                        CODE     1A88      6719
FNDCL2                           CODE     0EF6      3826
FNDCL3                           CODE     0EFA      3829
FORMAT                           NUMBER   0017       399
FOUND_RADIX                      BIT        51      6363
FOV                              CODE     1A8A      6723
FPC1                             CODE     1BB5      7039
FPO1                             CODE     1D8C      7484
FPO2                             CODE     1D93      7491
FPO3                             CODE     1DA6      7504
FPONE                            CODE     16F2      5752
FPSIZ                            NUMBER   0006       549
FPT1                             XDATA    0119      8030
FPT2                             XDATA    011F      8032
FPTS                             CODE     104B      4126
FPTST                            CODE     1038      4115
FPTST1                           CODE     1045      4123
FP_ACC1                          NUMBER   0035      6383
FP_ACC2                          NUMBER   0036      6384
FP_ACC3                          NUMBER   0037      6385
FP_ACC4                          NUMBER   0038      6386
FP_ACC5                          NUMBER   0039      6387
FP_ACC6                          NUMBER   003A      6388
FP_ACC7                          NUMBER   003B      6389
FP_ACC8                          NUMBER   003C      6390
FP_ACCC                          NUMBER   0034      6382
FP_ACCS                          NUMBER   003D      6391
FP_ACCX                          NUMBER   0033      6381
FP_BASE                          CODE     196F      6405
FP_BASE1                         CODE     1971      6406
FP_BASE10                        CODE     1983      6415
FP_BASE11                        CODE     1985      6416
FP_BASE12                        CODE     1987      6417
FP_BASE2                         CODE     1973      6407
FP_BASE3                         CODE     1975      6408
FP_BASE4                         CODE     1977      6409

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 169



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
FP_BASE5                         CODE     1979      6410
FP_BASE6                         CODE     197B      6411
FP_BASE7                         CODE     197D      6412
FP_BASE8                         CODE     197F      6413
FP_BASE9                         CODE     1981      6414
FP_CARRY                         NUMBER   002A      6360
FP_CLEAR                         CODE     1BB2      7030
FP_DIG12                         NUMBER   002B      6366
FP_DIG34                         NUMBER   002C      6367
FP_DIG56                         NUMBER   002D      6368
FP_DIG78                         NUMBER   002E      6369
FP_EXP                           NUMBER   0030      6372
FP_NIB1                          NUMBER   002B      6373
FP_NIB2                          NUMBER   002C      6374
FP_NIB3                          NUMBER   002D      6375
FP_NIB4                          NUMBER   002E      6376
FP_NIB5                          NUMBER   002F      6377
FP_NIB6                          NUMBER   0030      6378
FP_NIB7                          NUMBER   0031      6379
FP_NIB8                          NUMBER   0032      6380
FP_NUMBER_SIZE                   NUMBER   0006      6342
FP_SIGN                          NUMBER   002F      6370
FP_STATUS                        NUMBER   0028      6358
FP_TEMP                          NUMBER   0029      6359
FREE                             CODE     1DD2      7539
FREE1                            CODE     1DD9      7544
FREE2                            CODE     1DF5      7563
FREE4                            CODE     1DED      7558
FRTEST                           CODE     1D4C      7415
FS                               CODE     13D0      4936
FSIZE                            NUMBER   0011       554
FSTK                             CODE     13CB      4933
FSUB10                           CODE     1A41      6624
FSUB5                            CODE     1A10      6584
FSUB6                            CODE     1A1B      6595
FSUB7                            CODE     1A1F      6598
FSUB8                            CODE     1A2A      6606
FSUB81                           CODE     1A2D      6607
FSUB9                            CODE     1A30      6612
FTYPE                            NUMBER   0001       542
FUL1                             CODE     15B0      5431
FULL                             CODE     15A8      5424
F_VAR                            CODE     0619      2027
F_VAR0                           CODE     0620      2031
F_VAR1                           CODE     0636      2048
F_VAR2                           CODE     0643      2059
G1                               CODE     058F      1857
G2                               CODE     05A2      1867
G3                               CODE     05A6      1870
G4                               CODE     05A9      1873
G5                               CODE     05AC      1875
GC                               CODE     0ECD      3779
GCI                              CODE     0ED5      3785
GCI1                             CODE     0ED7      3789
GCI11                            CODE     0EDE      3793
GETEND                           CODE     058A      1853
GETLIN                           CODE     058C      1855
GET_DIGIT_CHECK                  CODE     1FEB      7987
GET_DPTR_CHARACTER               CODE     1D5F      7438

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 170



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
GET_NUM                          CODE     1957      6211
GLN                              CODE     0AD1      2992
GT1                              CODE     1CEA      7346
GT11                             CODE     1CF2      7349
GT12                             CODE     1CF5      7350
GT2                              CODE     1D02      7359
GTB                              XDATA    0100      8019
GTEST                            CODE     1CDB      7339
GTRD                             BIT        18       417
GTX                              CODE     1547      5303
GTX1                             CODE     155A      5314
GTYPE                            NUMBER   0002       543
HC1                              CODE     1CB1      7298
HC11                             CODE     1CB4      7299
HEX2X                            CODE     1F3C      7899
HEXDO1                           CODE     1CA1      7283
HEXDON                           CODE     1CA0      7281
HEXOUT                           CODE     1F30      7887
HEXSC1                           CODE     1C8F      7270
HEXSCAN                          CODE     1C89      7261
HEX_CHECK                        CODE     1CA9      7290
HEX_CHECK1                       CODE     1CAE      7294
HMODE                            BIT        37       471
HOUT1                            CODE     1F48      7908
HOUTHI                           CODE     1F53      7916
HOUTLO                           CODE     1F54      7918
HS1                              CODE     1CA6      7287
H_RET                            CODE     196B      6247
I2                               CODE     123B      4584
I21                              CODE     1247      4591
I2CERRMSG                        CODE     24DB      8296
I2CERROR                         CODE     24C7      8285
I2CGET                           CODE     2492      8239
I2CPUT                           CODE     2462      8205
I2CSTART                         CODE     2440      8180
I2CSTOP                          CODE     2456      8194
IAN                              CODE     00F3       699
IAT                              CODE     090B      2650
IAT1                             CODE     090E      2651
IBCNT                            XDATA    0004      8012
IBLK                             CODE     193F      6193
IBLK1                            CODE     194E      6199
IBLN                             XDATA    0005      8013
IBUF                             XDATA    0007      8014
ICLR                             CODE     069A      2154
ICLR1                            CODE     069F      2160
IE                               DATA       A8
IE0                              BIT        89
IE1                              BIT        8B
IFIX                             CODE     1223      4562
IFIXL                            CODE     0E90      3714
IGC                              CODE     0ECB      3777
ILOOP                            CODE     0813      2472
ILOOP1                           CODE     081F      2476
IMOV                             CODE     1566      5328
IN2                              CODE     0DFD      3604
IN2A                             CODE     0E02      3607
IN3                              CODE     0E0F      3613
IN3A                             CODE     0E20      3623

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 171



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
IN5                              CODE     0E40      3638
IN6                              CODE     0E49      3642
INBIT                            BIT        1D       426
INC3210                          CODE     1576      5350
INC3211                          CODE     157B      5354
INC3212                          CODE     1580      5357
INCH1                            CODE     07AA      2358
INCH11                           CODE     07AF      2360
INCH12                           CODE     07B4      2362
INCH13                           CODE     07BB      2370
INCHAR                           CODE     0791      2347
INCHAR1                          CODE     0799      2350
INCHAR2                          CODE     07A1      2353
INC_AND_GET_DPTR_CHARACTER       CODE     1D5E      7434
INC_ASTKA                        CODE     124F      4598
INC_FP_EXP                       CODE     1B72      6953
INERR                            CODE     1D44      7408
INL0                             CODE     06D6      2214
INL1                             CODE     06DD      2219
INL11                            CODE     06E6      2223
INL2                             CODE     06D3      2212
INL2B                            CODE     06EC      2228
INL2B1                           CODE     06F2      2231
INL2B2                           CODE     06F5      2232
INL6                             CODE     06FE      2238
INLINE                           CODE     06D8      2216
INLOOP                           CODE     1CD0      7331
INLPIK                           CODE     1CD8      7336
INLX                             CODE     06E8      2225
INPROG                           BIT        11       410
INP_B                            BIT        22       433
INS                              CODE     0103       703
INSR                             CODE     1517      5271
INSR1                            CODE     1523      5278
INT0                             BIT        B2
INT1                             BIT        B3
INTBIT                           BIT        12       411
INTERR                           CODE     0F30      3894
INTERR1                          CODE     0F32      3895
INTERX                           CODE     0938      2676
INTERX1                          CODE     093B      2678
INTERX2                          CODE     0941      2680
INTERX3                          CODE     0948      2683
INTERX4                          CODE     094D      2685
INTGER                           CODE     0F35      3898
INTGRC                           BIT        19      6334
INTLOC                           XDATA    0120      8033
INTPEN                           BIT        16       415
INTXAH                           NUMBER   0042       499
INTXAL                           NUMBER   0043       500
IP                               DATA       B8
IPROGS                           XDATA    012A      8043
IRAMTOP                          NUMBER   00FF       517
ISAV                             BIT        2B       452
ISHIGH                           CODE     2450      8188
ISTA0                            CODE     0950      2687
ISTA01                           CODE     095A      2691
ISTA1                            CODE     095C      2693
ISTAT                            CODE     08F8      2641

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 172



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
ISTAT1                           CODE     0900      2644
ISTAX                            CODE     091C      2659
ISTAX1                           CODE     0921      2662
ISTAY                            CODE     0925      2666
ISTAY1                           CODE     0928      2667
ISTAY2                           CODE     092D      2669
IST_CAL                          CODE     09E7      2797
IT0                              BIT        88
IT1                              BIT        8A
ITRAP                            CODE     086A      2528
ITRAP1                           CODE     0872      2533
ITRAP2                           CODE     087A      2538
ITRAP21                          CODE     087D      2539
ITRAP3                           CODE     0882      2547
ITRET                            CODE     0F40      3904
I_DL                             CODE     185B      6003
I_DR                             CODE     1902      6119
I_L                              CODE     0849      2500
I_PI                             CODE     0E95      3721
I_RET                            CODE     1871      6020
I_S                              CODE     0933      2673
I_S1                             CODE     0936      2674
I_T0                             BIT        26       437
L20DPI                           CODE     0573      1803
L31DPI                           CODE     05BA      1903
LCLR                             CODE     05E7      1967
LDPTRI                           CODE     05B0      1887
LD_A                             CODE     0FE9      4045
LD_T                             CODE     0582      1830
LEFT                             CODE     1BF3      7099
LEFT1                            CODE     1BF5      7105
LEFT2                            CODE     1BF6      7106
LEFT3                            CODE     1BFD      7111
LEFT5                            CODE     1C1C      7138
LEFTL                            CODE     1C08      7120
LEFTL1                           CODE     1C1B      7136
LF                               NUMBER   000A       523
LIN1                             CODE     155C      5316
LINE                             CODE     14F0      5244
LINE0                            CODE     14ED      5242
LINE1                            CODE     150B      5261
LINEB                            BIT        15       414
LINLEN                           NUMBER   0049       538
LMOV                             CODE     156D      5344
LNTAB                            CODE     16A9      5657
LN_D                             CODE     131B      4748
LOAD1                            CODE     19AD      6467
LOAD2                            CODE     19BD      6479
LOAD21                           CODE     19C5      6486
LOAD22                           CODE     19CA      6492
LOAD23                           CODE     19CE      6495
LOAD25                           CODE     19E3      6543
LOAD7                            CODE     1B93      6985
LOADR1                           CODE     1C7F      7250
LOADR1_MANTISSA                  CODE     1C7B      7241
LOAD_POINTERS                    CODE     1C5E      7196
LP                               BIT        97       472
LPB                              BIT        19       418
LTOUT1                           CODE     074A      2301

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 173



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
LTX                              CODE     1528      5284
LTX1                             CODE     152F      5289
LTX2                             CODE     1543      5300
L_RET                            CODE     0EEB      3809
MDES1                            CODE     1C6A      7218
MEMTOP                           XDATA    010A      8025
MILLIV                           NUMBER   0047       503
MNL0                             CODE     1C3E      7170
MNL1                             CODE     1C50      7182
MNLOOP                           CODE     1C35      7162
MOUT                             CODE     1E8E      7684
MSIGN                            BIT        78      6371
MT1                              NUMBER   0045       501
MT2                              NUMBER   0046       502
MT_ALL                           XDATA    0108      8024
MU1                              CODE     136B      4801
MUL11                            CODE     1EEF      7765
MULNUM                           CODE     1ED6      7743
MULNUM10                         CODE     1ED3      7739
MULX                             CODE     1EF6      7772
MUL_DIV_EXP_AND_SIGN             CODE     1C68      7209
MUL_NIBBLE                       CODE     1C2B      7148
MUL_UNDERFLOW                    BIT        28       446
N4                               CODE     0BC6      3210
NACK                             NUMBER   0008      8113
NL1                              CODE     1E6E      7654
NLC                              CODE     077A      2328
NLC1                             CODE     077F      2330
NLC2                             CODE     0782      2331
NLC3                             CODE     0786      2333
NMARK_L                          CODE     1A96      6739
NMOV                             CODE     159D      5406
NMOV1                            CODE     15A7      5414
NOGO                             CODE     056E      1798
NOPASS                           CODE     0F21      3874
NOROM                            CODE     1FC9      7974
NO_C                             BIT        30       457
NR1                              CODE     1E77      7663
NTWO                             CODE     1161      4368
NULL                             NUMBER   0000       528
NULLCT                           NUMBER   0015       397
NUMC                             CODE     0C19      3277
NUMC1                            CODE     0C22      3282
NUM_LT                           CODE     1E67      7648
NUM_RT                           CODE     1E70      7657
ONE                              CODE     0E8E      3708
ON_ERR                           BIT        13       412
OOPS                             CODE     0D3A      3466
OPBOL                            CODE     00CF       657
OPTAB                            CODE     0057       581
OTI                              BIT        14       413
OTS                              BIT        10       409
OTST                             CODE     1938      6180
OTST1                            CODE     193E      6185
OUTPUT                           CODE     196C      6395
OUTR                             CODE     1E5C      7637
OUTR0                            CODE     1E4B      7623
OV                               BIT        D2
OVE1                             CODE     1B98      6996

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 174



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
OVERFLOW                         NUMBER   0001      6344
OVERFLOW_AND_EXIT                CODE     1B94      6989
P                                BIT        D0
P0                               DATA       80
P1                               DATA       90
P2                               DATA       A0
P3                               DATA       B0
PACK                             CODE     1B11      6854
PACK0                            CODE     1B1A      6867
PACK1                            CODE     1B1B      6869
PACK11                           CODE     1B23      6874
PACK2                            CODE     1B25      6876
PACK3                            CODE     1B37      6890
PACK31                           CODE     1B38      6891
PACK4                            CODE     1B4F      6914
PAREN_INT                        CODE     0E97      3727
PCL                              CODE     1439      5041
PCON                             DATA       87
PCON0                            NUMBER   0087       510
PG1                              CODE     04BD      1645
PG10                             CODE     04BC      1643
PG101                            CODE     04B5      1638
PG2                              CODE     04C3      1649
PG31                             CODE     04F7      1682
PG4                              CODE     04C0      1647
PG5                              CODE     04CB      1654
PG6                              CODE     04D0      1657
PG7                              CODE     04D9      1662
PG8                              CODE     046F      1471
PGR                              CODE     04B3      1636
PGU                              CODE     04F8      1686
PHEAD                            NUMBER   0016       398
PIE                              CODE     17FE      5955
PIPI                             CODE     147F      5118
PLNEXP                           CODE     1430      5029
PLOOP                            CODE     1B51      6918
PLUS_MINUS_TEST                  CODE     1D65      7447
PMT1                             CODE     1D79      7461
PMT11                            CODE     1D6A      7451
PMT12                            CODE     1D6F      7453
PMT13                            CODE     1D74      7455
PMT2                             CODE     1D77      7457
PMT3                             CODE     1D78      7459
PMTOP                            CODE     164F      5570
PMTOP1                           CODE     1652      5571
PN0                              CODE     06C3      2198
PN01                             CODE     06CC      2202
PN02                             CODE     06CD      2203
PN1                              CODE     06B9      2189
POLY1                            CODE     11A3      4448
POLYC                            CODE     119B      4439
POPAS                            CODE     0FD3      4014
POP_AND_EXIT                     CODE     19A5      6458
POP_T1                           CODE     1448      5056
POSNM1                           CODE     1D24      7384
POSNUM                           CODE     1D21      7381
POTWO                            CODE     1192      4429
PP                               CODE     15BA      5447
PPL                              CODE     15CD      5458

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 175



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
PPL1                             CODE     15D2      5461
PPL2                             CODE     15D7      5466
PPL21                            CODE     15DC      5469
PPL22                            CODE     15E1      5471
PPL3                             CODE     15F0      5483
PPL4                             CODE     15F5      5489
PPL41                            CODE     15FE      5498
PPL6                             CODE     1622      5522
PPL61                            CODE     162B      5527
PPL7                             CODE     162F      5530
PPL71                            CODE     1630      5531
PPL9                             CODE     1643      5543
PPL91                            CODE     1644      5544
PPLX                             CODE     1609      5507
PPLY                             CODE     1616      5513
PPLY1                            CODE     161B      5518
PPX                              CODE     15E5      5474
PRET                             CODE     1B71      6951
PRNTCR                           CODE     06C1      2196
PROGS                            XDATA    0128      8037
PS                               BIT        BC
PSTART                           NUMBER   0200       553
PSW                              DATA       D0
PT0                              BIT        B9
PT1                              BIT        BB
PTIME                            CODE     0709      2256
PUSHAS                           CODE     0FDD      4024
PUSHC                            CODE     1433      5037
PUSHCS                           CODE     0BB1      3195
PUSHCS1                          CODE     0BB6      3197
PUSHCS2                          CODE     0BBC      3202
PUSHR2R0                         CODE     1CB6      7302
PUSH_ONE                         CODE     1443      5051
PUSH_T1                          CODE     144F      5062
PUSH_T11                         CODE     1451      5065
PUSH_T12                         CODE     1453      5067
PX0                              BIT        B8
PX1                              BIT        BA
P_E                              CODE     0CDF      3411
P_T2                             CODE     1456      5070
P_Z                              CODE     1375      4817
QUIT                             CODE     24C6      8281
R0B0                             NUMBER   0000       362
R1B0                             NUMBER   0001       363
R2B0                             NUMBER   0002       364
R3B0                             NUMBER   0003       365
R3CK                             CODE     09D5      2779
R4B0                             NUMBER   0004       366
R5B0                             NUMBER   0005       367
R6B0                             NUMBER   0006       368
R76S                             CODE     0DEF      3585
R7B0                             NUMBER   0007       369
RB8                              BIT        9A
RC1                              CODE     066F      2112
RC2                              CODE     0673      2115
RCAPH2                           NUMBER   00CB       513
RCAPL2                           NUMBER   00CA       514
RCASB                            CODE     1ECF      7735
RCELL                            XDATA    010C      8026

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 176



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
RCL                              CODE     0885      2548
RCL1                             CODE     088A      2556
RCL2                             CODE     0892      2563
RCL3                             CODE     0898      2567
RCL4                             CODE     089E      2571
RCL5                             CODE     08A4      2575
RCL6                             CODE     08AA      2579
RCLEAR                           CODE     0664      2106
RD                               BIT        B7
RDSFR                            CODE     2519      8311
RDYS                             CODE     00FD       701
READ                             CODE     2494      8240
RECIP                            CODE     127C      4637
REN                              BIT        9C
RETBIT                           BIT        25       436
RET_X                            CODE     1D46      7410
RF1                              CODE     055E      1785
RF2                              CODE     0565      1791
RF3                              CODE     056B      1796
RFX                              CODE     0564      1789
RI                               BIT        98
RIGHT                            CODE     1BBB      7046
RIGHT1                           CODE     1BBD      7053
RIGHT2                           CODE     1BBE      7054
RIGHT3                           CODE     1BC5      7061
RIGHT5                           CODE     1BE4      7087
RIGHTL                           CODE     1BD1      7071
RIGHTL1                          CODE     1BE3      7085
RL1                              CODE     0AF4      3025
RLINE                            CODE     0AF2      3023
RMOV                             CODE     1581      5369
RO1                              CODE     0543      1770
RO11                             CODE     054E      1776
ROMADR                           NUMBER   8000       545
ROMFD                            CODE     055B      1783
ROM_P                            CODE     06AF      2182
ROM_P1                           CODE     06B7      2187
ROUT                             CODE     1E92      7687
RROM                             CODE     07C0      2386
RS0                              BIT        D3
RS1                              BIT        D4
RSUB1                            CODE     1EF9      7844
RSUB2                            CODE     1F23      7873
RSUB3                            CODE     1F2D      7880
RTST                             CODE     0AC7      2975
RTST1                            CODE     0AD0      2983
RTXAH                            NUMBER   0012       391
RTXAL                            NUMBER   0010       389
RV                               CODE     11B5      4461
RXD                              BIT        B0
S0RELH                           NUMBER   00BA       512
S0RELL                           NUMBER   00AA       511
S13                              CODE     0D3D      3468
S20DP                            CODE     1424      5011
S31DP                            CODE     0605      1996
S31DP2                           CODE     0603      1994
S31L                             CODE     170E      5771
SA                               CODE     0D1B      3453
SA1                              CODE     0D22      3456

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 177



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
SA2                              CODE     0D26      3458
SAFE_MOD                         NUMBER   00A1       203
SAVE_T                           NUMBER   004A       506
SBAUD                            CODE     16F9      5761
SBUF                             DATA       99
SCALL                            CODE     0E63      3666
SCL                              BIT        95      8101
SCLHIGH                          CODE     24BA      8276
SCLOCK                           CODE     1918      6138
SCLR                             CODE     068F      2143
SCON                             DATA       98
SC_R                             CODE     192D      6158
SD0                              CODE     0D5C      3494
SD01                             CODE     0D59      3492
SDA                              BIT        96      8100
SDI                              CODE     0DBC      3558
SDIMX                            CODE     0D61      3497
SE0                              CODE     0CBE      3377
SE1                              CODE     199F      6452
SEND                             CODE     2472      8217
SERR1                            CODE     18B3      6069
SETFSYS                          CODE     0437      1441
SETREG                           CODE     1253      4605
SETREG1                          CODE     1254      4606
SETSCL                           CODE     24BC      8277
SETSDA                           CODE     2445      8182
SF2                              CODE     0A53      2882
SF21                             CODE     0A56      2884
SF3                              CODE     0A72      2899
SFOR                             CODE     0A3C      2870
SFRERRMSG                        CODE     24F6      8299
SFRERROR                         CODE     250E      8302
SFRGETTAB                        CODE     2588      8390
SFRPUTTAB                        CODE     2586      8389
SGOSUB                           CODE     0B2D      3099
SGOTO                            CODE     0AAA      2955
SGS0                             CODE     0B2F      3101
SGS1                             CODE     0B35      3105
SGT1                             CODE     0AAC      2957
SGT11                            CODE     0AB7      2963
SGT2                             CODE     0AB9      2965
SGT21                            CODE     0AC1      2968
SIF                              CODE     0A86      2927
SIF1                             CODE     0A90      2932
SIGNS_DIFFERENT                  CODE     1A53      6648
SIN0                             CODE     11FC      4518
SINOUT                           CODE     1E8B      7681
SINPUT                           CODE     0DF5      3598
SINTAB                           CODE     16CE      5707
SLET                             CODE     096E      2714
SLET0                            CODE     09C2      2766
SLET1                            CODE     09C6      2769
SLET2                            CODE     09C8      2771
SM                               CODE     0C5F      3328
SM0                              BIT        9F
SM01                             CODE     0C6D      3334
SM02                             CODE     0C71      3336
SM1                              BIT        9E
SM2                              BIT        9D

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 178



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
SNEXT                            CODE     0B5F      3140
SONERR                           CODE     140F      4990
SONEXT                           CODE     1419      5002
SOT                              CODE     0E56      3652
SOUT                             CODE     1E9A      7693
SOUT1                            CODE     1E9C      7695
SOUT_1                           CODE     1F46      7906
SP                               DATA       81
SP0                              CODE     0C3C      3306
SP1                              CODE     0C43      3311
SP2                              CODE     0C3F      3308
SP4                              CODE     0C47      3314
SP6                              CODE     0C52      3320
SP7                              CODE     0C57      3323
SP8                              CODE     0C75      3339
SP9                              CODE     0CD7      3398
SP9A                             CODE     0CDE      3403
SPACE7                           CODE     1E78      7665
SPEOP                            CODE     09D9      2782
SPEOP1                           CODE     09DD      2784
SPH0                             CODE     0C29      3292
SPH1                             CODE     0C2B      3294
SPINT                            BIT        1F       430
SPOP                             CODE     0A7D      2914
SPOP1                            CODE     0A85      2919
SPRINT                           CODE     0C2D      3296
SPRINT1                          CODE     0C31      3298
SPRINT2                          CODE     0C38      3303
SPSAV                            NUMBER   003E       495
SPUSH                            CODE     0A76      2908
SPV                              XDATA    0124      8035
SP_H                             NUMBER   004B       507
SP_L                             NUMBER   004C       508
SQ                               CODE     0C7C      3343
SQR1                             CODE     12A3      4667
SQR2                             CODE     12AA      4674
SQR4                             CODE     12AD      4679
SQR41                            CODE     12BE      4688
SQ_ERR                           CODE     128A      4646
SR0                              CODE     0B14      3076
SR01                             CODE     0B24      3086
SRD                              CODE     0BE9      3248
SRD0                             CODE     0BE5      3245
SRD1                             CODE     0BF2      3253
SRD2                             CODE     0BF4      3255
SRD21                            CODE     0BFE      3260
SRD4                             CODE     0BFF      3262
SRD5                             CODE     0C06      3266
SRD51                            CODE     0C09      3267
SRD6                             CODE     0C11      3272
SREAD                            CODE     0BE3      3243
SRESTR                           CODE     0BCE      3220
SRESTR1                          CODE     0BD0      3221
SRETI                            CODE     0B0E      3065
SRETRN                           CODE     0B10      3073
SRT                              CODE     1219      4549
SS                               CODE     0D12      3448
SS7                              CODE     1E89      7679
SSOOP                            CODE     099D      2742

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 179



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
SSTOP                            CODE     0858      2513
SSTOP0                           CODE     0860      2517
STACKTP                          NUMBER   00FE       518
STATD                            CODE     0123       736
STATUS                           NUMBER   0018      8103
STDIG                            CODE     1D38      7401
STDIG1                           CODE     1D47      7412
STEROT                           CODE     070F      2272
STESIZ                           NUMBER   0009       551
STJ                              CODE     0020       305
STK                              CODE     0041       348
STONE                            CODE     1686      5633
STONE1                           CODE     168B      5640
STOPBIT                          BIT        20       431
STORE2                           CODE     1B69      6943
STORE_ALIGN_TEST_AND_EXIT        CODE     1B63      6933
STP                              CODE     00EE       697
STQ                              CODE     0033       340
STRING                           CODE     060C      2007
STRIP                            CODE     11DA      4494
STR_AL                           XDATA    0122      8034
STS                              CODE     003E       346
STU                              CODE     0044       351
ST_A                             CODE     0FE5      4035
ST_ALL                           XDATA    0106      8023
SUBLP                            CODE     19FB      6563
SUI                              CODE     192E      6162
SUNTIL                           CODE     0B01      3042
SUO                              CODE     1933      6172
SWAP_AND_EXIT                    CODE     199B      6445
SWAP_ASTKA                       CODE     145A      5075
SWHILE                           CODE     0AFC      3038
SX                               CODE     0C81      3346
SX1                              CODE     0C97      3355
S_0                              CODE     0982      2725
S_1                              CODE     09B2      2756
S_11                             CODE     09BA      2760
S_3                              CODE     0991      2735
S_4                              CODE     099F      2744
S_41                             CODE     09A6      2747
S_5                              CODE     09AD      2753
S_C                              CODE     0EBF      3755
S_C_1                            CODE     0E72      3678
S_DO                             CODE     0F05      3851
S_E                              CODE     098C      2731
S_L                              CODE     1461      5085
S_LEN                            NUMBER   003F       496
S_N                              CODE     1FD3      7981
S_ON                             CODE     0CEB      3422
S_WU                             CODE     0B03      3044
T0                               BIT        B4
T1                               BIT        B5
T2CON                            NUMBER   00C8       196
T2MOD                            NUMBER   00C9       201
TB                               CODE     15B5      5434
TB8                              BIT        9B
TBR                              CODE     1599      5394
TBYTE                            CODE     1596      5391
TCON                             DATA       88

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 180



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
TEMP1                            NUMBER   000B       380
TEMP2                            NUMBER   000C       381
TEMP3                            NUMBER   000D       382
TEMP4                            NUMBER   000E       383
TEMP5                            NUMBER   000F       384
TEMPD                            CODE     1854      5997
TEMP_COMP                        CODE     131C      4752
TEROT                            CODE     0711      2274
TEROT01                          CODE     0717      2277
TEROT02                          CODE     071E      2280
TEROT03                          CODE     0727      2284
TEROT04                          CODE     072F      2287
TEROT1                           CODE     0766      2316
TEROT11                          CODE     076C      2319
TEROT2                           CODE     0773      2323
TEST_USER                        CODE     17E0      5910
TF0                              BIT        8D
TF1                              BIT        8F
TH0                              DATA       8C
TH1                              DATA       8D
TH2                              NUMBER   00CD       198
THREE                            CODE     0E78      3684
TI                               BIT        99
TIMER_LOAD                       CODE     052D      1740
TIMER_LOAD1                      CODE     052F      1745
TIV                              XDATA    0126      8036
TL0                              DATA       8A
TL1                              DATA       8B
TL2                              NUMBER   00CC       197
TMOD                             DATA       89
TMR0                             NUMBER   00C8      1086
TMR1                             NUMBER   00C9      1090
TMR2                             NUMBER   00CA      1094
TM_TOP                           XDATA    012C      8047
TOKENTABLE                       CODE     240C      8147
TOKTAB                           CODE     0175       784
TOUT                             NUMBER   0002      8111
TR                               CODE     1913      6128
TR0                              BIT        8C
TR1                              BIT        8E
TRC2                             NUMBER   00CE      1114
TT2C                             NUMBER   00CB      1102
TTC                              NUMBER   00CC      1106
TTIME                            CODE     1167      4386
TTM                              NUMBER   00CD      1110
TVH                              NUMBER   0048       504
TVL                              NUMBER   0049       505
TWO                              CODE     0E85      3697
TWOL                             CODE     14A1      5153
TWO_EX                           CODE     14B3      5172
TWO_EY                           CODE     14B4      5175
TWO_R2                           CODE     14B1      5169
TXAH                             NUMBER   000A       376
TXAL                             NUMBER   0008       374
TXD                              BIT        B1
TXX                              CODE     075F      2312
T_1                              CODE     073A      2292
T_ADD                            NUMBER   00E3       967
T_ASC                            NUMBER   00D1      1126

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 181



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
T_BIT                            BIT        92       481
T_BUF                            CODE     176C      5818
T_CHR                            NUMBER   00D3      1136
T_CMND                           NUMBER   00F0      1140
T_CMP                            CODE     07E3      2429
T_CR                             NUMBER   00AA       936
T_DATA                           NUMBER   009C       884
T_DIR                            NUMBER   0090       848
T_DP                             CODE     0EB8      3749
T_ELSE                           NUMBER   00A8       928
T_EQU                            NUMBER   00EA       989
T_F1                             CODE     0A9E      2940
T_GOSB                           NUMBER   009F       894
T_GOTO                           NUMBER   0083       799
T_HH                             NUMBER   0040       497
T_IE                             NUMBER   00C6      1078
T_IP                             NUMBER   00C7      1082
T_L                              CODE     196C      6396
T_LAST                           NUMBER   00A4       910
T_LL                             NUMBER   0041       498
T_LPAR                           NUMBER   00E0       957
T_MTOP                           NUMBER   00C4      1074
T_NEG                            NUMBER   00E9       987
T_P1                             NUMBER   00CF      1118
T_PC                             NUMBER   00D0      1122
T_REM                            NUMBER   0096       865
T_SPC                            NUMBER   00A9       932
T_STEP                           NUMBER   00A7       924
T_STOP                           NUMBER   0090       844
T_SUB                            NUMBER   00E5       974
T_T                              CODE     08B0      2589
T_T01                            CODE     08BE      2596
T_T1                             CODE     08CE      2603
T_T2                             CODE     08DF      2620
T_TAB                            NUMBER   00A4       912
T_THEN                           NUMBER   00A5       916
T_TIME                           NUMBER   00C5      1098
T_TO                             NUMBER   00A6       920
T_TRAP                           CODE     08E5      2626
T_ULAST                          NUMBER   00BE      1053
T_UOP                            NUMBER   00B0      1009
T_USE                            NUMBER   00D2      1130
T_XTAL                           NUMBER   00C3      1070
T_X_S                            CODE     0B39      3108
U3                               CODE     0C9B      3358
U4                               CODE     0C9F      3361
U5                               CODE     0CA9      3366
U5A                              CODE     0CC0      3379
U6                               CODE     0CCD      3391
U7                               CODE     0CCF      3393
U8                               CODE     0CC9      3388
U8A                              CODE     0CC4      3383
U8B                              CODE     0CC6      3385
UBIT                             BIT        2A       451
UE                               CODE     1513      5266
ULOOP                            CODE     1B82      6971
UNDERFLOW                        NUMBER   0000      6343
UNDERFLOW_AND_EXIT               CODE     1BA5      7008
UNDER_MD                         CODE     1B4D      6909

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 182



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
UNPACK_R0                        CODE     1B7E      6964
UOPBOL                           CODE     00E0       676
UPB                              BIT        27       438
UPP0                             CODE     10AE      4207
UPP01                            CODE     10B1      4208
UPP02                            CODE     10BC      4214
UPP03                            CODE     10C1      4216
UPP04                            CODE     10C6      4218
UPP1                             CODE     10DD      4232
UPP11                            CODE     10E3      4235
UPP1A                            CODE     10D9      4229
UPP2                             CODE     10EC      4239
UPP3                             CODE     1101      4252
UPP4                             CODE     110D      4260
UPP41                            CODE     1115      4264
UPP42                            CODE     1119      4266
UPP7                             CODE     1121      4272
UPP7A                            CODE     111F      4270
UPP8                             CODE     1123      4274
UPP81                            CODE     1125      4276
UPP9                             CODE     10CD      4222
UPP91                            CODE     10D5      4226
UPPL                             CODE     10A3      4187
UPPL0                            CODE     10A0      4178
UPRNT                            CODE     06BF      2194
UP_2                             CODE     10F7      4246
UP_3                             CODE     10FA      4248
UP_4                             CODE     10FD      4249
USENT                            CODE     0047       562
USING0                           CODE     1DB0      7510
USING1                           CODE     1DB6      7515
USING2                           CODE     1DC8      7528
USINGX                           CODE     1DC6      7526
USINGY                           CODE     1DC3      7523
U_ID1                            CODE     1860      6010
U_IDL                            BIT        21       432
U_RET                            CODE     1E4A      7621
V4                               CODE     0DB4      3553
VAR                              CODE     0D65      3500
VAR1                             CODE     0D67      3502
VAR11                            CODE     0D71      3507
VAR2                             CODE     0D9A      3534
VARB                             CODE     0A0D      2828
VARCOP                           CODE     1472      5108
VARD                             CODE     0A10      2830
VARTOP                           XDATA    0104      8022
VAR_ER                           CODE     0F01      3841
VECTORTABLE                      CODE     2400      8138
VX                               CODE     0D80      3521
VY                               CODE     0D74      3511
V_C                              CODE     1474      5110
WCR                              CODE     0EFC      3831
WE                               CODE     0F41      3907
WR                               BIT        B6
WRSFR                            CODE     2541      8339
X3120                            CODE     0DAD      3545
X31DP                            CODE     0579      1816
XBILT                            CODE     0FB8      3992
XBILT1                           CODE     0FC2      3996

C51ASM V1.2            Copyright (c) 2009 Atmel Corp.           PAGE 183



SYMBOL                           TYPE     VALUE     LINE
--------------------------------------------------------
XBIT                             BIT        2D       454
XLPAR                            CODE     0FC4      3998
XOP                              CODE     0F86      3957
XOP1                             CODE     0F90      3962
XOP11                            CODE     0FA3      3973
XOP12                            CODE     0FAD      3981
XOP2                             CODE     0FAF      3985
XOP3                             CODE     0FCA      4002
XOUT0                            CODE     1E23      7593
XOUT2                            CODE     1E28      7597
XOUT3                            CODE     1E30      7602
XOUT4                            CODE     1E34      7606
XPOP                             CODE     0FD1      4006
XSIGN                            BIT        50      6362
XTALV                            CODE     17EC      5922
XXI                              CODE     0B67      3145
XXI1                             CODE     0B76      3155
XXI2                             CODE     0BAB      3182
XXI3                             CODE     0BAF      3184
X_TR                             CODE     0BD6      3227
Z7R7                             CODE     1E80      7671
ZERO                             NUMBER   0002      6345
ZERO7                            CODE     1E81      7673
ZERO_AND_EXIT                    CODE     1BAB      7019
ZERO_DIVIDE                      NUMBER   0003      6346
ZOUT                             CODE     1E96      7690
ZRO                              CODE     04E0      1668
ZSURP                            BIT        36       470
ZT0                              CODE     1E5F      7641
ZT1                              CODE     1E66      7646
ZTEST                            CODE     1E5D      7639
